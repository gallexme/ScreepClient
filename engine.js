var globalWorkersBlob = (function(){ var d = "var global = self; var Reflect = {global: global};\n";
 d += "!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i=\"function\"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error(\"Cannot find module '\"+g+\"'\");throw j.code=\"MODULE_NOT_FOUND\",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f=\"function\"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e={};try{e=a(\"./local-config\")}catch(f){}d.merge(e,{redis:{port:6379,host:\"127.0.0.1\",options:{}}}),b.exports=e},{\"./local-config\":34,lodash:60}],2:[function(a,b,c){\"use strict\";function d(a){for(var b in a)\"_\"!=b[0]?e.isArray(a[b])?a[b].forEach(d):e.isObject(a[b])&&d(a[b]):delete a[b]}var e=(a(\"q\"),a(\"./local-storage\"),a(\"lodash\")),f=a(\"./message-mux\");b.exports=function(a){var b=[],c=[],g=[];return{update:function(a,c){c=e.cloneDeep(c),d(c),e.isObject(a)&&(e.merge(a,c),a=a._id),b.push({_id:a,data:c})},insert:function(a){a=e.cloneDeep(a),d(a),c.push(a)},remove:function(a){g.push(a)},execute:function(){return f.sendMessage({type:\"bulk\",storage:a,updates:b,inserts:c,removes:g})}}}},{\"./local-storage\":7,\"./message-mux\":8,lodash:9,q:10}],3:[function(a,b,c){\"use strict\";b.exports={localStorage:{PENDING_QUEUE:\"pendingQueue_\",PROCESSING_QUEUE:\"processingQueue_\",USERS:\"users\",USERS_CODE:\"users.code.activeSim\",USERS_MEMORY:\"users.memory\",TRANSACTIONS:\"transactions\",ROOMS:\"rooms\",ROOMS_OBJECTS:\"rooms.objects\",ROOMS_FLAGS:\"rooms.flags\",ROOMS_TERRAIN:\"rooms.terrain\",ROOMS_INTENTS:\"rooms.intents\",GAME_TIME:\"gametime\",RUN_TIMESTAMP:\"runTimestamp\",GAME_INFO:\"gameinfo\",REPLAY:\"replay\"}}},{}],4:[function(a,b,c){\"use strict\";b.exports={OK:0,ERR_NOT_OWNER:-1,ERR_NO_PATH:-2,ERR_NAME_EXISTS:-3,ERR_BUSY:-4,ERR_NOT_FOUND:-5,ERR_NOT_ENOUGH_ENERGY:-6,ERR_NOT_ENOUGH_RESOURCES:-6,ERR_INVALID_TARGET:-7,ERR_FULL:-8,ERR_NOT_IN_RANGE:-9,ERR_INVALID_ARGS:-10,ERR_TIRED:-11,ERR_NO_BODYPART:-12,ERR_NOT_ENOUGH_EXTENSIONS:-6,ERR_RCL_NOT_ENOUGH:-14,ERR_GCL_NOT_ENOUGH:-15,FIND_EXIT_TOP:1,FIND_EXIT_RIGHT:3,FIND_EXIT_BOTTOM:5,FIND_EXIT_LEFT:7,FIND_EXIT:10,FIND_CREEPS:101,FIND_MY_CREEPS:102,FIND_HOSTILE_CREEPS:103,FIND_SOURCES_ACTIVE:104,FIND_SOURCES:105,FIND_DROPPED_ENERGY:106,FIND_DROPPED_RESOURCES:106,FIND_STRUCTURES:107,FIND_MY_STRUCTURES:108,FIND_HOSTILE_STRUCTURES:109,FIND_FLAGS:110,FIND_CONSTRUCTION_SITES:111,FIND_MY_SPAWNS:112,FIND_HOSTILE_SPAWNS:113,FIND_MY_CONSTRUCTION_SITES:114,FIND_HOSTILE_CONSTRUCTION_SITES:115,FIND_MINERALS:116,FIND_NUKES:117,TOP:1,TOP_RIGHT:2,RIGHT:3,BOTTOM_RIGHT:4,BOTTOM:5,BOTTOM_LEFT:6,LEFT:7,TOP_LEFT:8,COLOR_RED:1,COLOR_PURPLE:2,COLOR_BLUE:3,COLOR_CYAN:4,COLOR_GREEN:5,COLOR_YELLOW:6,COLOR_ORANGE:7,COLOR_BROWN:8,COLOR_GREY:9,COLOR_WHITE:10,LOOK_CREEPS:\"creep\",LOOK_ENERGY:\"energy\",LOOK_RESOURCES:\"resource\",LOOK_SOURCES:\"source\",LOOK_MINERALS:\"mineral\",LOOK_STRUCTURES:\"structure\",LOOK_FLAGS:\"flag\",LOOK_CONSTRUCTION_SITES:\"constructionSite\",LOOK_NUKES:\"nuke\",LOOK_TERRAIN:\"terrain\",OBSTACLE_OBJECT_TYPES:[\"spawn\",\"creep\",\"wall\",\"source\",\"constructedWall\",\"extension\",\"link\",\"storage\",\"tower\",\"observer\",\"powerSpawn\",\"powerBank\",\"lab\",\"terminal\",\"nuker\"],MOVE:\"move\",WORK:\"work\",CARRY:\"carry\",ATTACK:\"attack\",RANGED_ATTACK:\"ranged_attack\",TOUGH:\"tough\",HEAL:\"heal\",CLAIM:\"claim\",BODYPART_COST:{move:50,work:100,attack:80,carry:50,heal:250,ranged_attack:150,tough:10,claim:600},WORLD_WIDTH:142,WORLD_HEIGHT:142,CREEP_LIFE_TIME:1500,CREEP_CLAIM_LIFE_TIME:500,CREEP_CORPSE_RATE:.2,CARRY_CAPACITY:50,HARVEST_POWER:2,HARVEST_MINERAL_POWER:1,REPAIR_POWER:100,DISMANTLE_POWER:50,BUILD_POWER:5,ATTACK_POWER:30,UPGRADE_CONTROLLER_POWER:1,RANGED_ATTACK_POWER:10,HEAL_POWER:12,RANGED_HEAL_POWER:4,REPAIR_COST:.01,DISMANTLE_COST:.005,RAMPART_DECAY_AMOUNT:300,RAMPART_DECAY_TIME:100,RAMPART_HITS:1,RAMPART_HITS_MAX:{2:3e5,3:1e6,4:3e6,5:1e7,6:3e7,7:1e8,8:3e8},ENERGY_REGEN_TIME:300,ENERGY_DECAY:1e3,SPAWN_HITS:5e3,SPAWN_ENERGY_START:300,SPAWN_ENERGY_CAPACITY:300,CREEP_SPAWN_TIME:3,SPAWN_RENEW_RATIO:1.2,SOURCE_ENERGY_CAPACITY:3e3,SOURCE_ENERGY_NEUTRAL_CAPACITY:1500,SOURCE_ENERGY_KEEPER_CAPACITY:4e3,WALL_HITS:1,WALL_HITS_MAX:3e8,EXTENSION_HITS:1e3,EXTENSION_ENERGY_CAPACITY:{0:50,1:50,2:50,3:50,4:50,5:50,6:50,7:100,8:200},ROAD_HITS:5e3,ROAD_WEAROUT:1,ROAD_DECAY_AMOUNT:100,ROAD_DECAY_TIME:1e3,LINK_HITS:1e3,LINK_HITS_MAX:1e3,LINK_CAPACITY:800,LINK_COOLDOWN:1,LINK_LOSS_RATIO:.03,STORAGE_CAPACITY:1e6,STORAGE_HITS:1e4,STRUCTURE_SPAWN:\"spawn\",STRUCTURE_EXTENSION:\"extension\",STRUCTURE_ROAD:\"road\",STRUCTURE_WALL:\"constructedWall\",STRUCTURE_RAMPART:\"rampart\",STRUCTURE_KEEPER_LAIR:\"keeperLair\",STRUCTURE_PORTAL:\"portal\",STRUCTURE_CONTROLLER:\"controller\",STRUCTURE_LINK:\"link\",STRUCTURE_STORAGE:\"storage\",STRUCTURE_TOWER:\"tower\",STRUCTURE_OBSERVER:\"observer\",STRUCTURE_POWER_BANK:\"powerBank\",STRUCTURE_POWER_SPAWN:\"powerSpawn\",STRUCTURE_EXTRACTOR:\"extractor\",STRUCTURE_LAB:\"lab\",STRUCTURE_TERMINAL:\"terminal\",STRUCTURE_CONTAINER:\"container\",STRUCTURE_NUKER:\"nuker\",CONSTRUCTION_COST:{spawn:15e3,extension:3e3,road:300,constructedWall:1,rampart:1,link:5e3,storage:3e4,tower:5e3,observer:8e3,powerSpawn:1e5,extractor:5e3,lab:5e4,terminal:1e5,container:5e3,nuker:1e5},CONSTRUCTION_COST_ROAD_SWAMP_RATIO:5,CONTROLLER_LEVELS:{1:200,2:45e3,3:135e3,4:405e3,5:1215e3,6:3645e3,7:10935e3},CONTROLLER_STRUCTURES:{spawn:{0:0,1:1,2:1,3:1,4:1,5:1,6:1,7:2,8:3},extension:{0:0,1:0,2:5,3:10,4:20,5:30,6:40,7:50,8:60},link:{1:0,2:0,3:0,4:0,5:2,6:3,7:4,8:6},road:{0:2500,1:2500,2:2500,3:2500,4:2500,5:2500,6:2500,7:2500,8:2500},constructedWall:{1:0,2:2500,3:2500,4:2500,5:2500,6:2500,7:2500,8:2500},rampart:{1:0,2:2500,3:2500,4:2500,5:2500,6:2500,7:2500,8:2500},storage:{1:0,2:0,3:0,4:1,5:1,6:1,7:1,8:1},tower:{1:0,2:0,3:1,4:1,5:2,6:2,7:3,8:6},observer:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:1},powerSpawn:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:1},extractor:{1:0,2:0,3:0,4:0,5:0,6:1,7:1,8:1},terminal:{1:0,2:0,3:0,4:0,5:0,6:1,7:1,8:1},lab:{1:0,2:0,3:0,4:0,5:0,6:3,7:6,8:10},container:{0:5,1:5,2:5,3:5,4:5,5:5,6:5,7:5,8:5},nuker:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:1}},CONTROLLER_DOWNGRADE:{1:2e4,2:5e3,3:1e4,4:2e4,5:4e4,6:6e4,7:1e5,8:15e4},CONTROLLER_CLAIM_DOWNGRADE:.2,CONTROLLER_RESERVE:1,CONTROLLER_RESERVE_MAX:5e3,CONTROLLER_MAX_UPGRADE_PER_TICK:15,CONTROLLER_ATTACK_BLOCKED_UPGRADE:1e3,CONTROLLER_NUKE_BLOCKED_UPGRADE:200,SAFE_MODE_DURATION:2e4,SAFE_MODE_COOLDOWN:5e4,SAFE_MODE_COST:1e3,TOWER_HITS:3e3,TOWER_CAPACITY:1e3,TOWER_ENERGY_COST:10,TOWER_POWER_ATTACK:600,TOWER_POWER_HEAL:400,TOWER_POWER_REPAIR:800,TOWER_OPTIMAL_RANGE:5,TOWER_FALLOFF_RANGE:20,TOWER_FALLOFF:.75,OBSERVER_HITS:500,OBSERVER_RANGE:10,POWER_BANK_HITS:2e6,POWER_BANK_CAPACITY_MAX:5e3,POWER_BANK_CAPACITY_MIN:500,POWER_BANK_CAPACITY_CRIT:.3,POWER_BANK_DECAY:5e3,POWER_BANK_HIT_BACK:.5,POWER_SPAWN_HITS:5e3,POWER_SPAWN_ENERGY_CAPACITY:5e3,POWER_SPAWN_POWER_CAPACITY:100,POWER_SPAWN_ENERGY_RATIO:50,EXTRACTOR_HITS:500,EXTRACTOR_COOLDOWN:5,LAB_HITS:500,LAB_MINERAL_CAPACITY:3e3,LAB_ENERGY_CAPACITY:2e3,LAB_BOOST_ENERGY:20,LAB_BOOST_MINERAL:30,LAB_COOLDOWN:10,LAB_REACTION_AMOUNT:5,GCL_POW:2.4,GCL_MULTIPLY:1e6,GCL_NOVICE:3,MODE_SIMULATION:\"simulation\",MODE_SURVIVAL:\"survival\",MODE_WORLD:\"world\",MODE_ARENA:\"arena\",TERRAIN_MASK_WALL:1,TERRAIN_MASK_SWAMP:2,TERRAIN_MASK_LAVA:4,MAX_CONSTRUCTION_SITES:100,MAX_CREEP_SIZE:50,MINERAL_REGEN_TIME:5e4,MINERAL_MIN_AMOUNT:{H:35e3,O:35e3,L:35e3,K:35e3,Z:35e3,U:35e3,X:35e3},MINERAL_RANDOM_FACTOR:2,MINERAL_DENSITY:{1:15e3,2:35e3,3:7e4,4:1e5},MINERAL_DENSITY_PROBABILITY:{1:.1,2:.5,3:.9,4:1},MINERAL_DENSITY_CHANGE:.05,DENSITY_LOW:1,DENSITY_MODERATE:2,DENSITY_HIGH:3,DENSITY_ULTRA:4,TERMINAL_CAPACITY:3e5,TERMINAL_HITS:3e3,TERMINAL_SEND_COST:.1,TERMINAL_MIN_SEND:100,CONTAINER_HITS:25e4,CONTAINER_CAPACITY:2e3,CONTAINER_DECAY:5e3,CONTAINER_DECAY_TIME:100,CONTAINER_DECAY_TIME_OWNED:500,NUKER_HITS:1e3,NUKER_COOLDOWN:1e5,NUKER_ENERGY_CAPACITY:3e5,NUKER_GHODIUM_CAPACITY:5e3,NUKE_LAND_TIME:5e4,NUKE_RANGE:10,NUKE_DAMAGE:{0:1e7,2:5e6},PORTAL_DECAY:3e4,ORDER_SELL:\"sell\",ORDER_BUY:\"buy\",MARKET_FEE:.05,FLAGS_LIMIT:1e4,SUBSCRIPTION_TOKEN:\"token\",RESOURCE_ENERGY:\"energy\",RESOURCE_POWER:\"power\",RESOURCE_HYDROGEN:\"H\",RESOURCE_OXYGEN:\"O\",RESOURCE_UTRIUM:\"U\",RESOURCE_LEMERGIUM:\"L\",RESOURCE_KEANIUM:\"K\",RESOURCE_ZYNTHIUM:\"Z\",RESOURCE_CATALYST:\"X\",RESOURCE_GHODIUM:\"G\",RESOURCE_HYDROXIDE:\"OH\",RESOURCE_ZYNTHIUM_KEANITE:\"ZK\",RESOURCE_UTRIUM_LEMERGITE:\"UL\",RESOURCE_UTRIUM_HYDRIDE:\"UH\",RESOURCE_UTRIUM_OXIDE:\"UO\",RESOURCE_KEANIUM_HYDRIDE:\"KH\",RESOURCE_KEANIUM_OXIDE:\"KO\",RESOURCE_LEMERGIUM_HYDRIDE:\"LH\",RESOURCE_LEMERGIUM_OXIDE:\"LO\",RESOURCE_ZYNTHIUM_HYDRIDE:\"ZH\",RESOURCE_ZYNTHIUM_OXIDE:\"ZO\",RESOURCE_GHODIUM_HYDRIDE:\"GH\",RESOURCE_GHODIUM_OXIDE:\"GO\",RESOURCE_UTRIUM_ACID:\"UH2O\",RESOURCE_UTRIUM_ALKALIDE:\"UHO2\",RESOURCE_KEANIUM_ACID:\"KH2O\",RESOURCE_KEANIUM_ALKALIDE:\"KHO2\",RESOURCE_LEMERGIUM_ACID:\"LH2O\",RESOURCE_LEMERGIUM_ALKALIDE:\"LHO2\",RESOURCE_ZYNTHIUM_ACID:\"ZH2O\",RESOURCE_ZYNTHIUM_ALKALIDE:\"ZHO2\",RESOURCE_GHODIUM_ACID:\"GH2O\",RESOURCE_GHODIUM_ALKALIDE:\"GHO2\",RESOURCE_CATALYZED_UTRIUM_ACID:\"XUH2O\",RESOURCE_CATALYZED_UTRIUM_ALKALIDE:\"XUHO2\",RESOURCE_CATALYZED_KEANIUM_ACID:\"XKH2O\",RESOURCE_CATALYZED_KEANIUM_ALKALIDE:\"XKHO2\",RESOURCE_CATALYZED_LEMERGIUM_ACID:\"XLH2O\",RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE:\"XLHO2\",RESOURCE_CATALYZED_ZYNTHIUM_ACID:\"XZH2O\",RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE:\"XZHO2\",RESOURCE_CATALYZED_GHODIUM_ACID:\"XGH2O\",RESOURCE_CATALYZED_GHODIUM_ALKALIDE:\"XGHO2\",REACTIONS:{H:{O:\"OH\",L:\"LH\",K:\"KH\",U:\"UH\",Z:\"ZH\",G:\"GH\"},O:{H:\"OH\",L:\"LO\",K:\"KO\",U:\"UO\",Z:\"ZO\",G:\"GO\"},Z:{K:\"ZK\",H:\"ZH\",O:\"ZO\"},L:{U:\"UL\",H:\"LH\",O:\"LO\"},K:{Z:\"ZK\",H:\"KH\",O:\"KO\"},G:{H:\"GH\",O:\"GO\"},U:{L:\"UL\",H:\"UH\",O:\"UO\"},OH:{UH:\"UH2O\",UO:\"UHO2\",ZH:\"ZH2O\",ZO:\"ZHO2\",KH:\"KH2O\",KO:\"KHO2\",LH:\"LH2O\",LO:\"LHO2\",GH:\"GH2O\",GO:\"GHO2\"},X:{UH2O:\"XUH2O\",UHO2:\"XUHO2\",LH2O:\"XLH2O\",LHO2:\"XLHO2\",KH2O:\"XKH2O\",KHO2:\"XKHO2\",ZH2O:\"XZH2O\",ZHO2:\"XZHO2\",GH2O:\"XGH2O\",GHO2:\"XGHO2\"},ZK:{UL:\"G\"},UL:{ZK:\"G\"},LH:{OH:\"LH2O\"},ZH:{OH:\"ZH2O\"},GH:{OH:\"GH2O\"},KH:{OH:\"KH2O\"},UH:{OH:\"UH2O\"},LO:{OH:\"LHO2\"},ZO:{OH:\"ZHO2\"},KO:{OH:\"KHO2\"},UO:{OH:\"UHO2\"},GO:{OH:\"GHO2\"},LH2O:{X:\"XLH2O\"},KH2O:{X:\"XKH2O\"},ZH2O:{X:\"XZH2O\"},UH2O:{X:\"XUH2O\"},GH2O:{X:\"XGH2O\"},LHO2:{X:\"XLHO2\"},UHO2:{X:\"XUHO2\"},KHO2:{X:\"XKHO2\"},ZHO2:{X:\"XZHO2\"},GHO2:{X:\"XGHO2\"}},BOOSTS:{work:{UO:{harvest:4},UHO2:{harvest:6},XUHO2:{harvest:8},LH:{build:1.5,repair:1.5},LH2O:{build:1.8,repair:1.8},XLH2O:{build:2,repair:2},ZH:{dismantle:2},ZH2O:{dismantle:3},XZH2O:{dismantle:4},GH:{upgradeController:1.5},GH2O:{upgradeController:1.8},XGH2O:{upgradeController:2}},attack:{UH:{attack:2},UH2O:{attack:3},XUH2O:{attack:4}},ranged_attack:{KO:{rangedAttack:2,rangedMassAttack:2},KHO2:{rangedAttack:3,rangedMassAttack:3},XKHO2:{rangedAttack:4,rangedMassAttack:4}},heal:{LO:{heal:2,rangedHeal:2},LHO2:{heal:3,rangedHeal:3},XLHO2:{heal:4,rangedHeal:4}},carry:{KH:{capacity:2},KH2O:{capacity:3},XKH2O:{capacity:4}},move:{ZO:{fatigue:2},ZHO2:{fatigue:3},XZHO2:{fatigue:4}},tough:{GO:{damage:.7},GHO2:{damage:.5},XGHO2:{damage:.3}}},PORTAL_UNSTABLE:864e6,PORTAL_MIN_TIMEOUT:10368e5,PORTAL_MAX_TIMEOUT:19008e5,POWER_BANK_RESPAWN_TIME:5e4,INVADERS_ENERGY_GOAL:1e5},b.exports.BODYPARTS_ALL=[b.exports.MOVE,b.exports.WORK,b.exports.CARRY,b.exports.ATTACK,b.exports.RANGED_ATTACK,b.exports.TOUGH,b.exports.HEAL,b.exports.CLAIM],b.exports.RESOURCES_ALL=[b.exports.RESOURCE_ENERGY,b.exports.RESOURCE_POWER,b.exports.RESOURCE_HYDROGEN,b.exports.RESOURCE_OXYGEN,b.exports.RESOURCE_UTRIUM,b.exports.RESOURCE_KEANIUM,b.exports.RESOURCE_LEMERGIUM,b.exports.RESOURCE_ZYNTHIUM,b.exports.RESOURCE_CATALYST,b.exports.RESOURCE_GHODIUM,b.exports.RESOURCE_HYDROXIDE,b.exports.RESOURCE_ZYNTHIUM_KEANITE,b.exports.RESOURCE_UTRIUM_LEMERGITE,b.exports.RESOURCE_UTRIUM_HYDRIDE,b.exports.RESOURCE_UTRIUM_OXIDE,b.exports.RESOURCE_KEANIUM_HYDRIDE,b.exports.RESOURCE_KEANIUM_OXIDE,b.exports.RESOURCE_LEMERGIUM_HYDRIDE,b.exports.RESOURCE_LEMERGIUM_OXIDE,b.exports.RESOURCE_ZYNTHIUM_HYDRIDE,b.exports.RESOURCE_ZYNTHIUM_OXIDE,b.exports.RESOURCE_GHODIUM_HYDRIDE,b.exports.RESOURCE_GHODIUM_OXIDE,b.exports.RESOURCE_UTRIUM_ACID,b.exports.RESOURCE_UTRIUM_ALKALIDE,b.exports.RESOURCE_KEANIUM_ACID,b.exports.RESOURCE_KEANIUM_ALKALIDE,b.exports.RESOURCE_LEMERGIUM_ACID,b.exports.RESOURCE_LEMERGIUM_ALKALIDE,b.exports.RESOURCE_ZYNTHIUM_ACID,b.exports.RESOURCE_ZYNTHIUM_ALKALIDE,b.exports.RESOURCE_GHODIUM_ACID,b.exports.RESOURCE_GHODIUM_ALKALIDE,b.exports.RESOURCE_CATALYZED_UTRIUM_ACID,b.exports.RESOURCE_CATALYZED_UTRIUM_ALKALIDE,b.exports.RESOURCE_CATALYZED_KEANIUM_ACID,b.exports.RESOURCE_CATALYZED_KEANIUM_ALKALIDE,b.exports.RESOURCE_CATALYZED_LEMERGIUM_ACID,b.exports.RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE,b.exports.RESOURCE_CATALYZED_ZYNTHIUM_ACID,b.exports.RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE,b.exports.RESOURCE_CATALYZED_GHODIUM_ACID,b.exports.RESOURCE_CATALYZED_GHODIUM_ALKALIDE],b.exports.COLORS_ALL=[b.exports.COLOR_RED,b.exports.COLOR_PURPLE,b.exports.COLOR_BLUE,b.exports.COLOR_CYAN,b.exports.COLOR_GREEN,b.exports.COLOR_YELLOW,b.exports.COLOR_ORANGE,b.exports.COLOR_BROWN,b.exports.COLOR_GREY,b.exports.COLOR_WHITE]},{}],5:[function(a,b,c){\"use strict\";var d=a(\"q\");c.saveTick=function(a,b,c){return d.when()},c.get=function(a){return d.when()},c.upload=function(a,b,c){return d.when()},c.del=function(a){return d.when()}},{q:10}],6:[function(require,module,exports){\"use strict\";function EvalCodeError(a){this.toString=function(){return a}}!function(){exports.constants=require(\"./constants\");var a=require(\"lodash\"),b=require(\"q\"),c=require(\"events\").EventEmitter,d=require(\"./config\"),e=require(\"./local-storage\"),f=require(\"./bulk\"),g=require(\"./workers\"),h=require(\"./message-mux\"),i={0:[],1:[],2:[]},j=b.defer(),k=(new Date).getTime(),l=require(\"../utils\");exports.config=new c,Object.assign(exports.config,{mainLoopMinDuration:void 0,mainLoopResetInterval:1e4,mainLoopCustomStage:function(){return b.when()},customIntentTypes:{}}),self.onmessage=function(a){\"setTickPeriod\"==a.data.type?j.resolve(a.data.period):\"worker\"==a.data.type?g.handleMessage(a.data):a.data.consoleCommand?i[a.data.userId].push({expression:a.data.consoleCommand}):h.handleMessage(a.data)},setInterval(function(){e.get(d.localStorage.RUN_TIMESTAMP).then(function(a){a>k&&self.close()})},1e3),exports.queue=require(\"./queue\"),exports.connect=function(a){return(\"main\"==a?j.promise.then(function(a){return exports.config.mainLoopMinDuration=parseInt(a)}):b.when()).then(function(){return b.all([e.initArray(d.localStorage.USERS),e.initArray(d.localStorage.ROOMS,[{_id:\"sim\"}]),e.initArray(d.localStorage.ROOMS_OBJECTS),e.initArray(d.localStorage.ROOMS_FLAGS),e.initArray(d.localStorage.ROOMS_INTENTS)])})},exports.setupRunner=function(){},exports.setupProcessor=function(){},exports.setupMain=function(){},exports.getUserData=function(b){return e.get(d.localStorage.USERS).then(function(c){var d=new Object({user:a.find(d[0],function(a){return a._id==b}),cpu:1/0});return d})},exports.getRuntimeData=function(c){return b.all([e.get(d.localStorage.USERS),e.get(d.localStorage.USERS_CODE).then(function(b){return a.find(b,function(a){return a._id==c})}),e.get(d.localStorage.ROOMS_OBJECTS),e.get(d.localStorage.ROOMS),e.get(d.localStorage.GAME_TIME),e.get(d.localStorage.ROOMS_TERRAIN),e.get(d.localStorage.USERS_MEMORY).then(function(b){return a.find(b,function(a){return a._id==c})}),e.get(d.localStorage.GAME_INFO),e.get(d.localStorage.TRANSACTIONS),e.get(d.localStorage.ROOMS_FLAGS)]).then(function(b){var d={};b[5].forEach(function(a){for(var b,c=new Uint8Array(2500),e=0;2500>e;e++)b=a.terrain.charAt(e),c[e]=Number(b);d[a.room]=c}),b[9].forEach(function(a){return a.room=\"sim\"});var b=new Object({user:a.find(b[0],function(a){return a._id==c}),users:exports.mapById(b[0]),userCode:b[1]&&b[1].modules,userCodeTimestamp:b[1]&&b[1].timestamp||0,userObjects:exports.mapById(a.filter(b[2],function(a){return a.user==c})),roomObjects:exports.mapById(b[2]),flags:a.filter(b[9],function(a){return a.user==c}),rooms:exports.mapById(b[3]),time:b[4],consoleCommands:i[c],userMemory:b[6].memory,cpu:1/0,games:{sim:b[7]},transactions:{incoming:b[8],outgoing:b[8]},market:{orders:{all:{}},myOrders:[]},staticTerrainData:d,sim:!0});return i[c]=[],b})},exports.initUserRoomVisibility=function(){return b.when()},exports.setUserRoomVisibility=function(a,c){return b.when()},exports.resetUserRoomVisibility=function(a){return b.when()},exports.getAllUsers=function(){return e.get(d.localStorage.USERS)},exports.restartAllRuntimes=function(){return b.when()},exports.makeRuntime=function(a,c){return exports.getRuntimeData(a,c).then(function(c){var d=g.create(\"runtime\"),e=b.defer(),f=!1,i={type:\"timeout\",timeout:5e3};return h.sendMessage(i).then(function(){f||(d.terminate(),e.reject(\"Script execution has been terminated\"))}),d.onmessage=function(b){\"done\"==b.data.type&&(f=!0,h.sendMessage({type:\"clearTimeout\",timeoutTransactionId:i.transactionId}),b.data.intents&&(b.data.intents=l.storeIntents(a,b.data.intents,c)),e.resolve(b.data)),\"error\"==b.data.type&&(f=!0,h.sendMessage({type:\"clearTimeout\",timeoutTransactionId:i.transactionId}),b.data.intents&&(b.data.intents=l.storeIntents(a,b.data.intents,c)),e.reject(b.data))},d.postMessage(c),e.promise})[\"catch\"](function(a){return\"error\"==a.type?b.reject(a):b.reject({type:\"reject\"})})},exports.saveUserMemory=function(b,c){return e.get(d.localStorage.USERS_MEMORY).then(function(f){var g=a.find(f,function(a){return a._id==b});return g.memory=c,e.put(d.localStorage.USERS_MEMORY,f)})},exports.saveUserIntents=function(b,c){return e.get(d.localStorage.ROOMS_INTENTS).then(function(f){for(var g in c)if(\"notify\"!=g){var h=a.find(f,{room:g});h||f.push(h={room:g}),h.users=h.users||{},h.users[b]=h.users[b]||{objects:{}},a.merge(h.users[b].objects,c[g])}return e.put(d.localStorage.ROOMS_INTENTS,f)})},exports.getAllRooms=function(){return e.get(d.localStorage.ROOMS)},exports.getRoomIntents=function(b){return e.get(d.localStorage.ROOMS_INTENTS).then(function(c){return a.find(c,{room:b})})},exports.getRoomObjects=function(a){return e.get(d.localStorage.ROOMS_OBJECTS).then(function(a){return exports.mapById(a)})},exports.getRoomFlags=function(a){return e.get(d.localStorage.ROOMS_FLAGS)},exports.getRoomTerrain=function(a){return e.get(d.localStorage.ROOMS_TERRAIN).then(function(a){return exports.mapById(a)})},exports.bulkObjectsWrite=function(){return f(d.localStorage.ROOMS_OBJECTS)},exports.bulkFlagsWrite=function(){return f(d.localStorage.ROOMS_FLAGS)},exports.bulkUsersWrite=function(){return f(d.localStorage.USERS)},exports.bulkTransactionsWrite=function(){return f(d.localStorage.TRANSACTIONS)},exports.bulkRoomsWrite=function(){return f(d.localStorage.ROOMS_FLAGS)},exports.clearRoomIntents=function(b){return e.get(d.localStorage.ROOMS_INTENTS).then(function(c){return a.remove(c,{room:b}),e.put(d.localStorage.ROOMS_INTENTS,c)})},exports.mapById=function(b){return a.reduce(b,function(a,b){return a[b._id.toString()]=b,a},{})},exports.notifyRoomsDone=function(){return h.sendMessage({type:\"roomsDone\"})},exports.sendConsoleMessages=function(a,b){self.postMessage({type:\"console\",userId:a,messages:b})},exports.sendConsoleError=function(a,b){\"undefined\"!=typeof self,self.postMessage({type:\"console\",userId:a,error:\"\"+b})},exports.getGameTime=function(){return e.get(d.localStorage.GAME_TIME).then(parseInt)},exports.incrementGameTime=function(){return e.get(d.localStorage.GAME_TIME).then(function(a){return a++,e.put(d.localStorage.GAME_TIME,a)})},exports.getGameInfo=function(){return e.get(d.localStorage.GAME_INFO)},exports.saveGameInfo=function(a,b){return e.get(d.localStorage.REPLAY).then(function(c){return c.log[a.score]=l.getDiff(c.current,b),c.current=b,e.put(d.localStorage.REPLAY,c)}).then(function(){return e.put(d.localStorage.GAME_INFO,a)})},exports.getInterRoom=function(){return b.when()},exports.saveRoomInfo=function(a,c){return b.when(null)},exports.updateAccessibleRoomsList=function(){return b.when(null)},exports.sendNotification=function(){return b.when(null)},exports.getRoomStatsUpdater=function(){return{inc:function(){},save:function(){return b.when(null)}}},exports.roomsStatsSave=function(){return b.when(null)},exports.commitDbBulk=function(){return b.when(null)},exports.notifyTickStarted=function(){return b.when(null)},exports.getMapGridData=function(){return{}},exports.mapViewSave=function(){return b.when(null)},exports.getRoomInfo=function(){return b.when({})},exports.bulkUsersMoney=function(){return{execute:function(){return b.when()}}},exports.bulkUsersResources=function(){return{execute:function(){return b.when()}}},exports.bulkMarketOrders=function(){return{execute:function(){return b.when()}}},exports.history=require(\"./history\"),exports.pathFinder=require(\"./path-finder\")}(),exports.evalCode=function(module,globals,returnValue){var window,self,process,exports=module.exports,scopeInject=\"\";for(var i in globals)scopeInject+=i+\" = __globals.\"+i+\", \";module.name=module.name.replace(/[^a-zA-Z0-9_]+/g,\"\");try{if(returnValue)return eval(\"(function __run_\"+module.name+\"(__globals){ var \"+scopeInject+\"globals = undefined, __result = \"+module.code+\";\\n return __result; \\n}).call(global, globals);\");\"__mainLoop\"!=module.name&&(module.code=\"module.__initGlobals = function() { \"+scopeInject.replace(/,/g,\";\")+\" }; \"+module.code),eval(\"(function __run_\"+module.name+\"(__globals){ var \"+scopeInject+\"globals = undefined; \"+module.code+\" \\n}).call(global, globals);\")}catch(e){if(e instanceof EvalCodeError)throw e;var message=\"\";if(/at Object\\.exports\\.evalCode /.test(e.stack)){message=e.stack,message=message.replace(/at __run_([^ ]+) /g,\"at $1 \"),message=message.replace(/</g,\"&lt;\");var strip=[\"Object\\\\.eval\",\"Object\\\\.exports\\\\.evalCode\",\"Object\\\\.exports\\\\.runCode\",\"requireFn\"];strip.forEach(function(a){var b=new RegExp(\" *at \"+a+\" [^\\n]*?\\n\",\"g\");message=message.replace(b,\"\")}),message=message.replace(/ *at .*?$/,\"\"),message=message.replace(/ \\([^\\n]*\\:(\\d+)\\:(\\d+)\\)\\n/g,\":$1:$2\\n\"),message=message.replace(/_console\\d+:\\d+/g,\"console\")}else message=e.message;throw new EvalCodeError(message)}}},{\"../utils\":148,\"./bulk\":2,\"./config\":3,\"./constants\":4,\"./history\":5,\"./local-storage\":7,\"./message-mux\":8,\"./path-finder\":11,\"./queue\":12,\"./workers\":15,events:149,lodash:9,q:10}],7:[function(a,b,c){\"use strict\";var d=(a(\"q\"),a(\"./message-mux\"));c.put=function(a,b){return d.sendMessage({type:\"localStorage\",put:{key:a,value:b}}).then(function(a){return a.put.value})},c.get=function(a){return d.sendMessage({type:\"localStorage\",get:{key:a}}).then(function(a){return a.get.value})},c.initArray=function(a,b){return c.get(a).then(function(d){return d?void 0:c.put(a,b||[])})}},{\"./message-mux\":8,q:10}],8:[function(a,b,c){\"use strict\";var d=a(\"q\"),e={},f=0;c.sendMessage=function(a){return f++,e[f]=d.defer(),a.transactionId=f,self.postMessage(a),e[f].promise},c.handleMessage=function(a){e[a.transactionId]&&(a.reject?e[a.transactionId].reject(a):e[a.transactionId].resolve(a),delete e[a.transactionId])}},{q:10}],9:[function(a,b,c){(function(a){(function(){function d(a,b){if(a!==b){var c=null===a,d=a===z,e=a===a,f=null===b,g=b===z,h=b===b;if(a>b&&!f||!e||c&&!g&&h||d&&h)return 1;if(b>a&&!c||!h||f&&!d&&e||g&&e)return-1}return 0}function e(a,b,c){for(var d=a.length,e=c?d:-1;c?e--:++e<d;)if(b(a[e],e,a))return e;return-1}function f(a,b,c){if(b!==b)return q(a,c);for(var d=c-1,e=a.length;++d<e;)if(a[d]===b)return d;return-1}function g(a){return\"function\"==typeof a||!1}function h(a){return null==a?\"\":a+\"\"}function i(a,b){for(var c=-1,d=a.length;++c<d&&b.indexOf(a.charAt(c))>-1;);return c}function j(a,b){for(var c=a.length;c--&&b.indexOf(a.charAt(c))>-1;);return c}function k(a,b){return d(a.criteria,b.criteria)||a.index-b.index}function l(a,b,c){for(var e=-1,f=a.criteria,g=b.criteria,h=f.length,i=c.length;++e<h;){var j=d(f[e],g[e]);if(j){if(e>=i)return j;var k=c[e];return j*(\"asc\"===k||k===!0?1:-1)}}return a.index-b.index}function m(a){return Sa[a]}function n(a){return Ta[a]}function o(a,b,c){return b?a=Wa[a]:c&&(a=Xa[a]),\"\\\\\"+a}function p(a){return\"\\\\\"+Xa[a]}function q(a,b,c){for(var d=a.length,e=b+(c?0:-1);c?e--:++e<d;){var f=a[e];if(f!==f)return e}return-1}function r(a){return!!a&&\"object\"==typeof a}function s(a){return 160>=a&&a>=9&&13>=a||32==a||160==a||5760==a||6158==a||a>=8192&&(8202>=a||8232==a||8233==a||8239==a||8287==a||12288==a||65279==a)}function t(a,b){for(var c=-1,d=a.length,e=-1,f=[];++c<d;)a[c]===b&&(a[c]=S,f[++e]=c);return f}function u(a,b){for(var c,d=-1,e=a.length,f=-1,g=[];++d<e;){var h=a[d],i=b?b(h,d,a):h;d&&c===i||(c=i,g[++f]=h)}return g}function v(a){for(var b=-1,c=a.length;++b<c&&s(a.charCodeAt(b)););return b}function w(a){for(var b=a.length;b--&&s(a.charCodeAt(b)););return b}function x(a){return Ua[a]}function y(a){function b(a){if(r(a)&&!Ch(a)&&!(a instanceof Z)){if(a instanceof s)return a;if(ag.call(a,\"__chain__\")&&ag.call(a,\"__wrapped__\"))return md(a)}return new s(a)}function c(){}function s(a,b,c){this.__wrapped__=a,this.__actions__=c||[],this.__chain__=!!b}function Z(a){this.__wrapped__=a,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Bg,this.__views__=[]}function ba(){var a=new Z(this.__wrapped__);return a.__actions__=ab(this.__actions__),a.__dir__=this.__dir__,a.__filtered__=this.__filtered__,a.__iteratees__=ab(this.__iteratees__),a.__takeCount__=this.__takeCount__,a.__views__=ab(this.__views__),a}function da(){if(this.__filtered__){var a=new Z(this);a.__dir__=-1,a.__filtered__=!0}else a=this.clone(),a.__dir__*=-1;return a}function Sa(){var a=this.__wrapped__.value(),b=this.__dir__,c=Ch(a),d=0>b,e=c?a.length:0,f=Tc(0,e,this.__views__),g=f.start,h=f.end,i=h-g,j=d?h:g-1,k=this.__iteratees__,l=k.length,m=0,n=wg(i,this.__takeCount__);if(!c||O>e||e==i&&n==i)return cc(d&&c?a.reverse():a,this.__actions__);var o=[];a:for(;i--&&n>m;){j+=b;for(var p=-1,q=a[j];++p<l;){var r=k[p],s=r.iteratee,t=r.type,u=s(q);if(t==Q)q=u;else if(!u){if(t==P)continue a;break a}}o[m++]=q}return o}function Ta(){this.__data__={}}function Ua(a){return this.has(a)&&delete this.__data__[a]}function Va(a){return\"__proto__\"==a?z:this.__data__[a]}function Wa(a){return\"__proto__\"!=a&&ag.call(this.__data__,a)}function Xa(a,b){return\"__proto__\"!=a&&(this.__data__[a]=b),this}function Ya(a){var b=a?a.length:0;for(this.data={hash:qg(null),set:new kg};b--;)this.push(a[b])}function Za(a,b){var c=a.data,d=\"string\"==typeof b||He(b)?c.set.has(b):c.hash[b];return d?0:-1}function $a(a){var b=this.data;\"string\"==typeof a||He(a)?b.set.add(a):b.hash[a]=!0}function _a(a,b){for(var c=-1,d=a.length,e=-1,f=b.length,g=Of(d+f);++c<d;)g[c]=a[c];for(;++e<f;)g[c++]=b[e];return g}function ab(a,b){var c=-1,d=a.length;for(b||(b=Of(d));++c<d;)b[c]=a[c];return b}function bb(a,b){for(var c=-1,d=a.length;++c<d&&b(a[c],c,a)!==!1;);return a}function eb(a,b){for(var c=a.length;c--&&b(a[c],c,a)!==!1;);return a}function fb(a,b){for(var c=-1,d=a.length;++c<d;)if(!b(a[c],c,a))return!1;return!0}function gb(a,b,c,d){for(var e=-1,f=a.length,g=d,h=g;++e<f;){var i=a[e],j=+b(i);c(j,g)&&(g=j,h=i)}return h}function hb(a,b){for(var c=-1,d=a.length,e=-1,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[++e]=g)}return f}function ib(a,b){for(var c=-1,d=a.length,e=Of(d);++c<d;)e[c]=b(a[c],c,a);return e}function jb(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a}function kb(a,b,c,d){var e=-1,f=a.length;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function lb(a,b,c,d){var e=a.length;for(d&&e&&(c=a[--e]);e--;)c=b(c,a[e],e,a);return c}function mb(a,b){for(var c=-1,d=a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function nb(a,b){for(var c=a.length,d=0;c--;)d+=+b(a[c])||0;return d}function ob(a,b){return a===z?b:a}function pb(a,b,c,d){return a!==z&&ag.call(d,c)?a:b}function qb(a,b,c){for(var d=-1,e=Nh(b),f=e.length;++d<f;){var g=e[d],h=a[g],i=c(h,b[g],g,a,b);(i===i?i===h:h!==h)&&(h!==z||g in a)||(a[g]=i)}return a}function rb(a,b){return null==b?a:tb(b,Nh(b),a)}function sb(a,b){for(var c=-1,d=null==a,e=!d&&Yc(a),f=e?a.length:0,g=b.length,h=Of(g);++c<g;){var i=b[c];e?h[c]=Zc(i,f)?a[i]:z:h[c]=d?z:a[i]}return h}function tb(a,b,c){c||(c={});for(var d=-1,e=b.length;++d<e;){var f=b[d];c[f]=a[f]}return c}function ub(a,b,c){var d=typeof a;return\"function\"==d?b===z?a:fc(a,b,c):null==a?Bf:\"object\"==d?Nb(a):b===z?Hf(a):Ob(a,b)}function vb(a,b,c,d,e,f,g){var h;if(c&&(h=e?c(a,d,e):c(a)),h!==z)return h;if(!He(a))return a;var i=Ch(a);if(i){if(h=Uc(a),!b)return ab(a,h)}else{var j=cg.call(a),k=j==Y;if(j!=_&&j!=T&&(!k||e))return Ra[j]?Wc(a,j,b):e?a:{};if(h=Vc(k?{}:a),!b)return rb(h,a)}f||(f=[]),g||(g=[]);for(var l=f.length;l--;)if(f[l]==a)return g[l];return f.push(a),g.push(h),(i?bb:Fb)(a,function(d,e){h[e]=vb(d,b,c,e,a,f,g)}),h}function wb(a,b,c){if(\"function\"!=typeof a)throw new Xf(R);return lg(function(){a.apply(z,c)},b)}function xb(a,b){var c=a?a.length:0,d=[];if(!c)return d;var e=-1,g=Qc(),h=g==f,i=h&&b.length>=O?oc(b):null,j=b.length;i&&(g=Za,h=!1,b=i);a:for(;++e<c;){var k=a[e];if(h&&k===k){for(var l=j;l--;)if(b[l]===k)continue a;d.push(k)}else g(b,k,0)<0&&d.push(k)}return d}function yb(a,b){var c=!0;return Jg(a,function(a,d,e){return c=!!b(a,d,e)}),c}function zb(a,b,c,d){var e=d,f=e;return Jg(a,function(a,g,h){var i=+b(a,g,h);(c(i,e)||i===d&&i===f)&&(e=i,f=a)}),f}function Ab(a,b,c,d){var e=a.length;for(c=null==c?0:+c||0,0>c&&(c=-c>e?0:e+c),d=d===z||d>e?e:+d||0,0>d&&(d+=e),e=c>d?0:d>>>0,c>>>=0;e>c;)a[c++]=b;return a}function Bb(a,b){var c=[];return Jg(a,function(a,d,e){b(a,d,e)&&c.push(a)}),c}function Cb(a,b,c,d){var e;return c(a,function(a,c,f){return b(a,c,f)?(e=d?c:a,!1):void 0}),e}function Db(a,b,c,d){d||(d=[]);for(var e=-1,f=a.length;++e<f;){var g=a[e];r(g)&&Yc(g)&&(c||Ch(g)||ye(g))?b?Db(g,b,c,d):jb(d,g):c||(d[d.length]=g)}return d}function Eb(a,b){return Lg(a,b,_e)}function Fb(a,b){return Lg(a,b,Nh)}function Gb(a,b){return Mg(a,b,Nh)}function Hb(a,b){for(var c=-1,d=b.length,e=-1,f=[];++c<d;){var g=b[c];Ge(a[g])&&(f[++e]=g)}return f}function Ib(a,b,c){if(null!=a){c!==z&&c in kd(a)&&(b=[c]);for(var d=0,e=b.length;null!=a&&e>d;)a=a[b[d++]];return d&&d==e?a:z}}function Jb(a,b,c,d,e,f){return a===b?!0:null==a||null==b||!He(a)&&!r(b)?a!==a&&b!==b:Kb(a,b,Jb,c,d,e,f)}function Kb(a,b,c,d,e,f,g){var h=Ch(a),i=Ch(b),j=U,k=U;h||(j=cg.call(a),j==T?j=_:j!=_&&(h=Qe(a))),i||(k=cg.call(b),k==T?k=_:k!=_&&(i=Qe(b)));var l=j==_,m=k==_,n=j==k;if(n&&!h&&!l)return Mc(a,b,j);if(!e){var o=l&&ag.call(a,\"__wrapped__\"),p=m&&ag.call(b,\"__wrapped__\");if(o||p)return c(o?a.value():a,p?b.value():b,d,e,f,g)}if(!n)return!1;f||(f=[]),g||(g=[]);for(var q=f.length;q--;)if(f[q]==a)return g[q]==b;f.push(a),g.push(b);var r=(h?Lc:Nc)(a,b,c,d,e,f,g);return f.pop(),g.pop(),r}function Lb(a,b,c){var d=b.length,e=d,f=!c;if(null==a)return!e;for(a=kd(a);d--;){var g=b[d];if(f&&g[2]?g[1]!==a[g[0]]:!(g[0]in a))return!1}for(;++d<e;){g=b[d];var h=g[0],i=a[h],j=g[1];if(f&&g[2]){if(i===z&&!(h in a))return!1}else{var k=c?c(i,j,h):z;if(!(k===z?Jb(j,i,c,!0):k))return!1}}return!0}function Mb(a,b){var c=-1,d=Yc(a)?Of(a.length):[];return Jg(a,function(a,e,f){d[++c]=b(a,e,f)}),d}function Nb(a){var b=Rc(a);if(1==b.length&&b[0][2]){var c=b[0][0],d=b[0][1];return function(a){return null==a?!1:a[c]===d&&(d!==z||c in kd(a))}}return function(a){return Lb(a,b)}}function Ob(a,b){var c=Ch(a),d=_c(a)&&cd(b),e=a+\"\";return a=ld(a),function(f){if(null==f)return!1;var g=e;if(f=kd(f),(c||!d)&&!(g in f)){if(f=1==a.length?f:Ib(f,Wb(a,0,-1)),null==f)return!1;g=zd(a),f=kd(f)}return f[g]===b?b!==z||g in f:Jb(b,f[g],z,!0)}}function Pb(a,b,c,d,e){if(!He(a))return a;var f=Yc(b)&&(Ch(b)||Qe(b)),g=f?z:Nh(b);return bb(g||b,function(h,i){if(g&&(i=h,h=b[i]),r(h))d||(d=[]),e||(e=[]),Qb(a,b,i,Pb,c,d,e);else{var j=a[i],k=c?c(j,h,i,a,b):z,l=k===z;l&&(k=h),k===z&&(!f||i in a)||!l&&(k===k?k===j:j!==j)||(a[i]=k)}}),a}function Qb(a,b,c,d,e,f,g){for(var h=f.length,i=b[c];h--;)if(f[h]==i)return void(a[c]=g[h]);var j=a[c],k=e?e(j,i,c,a,b):z,l=k===z;l&&(k=i,Yc(i)&&(Ch(i)||Qe(i))?k=Ch(j)?j:Yc(j)?ab(j):[]:Ne(i)||ye(i)?k=ye(j)?Ve(j):Ne(j)?j:{}:l=!1),f.push(i),g.push(k),l?a[c]=d(k,i,e,f,g):(k===k?k!==j:j===j)&&(a[c]=k)}function Rb(a){return function(b){return null==b?z:b[a]}}function Sb(a){var b=a+\"\";\n";
 d += "return a=ld(a),function(c){return Ib(c,a,b)}}function Tb(a,b){for(var c=a?b.length:0;c--;){var d=b[c];if(d!=e&&Zc(d)){var e=d;mg.call(a,d,1)}}return a}function Ub(a,b){return a+rg(zg()*(b-a+1))}function Vb(a,b,c,d,e){return e(a,function(a,e,f){c=d?(d=!1,a):b(c,a,e,f)}),c}function Wb(a,b,c){var d=-1,e=a.length;b=null==b?0:+b||0,0>b&&(b=-b>e?0:e+b),c=c===z||c>e?e:+c||0,0>c&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Of(e);++d<e;)f[d]=a[d+b];return f}function Xb(a,b){var c;return Jg(a,function(a,d,e){return c=b(a,d,e),!c}),!!c}function Yb(a,b){var c=a.length;for(a.sort(b);c--;)a[c]=a[c].value;return a}function Zb(a,b,c){var d=Oc(),e=-1;b=ib(b,function(a){return d(a)});var f=Mb(a,function(a){var c=ib(b,function(b){return b(a)});return{criteria:c,index:++e,value:a}});return Yb(f,function(a,b){return l(a,b,c)})}function $b(a,b){var c=0;return Jg(a,function(a,d,e){c+=+b(a,d,e)||0}),c}function _b(a,b){var c=-1,d=Qc(),e=a.length,g=d==f,h=g&&e>=O,i=h?oc():null,j=[];i?(d=Za,g=!1):(h=!1,i=b?[]:j);a:for(;++c<e;){var k=a[c],l=b?b(k,c,a):k;if(g&&k===k){for(var m=i.length;m--;)if(i[m]===l)continue a;b&&i.push(l),j.push(k)}else d(i,l,0)<0&&((b||h)&&i.push(l),j.push(k))}return j}function ac(a,b){for(var c=-1,d=b.length,e=Of(d);++c<d;)e[c]=a[b[c]];return e}function bc(a,b,c,d){for(var e=a.length,f=d?e:-1;(d?f--:++f<e)&&b(a[f],f,a););return c?Wb(a,d?0:f,d?f+1:e):Wb(a,d?f+1:0,d?e:f)}function cc(a,b){var c=a;c instanceof Z&&(c=c.value());for(var d=-1,e=b.length;++d<e;){var f=b[d];c=f.func.apply(f.thisArg,jb([c],f.args))}return c}function dc(a,b,c){var d=0,e=a?a.length:d;if(\"number\"==typeof b&&b===b&&Eg>=e){for(;e>d;){var f=d+e>>>1,g=a[f];(c?b>=g:b>g)&&null!==g?d=f+1:e=f}return e}return ec(a,b,Bf,c)}function ec(a,b,c,d){b=c(b);for(var e=0,f=a?a.length:0,g=b!==b,h=null===b,i=b===z;f>e;){var j=rg((e+f)/2),k=c(a[j]),l=k!==z,m=k===k;if(g)var n=m||d;else n=h?m&&l&&(d||null!=k):i?m&&(d||l):null==k?!1:d?b>=k:b>k;n?e=j+1:f=j}return wg(f,Dg)}function fc(a,b,c){if(\"function\"!=typeof a)return Bf;if(b===z)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}function gc(a){var b=new fg(a.byteLength),c=new ng(b);return c.set(new ng(a)),b}function hc(a,b,c){for(var d=c.length,e=-1,f=vg(a.length-d,0),g=-1,h=b.length,i=Of(h+f);++g<h;)i[g]=b[g];for(;++e<d;)i[c[e]]=a[e];for(;f--;)i[g++]=a[e++];return i}function ic(a,b,c){for(var d=-1,e=c.length,f=-1,g=vg(a.length-e,0),h=-1,i=b.length,j=Of(g+i);++f<g;)j[f]=a[f];for(var k=f;++h<i;)j[k+h]=b[h];for(;++d<e;)j[k+c[d]]=a[f++];return j}function jc(a,b){return function(c,d,e){var f=b?b():{};if(d=Oc(d,e,3),Ch(c))for(var g=-1,h=c.length;++g<h;){var i=c[g];a(f,i,d(i,g,c),c)}else Jg(c,function(b,c,e){a(f,b,d(b,c,e),e)});return f}}function kc(a){return qe(function(b,c){var d=-1,e=null==b?0:c.length,f=e>2?c[e-2]:z,g=e>2?c[2]:z,h=e>1?c[e-1]:z;for(\"function\"==typeof f?(f=fc(f,h,5),e-=2):(f=\"function\"==typeof h?h:z,e-=f?1:0),g&&$c(c[0],c[1],g)&&(f=3>e?z:f,e=1);++d<e;){var i=c[d];i&&a(b,i,f)}return b})}function lc(a,b){return function(c,d){var e=c?Pg(c):0;if(!bd(e))return a(c,d);for(var f=b?e:-1,g=kd(c);(b?f--:++f<e)&&d(g[f],f,g)!==!1;);return c}}function mc(a){return function(b,c,d){for(var e=kd(b),f=d(b),g=f.length,h=a?g:-1;a?h--:++h<g;){var i=f[h];if(c(e[i],i,e)===!1)break}return b}}function nc(a,b){function c(){var e=this&&this!==cb&&this instanceof c?d:a;return e.apply(b,arguments)}var d=qc(a);return c}function oc(a){return qg&&kg?new Ya(a):null}function pc(a){return function(b){for(var c=-1,d=yf(kf(b)),e=d.length,f=\"\";++c<e;)f=a(f,d[c],c);return f}}function qc(a){return function(){var b=arguments;switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var c=Ig(a.prototype),d=a.apply(c,b);return He(d)?d:c}}function rc(a){function b(c,d,e){e&&$c(c,d,e)&&(d=z);var f=Kc(c,a,z,z,z,z,z,d);return f.placeholder=b.placeholder,f}return b}function sc(a,b){return qe(function(c){var d=c[0];return null==d?d:(c.push(b),a.apply(z,c))})}function tc(a,b){return function(c,d,e){if(e&&$c(c,d,e)&&(d=z),d=Oc(d,e,3),1==d.length){c=Ch(c)?c:jd(c);var f=gb(c,d,a,b);if(!c.length||f!==b)return f}return zb(c,d,a,b)}}function uc(a,b){return function(c,d,f){if(d=Oc(d,f,3),Ch(c)){var g=e(c,d,b);return g>-1?c[g]:z}return Cb(c,d,a)}}function vc(a){return function(b,c,d){return b&&b.length?(c=Oc(c,d,3),e(b,c,a)):-1}}function wc(a){return function(b,c,d){return c=Oc(c,d,3),Cb(b,c,a,!0)}}function xc(a){return function(){for(var b,c=arguments.length,d=a?c:-1,e=0,f=Of(c);a?d--:++d<c;){var g=f[e++]=arguments[d];if(\"function\"!=typeof g)throw new Xf(R);!b&&s.prototype.thru&&\"wrapper\"==Pc(g)&&(b=new s([],!0))}for(d=b?-1:c;++d<c;){g=f[d];var h=Pc(g),i=\"wrapper\"==h?Og(g):z;b=i&&ad(i[0])&&i[1]==(I|E|G|J)&&!i[4].length&&1==i[9]?b[Pc(i[0])].apply(b,i[3]):1==g.length&&ad(g)?b[h]():b.thru(g)}return function(){var a=arguments,d=a[0];if(b&&1==a.length&&Ch(d)&&d.length>=O)return b.plant(d).value();for(var e=0,g=c?f[e].apply(this,a):d;++e<c;)g=f[e].call(this,g);return g}}}function yc(a,b){return function(c,d,e){return\"function\"==typeof d&&e===z&&Ch(c)?a(c,d):b(c,fc(d,e,3))}}function zc(a){return function(b,c,d){return(\"function\"!=typeof c||d!==z)&&(c=fc(c,d,3)),a(b,c,_e)}}function Ac(a){return function(b,c,d){return(\"function\"!=typeof c||d!==z)&&(c=fc(c,d,3)),a(b,c)}}function Bc(a){return function(b,c,d){var e={};return c=Oc(c,d,3),Fb(b,function(b,d,f){var g=c(b,d,f);d=a?g:d,b=a?b:g,e[d]=b}),e}}function Cc(a){return function(b,c,d){return b=h(b),(a?b:\"\")+Gc(b,c,d)+(a?\"\":b)}}function Dc(a){var b=qe(function(c,d){var e=t(d,b.placeholder);return Kc(c,a,z,d,e)});return b}function Ec(a,b){return function(c,d,e,f){var g=arguments.length<3;return\"function\"==typeof d&&f===z&&Ch(c)?a(c,d,e,g):Vb(c,Oc(d,f,4),e,g,b)}}function Fc(a,b,c,d,e,f,g,h,i,j){function k(){for(var s=arguments.length,u=s,v=Of(s);u--;)v[u]=arguments[u];if(d&&(v=hc(v,d,e)),f&&(v=ic(v,f,g)),o||q){var w=k.placeholder,x=t(v,w);if(s-=x.length,j>s){var y=h?ab(h):z,A=vg(j-s,0),D=o?x:z,E=o?z:x,F=o?v:z,I=o?z:v;b|=o?G:H,b&=~(o?H:G),p||(b&=~(B|C));var J=[a,b,c,F,D,I,E,y,i,A],K=Fc.apply(z,J);return ad(a)&&Qg(K,J),K.placeholder=w,K}}var L=m?c:this,M=n?L[a]:a;return h&&(v=hd(v,h)),l&&i<v.length&&(v.length=i),this&&this!==cb&&this instanceof k&&(M=r||qc(a)),M.apply(L,v)}var l=b&I,m=b&B,n=b&C,o=b&E,p=b&D,q=b&F,r=n?z:qc(a);return k}function Gc(a,b,c){var d=a.length;if(b=+b,d>=b||!tg(b))return\"\";var e=b-d;return c=null==c?\" \":c+\"\",qf(c,pg(e/c.length)).slice(0,e)}function Hc(a,b,c,d){function e(){for(var b=-1,h=arguments.length,i=-1,j=d.length,k=Of(j+h);++i<j;)k[i]=d[i];for(;h--;)k[i++]=arguments[++b];var l=this&&this!==cb&&this instanceof e?g:a;return l.apply(f?c:this,k)}var f=b&B,g=qc(a);return e}function Ic(a){var b=Sf[a];return function(a,c){return c=c===z?0:+c||0,c?(c=ig(10,c),b(a*c)/c):b(a)}}function Jc(a){return function(b,c,d,e){var f=Oc(d);return null==d&&f===ub?dc(b,c,a):ec(b,c,f(d,e,1),a)}}function Kc(a,b,c,d,e,f,g,h){var i=b&C;if(!i&&\"function\"!=typeof a)throw new Xf(R);var j=d?d.length:0;if(j||(b&=~(G|H),d=e=z),j-=e?e.length:0,b&H){var k=d,l=e;d=e=z}var m=i?z:Og(a),n=[a,b,c,d,e,k,l,f,g,h];if(m&&(dd(n,m),b=n[1],h=n[9]),n[9]=null==h?i?0:a.length:vg(h-j,0)||0,b==B)var o=nc(n[0],n[2]);else o=b!=G&&b!=(B|G)||n[4].length?Fc.apply(z,n):Hc.apply(z,n);var p=m?Ng:Qg;return p(o,n)}function Lc(a,b,c,d,e,f,g){var h=-1,i=a.length,j=b.length;if(i!=j&&!(e&&j>i))return!1;for(;++h<i;){var k=a[h],l=b[h],m=d?d(e?l:k,e?k:l,h):z;if(m!==z){if(m)continue;return!1}if(e){if(!mb(b,function(a){return k===a||c(k,a,d,e,f,g)}))return!1}else if(k!==l&&!c(k,l,d,e,f,g))return!1}return!0}function Mc(a,b,c){switch(c){case V:case W:return+a==+b;case X:return a.name==b.name&&a.message==b.message;case $:return a!=+a?b!=+b:a==+b;case aa:case ca:return a==b+\"\"}return!1}function Nc(a,b,c,d,e,f,g){var h=Nh(a),i=h.length,j=Nh(b),k=j.length;if(i!=k&&!e)return!1;for(var l=i;l--;){var m=h[l];if(!(e?m in b:ag.call(b,m)))return!1}for(var n=e;++l<i;){m=h[l];var o=a[m],p=b[m],q=d?d(e?p:o,e?o:p,m):z;if(!(q===z?c(o,p,d,e,f,g):q))return!1;n||(n=\"constructor\"==m)}if(!n){var r=a.constructor,s=b.constructor;if(r!=s&&\"constructor\"in a&&\"constructor\"in b&&!(\"function\"==typeof r&&r instanceof r&&\"function\"==typeof s&&s instanceof s))return!1}return!0}function Oc(a,c,d){var e=b.callback||zf;return e=e===zf?ub:e,d?e(a,c,d):e}function Pc(a){for(var b=a.name,c=Hg[b],d=c?c.length:0;d--;){var e=c[d],f=e.func;if(null==f||f==a)return e.name}return b}function Qc(a,c,d){var e=b.indexOf||xd;return e=e===xd?f:e,a?e(a,c,d):e}function Rc(a){for(var b=af(a),c=b.length;c--;)b[c][2]=cd(b[c][1]);return b}function Sc(a,b){var c=null==a?z:a[b];return Ke(c)?c:z}function Tc(a,b,c){for(var d=-1,e=c.length;++d<e;){var f=c[d],g=f.size;switch(f.type){case\"drop\":a+=g;break;case\"dropRight\":b-=g;break;case\"take\":b=wg(b,a+g);break;case\"takeRight\":a=vg(a,b-g)}}return{start:a,end:b}}function Uc(a){var b=a.length,c=new a.constructor(b);return b&&\"string\"==typeof a[0]&&ag.call(a,\"index\")&&(c.index=a.index,c.input=a.input),c}function Vc(a){var b=a.constructor;return\"function\"==typeof b&&b instanceof b||(b=Uf),new b}function Wc(a,b,c){var d=a.constructor;switch(b){case ea:return gc(a);case V:case W:return new d(+a);case fa:case ga:case ha:case ia:case ja:case ka:case la:case ma:case na:var e=a.buffer;return new d(c?gc(e):e,a.byteOffset,a.length);case $:case ca:return new d(a);case aa:var f=new d(a.source,Ga.exec(a));f.lastIndex=a.lastIndex}return f}function Xc(a,b,c){null==a||_c(b,a)||(b=ld(b),a=1==b.length?a:Ib(a,Wb(b,0,-1)),b=zd(b));var d=null==a?a:a[b];return null==d?z:d.apply(a,c)}function Yc(a){return null!=a&&bd(Pg(a))}function Zc(a,b){return a=\"number\"==typeof a||Ja.test(a)?+a:-1,b=null==b?Fg:b,a>-1&&a%1==0&&b>a}function $c(a,b,c){if(!He(c))return!1;var d=typeof b;if(\"number\"==d?Yc(c)&&Zc(b,c.length):\"string\"==d&&b in c){var e=c[b];return a===a?a===e:e!==e}return!1}function _c(a,b){var c=typeof a;if(\"string\"==c&&za.test(a)||\"number\"==c)return!0;if(Ch(a))return!1;var d=!ya.test(a);return d||null!=b&&a in kd(b)}function ad(a){var c=Pc(a);if(!(c in Z.prototype))return!1;var d=b[c];if(a===d)return!0;var e=Og(d);return!!e&&a===e[0]}function bd(a){return\"number\"==typeof a&&a>-1&&a%1==0&&Fg>=a}function cd(a){return a===a&&!He(a)}function dd(a,b){var c=a[1],d=b[1],e=c|d,f=I>e,g=d==I&&c==E||d==I&&c==J&&a[7].length<=b[8]||d==(I|J)&&c==E;if(!f&&!g)return a;d&B&&(a[2]=b[2],e|=c&B?0:D);var h=b[3];if(h){var i=a[3];a[3]=i?hc(i,h,b[4]):ab(h),a[4]=i?t(a[3],S):ab(b[4])}return h=b[5],h&&(i=a[5],a[5]=i?ic(i,h,b[6]):ab(h),a[6]=i?t(a[5],S):ab(b[6])),h=b[7],h&&(a[7]=ab(h)),d&I&&(a[8]=null==a[8]?b[8]:wg(a[8],b[8])),null==a[9]&&(a[9]=b[9]),a[0]=b[0],a[1]=e,a}function ed(a,b){return a===z?b:Dh(a,b,ed)}function fd(a,b){a=kd(a);for(var c=-1,d=b.length,e={};++c<d;){var f=b[c];f in a&&(e[f]=a[f])}return e}function gd(a,b){var c={};return Eb(a,function(a,d,e){b(a,d,e)&&(c[d]=a)}),c}function hd(a,b){for(var c=a.length,d=wg(b.length,c),e=ab(a);d--;){var f=b[d];a[d]=Zc(f,c)?e[f]:z}return a}function id(a){for(var b=_e(a),c=b.length,d=c&&a.length,e=!!d&&bd(d)&&(Ch(a)||ye(a)),f=-1,g=[];++f<c;){var h=b[f];(e&&Zc(h,d)||ag.call(a,h))&&g.push(h)}return g}function jd(a){return null==a?[]:Yc(a)?He(a)?a:Uf(a):ef(a)}function kd(a){return He(a)?a:Uf(a)}function ld(a){if(Ch(a))return a;var b=[];return h(a).replace(Aa,function(a,c,d,e){b.push(d?e.replace(Ea,\"$1\"):c||a)}),b}function md(a){return a instanceof Z?a.clone():new s(a.__wrapped__,a.__chain__,ab(a.__actions__))}function nd(a,b,c){b=(c?$c(a,b,c):null==b)?1:vg(rg(b)||1,1);for(var d=0,e=a?a.length:0,f=-1,g=Of(pg(e/b));e>d;)g[++f]=Wb(a,d,d+=b);return g}function od(a){for(var b=-1,c=a?a.length:0,d=-1,e=[];++b<c;){var f=a[b];f&&(e[++d]=f)}return e}function pd(a,b,c){var d=a?a.length:0;return d?((c?$c(a,b,c):null==b)&&(b=1),Wb(a,0>b?0:b)):[]}function qd(a,b,c){var d=a?a.length:0;return d?((c?$c(a,b,c):null==b)&&(b=1),b=d-(+b||0),Wb(a,0,0>b?0:b)):[]}function rd(a,b,c){return a&&a.length?bc(a,Oc(b,c,3),!0,!0):[]}function sd(a,b,c){return a&&a.length?bc(a,Oc(b,c,3),!0):[]}function td(a,b,c,d){var e=a?a.length:0;return e?(c&&\"number\"!=typeof c&&$c(a,b,c)&&(c=0,d=e),Ab(a,b,c,d)):[]}function ud(a){return a?a[0]:z}function vd(a,b,c){var d=a?a.length:0;return c&&$c(a,b,c)&&(b=!1),d?Db(a,b):[]}function wd(a){var b=a?a.length:0;return b?Db(a,!0):[]}function xd(a,b,c){var d=a?a.length:0;if(!d)return-1;if(\"number\"==typeof c)c=0>c?vg(d+c,0):c;else if(c){var e=dc(a,b);return d>e&&(b===b?b===a[e]:a[e]!==a[e])?e:-1}return f(a,b,c||0)}function yd(a){return qd(a,1)}function zd(a){var b=a?a.length:0;return b?a[b-1]:z}function Ad(a,b,c){var d=a?a.length:0;if(!d)return-1;var e=d;if(\"number\"==typeof c)e=(0>c?vg(d+c,0):wg(c||0,d-1))+1;else if(c){e=dc(a,b,!0)-1;var f=a[e];return(b===b?b===f:f!==f)?e:-1}if(b!==b)return q(a,e,!0);for(;e--;)if(a[e]===b)return e;return-1}function Bd(){var a=arguments,b=a[0];if(!b||!b.length)return b;for(var c=0,d=Qc(),e=a.length;++c<e;)for(var f=0,g=a[c];(f=d(b,g,f))>-1;)mg.call(b,f,1);return b}function Cd(a,b,c){var d=[];if(!a||!a.length)return d;var e=-1,f=[],g=a.length;for(b=Oc(b,c,3);++e<g;){var h=a[e];b(h,e,a)&&(d.push(h),f.push(e))}return Tb(a,f),d}function Dd(a){return pd(a,1)}function Ed(a,b,c){var d=a?a.length:0;return d?(c&&\"number\"!=typeof c&&$c(a,b,c)&&(b=0,c=d),Wb(a,b,c)):[]}function Fd(a,b,c){var d=a?a.length:0;return d?((c?$c(a,b,c):null==b)&&(b=1),Wb(a,0,0>b?0:b)):[]}function Gd(a,b,c){var d=a?a.length:0;return d?((c?$c(a,b,c):null==b)&&(b=1),b=d-(+b||0),Wb(a,0>b?0:b)):[]}function Hd(a,b,c){return a&&a.length?bc(a,Oc(b,c,3),!1,!0):[]}function Id(a,b,c){return a&&a.length?bc(a,Oc(b,c,3)):[]}function Jd(a,b,c,d){var e=a?a.length:0;if(!e)return[];null!=b&&\"boolean\"!=typeof b&&(d=c,c=$c(a,b,d)?z:b,b=!1);var g=Oc();return(null!=c||g!==ub)&&(c=g(c,d,3)),b&&Qc()==f?u(a,c):_b(a,c)}function Kd(a){if(!a||!a.length)return[];var b=-1,c=0;a=hb(a,function(a){return Yc(a)?(c=vg(a.length,c),!0):void 0});for(var d=Of(c);++b<c;)d[b]=ib(a,Rb(b));return d}function Ld(a,b,c){var d=a?a.length:0;if(!d)return[];var e=Kd(a);return null==b?e:(b=fc(b,c,4),ib(e,function(a){return kb(a,b,z,!0)}))}function Md(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Yc(c))var d=d?jb(xb(d,c),xb(c,d)):c}return d?_b(d):[]}function Nd(a,b){var c=-1,d=a?a.length:0,e={};for(!d||b||Ch(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Od(a){var c=b(a);return c.__chain__=!0,c}function Pd(a,b,c){return b.call(c,a),a}function Qd(a,b,c){return b.call(c,a)}function Rd(){return Od(this)}function Sd(){return new s(this.value(),this.__chain__)}function Td(a){for(var b,d=this;d instanceof c;){var e=md(d);b?f.__wrapped__=e:b=e;var f=e;d=d.__wrapped__}return f.__wrapped__=a,b}function Ud(){var a=this.__wrapped__,b=function(a){return c&&c.__dir__<0?a:a.reverse()};if(a instanceof Z){var c=a;return this.__actions__.length&&(c=new Z(this)),c=c.reverse(),c.__actions__.push({func:Qd,args:[b],thisArg:z}),new s(c,this.__chain__)}return this.thru(b)}function Vd(){return this.value()+\"\"}function Wd(){return cc(this.__wrapped__,this.__actions__)}function Xd(a,b,c){var d=Ch(a)?fb:yb;return c&&$c(a,b,c)&&(b=z),(\"function\"!=typeof b||c!==z)&&(b=Oc(b,c,3)),d(a,b)}function Yd(a,b,c){var d=Ch(a)?hb:Bb;return b=Oc(b,c,3),d(a,b)}function Zd(a,b){return dh(a,Nb(b))}function $d(a,b,c,d){var e=a?Pg(a):0;return bd(e)||(a=ef(a),e=a.length),c=\"number\"!=typeof c||d&&$c(b,c,d)?0:0>c?vg(e+c,0):c||0,\"string\"==typeof a||!Ch(a)&&Pe(a)?e>=c&&a.indexOf(b,c)>-1:!!e&&Qc(a,b,c)>-1}function _d(a,b,c){var d=Ch(a)?ib:Mb;return b=Oc(b,c,3),d(a,b)}function ae(a,b){return _d(a,Hf(b))}function be(a,b,c){var d=Ch(a)?hb:Bb;return b=Oc(b,c,3),d(a,function(a,c,d){return!b(a,c,d)})}function ce(a,b,c){if(c?$c(a,b,c):null==b){a=jd(a);var d=a.length;return d>0?a[Ub(0,d-1)]:z}var e=-1,f=Ue(a),d=f.length,g=d-1;for(b=wg(0>b?0:+b||0,d);++e<b;){var h=Ub(e,g),i=f[h];f[h]=f[e],f[e]=i}return f.length=b,f}function de(a){return ce(a,Bg)}function ee(a){var b=a?Pg(a):0;return bd(b)?b:Nh(a).length}function fe(a,b,c){var d=Ch(a)?mb:Xb;return c&&$c(a,b,c)&&(b=z),(\"function\"!=typeof b||c!==z)&&(b=Oc(b,c,3)),d(a,b)}function ge(a,b,c){if(null==a)return[];c&&$c(a,b,c)&&(b=z);var d=-1;b=Oc(b,c,3);var e=Mb(a,function(a,c,e){return{criteria:b(a,c,e),index:++d,value:a}});return Yb(e,k)}function he(a,b,c,d){return null==a?[]:(d&&$c(b,c,d)&&(c=z),Ch(b)||(b=null==b?[]:[b]),Ch(c)||(c=null==c?[]:[c]),Zb(a,b,c))}function ie(a,b){return Yd(a,Nb(b))}function je(a,b){if(\"function\"!=typeof b){if(\"function\"!=typeof a)throw new Xf(R);var c=a;a=b,b=c}return a=tg(a=+a)?a:0,function(){return--a<1?b.apply(this,arguments):void 0}}function ke(a,b,c){return c&&$c(a,b,c)&&(b=z),b=a&&null==b?a.length:vg(+b||0,0),Kc(a,I,z,z,z,z,b)}function le(a,b){var c;if(\"function\"!=typeof b){if(\"function\"!=typeof a)throw new Xf(R);var d=a;a=b,b=d}return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=z),c}}function me(a,b,c){function d(){n&&gg(n),j&&gg(j),p=0,j=n=o=z}function e(b,c){c&&gg(c),j=n=o=z,b&&(p=oh(),k=a.apply(m,i),n||j||(i=m=z))}function f(){var a=b-(oh()-l);0>=a||a>b?e(o,j):n=lg(f,a)}function g(){e(r,n)}function h(){if(i=arguments,l=oh(),m=this,o=r&&(n||!s),q===!1)var c=s&&!n;else{j||s||(p=l);var d=q-(l-p),e=0>=d||d>q;e?(j&&(j=gg(j)),p=l,k=a.apply(m,i)):j||(j=lg(g,d))}return e&&n?n=gg(n):n||b===q||(n=lg(f,b)),c&&(e=!0,k=a.apply(m,i)),!e||n||j||(i=m=z),k}var i,j,k,l,m,n,o,p=0,q=!1,r=!0;if(\"function\"!=typeof a)throw new Xf(R);if(b=0>b?0:+b||0,c===!0){var s=!0;r=!1}else He(c)&&(s=!!c.leading,q=\"maxWait\"in c&&vg(+c.maxWait||0,b),r=\"trailing\"in c?!!c.trailing:r);return h.cancel=d,h}function ne(a,b){if(\"function\"!=typeof a||b&&\"function\"!=typeof b)throw new Xf(R);var c=function(){var d=arguments,e=b?b.apply(this,d):d[0],f=c.cache;if(f.has(e))return f.get(e);var g=a.apply(this,d);return c.cache=f.set(e,g),g};return c.cache=new ne.Cache,c}function oe(a){if(\"function\"!=typeof a)throw new Xf(R);return function(){return!a.apply(this,arguments)}}function pe(a){return le(2,a)}function qe(a,b){if(\"function\"!=typeof a)throw new Xf(R);return b=vg(b===z?a.length-1:+b||0,0),function(){for(var c=arguments,d=-1,e=vg(c.length-b,0),f=Of(e);++d<e;)f[d]=c[b+d];switch(b){case 0:return a.call(this,f);case 1:return a.call(this,c[0],f);case 2:return a.call(this,c[0],c[1],f)}var g=Of(b+1);for(d=-1;++d<b;)g[d]=c[d];return g[b]=f,a.apply(this,g)}}function re(a){if(\"function\"!=typeof a)throw new Xf(R);return function(b){return a.apply(this,b)}}function se(a,b,c){var d=!0,e=!0;if(\"function\"!=typeof a)throw new Xf(R);return c===!1?d=!1:He(c)&&(d=\"leading\"in c?!!c.leading:d,e=\"trailing\"in c?!!c.trailing:e),me(a,b,{leading:d,maxWait:+b,trailing:e})}function te(a,b){return b=null==b?Bf:b,Kc(b,G,z,[a],[])}function ue(a,b,c,d){return b&&\"boolean\"!=typeof b&&$c(a,b,c)?b=!1:\"function\"==typeof b&&(d=c,c=b,b=!1),\"function\"==typeof c?vb(a,b,fc(c,d,1)):vb(a,b)}function ve(a,b,c){return\"function\"==typeof b?vb(a,!0,fc(b,c,1)):vb(a,!0)}function we(a,b){return a>b}function xe(a,b){return a>=b}function ye(a){return r(a)&&Yc(a)&&ag.call(a,\"callee\")&&!jg.call(a,\"callee\")}function ze(a){return a===!0||a===!1||r(a)&&cg.call(a)==V}function Ae(a){return r(a)&&cg.call(a)==W}function Be(a){return!!a&&1===a.nodeType&&r(a)&&!Ne(a)}function Ce(a){return null==a?!0:Yc(a)&&(Ch(a)||Pe(a)||ye(a)||r(a)&&Ge(a.splice))?!a.length:!Nh(a).length}function De(a,b,c,d){c=\"function\"==typeof c?fc(c,d,3):z;var e=c?c(a,b):z;return e===z?Jb(a,b,c):!!e}function Ee(a){return r(a)&&\"string\"==typeof a.message&&cg.call(a)==X}function Fe(a){return\"number\"==typeof a&&tg(a)}function Ge(a){return He(a)&&cg.call(a)==Y}function He(a){var b=typeof a;return!!a&&(\"object\"==b||\"function\"==b)}function Ie(a,b,c,d){return c=\"function\"==typeof c?fc(c,d,3):z,Lb(a,Rc(b),c)}function Je(a){return Me(a)&&a!=+a}function Ke(a){return null==a?!1:Ge(a)?eg.test(_f.call(a)):r(a)&&Ia.test(a)}function Le(a){return null===a}function Me(a){return\"number\"==typeof a||r(a)&&cg.call(a)==$}function Ne(a){var b;if(!r(a)||cg.call(a)!=_||ye(a)||!ag.call(a,\"constructor\")&&(b=a.constructor,\"function\"==typeof b&&!(b instanceof b)))return!1;var c;return Eb(a,function(a,b){c=b}),c===z||ag.call(a,c)}function Oe(a){return He(a)&&cg.call(a)==aa}function Pe(a){return\"string\"==typeof a||r(a)&&cg.call(a)==ca}function Qe(a){return r(a)&&bd(a.length)&&!!Qa[cg.call(a)]}function Re(a){return a===z}function Se(a,b){return b>a}function Te(a,b){return b>=a}function Ue(a){var b=a?Pg(a):0;return bd(b)?b?ab(a):[]:ef(a)}function Ve(a){return tb(a,_e(a))}function We(a,b,c){var d=Ig(a);return c&&$c(a,b,c)&&(b=z),b?rb(d,b):d}function Xe(a){return Hb(a,_e(a))}function Ye(a,b,c){var d=null==a?z:Ib(a,ld(b),b+\"\");return d===z?c:d}function Ze(a,b){if(null==a)return!1;var c=ag.call(a,b);if(!c&&!_c(b)){if(b=ld(b),a=1==b.length?a:Ib(a,Wb(b,0,-1)),null==a)return!1;b=zd(b),c=ag.call(a,b)}return c||bd(a.length)&&Zc(b,a.length)&&(Ch(a)||ye(a))}function $e(a,b,c){c&&$c(a,b,c)&&(b=z);for(var d=-1,e=Nh(a),f=e.length,g={};++d<f;){var h=e[d],i=a[h];b?ag.call(g,i)?g[i].push(h):g[i]=[h]:g[i]=h}return g}function _e(a){if(null==a)return[];He(a)||(a=Uf(a));var b=a.length;b=b&&bd(b)&&(Ch(a)||ye(a))&&b||0;for(var c=a.constructor,d=-1,e=\"function\"==typeof c&&c.prototype===a,f=Of(b),g=b>0;++d<b;)f[d]=d+\"\";for(var h in a)g&&Zc(h,b)||\"constructor\"==h&&(e||!ag.call(a,h))||f.push(h);return f}function af(a){a=kd(a);for(var b=-1,c=Nh(a),d=c.length,e=Of(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function bf(a,b,c){var d=null==a?z:a[b];return d===z&&(null==a||_c(b,a)||(b=ld(b),a=1==b.length?a:Ib(a,Wb(b,0,-1)),d=null==a?z:a[zd(b)]),d=d===z?c:d),Ge(d)?d.call(a):d}function cf(a,b,c){if(null==a)return a;var d=b+\"\";b=null!=a[d]||_c(b,a)?[d]:ld(b);for(var e=-1,f=b.length,g=f-1,h=a;null!=h&&++e<f;){var i=b[e];He(h)&&(e==g?h[i]=c:null==h[i]&&(h[i]=Zc(b[e+1])?[]:{})),h=h[i]}return a}function df(a,b,c,d){var e=Ch(a)||Qe(a);if(b=Oc(b,d,4),null==c)if(e||He(a)){var f=a.constructor;c=e?Ch(a)?new f:[]:Ig(Ge(f)?f.prototype:z)}else c={};return(e?bb:Fb)(a,function(a,d,e){return b(c,a,d,e)}),c}function ef(a){return ac(a,Nh(a))}function ff(a){return ac(a,_e(a))}function gf(a,b,c){return b=+b||0,c===z?(c=b,b=0):c=+c||0,a>=wg(b,c)&&a<vg(b,c)}function hf(a,b,c){c&&$c(a,b,c)&&(b=c=z);var d=null==a,e=null==b;if(null==c&&(e&&\"boolean\"==typeof a?(c=a,a=1):\"boolean\"==typeof b&&(c=b,e=!0)),d&&e&&(b=1,e=!1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1){var f=zg();return wg(a+f*(b-a+hg(\"1e-\"+((f+\"\").length-1))),b)}return Ub(a,b)}function jf(a){return a=h(a),a&&a.charAt(0).toUpperCase()+a.slice(1)}function kf(a){return a=h(a),a&&a.replace(Ka,m).replace(Da,\"\")}function lf(a,b,c){a=h(a),b+=\"\";var d=a.length;return c=c===z?d:wg(0>c?0:+c||0,d),c-=b.length,c>=0&&a.indexOf(b,c)==c}function mf(a){return a=h(a),a&&ua.test(a)?a.replace(sa,n):a}function nf(a){return a=h(a),a&&Ca.test(a)?a.replace(Ba,o):a||\"(?:)\"}function of(a,b,c){a=h(a),b=+b;var d=a.length;if(d>=b||!tg(b))return a;var e=(b-d)/2,f=rg(e),g=pg(e);return c=Gc(\"\",g,c),c.slice(0,f)+a+c}function pf(a,b,c){return(c?$c(a,b,c):null==b)?b=0:b&&(b=+b),a=tf(a),yg(a,b||(Ha.test(a)?16:10))}function qf(a,b){var c=\"\";if(a=h(a),b=+b,1>b||!a||!tg(b))return c;do b%2&&(c+=a),b=rg(b/2),a+=a;while(b);return c}function rf(a,b,c){return a=h(a),c=null==c?0:wg(0>c?0:+c||0,a.length),a.lastIndexOf(b,c)==c}function sf(a,c,d){var e=b.templateSettings;d&&$c(a,c,d)&&(c=d=z),a=h(a),c=qb(rb({},d||c),e,pb);var f,g,i=qb(rb({},c.imports),e.imports,pb),j=Nh(i),k=ac(i,j),l=0,m=c.interpolate||La,n=\"__p += '\",o=Vf((c.escape||La).source+\"|\"+m.source+\"|\"+(m===xa?Fa:La).source+\"|\"+(c.evaluate||La).source+\"|$\",\"g\"),q=\"//# sourceURL=\"+(\"sourceURL\"in c?c.sourceURL:\"lodash.templateSources[\"+ ++Pa+\"]\")+\"\\n\";a.replace(o,function(b,c,d,e,h,i){return d||(d=e),n+=a.slice(l,i).replace(Ma,p),c&&(f=!0,n+=\"' +\\n__e(\"+c+\") +\\n'\"),h&&(g=!0,n+=\"';\\n\"+h+\";\\n__p += '\"),d&&(n+=\"' +\\n((__t = (\"+d+\")) == null ? '' : __t) +\\n'\"),l=i+b.length,b}),n+=\"';\\n\";var r=c.variable;r||(n=\"with (obj) {\\n\"+n+\"\\n}\\n\"),n=(g?n.replace(oa,\"\"):n).replace(pa,\"$1\").replace(qa,\"$1;\"),n=\"function(\"+(r||\"obj\")+\") {\\n\"+(r?\"\":\"obj || (obj = {});\\n\")+\"var __t, __p = ''\"+(f?\", __e = _.escape\":\"\")+(g?\", __j = Array.prototype.join;\\nfunction print() { __p += __j.call(arguments, '') }\\n\":\";\\n\")+n+\"return __p\\n}\";var s=Yh(function(){return Rf(j,q+\"return \"+n).apply(z,k)});if(s.source=n,Ee(s))throw s;return s}function tf(a,b,c){var d=a;return(a=h(a))?(c?$c(d,b,c):null==b)?a.slice(v(a),w(a)+1):(b+=\"\",a.slice(i(a,b),j(a,b)+1)):a}function uf(a,b,c){var d=a;return a=h(a),a?(c?$c(d,b,c):null==b)?a.slice(v(a)):a.slice(i(a,b+\"\")):a}function vf(a,b,c){var d=a;return a=h(a),a?(c?$c(d,b,c):null==b)?a.slice(0,w(a)+1):a.slice(0,j(a,b+\"\")+1):a}function wf(a,b,c){c&&$c(a,b,c)&&(b=z);var d=K,e=L;if(null!=b)if(He(b)){var f=\"separator\"in b?b.separator:f;d=\"length\"in b?+b.length||0:d,e=\"omission\"in b?h(b.omission):e}else d=+b||0;if(a=h(a),d>=a.length)return a;var g=d-e.length;if(1>g)return e;var i=a.slice(0,g);if(null==f)return i+e;if(Oe(f)){if(a.slice(g).search(f)){var j,k,l=a.slice(0,g);for(f.global||(f=Vf(f.source,(Ga.exec(f)||\"\")+\"g\")),f.lastIndex=0;j=f.exec(l);)k=j.index;i=i.slice(0,null==k?g:k)}}else if(a.indexOf(f,g)!=g){var m=i.lastIndexOf(f);m>-1&&(i=i.slice(0,m))}return i+e}function xf(a){return a=h(a),a&&ta.test(a)?a.replace(ra,x):a}function yf(a,b,c){return c&&$c(a,b,c)&&(b=z),a=h(a),a.match(b||Na)||[]}function zf(a,b,c){return c&&$c(a,b,c)&&(b=z),r(a)?Cf(a):ub(a,b)}function Af(a){return function(){return a}}function Bf(a){return a}function Cf(a){return Nb(vb(a,!0))}function Df(a,b){return Ob(a,vb(b,!0))}function Ef(a,b,c){if(null==c){var d=He(b),e=d?Nh(b):z,f=e&&e.length?Hb(b,e):z;(f?f.length:d)||(f=!1,c=b,b=a,a=this)}f||(f=Hb(b,Nh(b)));var g=!0,h=-1,i=Ge(a),j=f.length;c===!1?g=!1:He(c)&&\"chain\"in c&&(g=c.chain);for(;++h<j;){var k=f[h],l=b[k];a[k]=l,i&&(a.prototype[k]=function(b){return function(){var c=this.__chain__;if(g||c){var d=a(this.__wrapped__),e=d.__actions__=ab(this.__actions__);return e.push({func:b,args:arguments,thisArg:a}),d.__chain__=c,d}return b.apply(a,jb([this.value()],arguments))}}(l))}return a}function Ff(){return cb._=dg,this}function Gf(){}function Hf(a){return _c(a)?Rb(a):Sb(a)}function If(a){return function(b){return Ib(a,ld(b),b+\"\")}}function Jf(a,b,c){c&&$c(a,b,c)&&(b=c=z),a=+a||0,c=null==c?1:+c||0,null==b?(b=a,a=0):b=+b||0;for(var d=-1,e=vg(pg((b-a)/(c||1)),0),f=Of(e);++d<e;)f[d]=a,a+=c;return f}function Kf(a,b,c){if(a=rg(a),1>a||!tg(a))return[];var d=-1,e=Of(wg(a,Cg));for(b=fc(b,c,1);++d<a;)Cg>d?e[d]=b(d):b(d);return e}function Lf(a){var b=++bg;return h(a)+b}function Mf(a,b){return(+a||0)+(+b||0)}function Nf(a,b,c){return c&&$c(a,b,c)&&(b=z),b=Oc(b,c,3),1==b.length?nb(Ch(a)?a:jd(a),b):$b(a,b)}a=a?db.defaults(cb.Object(),a,db.pick(cb,Oa)):cb;var Of=a.Array,Pf=a.Date,Qf=a.Error,Rf=a.Function,Sf=a.Math,Tf=a.Number,Uf=a.Object,Vf=a.RegExp,Wf=a.String,Xf=a.TypeError,Yf=Of.prototype,Zf=Uf.prototype,$f=Wf.prototype,_f=Rf.prototype.toString,ag=Zf.hasOwnProperty,bg=0,cg=Zf.toString,dg=cb._,eg=Vf(\"^\"+_f.call(ag).replace(/[\\\\^$.*+?()[\\]{}|]/g,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\"),fg=a.ArrayBuffer,gg=a.clearTimeout,hg=a.parseFloat,ig=Sf.pow,jg=Zf.propertyIsEnumerable,kg=Sc(a,\"Set\"),lg=a.setTimeout,mg=Yf.splice,ng=a.Uint8Array,og=Sc(a,\"WeakMap\"),pg=Sf.ceil,qg=Sc(Uf,\"create\"),rg=Sf.floor,sg=Sc(Of,\"isArray\"),tg=a.isFinite,ug=Sc(Uf,\"keys\"),vg=Sf.max,wg=Sf.min,xg=Sc(Pf,\"now\"),yg=a.parseInt,zg=Sf.random,Ag=Tf.NEGATIVE_INFINITY,Bg=Tf.POSITIVE_INFINITY,Cg=4294967295,Dg=Cg-1,Eg=Cg>>>1,Fg=9007199254740991,Gg=og&&new og,Hg={};b.support={};b.templateSettings={escape:va,evaluate:wa,interpolate:xa,variable:\"\",imports:{_:b}};var Ig=function(){function a(){}return function(b){if(He(b)){a.prototype=b;var c=new a;a.prototype=z}return c||{}}}(),Jg=lc(Fb),Kg=lc(Gb,!0),Lg=mc(),Mg=mc(!0),Ng=Gg?function(a,b){return Gg.set(a,b),a}:Bf,Og=Gg?function(a){return Gg.get(a)}:Gf,Pg=Rb(\"length\"),Qg=function(){var a=0,b=0;return function(c,d){var e=oh(),f=N-(e-b);if(b=e,f>0){if(++a>=M)return c}else a=0;return Ng(c,d)}}(),Rg=qe(function(a,b){return r(a)&&Yc(a)?xb(a,Db(b,!1,!0)):[]}),Sg=vc(),Tg=vc(!0),Ug=qe(function(a){for(var b=a.length,c=b,d=Of(l),e=Qc(),g=e==f,h=[];c--;){var i=a[c]=Yc(i=a[c])?i:[];d[c]=g&&i.length>=120?oc(c&&i):null}var j=a[0],k=-1,l=j?j.length:0,m=d[0];a:for(;++k<l;)if(i=j[k],(m?Za(m,i):e(h,i,0))<0){for(var c=b;--c;){var n=d[c];if((n?Za(n,i):e(a[c],i,0))<0)continue a}m&&m.push(i),h.push(i)}return h}),Vg=qe(function(a,b){b=Db(b);var c=sb(a,b);return Tb(a,b.sort(d)),c}),Wg=Jc(),Xg=Jc(!0),Yg=qe(function(a){return _b(Db(a,!1,!0))}),Zg=qe(function(a,b){return Yc(a)?xb(a,b):[]}),$g=qe(Kd),_g=qe(function(a){var b=a.length,c=b>2?a[b-2]:z,d=b>1?a[b-1]:z;return b>2&&\"function\"==typeof c?b-=2:(c=b>1&&\"function\"==typeof d?(--b,d):z,d=z),a.length=b,Ld(a,c,d)}),ah=qe(function(a){return a=Db(a),this.thru(function(b){return _a(Ch(b)?b:[kd(b)],a)})}),bh=qe(function(a,b){return sb(a,Db(b))}),ch=jc(function(a,b,c){ag.call(a,c)?++a[c]:a[c]=1}),dh=uc(Jg),eh=uc(Kg,!0),fh=yc(bb,Jg),gh=yc(eb,Kg),hh=jc(function(a,b,c){ag.call(a,c)?a[c].push(b):a[c]=[b]}),ih=jc(function(a,b,c){a[c]=b}),jh=qe(function(a,b,c){var d=-1,e=\"function\"==typeof b,f=_c(b),g=Yc(a)?Of(a.length):[];return Jg(a,function(a){var h=e?b:f&&null!=a?a[b]:z;g[++d]=h?h.apply(a,c):Xc(a,b,c)}),g}),kh=jc(function(a,b,c){a[c?0:1].push(b)},function(){return[[],[]]}),lh=Ec(kb,Jg),mh=Ec(lb,Kg),nh=qe(function(a,b){if(null==a)return[];var c=b[2];return c&&$c(b[0],b[1],c)&&(b.length=1),Zb(a,Db(b),[])}),oh=xg||function(){return(new Pf).getTime()},ph=qe(function(a,b,c){var d=B;if(c.length){var e=t(c,ph.placeholder);d|=G}return Kc(a,d,b,c,e)}),qh=qe(function(a,b){b=b.length?Db(b):Xe(a);for(var c=-1,d=b.length;++c<d;){var e=b[c];a[e]=Kc(a[e],B,a)}return a}),rh=qe(function(a,b,c){var d=B|C;if(c.length){var e=t(c,rh.placeholder);d|=G}return Kc(b,d,a,c,e)}),sh=rc(E),th=rc(F),uh=qe(function(a,b){return wb(a,1,b)}),vh=qe(function(a,b,c){return wb(a,b,c)}),wh=xc(),xh=xc(!0),yh=qe(function(a,b){if(b=Db(b),\"function\"!=typeof a||!fb(b,g))throw new Xf(R);var c=b.length;return qe(function(d){for(var e=wg(d.length,c);e--;)d[e]=b[e](d[e]);return a.apply(this,d)})}),zh=Dc(G),Ah=Dc(H),Bh=qe(function(a,b){return Kc(a,J,z,z,z,Db(b))}),Ch=sg||function(a){return r(a)&&bd(a.length)&&cg.call(a)==U},Dh=kc(Pb),Eh=kc(function(a,b,c){return c?qb(a,b,c):rb(a,b)}),Fh=sc(Eh,ob),Gh=sc(Dh,ed),Hh=wc(Fb),Ih=wc(Gb),Jh=zc(Lg),Kh=zc(Mg),Lh=Ac(Fb),Mh=Ac(Gb),Nh=ug?function(a){var b=null==a?z:a.constructor;return\"function\"==typeof b&&b.prototype===a||\"function\"!=typeof a&&Yc(a)?id(a):He(a)?ug(a):[]}:id,Oh=Bc(!0),Ph=Bc(),Qh=qe(function(a,b){if(null==a)return{};if(\"function\"!=typeof b[0]){var b=ib(Db(b),Wf);return fd(a,xb(_e(a),b))}var c=fc(b[0],b[1],3);return gd(a,function(a,b,d){return!c(a,b,d)})}),Rh=qe(function(a,b){return null==a?{}:\"function\"==typeof b[0]?gd(a,fc(b[0],b[1],3)):fd(a,Db(b))}),Sh=pc(function(a,b,c){return b=b.toLowerCase(),a+(c?b.charAt(0).toUpperCase()+b.slice(1):b)}),Th=pc(function(a,b,c){return a+(c?\"-\":\"\")+b.toLowerCase()}),Uh=Cc(),Vh=Cc(!0),Wh=pc(function(a,b,c){return a+(c?\"_\":\"\")+b.toLowerCase()}),Xh=pc(function(a,b,c){return a+(c?\" \":\"\")+(b.charAt(0).toUpperCase()+b.slice(1))}),Yh=qe(function(a,b){try{return a.apply(z,b)}catch(c){return Ee(c)?c:new Qf(c)}}),Zh=qe(function(a,b){return function(c){return Xc(c,a,b)}}),$h=qe(function(a,b){return function(c){return Xc(a,c,b)}}),_h=Ic(\"ceil\"),ai=Ic(\"floor\"),bi=tc(we,Ag),ci=tc(Se,Bg),di=Ic(\"round\");return b.prototype=c.prototype,s.prototype=Ig(c.prototype),s.prototype.constructor=s,Z.prototype=Ig(c.prototype),Z.prototype.constructor=Z,Ta.prototype[\"delete\"]=Ua,Ta.prototype.get=Va,Ta.prototype.has=Wa,\n";
 d += "Ta.prototype.set=Xa,Ya.prototype.push=$a,ne.Cache=Ta,b.after=je,b.ary=ke,b.assign=Eh,b.at=bh,b.before=le,b.bind=ph,b.bindAll=qh,b.bindKey=rh,b.callback=zf,b.chain=Od,b.chunk=nd,b.compact=od,b.constant=Af,b.countBy=ch,b.create=We,b.curry=sh,b.curryRight=th,b.debounce=me,b.defaults=Fh,b.defaultsDeep=Gh,b.defer=uh,b.delay=vh,b.difference=Rg,b.drop=pd,b.dropRight=qd,b.dropRightWhile=rd,b.dropWhile=sd,b.fill=td,b.filter=Yd,b.flatten=vd,b.flattenDeep=wd,b.flow=wh,b.flowRight=xh,b.forEach=fh,b.forEachRight=gh,b.forIn=Jh,b.forInRight=Kh,b.forOwn=Lh,b.forOwnRight=Mh,b.functions=Xe,b.groupBy=hh,b.indexBy=ih,b.initial=yd,b.intersection=Ug,b.invert=$e,b.invoke=jh,b.keys=Nh,b.keysIn=_e,b.map=_d,b.mapKeys=Oh,b.mapValues=Ph,b.matches=Cf,b.matchesProperty=Df,b.memoize=ne,b.merge=Dh,b.method=Zh,b.methodOf=$h,b.mixin=Ef,b.modArgs=yh,b.negate=oe,b.omit=Qh,b.once=pe,b.pairs=af,b.partial=zh,b.partialRight=Ah,b.partition=kh,b.pick=Rh,b.pluck=ae,b.property=Hf,b.propertyOf=If,b.pull=Bd,b.pullAt=Vg,b.range=Jf,b.rearg=Bh,b.reject=be,b.remove=Cd,b.rest=Dd,b.restParam=qe,b.set=cf,b.shuffle=de,b.slice=Ed,b.sortBy=ge,b.sortByAll=nh,b.sortByOrder=he,b.spread=re,b.take=Fd,b.takeRight=Gd,b.takeRightWhile=Hd,b.takeWhile=Id,b.tap=Pd,b.throttle=se,b.thru=Qd,b.times=Kf,b.toArray=Ue,b.toPlainObject=Ve,b.transform=df,b.union=Yg,b.uniq=Jd,b.unzip=Kd,b.unzipWith=Ld,b.values=ef,b.valuesIn=ff,b.where=ie,b.without=Zg,b.wrap=te,b.xor=Md,b.zip=$g,b.zipObject=Nd,b.zipWith=_g,b.backflow=xh,b.collect=_d,b.compose=xh,b.each=fh,b.eachRight=gh,b.extend=Eh,b.iteratee=zf,b.methods=Xe,b.object=Nd,b.select=Yd,b.tail=Dd,b.unique=Jd,Ef(b,b),b.add=Mf,b.attempt=Yh,b.camelCase=Sh,b.capitalize=jf,b.ceil=_h,b.clone=ue,b.cloneDeep=ve,b.deburr=kf,b.endsWith=lf,b.escape=mf,b.escapeRegExp=nf,b.every=Xd,b.find=dh,b.findIndex=Sg,b.findKey=Hh,b.findLast=eh,b.findLastIndex=Tg,b.findLastKey=Ih,b.findWhere=Zd,b.first=ud,b.floor=ai,b.get=Ye,b.gt=we,b.gte=xe,b.has=Ze,b.identity=Bf,b.includes=$d,b.indexOf=xd,b.inRange=gf,b.isArguments=ye,b.isArray=Ch,b.isBoolean=ze,b.isDate=Ae,b.isElement=Be,b.isEmpty=Ce,b.isEqual=De,b.isError=Ee,b.isFinite=Fe,b.isFunction=Ge,b.isMatch=Ie,b.isNaN=Je,b.isNative=Ke,b.isNull=Le,b.isNumber=Me,b.isObject=He,b.isPlainObject=Ne,b.isRegExp=Oe,b.isString=Pe,b.isTypedArray=Qe,b.isUndefined=Re,b.kebabCase=Th,b.last=zd,b.lastIndexOf=Ad,b.lt=Se,b.lte=Te,b.max=bi,b.min=ci,b.noConflict=Ff,b.noop=Gf,b.now=oh,b.pad=of,b.padLeft=Uh,b.padRight=Vh,b.parseInt=pf,b.random=hf,b.reduce=lh,b.reduceRight=mh,b.repeat=qf,b.result=bf,b.round=di,b.runInContext=y,b.size=ee,b.snakeCase=Wh,b.some=fe,b.sortedIndex=Wg,b.sortedLastIndex=Xg,b.startCase=Xh,b.startsWith=rf,b.sum=Nf,b.template=sf,b.trim=tf,b.trimLeft=uf,b.trimRight=vf,b.trunc=wf,b.unescape=xf,b.uniqueId=Lf,b.words=yf,b.all=Xd,b.any=fe,b.contains=$d,b.eq=De,b.detect=dh,b.foldl=lh,b.foldr=mh,b.head=ud,b.include=$d,b.inject=lh,Ef(b,function(){var a={};return Fb(b,function(c,d){b.prototype[d]||(a[d]=c)}),a}(),!1),b.sample=ce,b.prototype.sample=function(a){return this.__chain__||null!=a?this.thru(function(b){return ce(b,a)}):ce(this.value())},b.VERSION=A,bb([\"bind\",\"bindKey\",\"curry\",\"curryRight\",\"partial\",\"partialRight\"],function(a){b[a].placeholder=b}),bb([\"drop\",\"take\"],function(a,b){Z.prototype[a]=function(c){var d=this.__filtered__;if(d&&!b)return new Z(this);c=null==c?1:vg(rg(c)||0,0);var e=this.clone();return d?e.__takeCount__=wg(e.__takeCount__,c):e.__views__.push({size:c,type:a+(e.__dir__<0?\"Right\":\"\")}),e},Z.prototype[a+\"Right\"]=function(b){return this.reverse()[a](b).reverse()}}),bb([\"filter\",\"map\",\"takeWhile\"],function(a,b){var c=b+1,d=c!=Q;Z.prototype[a]=function(a,b){var e=this.clone();return e.__iteratees__.push({iteratee:Oc(a,b,1),type:c}),e.__filtered__=e.__filtered__||d,e}}),bb([\"first\",\"last\"],function(a,b){var c=\"take\"+(b?\"Right\":\"\");Z.prototype[a]=function(){return this[c](1).value()[0]}}),bb([\"initial\",\"rest\"],function(a,b){var c=\"drop\"+(b?\"\":\"Right\");Z.prototype[a]=function(){return this.__filtered__?new Z(this):this[c](1)}}),bb([\"pluck\",\"where\"],function(a,b){var c=b?\"filter\":\"map\",d=b?Nb:Hf;Z.prototype[a]=function(a){return this[c](d(a))}}),Z.prototype.compact=function(){return this.filter(Bf)},Z.prototype.reject=function(a,b){return a=Oc(a,b,1),this.filter(function(b){return!a(b)})},Z.prototype.slice=function(a,b){a=null==a?0:+a||0;var c=this;return c.__filtered__&&(a>0||0>b)?new Z(c):(0>a?c=c.takeRight(-a):a&&(c=c.drop(a)),b!==z&&(b=+b||0,c=0>b?c.dropRight(-b):c.take(b-a)),c)},Z.prototype.takeRightWhile=function(a,b){return this.reverse().takeWhile(a,b).reverse()},Z.prototype.toArray=function(){return this.take(Bg)},Fb(Z.prototype,function(a,c){var d=/^(?:filter|map|reject)|While$/.test(c),e=/^(?:first|last)$/.test(c),f=b[e?\"take\"+(\"last\"==c?\"Right\":\"\"):c];f&&(b.prototype[c]=function(){var b=e?[1]:arguments,c=this.__chain__,g=this.__wrapped__,h=!!this.__actions__.length,i=g instanceof Z,j=b[0],k=i||Ch(g);k&&d&&\"function\"==typeof j&&1!=j.length&&(i=k=!1);var l=function(a){return e&&c?f(a,1)[0]:f.apply(z,jb([a],b))},m={func:Qd,args:[l],thisArg:z},n=i&&!h;if(e&&!c)return n?(g=g.clone(),g.__actions__.push(m),a.call(g)):f.call(z,this.value())[0];if(!e&&k){g=n?g:new Z(this);var o=a.apply(g,b);return o.__actions__.push(m),new s(o,c)}return this.thru(l)})}),bb([\"join\",\"pop\",\"push\",\"replace\",\"shift\",\"sort\",\"splice\",\"split\",\"unshift\"],function(a){var c=(/^(?:replace|split)$/.test(a)?$f:Yf)[a],d=/^(?:push|sort|unshift)$/.test(a)?\"tap\":\"thru\",e=/^(?:join|pop|replace|shift)$/.test(a);b.prototype[a]=function(){var a=arguments;return e&&!this.__chain__?c.apply(this.value(),a):this[d](function(b){return c.apply(b,a)})}}),Fb(Z.prototype,function(a,c){var d=b[c];if(d){var e=d.name,f=Hg[e]||(Hg[e]=[]);f.push({name:c,func:d})}}),Hg[Fc(z,C).name]=[{name:\"wrapper\",func:z}],Z.prototype.clone=ba,Z.prototype.reverse=da,Z.prototype.value=Sa,b.prototype.chain=Rd,b.prototype.commit=Sd,b.prototype.concat=ah,b.prototype.plant=Td,b.prototype.reverse=Ud,b.prototype.toString=Vd,b.prototype.run=b.prototype.toJSON=b.prototype.valueOf=b.prototype.value=Wd,b.prototype.collect=b.prototype.map,b.prototype.head=b.prototype.first,b.prototype.select=b.prototype.filter,b.prototype.tail=b.prototype.rest,b}var z,A=\"3.10.1\",B=1,C=2,D=4,E=8,F=16,G=32,H=64,I=128,J=256,K=30,L=\"...\",M=150,N=16,O=200,P=1,Q=2,R=\"Expected a function\",S=\"__lodash_placeholder__\",T=\"[object Arguments]\",U=\"[object Array]\",V=\"[object Boolean]\",W=\"[object Date]\",X=\"[object Error]\",Y=\"[object Function]\",Z=\"[object Map]\",$=\"[object Number]\",_=\"[object Object]\",aa=\"[object RegExp]\",ba=\"[object Set]\",ca=\"[object String]\",da=\"[object WeakMap]\",ea=\"[object ArrayBuffer]\",fa=\"[object Float32Array]\",ga=\"[object Float64Array]\",ha=\"[object Int8Array]\",ia=\"[object Int16Array]\",ja=\"[object Int32Array]\",ka=\"[object Uint8Array]\",la=\"[object Uint8ClampedArray]\",ma=\"[object Uint16Array]\",na=\"[object Uint32Array]\",oa=/\\b__p \\+= '';/g,pa=/\\b(__p \\+=) '' \\+/g,qa=/(__e\\(.*?\\)|\\b__t\\)) \\+\\n'';/g,ra=/&(?:amp|lt|gt|quot|#39|#96);/g,sa=/[&<>\"'`]/g,ta=RegExp(ra.source),ua=RegExp(sa.source),va=/<%-([\\s\\S]+?)%>/g,wa=/<%([\\s\\S]+?)%>/g,xa=/<%=([\\s\\S]+?)%>/g,ya=/\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\n\\\\]|\\\\.)*?\\1)\\]/,za=/^\\w*$/,Aa=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\n\\\\]|\\\\.)*?)\\2)\\]/g,Ba=/^[:!,]|[\\\\^$.*+?()[\\]{}|\\/]|(^[0-9a-fA-Fnrtuvx])|([\\n\\r\\u2028\\u2029])/g,Ca=RegExp(Ba.source),Da=/[\\u0300-\\u036f\\ufe20-\\ufe23]/g,Ea=/\\\\(\\\\)?/g,Fa=/\\$\\{([^\\\\}]*(?:\\\\.[^\\\\}]*)*)\\}/g,Ga=/\\w*$/,Ha=/^0[xX]/,Ia=/^\\[object .+?Constructor\\]$/,Ja=/^\\d+$/,Ka=/[\\xc0-\\xd6\\xd8-\\xde\\xdf-\\xf6\\xf8-\\xff]/g,La=/($^)/,Ma=/['\\n\\r\\u2028\\u2029\\\\]/g,Na=function(){var a=\"[A-Z\\\\xc0-\\\\xd6\\\\xd8-\\\\xde]\",b=\"[a-z\\\\xdf-\\\\xf6\\\\xf8-\\\\xff]+\";return RegExp(a+\"+(?=\"+a+b+\")|\"+a+\"?\"+b+\"|\"+a+\"+|[0-9]+\",\"g\")}(),Oa=[\"Array\",\"ArrayBuffer\",\"Date\",\"Error\",\"Float32Array\",\"Float64Array\",\"Function\",\"Int8Array\",\"Int16Array\",\"Int32Array\",\"Math\",\"Number\",\"Object\",\"RegExp\",\"Set\",\"String\",\"_\",\"clearTimeout\",\"isFinite\",\"parseFloat\",\"parseInt\",\"setTimeout\",\"TypeError\",\"Uint8Array\",\"Uint8ClampedArray\",\"Uint16Array\",\"Uint32Array\",\"WeakMap\"],Pa=-1,Qa={};Qa[fa]=Qa[ga]=Qa[ha]=Qa[ia]=Qa[ja]=Qa[ka]=Qa[la]=Qa[ma]=Qa[na]=!0,Qa[T]=Qa[U]=Qa[ea]=Qa[V]=Qa[W]=Qa[X]=Qa[Y]=Qa[Z]=Qa[$]=Qa[_]=Qa[aa]=Qa[ba]=Qa[ca]=Qa[da]=!1;var Ra={};Ra[T]=Ra[U]=Ra[ea]=Ra[V]=Ra[W]=Ra[fa]=Ra[ga]=Ra[ha]=Ra[ia]=Ra[ja]=Ra[$]=Ra[_]=Ra[aa]=Ra[ca]=Ra[ka]=Ra[la]=Ra[ma]=Ra[na]=!0,Ra[X]=Ra[Y]=Ra[Z]=Ra[ba]=Ra[da]=!1;var Sa={\"À\":\"A\",\"Á\":\"A\",\"Â\":\"A\",\"Ã\":\"A\",\"Ä\":\"A\",\"Å\":\"A\",\"à\":\"a\",\"á\":\"a\",\"â\":\"a\",\"ã\":\"a\",\"ä\":\"a\",\"å\":\"a\",\"Ç\":\"C\",\"ç\":\"c\",\"Ð\":\"D\",\"ð\":\"d\",\"È\":\"E\",\"É\":\"E\",\"Ê\":\"E\",\"Ë\":\"E\",\"è\":\"e\",\"é\":\"e\",\"ê\":\"e\",\"ë\":\"e\",\"Ì\":\"I\",\"Í\":\"I\",\"Î\":\"I\",\"Ï\":\"I\",\"ì\":\"i\",\"í\":\"i\",\"î\":\"i\",\"ï\":\"i\",\"Ñ\":\"N\",\"ñ\":\"n\",\"Ò\":\"O\",\"Ó\":\"O\",\"Ô\":\"O\",\"Õ\":\"O\",\"Ö\":\"O\",\"Ø\":\"O\",\"ò\":\"o\",\"ó\":\"o\",\"ô\":\"o\",\"õ\":\"o\",\"ö\":\"o\",\"ø\":\"o\",\"Ù\":\"U\",\"Ú\":\"U\",\"Û\":\"U\",\"Ü\":\"U\",\"ù\":\"u\",\"ú\":\"u\",\"û\":\"u\",\"ü\":\"u\",\"Ý\":\"Y\",\"ý\":\"y\",\"ÿ\":\"y\",\"Æ\":\"Ae\",\"æ\":\"ae\",\"Þ\":\"Th\",\"þ\":\"th\",\"ß\":\"ss\"},Ta={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\",\"`\":\"&#96;\"},Ua={\"&amp;\":\"&\",\"&lt;\":\"<\",\"&gt;\":\">\",\"&quot;\":'\"',\"&#39;\":\"'\",\"&#96;\":\"`\"},Va={\"function\":!0,object:!0},Wa={0:\"x30\",1:\"x31\",2:\"x32\",3:\"x33\",4:\"x34\",5:\"x35\",6:\"x36\",7:\"x37\",8:\"x38\",9:\"x39\",A:\"x41\",B:\"x42\",C:\"x43\",D:\"x44\",E:\"x45\",F:\"x46\",a:\"x61\",b:\"x62\",c:\"x63\",d:\"x64\",e:\"x65\",f:\"x66\",n:\"x6e\",r:\"x72\",t:\"x74\",u:\"x75\",v:\"x76\",x:\"x78\"},Xa={\"\\\\\":\"\\\\\",\"'\":\"'\",\"\\n\":\"n\",\"\\r\":\"r\",\"\\u2028\":\"u2028\",\"\\u2029\":\"u2029\"},Ya=Va[typeof c]&&c&&!c.nodeType&&c,Za=Va[typeof b]&&b&&!b.nodeType&&b,$a=Ya&&Za&&\"object\"==typeof a&&a&&a.Object&&a,_a=Va[typeof self]&&self&&self.Object&&self,ab=Va[typeof window]&&window&&window.Object&&window,bb=Za&&Za.exports===Ya&&Ya,cb=$a||ab!==(this&&this.window)&&ab||_a||this,db=y();\"function\"==typeof define&&\"object\"==typeof define.amd&&define.amd?(cb._=db,define(function(){return db})):Ya&&Za?bb?(Za.exports=db)._=db:Ya._=db:cb._=db}).call(this)}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],10:[function(a,b,c){(function(a){!function(a){\"use strict\";if(\"function\"==typeof bootstrap)bootstrap(\"promise\",a);else if(\"object\"==typeof c&&\"object\"==typeof b)b.exports=a();else if(\"function\"==typeof define&&define.amd)define(a);else if(\"undefined\"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else{if(\"undefined\"==typeof window&&\"undefined\"==typeof self)throw new Error(\"This environment was not anticipated by Q. Please file a bug.\");var d=\"undefined\"!=typeof window?window:self,e=d.Q;d.Q=a(),d.Q.noConflict=function(){return d.Q=e,this}}}(function(){\"use strict\";function b(a){return function(){return X.apply(a,arguments)}}function c(a){return a===Object(a)}function d(a){return\"[object StopIteration]\"===da(a)||a instanceof T}function e(a,b){if(Q&&b.stack&&\"object\"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(ea)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var e=c.join(\"\\n\"+ea+\"\\n\");a.stack=f(e)}}function f(a){for(var b=a.split(\"\\n\"),c=[],d=0;d<b.length;++d){var e=b[d];i(e)||g(e)||!e||c.push(e)}return c.join(\"\\n\")}function g(a){return-1!==a.indexOf(\"(module.js:\")||-1!==a.indexOf(\"(node.js:\")}function h(a){var b=/at .+ \\((.+):(\\d+):(?:\\d+)\\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\\d+):(?:\\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function i(a){var b=h(a);if(!b)return!1;var c=b[0],d=b[1];return c===S&&d>=U&&ja>=d}function j(){if(Q)try{throw new Error}catch(a){var b=a.stack.split(\"\\n\"),c=b[0].indexOf(\"@\")>0?b[1]:b[2],d=h(c);if(!d)return;return S=d[0],d[1]}}function k(a,b,c){return function(){return\"undefined\"!=typeof console&&\"function\"==typeof console.warn,a.apply(a,arguments)}}function l(a){return a instanceof p?a:t(a)?C(a):B(a)}function m(){function a(a){b=a,f.source=a,Z(c,function(b,c){l.nextTick(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=aa(m.prototype),f=aa(p.prototype);if(f.promiseDispatch=function(a,e,f){var g=Y(arguments);c?(c.push(g),\"when\"===e&&f[1]&&d.push(f[1])):l.nextTick(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=r(b);return s(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:\"pending\"}},l.longStackSupport&&Q)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf(\"\\n\")+1)}return e.promise=f,e.resolve=function(c){b||a(l(c))},e.fulfill=function(c){b||a(B(c))},e.reject=function(c){b||a(A(c))},e.notify=function(a){b||Z(d,function(b,c){l.nextTick(function(){c(a)})},void 0)},e}function n(a){if(\"function\"!=typeof a)throw new TypeError(\"resolver must be a function.\");var b=m();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function o(a){return n(function(b,c){for(var d=0,e=a.length;e>d;d++)l(a[d]).then(b,c)})}function p(a,b,c){void 0===b&&(b=function(a){return A(new Error(\"Promise does not support operation: \"+a))}),void 0===c&&(c=function(){return{state:\"unknown\"}});var d=aa(p.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=A(h)}c&&c(g)},d.inspect=c,c){var e=c();\"rejected\"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return\"pending\"===a.state||\"rejected\"===a.state?d:a.value}}return d}function q(a,b,c,d){return l(a).then(b,c,d)}function r(a){if(s(a)){var b=a.inspect();if(\"fulfilled\"===b.state)return b.value}return a}function s(a){return a instanceof p}function t(a){return c(a)&&\"function\"==typeof a.then}function u(a){return s(a)&&\"pending\"===a.inspect().state}function v(a){return!s(a)||\"fulfilled\"===a.inspect().state}function w(a){return s(a)&&\"rejected\"===a.inspect().state}function x(){fa.length=0,ga.length=0,ia||(ia=!0)}function y(b,c){ia&&(\"object\"==typeof a&&\"function\"==typeof a.emit&&l.nextTick.runAfter(function(){-1!==$(ga,b)&&(a.emit(\"unhandledRejection\",c,b),ha.push(b))}),ga.push(b),c&&\"undefined\"!=typeof c.stack?fa.push(c.stack):fa.push(\"(no stack) \"+c))}function z(b){if(ia){var c=$(ga,b);-1!==c&&(\"object\"==typeof a&&\"function\"==typeof a.emit&&l.nextTick.runAfter(function(){var d=$(ha,b);-1!==d&&(a.emit(\"rejectionHandled\",fa[c],b),ha.splice(d,1))}),ga.splice(c,1),fa.splice(c,1))}}function A(a){var b=p({when:function(b){return b&&z(this),b?b(a):this}},function(){return this},function(){return{state:\"rejected\",reason:a}});return y(b,a),b}function B(a){return p({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},\"delete\":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return ca(a)}},void 0,function(){return{state:\"fulfilled\",value:a}})}function C(a){var b=m();return l.nextTick(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function D(a){return p({isDef:function(){}},function(b,c){return J(a,b,c)},function(){return l(a).inspect()})}function E(a,b,c){return l(a).spread(b,c)}function F(a){return function(){function b(a,b){var g;if(\"undefined\"==typeof StopIteration){try{g=c[a](b)}catch(h){return A(h)}return g.done?l(g.value):q(g.value,e,f)}try{g=c[a](b)}catch(h){return d(h)?l(h.value):A(h)}return q(g,e,f)}var c=a.apply(this,arguments),e=b.bind(b,\"next\"),f=b.bind(b,\"throw\");return e()}}function G(a){l.done(l.async(a)())}function H(a){throw new T(a)}function I(a){return function(){return E([this,K(arguments)],function(b,c){return a.apply(b,c)})}}function J(a,b,c){return l(a).dispatch(b,c)}function K(a){return q(a,function(a){var b=0,c=m();return Z(a,function(d,e,f){var g;s(e)&&\"fulfilled\"===(g=e.inspect()).state?a[f]=g.value:(++b,q(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function L(a){if(0===a.length)return l.resolve();var b=l.defer(),c=0;return Z(a,function(d,e,f){function g(a){b.resolve(a)}function h(){c--,0===c&&b.reject(new Error(\"Can't get fulfillment value from any promise, all promises were rejected.\"))}function i(a){b.notify({index:f,value:a})}var j=a[f];c++,q(j,g,h,i)},void 0),b.promise}function M(a){return q(a,function(a){return a=_(a,l),q(K(_(a,function(a){return q(a,V,V)})),function(){return a})})}function N(a){return l(a).allSettled()}function O(a,b){return l(a).then(void 0,void 0,b)}function P(a,b){return l(a).nodeify(b)}var Q=!1;try{throw new Error}catch(R){Q=!!R.stack}var S,T,U=j(),V=function(){},W=function(){function b(){for(var a,b;d.next;)d=d.next,a=d.task,d.task=void 0,b=d.domain,b&&(d.domain=void 0,b.enter()),c(a,b);for(;i.length;)a=i.pop(),c(a);f=!1}function c(a,c){try{a()}catch(d){if(h)throw c&&c.exit(),setTimeout(b,0),c&&c.enter(),d;setTimeout(function(){throw d},0)}c&&c.exit()}var d={task:void 0,next:null},e=d,f=!1,g=void 0,h=!1,i=[];if(W=function(b){e=e.next={task:b,domain:h&&a.domain,next:null},f||(f=!0,g())},\"object\"==typeof a&&\"[object process]\"===a.toString()&&a.nextTick)h=!0,g=function(){a.nextTick(b)};else if(\"function\"==typeof setImmediate)g=\"undefined\"!=typeof window?setImmediate.bind(window,b):function(){setImmediate(b)};else if(\"undefined\"!=typeof MessageChannel){var j=new MessageChannel;j.port1.onmessage=function(){g=k,j.port1.onmessage=b,b()};var k=function(){j.port2.postMessage(0)};g=function(){setTimeout(b,0),k()}}else g=function(){setTimeout(b,0)};return W.runAfter=function(a){i.push(a),f||(f=!0,g())},W}(),X=Function.call,Y=b(Array.prototype.slice),Z=b(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),$=b(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),_=b(Array.prototype.map||function(a,b){var c=this,d=[];return Z(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),aa=Object.create||function(a){function b(){}return b.prototype=a,new b},ba=b(Object.prototype.hasOwnProperty),ca=Object.keys||function(a){var b=[];for(var c in a)ba(a,c)&&b.push(c);return b},da=b(Object.prototype.toString);T=\"undefined\"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var ea=\"From previous event:\";l.resolve=l,l.nextTick=W,l.longStackSupport=!1,\"object\"==typeof a&&a&&a.env&&a.env.Q_DEBUG&&(l.longStackSupport=!0),l.defer=m,m.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(Y(arguments,1)):a.resolve(c)}},l.Promise=n,l.promise=n,n.race=o,n.all=K,n.reject=A,n.resolve=l,l.passByCopy=function(a){return a},p.prototype.passByCopy=function(){return this},l.join=function(a,b){return l(a).join(b)},p.prototype.join=function(a){return l([this,a]).spread(function(a,b){if(a===b)return a;throw new Error(\"Can't join: not the same: \"+a+\" \"+b)})},l.race=o,p.prototype.race=function(){return this.then(l.race)},l.makePromise=p,p.prototype.toString=function(){return\"[object Promise]\"},p.prototype.then=function(a,b,c){function d(b){try{return\"function\"==typeof a?a(b):b}catch(c){return A(c)}}function f(a){if(\"function\"==typeof b){e(a,h);try{return b(a)}catch(c){return A(c)}}return A(a)}function g(a){return\"function\"==typeof c?c(a):a}var h=this,i=m(),j=!1;return l.nextTick(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(d(a)))},\"when\",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,\"when\",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!l.onerror)throw d;l.onerror(d)}c||i.notify(b)}]),i.promise},l.tap=function(a,b){return l(a).tap(b)},p.prototype.tap=function(a){return a=l(a),this.then(function(b){return a.fcall(b).thenResolve(b)})},l.when=q,p.prototype.thenResolve=function(a){return this.then(function(){return a})},l.thenResolve=function(a,b){return l(a).thenResolve(b)},p.prototype.thenReject=function(a){return this.then(function(){throw a})},l.thenReject=function(a,b){return l(a).thenReject(b)},l.nearer=r,l.isPromise=s,l.isPromiseAlike=t,l.isPending=u,p.prototype.isPending=function(){return\"pending\"===this.inspect().state},l.isFulfilled=v,p.prototype.isFulfilled=function(){return\"fulfilled\"===this.inspect().state},l.isRejected=w,p.prototype.isRejected=function(){return\"rejected\"===this.inspect().state};var fa=[],ga=[],ha=[],ia=!0;l.resetUnhandledRejections=x,l.getUnhandledReasons=function(){return fa.slice()},l.stopUnhandledRejectionTracking=function(){x(),ia=!1},x(),l.reject=A,l.fulfill=B,l.master=D,l.spread=E,p.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},l.async=F,l.spawn=G,l[\"return\"]=H,l.promised=I,l.dispatch=J,p.prototype.dispatch=function(a,b){var c=this,d=m();return l.nextTick(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},l.get=function(a,b){return l(a).dispatch(\"get\",[b])},p.prototype.get=function(a){return this.dispatch(\"get\",[a])},l.set=function(a,b,c){return l(a).dispatch(\"set\",[b,c])},p.prototype.set=function(a,b){return this.dispatch(\"set\",[a,b])},l.del=l[\"delete\"]=function(a,b){return l(a).dispatch(\"delete\",[b])},p.prototype.del=p.prototype[\"delete\"]=function(a){return this.dispatch(\"delete\",[a])},l.mapply=l.post=function(a,b,c){return l(a).dispatch(\"post\",[b,c])},p.prototype.mapply=p.prototype.post=function(a,b){return this.dispatch(\"post\",[a,b])},l.send=l.mcall=l.invoke=function(a,b){return l(a).dispatch(\"post\",[b,Y(arguments,2)])},p.prototype.send=p.prototype.mcall=p.prototype.invoke=function(a){return this.dispatch(\"post\",[a,Y(arguments,1)])},l.fapply=function(a,b){return l(a).dispatch(\"apply\",[void 0,b])},p.prototype.fapply=function(a){return this.dispatch(\"apply\",[void 0,a])},l[\"try\"]=l.fcall=function(a){return l(a).dispatch(\"apply\",[void 0,Y(arguments,1)])},p.prototype.fcall=function(){return this.dispatch(\"apply\",[void 0,Y(arguments)])},l.fbind=function(a){var b=l(a),c=Y(arguments,1);return function(){return b.dispatch(\"apply\",[this,c.concat(Y(arguments))])}},p.prototype.fbind=function(){var a=this,b=Y(arguments);return function(){return a.dispatch(\"apply\",[this,b.concat(Y(arguments))])}},l.keys=function(a){return l(a).dispatch(\"keys\",[])},p.prototype.keys=function(){return this.dispatch(\"keys\",[])},l.all=K,p.prototype.all=function(){return K(this)},l.any=L,p.prototype.any=function(){return L(this)},l.allResolved=k(M,\"allResolved\",\"allSettled\"),p.prototype.allResolved=function(){return M(this)},l.allSettled=N,p.prototype.allSettled=function(){return this.then(function(a){return K(_(a,function(a){function b(){return a.inspect()}return a=l(a),a.then(b,b)}))})},l.fail=l[\"catch\"]=function(a,b){return l(a).then(void 0,b)},p.prototype.fail=p.prototype[\"catch\"]=function(a){return this.then(void 0,a)},l.progress=O,p.prototype.progress=function(a){return this.then(void 0,void 0,a)},l.fin=l[\"finally\"]=function(a,b){return l(a)[\"finally\"](b)},p.prototype.fin=p.prototype[\"finally\"]=function(a){return a=l(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},l.done=function(a,b,c,d){return l(a).done(b,c,d)},p.prototype.done=function(b,c,d){var f=function(a){l.nextTick(function(){if(e(a,g),!l.onerror)throw a;l.onerror(a)})},g=b||c||d?this.then(b,c,d):this;\"object\"==typeof a&&a&&a.domain&&(f=a.domain.bind(f)),g.then(void 0,f)},l.timeout=function(a,b,c){return l(a).timeout(b,c)},p.prototype.timeout=function(a,b){var c=m(),d=setTimeout(function(){b&&\"string\"!=typeof b||(b=new Error(b||\"Timed out after \"+a+\" ms\"),b.code=\"ETIMEDOUT\"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},l.delay=function(a,b){return void 0===b&&(b=a,a=void 0),l(a).delay(b)},p.prototype.delay=function(a){return this.then(function(b){var c=m();return setTimeout(function(){c.resolve(b)},a),c.promise})},l.nfapply=function(a,b){return l(a).nfapply(b)},p.prototype.nfapply=function(a){var b=m(),c=Y(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},l.nfcall=function(a){var b=Y(arguments,1);return l(a).nfapply(b)},p.prototype.nfcall=function(){var a=Y(arguments),b=m();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},l.nfbind=l.denodeify=function(a){var b=Y(arguments,1);return function(){var c=b.concat(Y(arguments)),d=m();return c.push(d.makeNodeResolver()),l(a).fapply(c).fail(d.reject),d.promise}},p.prototype.nfbind=p.prototype.denodeify=function(){var a=Y(arguments);return a.unshift(this),l.denodeify.apply(void 0,a)},l.nbind=function(a,b){var c=Y(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(Y(arguments)),f=m();return e.push(f.makeNodeResolver()),l(d).fapply(e).fail(f.reject),f.promise}},p.prototype.nbind=function(){var a=Y(arguments,0);return a.unshift(this),l.nbind.apply(void 0,a)},l.nmapply=l.npost=function(a,b,c){return l(a).npost(b,c)},p.prototype.nmapply=p.prototype.npost=function(a,b){var c=Y(b||[]),d=m();return c.push(d.makeNodeResolver()),this.dispatch(\"post\",[a,c]).fail(d.reject),d.promise},l.nsend=l.nmcall=l.ninvoke=function(a,b){var c=Y(arguments,2),d=m();return c.push(d.makeNodeResolver()),l(a).dispatch(\"post\",[b,c]).fail(d.reject),d.promise},p.prototype.nsend=p.prototype.nmcall=p.prototype.ninvoke=function(a){var b=Y(arguments,1),c=m();return b.push(c.makeNodeResolver()),this.dispatch(\"post\",[a,b]).fail(c.reject),c.promise},l.nodeify=P,p.prototype.nodeify=function(a){return a?void this.then(function(b){l.nextTick(function(){a(null,b)})},function(b){l.nextTick(function(){a(b)})}):this},l.noConflict=function(){throw new Error(\"Q.noConflict only works when Q is used as a global\")};var ja=j();return l})}).call(this,a(\"_process\"))},{_process:151}],11:[function(a,b,c){\"use strict\";function d(a){return 50*a.x+a.y}function e(a){return new J(Math.floor(a/50),a%50,C)}function f(a,b){var c=new J(a.x,a.y,a.roomName);switch(b){case r.TOP_LEFT:case r.TOP:case r.TOP_RIGHT:--c.y;break;case r.BOTTOM_LEFT:case r.BOTTOM:case r.BOTTOM_RIGHT:++c.y}switch(b){case r.TOP_LEFT:case r.LEFT:case r.BOTTOM_LEFT:--c.x;break;case r.TOP_RIGHT:case r.RIGHT:case r.BOTTOM_RIGHT:++c.x}return c}function g(a,b,c){var e=d(b);if(!H.isClosed(e)){var f=i(b)*F,g=f+c;H.isOpen(e)?G.priority(e)>g&&(G.update(e,g),I[e]=a):(G.push(e,g),H.open(e),I[e]=a)}}function h(a){if(a.x<0||a.x>49||a.y<0||a.y>49)return 1/0;if(B){var b=B.get(a.x,a.y);if(b)return 255===b?1/0:b}switch(a.lookFor(\"terrain\")[0]){case\"plain\":return D;case\"wall\":return 1/0;case\"swamp\":return E}}function i(a){if(z){for(var b=0,c=0;c<A.length;++c)b=Math.max(b,A[c].range-a.getRangeTo(A[c].pos));return b}for(var b=1/0,c=0;c<A.length;++c)b=Math.min(b,Math.max(0,a.getRangeTo(A[c].pos)-A[c].range));return b}function j(a,b,c){for(var e=r.TOP;e<=r.TOP_LEFT;++e){var i=f(b,e);if((0!==b.x&&49!==b.x||b.x!==i.x)&&(0!==b.y&&49!==b.y||b.y!==i.y)){var j=h(i);if(j!==1/0){var k=d(i);H.isClosed(k)||g(a,i,c+j)}}}}function k(a,b,c){for(var d=h(new J(b.x,b.y-1,b.roomName)),e=h(new J(b.x,b.y+1,b.roomName));;){if(0==i(b)||(b.x+2)%50<4)return b;var f=h(new J(b.x+c,b.y-1,b.roomName)),g=h(new J(b.x+c,b.y+1,b.roomName));if(f!==1/0&&d!=a||g!==1/0&&e!=a)return b;d=f,e=g,b.x+=c;var j=h(b);if(j===1/0)return;if(j!==a)return b}}function l(a,b,c){for(var d=h(new J(b.x-1,b.y,b.roomName)),e=h(new J(b.x+1,b.y,b.roomName));;){if(0==i(b)||(b.y+2)%50<4)return b;var f=h(new J(b.x-1,b.y+c,b.roomName)),g=h(new J(b.x+1,b.y+c,b.roomName));if(f!==1/0&&d!==a||g!==1/0&&e!==a)return b;d=f,e=g,b.y+=c;var j=h(b);if(j===1/0)return;if(j!==a)return b}}function m(a,b,c,d){for(var e=h(new J(b.x-c,b.y,b.roomName)),f=h(new J(b.x,b.y-d,b.roomName));;){if(0==i(b)||(b.x+2)%50<4||(b.y+2)%50<4)return b;if(h(new J(b.x-c,b.y+d,b.roomName))!==1/0&&e!==a||h(new J(b.x+c,b.y-d,b.roomName))!==1/0&&f!==a)return b;if(e=h(new J(b.x,b.y+d,b.roomName)),f=h(new J(b.x+c,b.y,b.roomName)),f!==1/0&&void 0!==k(a,new J(b.x+c,b.y,b.roomName),c)||e!==1/0&&void 0!==l(a,new J(b.x,b.y+d,b.roomName),d))return b;b.x+=c,b.y+=d;var g=h(b);if(g===1/0)return;if(g!==a)return b}}function n(a,b,c,d){return 0!==c?0!==d?m(a,b,c,d):k(a,b,c):l(a,b,d)}function o(a,b,c){var d=e(I[a]),f=b.x>d.x?1:b.x<d.x?-1:0,i=b.y>d.y?1:b.y<d.y?-1:0,j=[];if(0===b.x){if(-1===f)return;1===f&&(j.push(new J(b.x+1,b.y-1,b.roomName)),j.push(new J(b.x+1,b.y,b.roomName)),j.push(new J(b.x+1,b.y+1,b.roomName)))}else if(49==b.x){if(1===f)return;-1===f&&(j.push(new J(b.x-1,b.y-1,b.roomName)),j.push(new J(b.x-1,b.y,b.roomName)),j.push(new J(b.x-1,b.y+1,b.roomName)))}else if(0===b.y){if(-1===i)return;1===i&&(j.push(new J(b.x-1,b.y+1,b.roomName)),j.push(new J(b.x,b.y+1,b.roomName)),j.push(new J(b.x+1,b.y+1,b.roomName)))}else if(49===b.y){if(1===i)return;-1===i&&(j.push(new J(b.x-1,b.y-1,b.roomName)),j.push(new J(b.x,b.y-1,b.roomName)),j.push(new J(b.x+1,b.y-1,b.roomName)))}if(0===j.length){var k=0;b.x%50==1?k=-1:b.x%50==48&&(k=1);var l=0;b.y%50==1?l=-1:b.y%50==48&&(l=1);var m=h(b);if(0!==f){var n=new J(b.x+f,b.y,b.roomName),o=h(n);o!==1/0&&(0===l?p(b,a,n,c,m,o):g(a,n,c+o))}if(0!==i){var n=new J(b.x,b.y+i,b.roomName),o=h(n);o!==1/0&&(0===k?p(b,a,n,c,m,o):g(a,n,c+o))}if(0!==f)if(0!==i){var n=new J(b.x+f,b.y+i,b.roomName),o=h(n);o!==1/0&&p(b,a,n,c,m,o),h(new J(b.x-f,b.y,b.roomName))!==m&&p(b,a,new J(b.x-f,b.y+i,b.roomName),c,m,h(new J(b.x-f,b.y+i,b.roomName))),h(new J(b.x,b.y-i,b.roomName))!==m&&p(b,a,new J(b.x+f,b.y-i,b.roomName),c,m,h(new J(b.x+f,b.y-i,b.roomName)))}else(1===l||h(new J(b.x,b.y+1,b.roomName))!==m)&&p(b,a,new J(b.x+f,b.y+1,b.roomName),c,m,h(new J(b.x+f,b.y+1,b.roomName))),(-1===l||h(new J(b.x,b.y-1,b.roomName))!==m)&&p(b,a,new J(b.x+f,b.y-1,b.roomName),c,m,h(new J(b.x+f,b.y-1,b.roomName)));else(1===k||h(new J(b.x+1,b.y,b.roomName))!==m)&&p(b,a,new J(b.x+1,b.y+i,b.roomName),c,m,h(new J(b.x+1,b.y+i,b.roomName))),(-1===k||h(new J(b.x-1,b.y,b.roomName))!==m)&&p(b,a,new J(b.x-1,b.y+i,b.roomName),c,m,h(new J(b.x-1,b.y+i,b.roomName)))}else for(var q=0;q<j.length;++q){var o=h(j[q]);o!==1/0&&g(a,j[q],c+o)}}function p(a,b,c,d,e,f){if(f!==e){if(f===1/0)return;d+=f}else{if(c=n(f,c,c.x-a.x,c.y-a.y),void 0===c)return;d+=f*(a.getRangeTo(c)-1)+h(c)}g(b,c,d)}var q=a(\"lodash\"),r=a(\"../game/constants\"),s=a(\"../game/path-utils\"),t=s.Heap,u=s.OpenClosed,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,E=void 0,F=void 0,G=void 0,H=void 0,I=void 0,J=void 0;c.init=function(){},c.make=function(a,b,c,d){v=a,w=b,x=c,y=d,J=y.RoomPosition,H=new u(2500),G=new t(2500),I=new Uint16Array(2500)},c.search=function(a,b,c){c=c||{},B=c.roomCallback?c.roomCallback(a.roomName):void 0,G.clear(),H.clear(),C=a.roomName,D=c.plainCost||1,E=c.swampCost||5,F=Math.min(9,Math.max(1,c.heuristicWeight||1)),z=c.flee;var g=c.maxOps||2e3,h=c.maxCost||1/0,k=g;A=q.map(Array.isArray(b)?b:[b],function(a){return a instanceof J?{range:0,pos:a}:a});var l=1/0,m=1/0,n=0;if(0==i(a))return{path:[],ops:0,cost:0,incomplete:!1};if(B===!1)return{path:[],ops:0,cost:0,incomplete:!0};for(n=d(a),j(n,a,0);G.size()&&k>0;){var p=G.min(),r=G.minPriority();G.pop(),H.close(p);var s=e(p),t=i(s),u=r-Math.floor(t*F);if(0==t){n=p,l=0,m=u;break}if(l>t&&(n=p,l=t,m=u),u+t>h)break;o(p,s,u),--k}for(var v=[],w=n,x=e(w);!x.isEqualTo(a);){v.push(x),w=I[w];var y=e(w);if(y.getRangeTo(x)>1){var K=x.getDirectionTo(y);do x=f(x,K),v.push(x);while(x.getRangeTo(y)>1)}x=y}return{path:v.reverse(),ops:g-k,cost:m,incomplete:0!==l}}},{\"../game/constants\":17,\"../game/path-utils\":29,lodash:9}],12:[function(a,b,c){\"use strict\";var d=a(\"q\"),e=a(\"./local-storage\"),f=a(\"./config\");c.create=function(a){return e.put(f.localStorage.PENDING_QUEUE+a,[]),e.put(f.localStorage.PROCESSING_QUEUE+a,[]),{fetch:function(){function b(){var d;e.get(f.localStorage.PENDING_QUEUE+a).then(function(g){return 0==g.length?void setTimeout(b,50):(d=g.pop(),void e.get(f.localStorage.PROCESSING_QUEUE+a).then(function(b){return b.push(d),e.put(f.localStorage.PROCESSING_QUEUE+a,b)}).then(function(){return e.put(f.localStorage.PENDING_QUEUE+a,g)}).then(function(){return c.resolve(d)}))})}var c=d.defer();return b(),c.promise},markDone:function(b){return e.get(f.localStorage.PROCESSING_QUEUE+a).then(function(c){\n";
 d += "var d=c.indexOf(b);if(-1!=d)return c.splice(d,1),e.put(f.localStorage.PROCESSING_QUEUE+a,c)})},add:function(b){return e.get(f.localStorage.PENDING_QUEUE+a).then(function(c){return c.push(b),e.put(f.localStorage.PENDING_QUEUE+a,c)})},addMulti:function(b){return e.get(f.localStorage.PENDING_QUEUE+a).then(function(c){return c=c.concat(b),e.put(f.localStorage.PENDING_QUEUE+a,c)})},whenAllDone:function(){var b=d.defer(),c=function g(){d.all([e.get(f.localStorage.PROCESSING_QUEUE+a),e.get(f.localStorage.PENDING_QUEUE+a)]).then(function(a){a[0].length>0||a[1].length>0?setTimeout(g,10):b.resolve()})};return c(),b.promise},getAffinitySet:function(){return{}},setAffinitySet:function(a){}}}},{\"./config\":3,\"./local-storage\":7,q:10}],13:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e={},f={};c.init=function(a,b){a=\"\"+a,e[a]?d.extend(e[a],b):e[a]=b||{}},c.get=function(a){return a=\"\"+a,e[a]},c.checkObsolete=function(a,b){(!f[a]||b>f[a])&&(delete e[a],e[a]=null),f[a]=b}},{lodash:9}],14:[function(a,b,c){\"use strict\";var d=a(\"../game/game\"),e=a(\"../game/console\"),f=a(\"lodash\"),g=a(\"./runtime-user-globals\");self.onmessage=function(a){var b,c=a.data,h={list:{},set:function(a,b,c){this.list[a]=this.list[a]||{},this.list[a][b]=c},push:function(a,b,c){return this.list[a]=this.list[a]||[],this.list[a].length>=c?!1:(this.list[a].push(b),!0)},pushByName:function(a,b,c,d){return this.list[a]=this.list[a]||{},this.list[a][b]=this.list[a][b]||[],d&&this.list[a][b].length>=d?!1:(this.list[a][b].push(c),!0)},remove:function(a,b){return this.list[a][b]?(delete this.list[a][b],!0):!1}};if(c.user){g.checkObsolete(c.user._id,c.userCodeTimestamp),g.init(c.user._id);var i={get:function(){return c.userMemory},set:function(a){if(!f.isString(a))throw new Error(\"Raw memory value is not a string\");this._parsed&&delete this._parsed,c.userMemory=a}};try{var j=function(a){return a};d.runCode(g.get(c.user._id),j,c.userCode,c,h,i,e.makeConsole(c.user._id,j),c.consoleCommands,1/0,function(){return 0},function(){}),b={type:\"done\"}}catch(a){b={type:\"error\",error:f.isObject(a)&&a.stack||a.toString()}}b.intents=h.list,i._parsed&&(c.userMemory=JSON.stringify(i._parsed)),b.memory=c.userMemory,b.console={log:e.getMessages(c.user._id),results:e.getCommandResults(c.user._id)},self.postMessage(b)}}},{\"../game/console\":16,\"../game/game\":22,\"./runtime-user-globals\":13,lodash:9}],15:[function(a,b,c){\"use strict\";var d={},e=0;c.create=function(a){return self.postMessage({type:\"worker\",workerId:e,startSrc:a}),d[e]={postMessage:function(a){self.postMessage({type:\"worker\",workerId:e,message:a})},terminate:function(){self.postMessage({type:\"worker\",workerId:e,terminate:!0})}}},c.handleMessage=function(a){d[a.workerId]&&d[a.workerId].onmessage({target:d[a.workerId],data:a.message})}},{}],16:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e={},f={};c.makeConsole=function(a,b){return e[a]=[],f[a]=[],Object.create(null,{log:{writable:!0,configurable:!0,value:b(function(){\"undefined\"!=typeof self&&self.navigator.userAgent&&self.console.log.apply(console,arguments),e[a].push(d.map(arguments,function(a){return a&&a.toString?a.toString():\"undefined\"==typeof a?\"undefined\":JSON.stringify(a)}).join(\" \"))})},commandResult:{value:b(function(b){\"undefined\"!=typeof self&&self.navigator.userAgent&&self.console.log.call(console,b),f[a].push(String(b))})}})},c.getMessages=function(a){var b=e[a];return e[a]=[],b},c.getCommandResults=function(a){var b=f[a];return f[a]=[],b}},{lodash:60}],17:[function(a,b,c){\"use strict\";var d=a(\"../utils\"),e=d.getDriver();b.exports=e.constants},{\"../utils\":148}],18:[function(a,b,c){\"use strict\";var d,e,f,g,h=a(\"./../utils\"),i=(a(\"./rooms\"),h.getDriver()),j=i.constants,k=a(\"lodash\");c.make=function(a,b,c,i){if(d=a,e=b,f=c,g=i,!g.ConstructionSite){var l=function(a){if(!d.roomObjects[a])throw new Error(\"Could not find an object with ID \"+a);return d.roomObjects[a]},m=f.wrapFn(function(a){var b=l(a);g.RoomObject.call(this,b.x,b.y,b.room),this.id=a});m.prototype=Object.create(g.RoomObject.prototype),m.prototype.constructor=m,h.defineGameObjectProperties(m.prototype,l,{progress:function(a){return a.progress},progressTotal:function(a){return a.progressTotal},structureType:function(a){return a.structureType},name:function(a){return a.name},owner:function(a){return new Object({username:d.users[a.user].username})},my:function(a){return k.isUndefined(a.user)?void 0:a.user==d.user._id}}),m.prototype.toString=f.wrapFn(function(){return\"[construction site (\"+l(this.id).structureType+\") #\"+this.id+\"]\"}),m.prototype.remove=f.wrapFn(function(){return this.my||this.room&&this.room.controller&&this.room.controller.my?(e.set(this.id,\"remove\",{}),j.OK):j.ERR_NOT_OWNER}),g.ConstructionSite=m}}},{\"./../utils\":148,\"./rooms\":31,lodash:60}],19:[function(a,b,c){\"use strict\";var d,e,f,g,h,i=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h[\"return\"]&&h[\"return\"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),j=a(\"./../utils\"),k=(a(\"./rooms\"),j.getDriver()),l=a(\"lodash\"),m=k.constants;c.make=function(a,b,c,k){if(d=a,e=b,f=c,g=k,h=0,!g.Creep){var n=function(a){if(!a)throw new Error(\"This creep doesn't exist yet\");if(!d.roomObjects[a])throw new Error(\"Could not find an object with ID \"+a);return d.roomObjects[a]},o=f.wrapFn(function(a){if(a){var b=n(a);g.RoomObject.call(this,b.x,b.y,b.room),this.id=a}});o.prototype=Object.create(g.RoomObject.prototype),o.prototype.constructor=o,j.defineGameObjectProperties(o.prototype,n,{name:function(a){return a.user==d.user._id?a.name:void 0},body:function(a){return a.body},my:function(a){return a.user==d.user._id},owner:function(a){return new Object({username:d.users[a.user].username})},spawning:function(a){return a.spawning},ticksToLive:function(a){return a.ageTime?a.ageTime-d.time:void 0},carryCapacity:function(a){return a.energyCapacity},carry:function(a){var b={energy:a.energy};return m.RESOURCES_ALL.forEach(function(c){a[c]&&(b[c]=a[c])}),b},fatigue:function(a){return a.fatigue},hits:function(a){return a.hits},hitsMax:function(a){return a.hitsMax},saying:function(a){return a.actionLog&&a.actionLog.say?a.user==d.user._id?a.actionLog.say.message:a.actionLog.say.isPublic?a.actionLog.say.message:void 0:void 0}}),Object.defineProperty(o.prototype,\"memory\",{get:function(){return this.id&&!this.my||((l.isUndefined(g.Memory.creeps)||\"undefined\"===g.Memory.creeps)&&(g.Memory.creeps={}),!l.isObject(g.Memory.creeps))?void 0:g.Memory.creeps[this.name]=g.Memory.creeps[this.name]||{}},set:function(a){if(this.id&&!this.my)throw new Error(\"Could not set other player's creep memory\");if((l.isUndefined(g.Memory.creeps)||\"undefined\"===g.Memory.creeps)&&(g.Memory.creeps={}),!l.isObject(g.Memory.creeps))throw new Error(\"Could not set creep memory\");g.Memory.creeps[this.name]=a}}),o.prototype.toString=f.wrapFn(function(){return\"[creep \"+(this.id&&n(this.id).user!=d.user._id?\"#\"+this.id:this.name)+\"]\"}),o.prototype.move=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:n(this.id).fatigue>0?m.ERR_TIRED:0==this.getActiveBodyparts(m.MOVE)?m.ERR_NO_BODYPART:(a=+a,!a||1>a||a>8?m.ERR_INVALID_ARGS:(e.set(this.id,\"move\",{direction:a}),m.OK)):m.ERR_NOT_OWNER}),o.prototype.moveTo=f.wrapFn(function(a,b,c){if(!this.my)return m.ERR_NOT_OWNER;if(this.spawning)return m.ERR_BUSY;if(n(this.id).fatigue>0)return m.ERR_TIRED;if(0==this.getActiveBodyparts(m.MOVE))return m.ERR_NO_BODYPART;var e=j.fetchXYArguments(a,b,g),h=i(e,3),k=h[0],o=h[1],p=h[2];if(p=p||this.pos.roomName,l.isUndefined(k)||l.isUndefined(o))return f.assertTargetObject(a),m.ERR_INVALID_TARGET;var q=new g.RoomPosition(k,o,p);if(l.isObject(a)&&(c=l.clone(b)),c=c||{},l.isUndefined(c.reusePath)&&(c.reusePath=5),l.isUndefined(c.serializeMemory)&&(c.serializeMemory=!0),k==this.pos.x&&o==this.pos.y&&p==this.pos.roomName)return m.OK;if(c.reusePath&&this.memory&&l.isObject(this.memory)&&this.memory._move){var r=this.memory._move;if(d.time>r.time+parseInt(c.reusePath)||r.room!=this.pos.roomName)delete this.memory._move;else if(r.dest.room==p&&r.dest.x==k&&r.dest.y==o){var s=l.isString(r.path)?j.deserializePath(r.path):r.path,t=l.findIndex(s,{x:this.pos.x,y:this.pos.y});if(-1!=t){l.cloneDeep(r);s.splice(0,t+1);try{r.path=c.serializeMemory?j.serializePath(s):s}catch(u){throw u}}if(0==s.length)return this.pos.isNearTo(q)?m.OK:m.ERR_NO_PATH;var v=this.moveByPath(s);if(v==m.OK)return m.OK}}if(c.noPathFinding)return m.ERR_NOT_FOUND;var s=this.pos.findPathTo(q,c);return c.reusePath&&this.memory&&l.isObject(this.memory)&&(this.memory._move={dest:{x:k,y:o,room:p},time:d.time,path:c.serializeMemory?j.serializePath(s):l.clone(s),room:this.pos.roomName}),0==s.length?m.ERR_NO_PATH:(this.move(s[0].direction),m.OK)}),o.prototype.moveByPath=f.wrapFn(function(a){var b=this;if(l.isArray(a)&&a.length>0&&a[0]instanceof g.RoomPosition){var c=l.findIndex(a,function(a){return a.isEqualTo(b.pos)});return-1!==c||a[0].isNearTo(this.pos)?(c++,c>=a.length?m.ERR_NOT_FOUND:this.move(this.pos.getDirectionTo(a[c]))):m.ERR_NOT_FOUND}if(l.isString(a)&&(a=j.deserializePath(a)),!l.isArray(a))return m.ERR_INVALID_ARGS;var d=l.find(a,function(a){return a.x-a.dx==b.pos.x&&a.y-a.dy==b.pos.y});return d?this.move(d.direction):m.ERR_NOT_FOUND}),o.prototype.harvest=f.wrapFn(function(a){if(!this.my)return m.ERR_NOT_OWNER;if(this.spawning)return m.ERR_BUSY;if(0==this.getActiveBodyparts(m.WORK))return m.ERR_NO_BODYPART;if(!a||!a.id)return m.ERR_INVALID_TARGET;if(f.sources[a.id]&&a instanceof g.Source){if(!a.energy)return m.ERR_NOT_ENOUGH_RESOURCES;if(!a.pos.isNearTo(this.pos))return m.ERR_NOT_IN_RANGE;if(this.room.controller&&(this.room.controller.owner&&this.room.controller.owner.username!=d.user.username||this.room.controller.reservation&&this.room.controller.reservation.username!=d.user.username))return m.ERR_NOT_OWNER}else{if(!(f.minerals[a.id]&&a instanceof g.Mineral))return f.assertTargetObject(a),m.ERR_INVALID_TARGET;if(!a.mineralAmount)return m.ERR_NOT_ENOUGH_RESOURCES;if(!a.pos.isNearTo(this.pos))return m.ERR_NOT_IN_RANGE;var b=l.find(a.pos.lookFor(\"structure\"),{structureType:m.STRUCTURE_EXTRACTOR});if(!b)return m.ERR_NOT_FOUND;if(b.owner&&!b.my)return m.ERR_NOT_OWNER;if(!b.isActive())return m.ERR_RCL_NOT_ENOUGH;if(b.cooldown)return m.ERR_TIRED}return e.set(this.id,\"harvest\",{id:a.id}),m.OK}),o.prototype.drop=f.wrapFn(function(a,b){return this.my?this.spawning?m.ERR_BUSY:l.contains(m.RESOURCES_ALL,a)?n(this.id)[a]?(b||(b=n(this.id)[a]),n(this.id)[a]<b?m.ERR_NOT_ENOUGH_RESOURCES:(e.set(this.id,\"drop\",{amount:b,resourceType:a}),m.OK)):m.ERR_NOT_ENOUGH_RESOURCES:m.ERR_INVALID_ARGS:m.ERR_NOT_OWNER}),o.prototype.transfer=f.wrapFn(function(a,b,c){if(!this.my)return m.ERR_NOT_OWNER;if(this.spawning)return m.ERR_BUSY;if(0>c)return m.ERR_INVALID_ARGS;if(!l.contains(m.RESOURCES_ALL,b))return m.ERR_INVALID_ARGS;if(!(a&&a.id&&(f.spawns[a.id]||f.creeps[a.id]||f.structures[a.id])&&(a instanceof g.StructureSpawn||a instanceof g.Structure||a instanceof g.Creep)))return f.assertTargetObject(a),m.ERR_INVALID_TARGET;if(b==m.RESOURCE_ENERGY){if(f.structures[a.id]&&\"controller\"==f.structures[a.id].structureType)return this.upgradeController(a);if(f.structures[a.id]&&\"extension\"!=f.structures[a.id].structureType&&\"spawn\"!=f.structures[a.id].structureType&&\"link\"!=f.structures[a.id].structureType&&\"storage\"!=f.structures[a.id].structureType&&\"tower\"!=f.structures[a.id].structureType&&\"powerSpawn\"!=f.structures[a.id].structureType&&\"terminal\"!=f.structures[a.id].structureType&&\"container\"!=f.structures[a.id].structureType&&\"lab\"!=f.structures[a.id].structureType&&\"nuker\"!=f.structures[a.id].structureType)return m.ERR_INVALID_TARGET}else if(b==m.RESOURCE_POWER){if(f.structures[a.id]&&\"storage\"!=f.structures[a.id].structureType&&\"terminal\"!=f.structures[a.id].structureType&&\"container\"!=f.structures[a.id].structureType&&\"powerSpawn\"!=f.structures[a.id].structureType)return m.ERR_INVALID_TARGET}else if(f.structures[a.id]&&\"storage\"!=f.structures[a.id].structureType&&\"terminal\"!=f.structures[a.id].structureType&&\"container\"!=f.structures[a.id].structureType&&\"lab\"!=f.structures[a.id].structureType&&\"nuker\"!=f.structures[a.id].structureType)return m.ERR_INVALID_TARGET;if(!a.pos.isNearTo(this.pos))return m.ERR_NOT_IN_RANGE;if(!n(this.id)[b])return m.ERR_NOT_ENOUGH_RESOURCES;if(\"powerSpawn\"==a.structureType){if(n(a.id)[b]>=n(a.id)[b+\"Capacity\"])return m.ERR_FULL;if(c||(c=Math.min(n(this.id)[b],n(a.id)[b+\"Capacity\"]-n(a.id)[b])),n(this.id)[b]<c)return m.ERR_NOT_ENOUGH_RESOURCES;if(!c||n(a.id)[b]+c>n(a.id)[b+\"Capacity\"])return m.ERR_FULL}else if(\"lab\"==a.structureType){if(b!=m.RESOURCE_ENERGY&&n(a.id).mineralType&&n(a.id).mineralType!=b)return m.ERR_FULL;var d=b==m.RESOURCE_ENERGY?n(a.id).energyCapacity:n(a.id).mineralCapacity,h=b==m.RESOURCE_ENERGY?n(a.id).energy:n(a.id).mineralAmount;if(h>d)return m.ERR_FULL;if(c||(c=Math.min(n(this.id)[b],d-h)),n(this.id)[b]<c)return m.ERR_NOT_ENOUGH_RESOURCES;if(!c||h+c>d)return m.ERR_FULL}else if(\"nuker\"==a.structureType){if(b!=m.RESOURCE_ENERGY&&b!=m.RESOURCE_GHODIUM)return m.ERR_FULL;if(n(a.id)[b]>=n(a.id)[b+\"Capacity\"])return m.ERR_FULL;if(c||(c=Math.min(n(this.id)[b],n(a.id)[b+\"Capacity\"]-n(a.id)[b])),n(this.id)[b]<c)return m.ERR_NOT_ENOUGH_RESOURCES;if(!c||n(a.id)[b]+c>n(a.id)[b+\"Capacity\"])return m.ERR_FULL}else{if(!l.isUndefined(n(a.id).energyCapacity)&&j.calcResources(n(a.id))>n(a.id).energyCapacity)return m.ERR_FULL;if(c||(c=l.isUndefined(n(a.id).energyCapacity)?n(this.id)[b]:Math.min(n(this.id)[b],n(a.id).energyCapacity-j.calcResources(n(a.id)))),n(this.id)[b]<c)return m.ERR_NOT_ENOUGH_RESOURCES;if(!l.isUndefined(n(a.id).energyCapacity)&&(!c||j.calcResources(n(a.id))+c>n(a.id).energyCapacity))return m.ERR_FULL}return e.set(this.id,\"transfer\",{id:a.id,amount:c,resourceType:b}),m.OK}),o.prototype.withdraw=f.wrapFn(function(a,b,c){if(!this.my)return m.ERR_NOT_OWNER;if(this.spawning)return m.ERR_BUSY;if(0>c)return m.ERR_INVALID_ARGS;if(!l.contains(m.RESOURCES_ALL,b))return m.ERR_INVALID_ARGS;if(!(a&&a.id&&f.structures[a.id]&&a instanceof g.Structure))return f.assertTargetObject(a),m.ERR_INVALID_TARGET;if(a.my===!1&&l.any(a.pos.lookFor(\"structure\"),function(a){return a.structureType==m.STRUCTURE_RAMPART&&!a.my}))return m.ERR_NOT_OWNER;if(this.room.controller&&!this.room.controller.my&&this.room.controller.safeMode)return m.ERR_NO_BODYPART;if(b==m.RESOURCE_ENERGY){if(f.structures[a.id]&&\"extension\"!=f.structures[a.id].structureType&&\"spawn\"!=f.structures[a.id].structureType&&\"link\"!=f.structures[a.id].structureType&&\"storage\"!=f.structures[a.id].structureType&&\"tower\"!=f.structures[a.id].structureType&&\"powerSpawn\"!=f.structures[a.id].structureType&&\"terminal\"!=f.structures[a.id].structureType&&\"container\"!=f.structures[a.id].structureType&&\"lab\"!=f.structures[a.id].structureType)return m.ERR_INVALID_TARGET}else if(b==m.RESOURCE_POWER){if(f.structures[a.id]&&\"storage\"!=f.structures[a.id].structureType&&\"terminal\"!=f.structures[a.id].structureType&&\"container\"!=f.structures[a.id].structureType&&\"powerSpawn\"!=f.structures[a.id].structureType)return m.ERR_INVALID_TARGET}else if(f.structures[a.id]&&\"storage\"!=f.structures[a.id].structureType&&\"terminal\"!=f.structures[a.id].structureType&&\"container\"!=f.structures[a.id].structureType&&\"lab\"!=f.structures[a.id].structureType)return m.ERR_INVALID_TARGET;if(!a.pos.isNearTo(this.pos))return m.ERR_NOT_IN_RANGE;var d=j.calcResources(n(this.id)),h=n(this.id).energyCapacity-d;if(0>=h)return m.ERR_FULL;if(\"powerSpawn\"==a.structureType){if(c||(c=Math.min(n(a.id)[b],h)),n(a.id)[b]||n(a.id)[b]<c)return m.ERR_NOT_ENOUGH_RESOURCES;if(c>h)return m.ERR_FULL}else if(\"lab\"==a.structureType){if(b!=m.RESOURCE_ENERGY&&n(a.id).mineralType&&n(a.id).mineralType!=b)return m.ERR_INVALID_ARGS;var i=(b==m.RESOURCE_ENERGY?n(a.id).energyCapacity:n(a.id).mineralCapacity,b==m.RESOURCE_ENERGY?n(a.id).energy:n(a.id).mineralAmount);if(c||(c=Math.min(i,h)),!i||c>i)return m.ERR_NOT_ENOUGH_RESOURCES;if(c>h)return m.ERR_FULL}else{if(c||(c=Math.min(n(a.id)[b],h)),!n(a.id)[b]||n(a.id)[b]<c)return m.ERR_NOT_ENOUGH_RESOURCES;if(c>h)return m.ERR_FULL}return e.set(this.id,\"withdraw\",{id:a.id,amount:c,resourceType:b}),m.OK}),o.prototype.pickup=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:a&&a.id&&f.energy[a.id]&&a instanceof g.Energy?j.calcResources(this.carry)>=this.carryCapacity?m.ERR_FULL:a.pos.isNearTo(this.pos)?(e.set(this.id,\"pickup\",{id:a.id}),m.OK):m.ERR_NOT_IN_RANGE:(f.assertTargetObject(a),m.ERR_INVALID_TARGET):m.ERR_NOT_OWNER}),o.prototype.getActiveBodyparts=f.wrapFn(function(a){return l.filter(this.body,function(b){return b.hits>0&&b.type==a}).length}),o.prototype.attack=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:0==this.getActiveBodyparts(m.ATTACK)?m.ERR_NO_BODYPART:this.room.controller&&!this.room.controller.my&&this.room.controller.safeMode?m.ERR_NO_BODYPART:a&&a.id&&(f.creeps[a.id]||f.structures[a.id])&&(a instanceof g.Creep||a instanceof g.StructureSpawn||a instanceof g.Structure)?a.pos.isNearTo(this.pos)?(e.set(this.id,\"attack\",{id:a.id,x:a.pos.x,y:a.pos.y}),m.OK):m.ERR_NOT_IN_RANGE:(f.assertTargetObject(a),m.ERR_INVALID_TARGET):m.ERR_NOT_OWNER}),o.prototype.rangedAttack=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:0==this.getActiveBodyparts(m.RANGED_ATTACK)?m.ERR_NO_BODYPART:this.room.controller&&!this.room.controller.my&&this.room.controller.safeMode?m.ERR_NO_BODYPART:a&&a.id&&(f.creeps[a.id]||f.structures[a.id])&&(a instanceof g.Creep||a instanceof g.StructureSpawn||a instanceof g.Structure)?this.pos.inRangeTo(a,3)?(e.set(this.id,\"rangedAttack\",{id:a.id}),m.OK):m.ERR_NOT_IN_RANGE:(f.assertTargetObject(a),m.ERR_INVALID_TARGET):m.ERR_NOT_OWNER}),o.prototype.rangedMassAttack=f.wrapFn(function(){return this.my?this.spawning?m.ERR_BUSY:0==this.getActiveBodyparts(m.RANGED_ATTACK)?m.ERR_NO_BODYPART:this.room.controller&&!this.room.controller.my&&this.room.controller.safeMode?m.ERR_NO_BODYPART:(e.set(this.id,\"rangedMassAttack\",{}),m.OK):m.ERR_NOT_OWNER}),o.prototype.heal=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:0==this.getActiveBodyparts(m.HEAL)?m.ERR_NO_BODYPART:a&&a.id&&f.creeps[a.id]&&a instanceof g.Creep?a.pos.isNearTo(this.pos)?this.room.controller&&!this.room.controller.my&&this.room.controller.safeMode?m.ERR_NO_BODYPART:(e.set(this.id,\"heal\",{id:a.id,x:a.pos.x,y:a.pos.y}),m.OK):m.ERR_NOT_IN_RANGE:(f.assertTargetObject(a),m.ERR_INVALID_TARGET):m.ERR_NOT_OWNER}),o.prototype.rangedHeal=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:0==this.getActiveBodyparts(m.HEAL)?m.ERR_NO_BODYPART:a&&a.id&&f.creeps[a.id]&&a instanceof g.Creep?this.room.controller&&!this.room.controller.my&&this.room.controller.safeMode?m.ERR_NO_BODYPART:(e.set(this.id,\"rangedHeal\",{id:a.id}),m.OK):(f.assertTargetObject(a),m.ERR_INVALID_TARGET):m.ERR_NOT_OWNER}),o.prototype.repair=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:0==this.getActiveBodyparts(m.WORK)?m.ERR_NO_BODYPART:this.carry.energy?a&&a.id&&f.structures[a.id]&&(a instanceof g.Structure||a instanceof g.StructureSpawn)?this.pos.inRangeTo(a,3)?(e.set(this.id,\"repair\",{id:a.id,x:a.pos.x,y:a.pos.y}),m.OK):m.ERR_NOT_IN_RANGE:(f.assertTargetObject(a),m.ERR_INVALID_TARGET):m.ERR_NOT_ENOUGH_RESOURCES:m.ERR_NOT_OWNER}),o.prototype.build=f.wrapFn(function(a){if(!this.my)return m.ERR_NOT_OWNER;if(this.spawning)return m.ERR_BUSY;if(0==this.getActiveBodyparts(m.WORK))return m.ERR_NO_BODYPART;if(!this.carry.energy)return m.ERR_NOT_ENOUGH_RESOURCES;if(!(a&&a.id&&f.constructionSites[a.id]&&a instanceof g.ConstructionSite))return f.assertTargetObject(a),m.ERR_INVALID_TARGET;if(!this.pos.inRangeTo(a,3))return m.ERR_NOT_IN_RANGE;if(l.contains([\"spawn\",\"extension\",\"constructedWall\"],a.structureType)&&l.any(f.objectsByRoom[n(this.id).room],function(b){return b.x==a.pos.x&&b.y==a.pos.y&&l.contains(m.OBSTACLE_OBJECT_TYPES,b.type)}))return m.ERR_INVALID_TARGET;var b=this.getActiveBodyparts(m.WORK)*m.BUILD_POWER,c=a.progressTotal-a.progress,d=Math.min(b,c,this.carry.energy);return a.progress+d>=a.progressTotal&&!j.checkControllerAvailability(a.structureType,f.objectsByRoom[n(this.id).room],this.room.controller,1)?m.ERR_RCL_NOT_ENOUGH:(e.set(this.id,\"build\",{id:a.id,x:a.pos.x,y:a.pos.y}),m.OK)}),o.prototype.suicide=f.wrapFn(function(){return this.my?this.spawning?m.ERR_BUSY:(e.set(this.id,\"suicide\",{}),m.OK):m.ERR_NOT_OWNER}),o.prototype.say=f.wrapFn(function(a,b){return this.my?this.spawning?m.ERR_BUSY:(e.set(this.id,\"say\",{message:\"\"+a,isPublic:b}),m.OK):m.ERR_NOT_OWNER}),o.prototype.claimController=f.wrapFn(function(a){if(!this.my)return m.ERR_NOT_OWNER;if(this.spawning)return m.ERR_BUSY;var b=l.filter(d.userObjects,{type:\"controller\"}).length+h;return b&&(!d.user.gcl||d.user.gcl<m.GCL_MULTIPLY*Math.pow(b,m.GCL_POW))?m.ERR_GCL_NOT_ENOUGH:b>=m.GCL_NOVICE&&d.rooms[this.room.name].novice>Date.now()?m.ERR_FULL:a&&a.id&&f.structures[a.id]&&a instanceof g.Structure?0==this.getActiveBodyparts(m.CLAIM)?m.ERR_NO_BODYPART:a.pos.isNearTo(this.pos)?\"controller\"!=a.structureType?m.ERR_INVALID_TARGET:a.level>0?m.ERR_INVALID_TARGET:a.reservation&&a.reservation.username!=d.user.username?m.ERR_INVALID_TARGET:this.room.controller&&!this.room.controller.my&&this.room.controller.safeMode?m.ERR_NO_BODYPART:(h++,e.set(this.id,\"claimController\",{id:a.id}),m.OK):m.ERR_NOT_IN_RANGE:(f.assertTargetObject(a),m.ERR_INVALID_TARGET)}),o.prototype.attackController=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:a&&a.id&&f.structures[a.id]&&a instanceof g.StructureController?this.getActiveBodyparts(m.CLAIM)<5?m.ERR_NO_BODYPART:a.pos.isNearTo(this.pos)?a.owner||a.reservation?this.room.controller&&!this.room.controller.my&&this.room.controller.safeMode?m.ERR_NO_BODYPART:(e.set(this.id,\"attackController\",{id:a.id}),m.OK):m.ERR_INVALID_TARGET:m.ERR_NOT_IN_RANGE:(f.assertTargetObject(a),m.ERR_INVALID_TARGET):m.ERR_NOT_OWNER}),o.prototype.upgradeController=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:0==this.getActiveBodyparts(m.WORK)?m.ERR_NO_BODYPART:this.carry.energy?a&&a.id&&f.structures[a.id]&&a instanceof g.StructureController?a.upgradeBlocked&&a.upgradeBlocked>0?m.ERR_INVALID_TARGET:a.pos.inRangeTo(this.pos,3)?a.my?a.level&&a.owner?(e.set(this.id,\"upgradeController\",{id:a.id}),m.OK):m.ERR_INVALID_TARGET:m.ERR_NOT_OWNER:m.ERR_NOT_IN_RANGE:(f.assertTargetObject(a),m.ERR_INVALID_TARGET):m.ERR_NOT_ENOUGH_RESOURCES:m.ERR_NOT_OWNER}),o.prototype.reserveController=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:a&&a.id&&f.structures[a.id]&&a instanceof g.Structure?a.pos.isNearTo(this.pos)?\"controller\"!=a.structureType?m.ERR_INVALID_TARGET:a.owner?m.ERR_INVALID_TARGET:a.reservation&&a.reservation.username!=d.user.username?m.ERR_INVALID_TARGET:this.getActiveBodyparts(m.CLAIM)?(e.set(this.id,\"reserveController\",{id:a.id}),m.OK):m.ERR_NO_BODYPART:m.ERR_NOT_IN_RANGE:(f.assertTargetObject(a),m.ERR_INVALID_TARGET):m.ERR_NOT_OWNER}),o.prototype.notifyWhenAttacked=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:l.isBoolean(a)?(a!=n(this.id).notifyWhenAttacked&&e.set(this.id,\"notifyWhenAttacked\",{enabled:a}),m.OK):m.ERR_INVALID_ARGS:m.ERR_NOT_OWNER}),o.prototype.cancelOrder=f.wrapFn(function(a){return e.remove(this.id,a)?m.OK:m.ERR_NOT_FOUND}),o.prototype.dismantle=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:0==this.getActiveBodyparts(m.WORK)?m.ERR_NO_BODYPART:a&&a.id&&f.structures[a.id]&&(a instanceof g.Structure||a instanceof g.StructureSpawn)&&!(a instanceof g.StructurePowerBank)?a.pos.isNearTo(this.pos)?this.room.controller&&!this.room.controller.my&&this.room.controller.safeMode?m.ERR_NO_BODYPART:(e.set(this.id,\"dismantle\",{id:a.id}),m.OK):m.ERR_NOT_IN_RANGE:(f.assertTargetObject(a),m.ERR_INVALID_TARGET):m.ERR_NOT_OWNER}),o.prototype.generateSafeMode=f.wrapFn(function(a){return this.my?this.spawning?m.ERR_BUSY:n(this.id)[m.RESOURCE_GHODIUM]>=m.SAFE_MODE_COST?a&&a.id&&f.structures[a.id]&&a instanceof g.StructureController?a.pos.isNearTo(this.pos)?(e.set(this.id,\"generateSafeMode\",{id:a.id}),m.OK):m.ERR_NOT_IN_RANGE:(f.assertTargetObject(a),m.ERR_INVALID_TARGET):m.ERR_NOT_ENOUGH_RESOURCES:m.ERR_NOT_OWNER}),g.Creep=o}}},{\"./../utils\":148,\"./rooms\":31,lodash:60}],20:[function(a,b,c){\"use strict\";var d=a(\"./../utils\"),e=(a(\"./rooms\"),d.getDriver()),f=(e.constants,{});b.exports=function(a,b,c,e,g){return function(h,i,j,k){if(f.runtimeData=h,f.intents=i,f.register=j,f.globals=k,!f.globals[a]){var l=function(a){if(!f.runtimeData.roomObjects[a])throw new Error(\"Could not find an object with ID \"+a);return f.runtimeData.roomObjects[a]},m=f.register.wrapFn(function(a){var c=l(a);b?f.globals[b].call(this,a):f.globals.RoomObject.call(this,c.x,c.y,c.room),this.id=a});m.prototype=Object.create(b?f.globals[b].prototype:f.globals.RoomObject.prototype),m.prototype.constructor=m,c&&d.defineGameObjectProperties(m.prototype,l,c),g&&d.defineGameObjectProperties(m.prototype,l,{my:function(a){return a.user==f.runtimeData.user._id},owner:function(a){return new Object({username:f.runtimeData.users[a.user].username})}}),e&&e(m.prototype,f),f.globals[a]=m}}}},{\"./../utils\":148,\"./rooms\":31}],21:[function(a,b,c){\"use strict\";var d,e,f,g,h=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h[\"return\"]&&h[\"return\"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),i=a(\"./../utils\"),j=(a(\"./rooms\"),i.getDriver()),k=j.constants,l=a(\"lodash\");c.make=function(a,b,c,j){if(d=a,e=b,f=c,g=j,!g.Flag){var m=f.wrapFn(function(a,b,c,d,e,f){g.RoomObject.call(this,Number(e),Number(f),d),this.name=a,this.color=Number(b),this.secondaryColor=Number(c||b)});m.prototype=Object.create(g.RoomObject.prototype),m.prototype.constructor=m,Object.defineProperty(m.prototype,\"memory\",{get:function(){return(l.isUndefined(g.Memory.flags)||\"undefined\"===g.Memory.flags)&&(g.Memory.flags={}),l.isObject(g.Memory.flags)?g.Memory.flags[this.name]=g.Memory.flags[this.name]||{}:void 0},set:function(a){if((l.isUndefined(g.Memory.flags)||\"undefined\"===g.Memory.flags)&&(g.Memory.flags={}),!l.isObject(g.Memory.flags))throw new Error(\"Could not set flag memory\");g.Memory.flags[this.name]=a}}),m.prototype.toString=f.wrapFn(function(){return\"[flag \"+this.name+\"]\"}),m.prototype.remove=f.wrapFn(function(){return e.pushByName(\"room\",\"removeFlag\",{roomName:this.pos.roomName,name:this.name}),k.OK}),m.prototype.setPosition=f.wrapFn(function(a,b){var c=i.fetchXYArguments(a,b,g),d=h(c,3),f=d[0],j=d[1],m=d[2];return m=m||this.pos.roomName,l.isUndefined(f)||l.isUndefined(j)?k.ERR_INVALID_TARGET:(e.pushByName(\"room\",\"removeFlag\",{roomName:this.pos.roomName,name:this.name}),e.pushByName(\"room\",\"createFlag\",{roomName:m,x:f,y:j,name:this.name,color:this.color,secondaryColor:this.secondaryColor}),k.OK)}),m.prototype.setColor=f.wrapFn(function(a,b){return l.contains(k.COLORS_ALL,a)?(b=b||a,l.contains(k.COLORS_ALL,b)?(e.pushByName(\"room\",\"removeFlag\",{roomName:this.pos.roomName,name:this.name}),e.pushByName(\"room\",\"createFlag\",{roomName:this.pos.roomName,x:this.pos.x,y:this.pos.y,name:this.name,color:a,secondaryColor:b}),k.OK):k.ERR_INVALID_ARGS):k.ERR_INVALID_ARGS}),g.Flag=m}}},{\"./../utils\":148,\"./rooms\":31,lodash:60}],22:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}!function(){function b(a,b){}function e(a,b){if(j.extend(a,{creeps:{},structures:{},ownedStructures:{},spawns:{},sources:{},energy:{},flags:{},constructionSites:{},minerals:{},nukes:{}}),b){var c=Object.keys(a);a.spatial={},c.forEach(function(b){a.spatial[b]=new Array(50);for(var c=0;50>c;c++)a.spatial[b][c]=new Array(50)})}}function f(a,b,c,d){(!q[b]||q[b](c))&&(a.findCache[b]=a.findCache[b]||{},a.findCache[b][d.room]=a.findCache[b][d.room]||[],a.findCache[b][d.room].push(c))}function g(a,b,c,d){a[b][c.id]=c,a.byRoom[d.room][b][c.id]=c,a.byRoom[d.room].spatial[b][d.y][d.x]=a.byRoom[d.room].spatial[b][d.y][d.x]||[],a.byRoom[d.room].spatial[b][d.y][d.x].push(c)}function h(a){if(a=a.replace(/^\\.\\//,\"\"),a in this.globals.require.cache){if(-1===this.globals.require.cache[a])throw new Error(\"Circular reference to module '\"+a+\"'\")}else{if(j.isUndefined(this.codeModules[a]))throw new Error(\"Unknown module '\"+a+\"'\");this.globals.require.cache[a]=-1;var b={exports:{},user:this.runtimeData.user._id,timestamp:this.runtimeData.userCodeTimestamp,name:a,code:this.codeModules[a]};try{l.evalCode(b,this.globals,!1,this.timeout,this.scriptCachedData)}catch(c){throw delete this.globals.require.cache[a],c}this.globals.require.cache[a]=b.exports,b.__initGlobals&&(this.globals.require.initGlobals=this.globals.require.initGlobals||{},this.globals.require.initGlobals[a]=b.__initGlobals)}return this.globals.require.cache[a]}var i,j=a(\"lodash\"),k=a(\"../utils\"),l=k.getDriver(),m=l.constants,n=a(\"./map\"),o=a(\"./market\"),p=a(\"./custom-prototypes\"),q=(i={},d(i,m.FIND_CREEPS,function(a){return!a.spawning}),d(i,m.FIND_MY_CREEPS,function(a){return!a.spawning&&a.my}),d(i,m.FIND_HOSTILE_CREEPS,function(a){return!a.spawning&&!a.my}),d(i,m.FIND_MY_SPAWNS,function(a){return a.my===!0}),d(i,m.FIND_HOSTILE_SPAWNS,function(a){return a.my===!1}),d(i,m.FIND_SOURCES_ACTIVE,function(a){return a.energy>0}),d(i,m.FIND_MY_STRUCTURES,function(a){return a.my===!0}),d(i,m.FIND_HOSTILE_STRUCTURES,function(a){return a.my===!1&&a.owner}),d(i,m.FIND_MY_CONSTRUCTION_SITES,function(a){return a.my}),d(i,m.FIND_HOSTILE_CONSTRUCTION_SITES,function(a){return a.my===!1}),i);l.config.makeGameObject=function(c,h,i,k,r,s,t){var u={};l.customObjectPrototypes&&l.customObjectPrototypes.forEach(function(a){a.opts=a.opts||{},u[a.objectType]={name:a.name,make:p(a.name,a.opts.parent,a.opts.properties,a.opts.prototypeExtender,!!a.opts.userOwned),findConstant:a.opts.findConstant}});var v={_useNewPathFinder:!0,_objects:{},byRoom:{},findCache:{},rooms:{},wrapFn:t},w=[];v.deprecated=function(a){j.contains(w,a)||(w.push(a),r.console.log(a))},v.assertTargetObject=function(a){if(a&&j.isPlainObject(a)&&j.isString(a.id)&&24==a.id.length)throw new Error(\"It seems you're trying to use a serialized game object stored in Memory which is not allowed. Please use `Game.getObjectById` to retrieve a live object reference instead.\")},e(v);var x=Math.floor(Math.pow((c.user.gcl||0)/m.GCL_MULTIPLY,1/m.GCL_POW))+1,y=Math.pow(x-1,m.GCL_POW)*m.GCL_MULTIPLY,z={creeps:{},spawns:{},structures:{},flags:{},constructionSites:{},rooms:{},time:c.time,cpuLimit:c.cpu,cpu:{getUsed:function(){return k()},tickLimit:c.cpu,limit:c.user.cpu,bucket:c.cpuBucket},map:{},gcl:{level:x,progress:(c.user.gcl||0)-y,progressTotal:Math.pow(x,m.GCL_POW)*m.GCL_MULTIPLY-y},market:{},resources:d({},m.SUBSCRIPTION_TOKEN,c.user.subscriptionTokens||0),getObjectById:function(a){return v._objects[a]||null},notify:function(a,b){return h.push(\"notify\",{message:a,groupInterval:b},20)?m.OK:m.ERR_FULL}};b(c.user._id,\"before objects by room\"),v.objectsByRoom={},v.objectsByRoomKeys={},j.forEach(c.roomObjects,function(a,b){a.temp||(v.objectsByRoom[a.room]=v.objectsByRoom[a.room]||{},v.objectsByRoom[a.room][b]=a,v.objectsByRoomKeys[a.room]=v.objectsByRoomKeys[a.room]||[],v.objectsByRoomKeys[a.room].push(b))}),b(c.user._id,\"after objects by room\");for(var A in c.rooms)v.byRoom[A]={},e(v.byRoom[A],!0);b(c.user._id,\"requires 0\"),a(\"./rooms\").make(c,h,v,r),a(\"./rooms\").makePos(v,r),a(\"./creeps\").make(c,h,v,r),a(\"./structures\").make(c,h,v,r),a(\"./sources\").make(c,h,v,r),a(\"./minerals\").make(c,h,v,r),a(\"./nukes\").make(c,h,v,r),a(\"./resources\").make(c,h,v,r),\n";
 d += "a(\"./flags\").make(c,h,v,r),a(\"./construction-sites\").make(c,h,v,r),a(\"./path-finder\").make(c,h,v,r);for(var A in c.rooms)v.rooms[A]=new r.Room(A);for(var A in u)u[A].make(c,h,v,r);z.rooms=j.clone(v.rooms);var B={rampart:r.StructureRampart,road:r.StructureRoad,extension:r.StructureExtension,constructedWall:r.StructureWall,keeperLair:r.StructureKeeperLair,controller:r.StructureController,link:r.StructureLink,storage:r.StructureStorage,tower:r.StructureTower,observer:r.StructureObserver,powerBank:r.StructurePowerBank,powerSpawn:r.StructurePowerSpawn,lab:r.StructureLab,extractor:r.StructureExtractor,terminal:r.StructureTerminal,container:r.StructureContainer,spawn:r.StructureSpawn,nuker:r.StructureNuker,portal:r.StructurePortal};b(c.user._id,\"before objects\");var C={};for(var A in c.roomObjects){var D=c.roomObjects[A];D.temp||(C[D.type]=C[D.type]||0,C[D.type]++,\"creep\"==D.type&&(v._objects[A]=new r.Creep(A),g(v,\"creeps\",v._objects[A],D),c.userObjects[A]&&(z.creeps[v.creeps[A].name]?v.creeps[A].suicide():z.creeps[v.creeps[A].name]=v.creeps[A]),f(v,m.FIND_CREEPS,v.creeps[A],D),f(v,m.FIND_MY_CREEPS,v.creeps[A],D),f(v,m.FIND_HOSTILE_CREEPS,v.creeps[A],D)),B[D.type]&&(v._objects[A]=new B[D.type](A),g(v,\"structures\",v._objects[A],D),v._objects[A]instanceof r.OwnedStructure&&(c.userObjects[A]&&(z.structures[v.structures[A].id]=v.structures[A]),g(v,\"ownedStructures\",v._objects[A],D)),f(v,m.FIND_STRUCTURES,v.structures[A],D),f(v,m.FIND_MY_STRUCTURES,v.structures[A],D),f(v,m.FIND_HOSTILE_STRUCTURES,v.structures[A],D),\"spawn\"==D.type&&(g(v,\"spawns\",v._objects[A],D),c.userObjects[A]&&(z.spawns[v.spawns[A].name]=v.spawns[A]),f(v,m.FIND_MY_SPAWNS,v.spawns[A],D),f(v,m.FIND_HOSTILE_SPAWNS,v.spawns[A],D))),D.off||\"extension\"!=D.type&&\"spawn\"!=D.type||(v.rooms[D.room].energyAvailable+=D.energy,v.rooms[D.room].energyCapacityAvailable+=D.energyCapacity),\"source\"==D.type&&(v._objects[A]=new r.Source(A),g(v,\"sources\",v._objects[A],D),f(v,m.FIND_SOURCES,v.sources[A],D),f(v,m.FIND_SOURCES_ACTIVE,v.sources[A],D)),\"mineral\"==D.type&&(v._objects[A]=new r.Mineral(A),g(v,\"minerals\",v._objects[A],D),f(v,m.FIND_MINERALS,v.minerals[A],D)),\"energy\"==D.type&&(v._objects[A]=new r.Energy(A),g(v,\"energy\",v._objects[A],D),f(v,m.FIND_DROPPED_ENERGY,v.energy[A],D)),\"nuke\"==D.type&&(v._objects[A]=new r.Nuke(A),g(v,\"nukes\",v._objects[A],D),f(v,m.FIND_NUKES,v._objects[A],D)),\"constructionSite\"==D.type&&(v._objects[A]=new r.ConstructionSite(A),c.userObjects[A]&&(z.constructionSites[v._objects[A].id]=v._objects[A],v.byRoom[c.userObjects[A].room]||(v.byRoom[c.userObjects[A].room]={},e(v.byRoom[c.userObjects[A].room],!0))),g(v,\"constructionSites\",v._objects[A],D),c.rooms[D.room]&&(f(v,m.FIND_CONSTRUCTION_SITES,v.constructionSites[A],D),f(v,m.FIND_MY_CONSTRUCTION_SITES,v.constructionSites[A],D),f(v,m.FIND_HOSTILE_CONSTRUCTION_SITES,v.constructionSites[A],D))),u[D.type]&&(v._objects[A]=new r[u[D.type].name](A),u[D.type].findConstant&&f(v,u[D.type].findConstant,v._objects[A],D)))}return b(c.user._id,\"after objects 1\"),c.flags.forEach(function(a){var b=a.data.split(\"|\");b.forEach(function(b){if(b){var c=b.split(\"~\");c[0]=c[0].replace(/\\$VLINE\\$/g,\"|\").replace(/\\$TILDE\\$/g,\"~\");var d=\"flag_\"+c[0],e=v._objects[d]=new r.Flag(c[0],c[1],c[2],a.room,c[3],c[4]);v.flags[d]=e,v.byRoom[a.room]&&(v.byRoom[a.room].flags[d]=e,v.byRoom[a.room].spatial.flags[c[4]][c[3]]=v.byRoom[a.room].spatial.flags[c[4]][c[3]]||[],v.byRoom[a.room].spatial.flags[c[4]][c[3]].push(e)),z.flags[c[0]]=e,(!q[m.FIND_FLAGS]||q[m.FIND_FLAGS](e))&&(v.findCache[m.FIND_FLAGS]=v.findCache[m.FIND_FLAGS]||{},v.findCache[m.FIND_FLAGS][a.room]=v.findCache[m.FIND_FLAGS][a.room]||[],v.findCache[m.FIND_FLAGS][a.room].push(e))}})}),b(c.user._id,\"after objects 2\"),z.map=v.map=n.makeMap(c,v),s(\"beforeMarket\"),z.market=v.market=o.make(c,h,v),s(\"afterMarket\"),j.extend(r,JSON.parse(JSON.stringify(m))),s(\"afterCloneConstants\"),z},function(){var a={};c.runCode=function(c,d,e,f,g,i,k,m,n,o,p,q,r){var s=f.user._id;a[s]=a[s]||{},a[s].globals=c,a[s].sandboxedFunctionWrapper=d,a[s].codeModules=e,a[s].runtimeData=f,a[s].intents=g,a[s].memory=i,a[s].fakeConsole=k,a[s].consoleCommands=m,a[s].timeout=n,a[s].getUsedCpu=o,a[s].resetUsedCpu=p,a[s].markStats=q||function(){},a[s].scriptCachedData=r,j.extend(a[s].globals,{RawMemory:a[s].memory,console:a[s].fakeConsole}),a[s].globals._||(a[s].globals._=j.runInContext()),Object.defineProperty(a[s].globals,\"Memory\",{configurable:!0,enumerable:!0,get:function(){try{a[s].memory._parsed=JSON.parse(a[s].memory.get()||\"{}\"),a[s].memory._parsed.__proto__=null}catch(b){a[s].memory._parsed=null}return Object.defineProperty(a[s].globals,\"Memory\",{configurable:!0,enumerable:!0,value:a[s].memory._parsed}),a[s].memory._parsed}}),a[s].markStats(\"beforeMake\"),a[s].globals.Game=l.config.makeGameObject(a[s].runtimeData,a[s].intents,a[s].memory,a[s].getUsedCpu,a[s].globals,a[s].markStats,a[s].sandboxedFunctionWrapper,b),a[s].markStats(\"afterMake\"),b(s,\"markGameObject\"),\"2\"==a[s].runtimeData.user._id&&(a[s].codeModules={main:\"PathFinder.use(true);  var  healer  =  require('healer'),  findAttack  =  require('findAttack');  for  (var  i  in  Game.creeps)  {  var  creep  =  Game.creeps[i];  if  (!creep.room)  {  continue;  }  if  (creep.getActiveBodyparts('heal')  >  0)  {  healer(creep);  }  else  {  findAttack(Game.creeps[i]);  }  require('shootAtWill')(creep);  }  for  (var  i  in  Memory.creeps)  {  if  (!Game.creeps[i])  {  delete  Memory.creeps[i];  }  }\",findAttack:\"var flee = require('flee'); function checkPath(pos1, pos2) { var path = pos1.findPathTo(pos2); if (!path.length) { return false; } return path[path.length - 1].x == pos2.x && path[path.length - 1].y == pos2.y; } function costCallbackIgnoreRamparts(roomName, cm) { var ramparts = Game.rooms[roomName].find(FIND_STRUCTURES, {filter: i => i.structureType == STRUCTURE_RAMPART || i.structureType == STRUCTURE_WALL}); ramparts.forEach(i => cm.set(i.pos.x, i.pos.y, 0)); } module.exports = function (creep) { if (!creep.getActiveBodyparts(ATTACK) && creep.getActiveBodyparts(RANGED_ATTACK) && flee(creep, 3)) { return; } var target, healers = creep.room.find(FIND_MY_CREEPS, { filter: function (i) { return i.getActiveBodyparts('heal') > 0; } }); if (creep.hits < creep.hitsMax / 2 && healers.length > 0 && !creep.getActiveBodyparts(ATTACK)) { target = creep.pos.findClosestByPath(FIND_MY_CREEPS, { ignoreRoads: true, filter: function (i) { return i.getActiveBodyparts('heal') > 0; } }); if (!target || creep.moveTo(target, {maxRooms: 1, ignoreRoads: true}) != OK) { target = null; } } var nearCreeps = creep.pos.findInRange(FIND_HOSTILE_CREEPS, 1, { filter: function (i) { return i.owner.username != 'Source Keeper' } }); if (nearCreeps) { creep.attack(nearCreeps[0]); } if (!target) { target = creep.pos.findClosestByPath(FIND_HOSTILE_CREEPS, { ignoreRoads: true, ignoreCreeps: true, filter: function (i) { return i.owner.username != 'Source Keeper' } }); if (target && (creep.getActiveBodyparts(ATTACK) || !creep.pos.inRangeTo(target, 3))) { creep.moveTo(target, {maxRooms: 1, ignoreRoads: true, ignoreCreeps: true}); } } if (!target) { target = creep.pos.findClosestByPath(FIND_HOSTILE_CREEPS, { ignoreRoads: true, filter: function (i) { return i.owner.username != 'Source Keeper' }, costCallback: costCallbackIgnoreRamparts }); if (target && (creep.getActiveBodyparts(ATTACK) || !creep.pos.inRangeTo(target, 3))) { creep.moveTo(target, {maxRooms: 1, ignoreRoads: true, costCallback: costCallbackIgnoreRamparts}); } } if (!target) { target = creep.pos.findClosestByPath(FIND_HOSTILE_CREEPS, { ignoreDestructibleStructures: true, ignoreRoads: true, filter: function (i) { return i.owner.username != 'Source Keeper' } }); if (target && (creep.getActiveBodyparts(ATTACK) || !creep.pos.inRangeTo(target, 3))) { creep.moveTo(target, {ignoreDestructibleStructures: true, maxRooms: 1, ignoreRoads: true}); } } if (!target) { if (creep.room.controller && creep.room.controller.level > 0 && !creep.room.find(FIND_HOSTILE_CREEPS).length) { var spawns = _.filter(creep.room.find(FIND_HOSTILE_SPAWNS), spawn => !checkPath(creep.pos, spawn.pos)); if (!spawns.length) { creep.suicide(); return; } target = spawns[0]; if (target) { creep.moveTo(target, {ignoreDestructibleStructures: true, maxRooms: 1, ignoreRoads: true}); } } return; } creep.attack(target); if (creep.getActiveBodyparts(WORK) > 0 && creep.memory._move && creep.memory._move.path) { var path = Room.deserializePath(creep.memory._move.path); if (path.length && creep.pos.isNearTo(path[0].x, path[0].y)) { var structures = creep.room.lookForAt('structure', path[0].x, path[0].y); if (structures.length > 0) { creep.dismantle(structures[0]); } } } }\",flee:\"var rooms = require('rooms'); module.exports = function(creep, range) { var nearCreeps = creep.pos.findInRange(FIND_HOSTILE_CREEPS, range-1, {filter: i => i.getActiveBodyparts(ATTACK) > 0 || i.getActiveBodyparts(RANGED_ATTACK) > 0}); if(nearCreeps.length > 0) { var ret = PathFinder.search(creep.pos, _.map(nearCreeps, i => ({pos: i.pos, range: range})), { maxRooms: 1, flee: true, roomCallback(roomName) { if(!rooms.rooms[roomName] || rooms.rooms[roomName].time < Game.time) { rooms.rooms[roomName] = {costMatrix: rooms.createCostMatrix(roomName), time: Game.time}; } return rooms.rooms[roomName].costMatrix; } }); if(ret.path.length) { creep.moveTo(ret.path[0]); creep.say('flee'); return true; } } return false; }\",healer:\"var flee = require('flee'); module.exports = function (creep) { var target; var healTargets = creep.pos.findInRange(FIND_MY_CREEPS, 3); if(healTargets.length > 0) { healTargets = healTargets.sort((a,b) => (b.hitsMax - b.hits) - (a.hitsMax - a.hits)); if (creep.pos.isNearTo(healTargets[0])) { creep.heal(healTargets[0]); } else { creep.rangedHeal(healTargets[0]); } } if (creep.hits < creep.hitsMax / 2) { if (!flee(creep)) { target = creep.pos.findClosestByPath(FIND_MY_CREEPS, {filter: i => i.getActiveBodyparts('heal') > 0}); if (target) { creep.moveTo(target, {maxRooms: 1, ignoreRoads: true}); } } return; } target = creep.pos.findClosestByRange(FIND_MY_CREEPS, {filter: i => i.hits < i.hitsMax}); if (!target) { if (flee(creep, 4)) { return; } target = creep.pos.findClosestByRange(FIND_MY_CREEPS, {filter: i => i != creep && i.getActiveBodyparts(HEAL) == 0}); } if (!target) { creep.suicide(); return; } if (creep.pos.isNearTo(target)) { creep.move(creep.pos.getDirectionTo(target)); } else { creep.moveTo(target, {maxRooms: 1, ignoreRoads: true, reusePath: 0}); } if (creep.getActiveBodyparts(RANGED_ATTACK)) { require('shootAtWill')(creep); } }\",rooms:\"module.exports = { rooms: {}, createCostMatrix(roomName) { var cm = new PathFinder.CostMatrix; Game.rooms[roomName].find(FIND_CREEPS).forEach(i => cm.set(i.pos.x, i.pos.y, 255)); Game.rooms[roomName].find(FIND_STRUCTURES).forEach(i => { if(i.structureType != STRUCTURE_ROAD && i.structureType != STRUCTURE_CONTAINER) { cm.set(i.pos.x, i.pos.y, 255); } }); return cm; } } \",shootAtWill:\"module.exports = function (creep) { if(!creep.getActiveBodyparts(RANGED_ATTACK)) { return; } var targets = creep.pos.findInRange(FIND_HOSTILE_CREEPS, 3, { filter: function (i) { return i.owner.username != 'Source Keeper' } }); if (!targets.length) { targets = creep.pos.findInRange(FIND_STRUCTURES, 3, { filter: function (i) { return i.structureType == STRUCTURE_RAMPART || i.structureType == STRUCTURE_WALL; } }); } var min = -1, target; for (var i in targets) { if (min == -1 || min > targets[i].hits) { target = targets[i]; min = targets[i].hits; } } creep.rangedAttack(target); }\"},a[s].runtimeData.userCodeTimestamp=2),\"3\"==a[s].runtimeData.user._id&&(a[s].codeModules={main:\"PathFinder.use(true);  for (var i in Game.creeps) { var creep = Game.creeps[i], source = undefined; if (!creep.room) { continue; } if (creep.memory.sourceId) { source = Game.getObjectById(creep.memory.sourceId); } if(!source) { source = creep.pos.findInRange(FIND_SOURCES, 5)[0] || creep.pos.findInRange(FIND_MINERALS, 5)[0]; if (source) { creep.memory.sourceId = source.id; } } if (source) { if (!creep.pos.isNearTo(source)) { if (creep.moveTo(source, {reusePath: 50}) == ERR_NO_PATH) { delete creep.memory._move; creep.moveTo(source, {reusePath: 50, ignoreDestructibleStructures: true}); } } } var enemies = creep.pos.findInRange(FIND_HOSTILE_CREEPS, 1, { filter: function (i) { return i.owner.username != 'Invader' } }); if (enemies.length) { enemies.sort(function (a, b) { return a.hits - b.hits; }); creep.attack(enemies[0]); } var enemies = creep.pos.findInRange(FIND_HOSTILE_CREEPS, 3, { filter: function (i) { return i.owner.username != 'Invader' } }); if (enemies.length) { var massDmg = 0, distanceDmg = {1: 10, 2: 4, 3: 1}; for (var i in enemies) { var distance = Math.max(Math.abs(enemies[i].pos.x - creep.pos.x), Math.abs(enemies[i].pos.y - creep.pos.y)); massDmg += distanceDmg[distance]; } if (massDmg > 13) { creep.rangedMassAttack(); } else { enemies.sort(function (a, b) { return a.hits - b.hits; }); creep.rangedAttack(enemies[0]); } } for (var i in Memory.creeps) { if (!Game.creeps[i]) { delete Memory.creeps[i]; } } }\"},a[s].runtimeData.userCodeTimestamp=2),a[s].globals.require&&a[s].runtimeData.userCodeTimestamp==a[s].globals.require.timestamp&&j.isObject(a[s].globals.require.cache.main)&&j.isFunction(a[s].globals.require.cache.main.loop)||(a[s].globals.require=a[s].sandboxedFunctionWrapper(h.bind(a[s])),a[s].globals.require.cache={lodash:a[s].globals._},a[s].globals.require.timestamp=a[s].runtimeData.userCodeTimestamp),l.config.emit(\"playerSandbox\",a[s].globals,s),a[s].resetUsedCpu();var t=a[s].globals.require(\"main\");if(j.isObject(t)&&j.isFunction(t.loop)&&(a[s].globals.require.initGlobals&&j.forEach(a[s].globals.require.initGlobals,function(a){return a()}),l.evalCode({exports:t,user:a[s].runtimeData.user._id,timestamp:a[s].runtimeData.userCodeTimestamp,name:\"__mainLoop\",code:\"module.exports.loop();\"},a[s].globals,!1,a[s].timeout)),a[s].consoleCommands)for(var u=0;u<a[s].consoleCommands.length;u++){var v=l.evalCode({exports:{},user:a[s].runtimeData.user._id,name:\"_console\"+(new Date).getTime()+\"_\"+u,code:a[s].consoleCommands[u].expression},a[s].globals,!0);a[s].consoleCommands[u].hidden||a[s].fakeConsole.commandResult(v)}}}()}()},{\"../utils\":148,\"./construction-sites\":18,\"./creeps\":19,\"./custom-prototypes\":20,\"./flags\":21,\"./map\":23,\"./market\":24,\"./minerals\":25,\"./nukes\":27,\"./path-finder\":28,\"./resources\":30,\"./rooms\":31,\"./sources\":32,\"./structures\":33,lodash:60}],23:[function(a,b,c){\"use strict\";var d=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h[\"return\"]&&h[\"return\"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),e=a(\"../utils\"),f=e.getDriver(),g=f.constants,h=a(\"lodash\"),i=(a(\"util\"),a(\"./path-utils\")),j=i.Heap,k=i.OpenClosed,l=30;c.makeMap=function(a,b){function c(b){if(!/^(W|E)\\d+(N|S)\\d+$/.test(b))return null;var c=e.roomNameToXY(b),f=d(c,2),h=f[0],i=f[1],j=a.mapGrid.gridData[h+\",\"+i];if(!j)return null;var k={};return j.t&&(k[g.TOP]=e.getRoomNameFromXY(h,i-1)),j.b&&(k[g.BOTTOM]=e.getRoomNameFromXY(h,i+1)),j.l&&(k[g.LEFT]=e.getRoomNameFromXY(h-1,i)),j.r&&(k[g.RIGHT]=e.getRoomNameFromXY(h+1,i)),k}function f(a,b){var c=q-a,d=r-b;return 0>c||c>=2*l||0>d||d>=2*l?void 0:c*l*2+d}function i(a){return[q-Math.floor(a/(2*l)),r-a%(2*l)]}function m(a,b){return Math.abs(a-s)+Math.abs(b-t)}var n,o,p,q,r,s,t;return{findRoute:function(a,b,u){if(h.isObject(a)&&(a=a.name),h.isObject(b)&&(b=b.name),a==b)return[];if(!/(W|E)\\d+(N|S)\\d+$/.test(a)||!/(W|E)\\d+(N|S)\\d+$/.test(b))return g.ERR_NO_PATH;var v=e.roomNameToXY(a),w=d(v,2),x=w[0],y=w[1],z=e.roomNameToXY(b),A=d(z,2);if(s=A[0],t=A[1],x==s&&y==t)return[];q=x+l,r=y+l,n?(n.clear(),o.clear()):(n=new j(Math.pow(2*l,2),Float64Array),o=new k(Math.pow(2*l,2))),p||(p=new Uint16Array(Math.pow(2*l,2)));var B=f(x,y);n.push(B,m(x,y));for(var C=u&&u.routeCallback||function(){return 1};n.size();){var D=n.min(),E=n.minPriority();n.pop(),o.close(D);var F=i(D),G=d(F,2),H=G[0],I=G[1],J=m(H,I),K=E-J;if(0===J){for(var L=[];D!==B;){var M=i(D),N=d(M,2),O=N[0],P=N[1];D=p[D];var Q=i(D),R=d(Q,2),S=R[0],T=R[1],U=void 0;U=O>S?g.FIND_EXIT_RIGHT:S>O?g.FIND_EXIT_LEFT:P>T?g.FIND_EXIT_BOTTOM:g.FIND_EXIT_TOP,L.push({exit:U,room:e.getRoomNameFromXY(O,P)})}return L.reverse(),L}var V=e.getRoomNameFromXY(H,I),W=c(V);for(var X in W){var Y=W[X],Z=e.roomNameToXY(Y),$=d(Z,2),_=$[0],aa=$[1],ba=f(_,aa);if(void 0!==ba&&!o.isClosed(ba)){var ca=Number(C(Y,V))||1;if(ca!==1/0){var da=K+m(_,aa)+ca;o.isOpen(ba)?n.priority(ba)>da&&(n.update(ba,da),p[ba]=D):(n.push(ba,da),o.open(ba),p[ba]=D)}}}}return g.ERR_NO_PATH},findExit:function(a,b,c){var d=this.findRoute(a,b,c);return h.isArray(d)?d.length?d[0].exit:g.ERR_INVALID_ARGS:d},describeExits:c,isRoomProtected:function(c){return b.deprecated(\"Method `Game.map.isRoomProtected` is deprecated and will be removed. Please use `Game.map.isRoomAvailable` instead.\"),/^(W|E)\\d+(N|S)\\d+$/.test(c)?!h.contains(a.accessibleRooms,c):null},isRoomAvailable:function(b){return/^(W|E)\\d+(N|S)\\d+$/.test(b)?h.contains(a.accessibleRooms,b):!1},getTerrainAt:function(b,c,d){if(h.isObject(b)&&(c=b.y,d=b.roomName,b=b.x),a.staticTerrainData&&a.staticTerrainData[d]){var e=a.staticTerrainData[d][50*c+b];return e&g.TERRAIN_MASK_WALL?\"wall\":e&g.TERRAIN_MASK_SWAMP?\"swamp\":\"plain\"}},getRoomLinearDistance:function(a,b,c){return e.calcRoomsDistance(a,b,c)}}}},{\"../utils\":148,\"./path-utils\":29,lodash:60,util:153}],24:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../utils\"),f=e.getDriver(),g=f.constants;a(\"util\");c.make=function(a,b,c){function f(b){if(b||(b=\"all\"),!l[b]){if(\"all\"!=b&&!d.contains(g.RESOURCES_ALL,b)&&b!=g.SUBSCRIPTION_TOKEN)return{};l[b]=JSON.parse(JSON.stringify(a.market.orders[b]||\"{}\"))}return l[b]}var h,i,j,k=0,l={},m={calcTransactionCost:c.wrapFn(function(a,b,c){var d=e.calcRoomsDistance(b,c,!0);return Math.max(0,Math.ceil(a*(Math.log(.1*(d+9))+.1)))}),getAllOrders:c.wrapFn(function(a){var b=f(a&&a.resourceType);return d.filter(b,a)}),getOrderById:c.wrapFn(function(b){return a.market.orders.all[b]?JSON.parse(JSON.stringify(a.market.orders.all[b])):null}),createOrder:c.wrapFn(function(c,e,f,h,i){return d.contains(g.RESOURCES_ALL,e)||e==g.SUBSCRIPTION_TOKEN?c!=g.ORDER_BUY&&c!=g.ORDER_SELL?g.ERR_INVALID_ARGS:(f=parseFloat(f),h=parseInt(h),!f||0>=f||!h?g.ERR_INVALID_ARGS:f*h*g.MARKET_FEE>this.credits?g.ERR_NOT_ENOUGH_RESOURCES:e==g.SUBSCRIPTION_TOKEN||i&&d.any(a.userObjects,{type:\"terminal\",room:i})?d.size(this.orders)+k>=50?g.ERR_FULL:(k++,b.pushByName(\"market\",\"createOrder\",{type:c,resourceType:e,price:f,totalAmount:h,roomName:i}),g.OK):g.ERR_NOT_OWNER):g.ERR_INVALID_ARGS}),cancelOrder:c.wrapFn(function(a){return this.orders[a]?(b.pushByName(\"market\",\"cancelOrder\",{orderId:a},50),g.OK):g.ERR_INVALID_ARGS}),deal:c.wrapFn(function(c,e,f){var h=a.market.orders.all[c];if(!h)return g.ERR_INVALID_ARGS;if(e=parseInt(e),!e||0>e)return g.ERR_INVALID_ARGS;if(h.resourceType==g.SUBSCRIPTION_TOKEN){if(h.type==g.ORDER_BUY&&(a.user.subscriptionTokens||0)<e)return g.ERR_NOT_ENOUGH_RESOURCES}else{if(!f)return g.ERR_INVALID_ARGS;var i=d.find(a.userObjects,{type:\"terminal\",room:f}),j=this.calcTransactionCost(e,f,h.roomName);if(!i)return g.ERR_NOT_OWNER;if(i[g.RESOURCE_ENERGY]<j)return g.ERR_NOT_ENOUGH_RESOURCES;if(h.type==g.ORDER_BUY&&(h.resourceType!=g.RESOURCE_ENERGY&&(!i[h.resourceType]||i[h.resourceType]<e)||h.resourceType==g.RESOURCE_ENERGY&&i[g.RESOURCE_ENERGY]<e+j))return g.ERR_NOT_ENOUGH_RESOURCES}return h.type==g.ORDER_SELL&&(a.user.money||0)<e*h.price?g.ERR_NOT_ENOUGH_RESOURCES:b.pushByName(\"market\",\"deal\",{orderId:c,targetRoomName:f,amount:e},10)?g.OK:g.ERR_FULL}),changeOrderPrice:c.wrapFn(function(a,c){var d=this.orders[a];return d?(c=parseFloat(c),!c||0>=c?g.ERR_INVALID_ARGS:c>d.price&&(c-d.price)*d.remainingAmount*g.MARKET_FEE>this.credits?g.ERR_NOT_ENOUGH_RESOURCES:(b.pushByName(\"market\",\"changeOrderPrice\",{orderId:a,newPrice:c},50),g.OK)):g.ERR_INVALID_ARGS}),extendOrder:c.wrapFn(function(a,c){var d=this.orders[a];return d?(c=parseInt(c),!c||0>=c?g.ERR_INVALID_ARGS:d.price*c*g.MARKET_FEE>this.credits?g.ERR_NOT_ENOUGH_RESOURCES:(b.pushByName(\"market\",\"extendOrder\",{orderId:a,addAmount:c},50),g.OK)):g.ERR_INVALID_ARGS})};return Object.defineProperties(m,{credits:{enumerable:!0,get:function(){return a.user.money||0}},incomingTransactions:{enumerable:!0,get:function(){return h||(h=d.map(a.transactions.incoming||[],function(b){return b.transactionId=\"\"+b._id,delete b._id,b.sender=b.sender?{username:a.users[b.sender].username}:void 0,b.recipient=b.recipient?{username:a.users[b.recipient].username}:void 0,b})),h}},outgoingTransactions:{enumerable:!0,get:function(){return i||(i=d.map(a.transactions.outgoing||[],function(b){return b.transactionId=\"\"+b._id,delete b._id,b.sender=b.sender?{username:a.users[b.sender].username}:void 0,b.recipient=b.recipient?{username:a.users[b.recipient].username}:void 0,b})),i}},orders:{enumerable:!0,get:function(){return j||(j=d(a.market.myOrders).map(function(a){return a.id=\"\"+a._id,delete a._id,delete a.user,a}).indexBy(\"id\").value()),j}}}),m}},{\"../utils\":148,lodash:60,util:153}],25:[function(a,b,c){\"use strict\";var d,e,f,g,h=a(\"./../utils\"),i=(a(\"./rooms\"),h.getDriver());i.constants;c.make=function(a,b,c,i){if(d=a,e=b,f=c,g=i,!g.Mineral){var j=function(a){if(!d.roomObjects[a])throw new Error(\"Could not find an object with ID \"+a);return d.roomObjects[a]},k=f.wrapFn(function(a){var b=j(a);g.RoomObject.call(this,b.x,b.y,b.room),this.id=a});k.prototype=Object.create(g.RoomObject.prototype),k.prototype.constructor=k,h.defineGameObjectProperties(k.prototype,j,{mineralType:function(a){return a.mineralType},mineralAmount:function(a){return a.mineralAmount},density:function(a){return a.density},ticksToRegeneration:function(a){return a.nextRegenerationTime?a.nextRegenerationTime-d.time:void 0}}),k.prototype.toString=f.wrapFn(function(){return\"[mineral (\"+this.mineralType+\") #\"+this.id+\"]\"}),g.Mineral=k}}},{\"./../utils\":148,\"./rooms\":31}],26:[function(a,b,c){\"use strict\";var d=[\"Jackson\",\"Aiden\",\"Liam\",\"Lucas\",\"Noah\",\"Mason\",\"Jayden\",\"Ethan\",\"Jacob\",\"Jack\",\"Caden\",\"Logan\",\"Benjamin\",\"Michael\",\"Caleb\",\"Ryan\",\"Alexander\",\"Elijah\",\"James\",\"William\",\"Oliver\",\"Connor\",\"Matthew\",\"Daniel\",\"Luke\",\"Brayden\",\"Jayce\",\"Henry\",\"Carter\",\"Dylan\",\"Gabriel\",\"Joshua\",\"Nicholas\",\"Isaac\",\"Owen\",\"Nathan\",\"Grayson\",\"Eli\",\"Landon\",\"Andrew\",\"Max\",\"Samuel\",\"Gavin\",\"Wyatt\",\"Christian\",\"Hunter\",\"Cameron\",\"Evan\",\"Charlie\",\"David\",\"Sebastian\",\"Joseph\",\"Dominic\",\"Anthony\",\"Colton\",\"John\",\"Tyler\",\"Zachary\",\"Thomas\",\"Julian\",\"Levi\",\"Adam\",\"Isaiah\",\"Alex\",\"Aaron\",\"Parker\",\"Cooper\",\"Miles\",\"Chase\",\"Muhammad\",\"Christopher\",\"Blake\",\"Austin\",\"Jordan\",\"Leo\",\"Jonathan\",\"Adrian\",\"Colin\",\"Hudson\",\"Ian\",\"Xavier\",\"Camden\",\"Tristan\",\"Carson\",\"Jason\",\"Nolan\",\"Riley\",\"Lincoln\",\"Brody\",\"Bentley\",\"Nathaniel\",\"Josiah\",\"Declan\",\"Jake\",\"Asher\",\"Jeremiah\",\"Cole\",\"Mateo\",\"Micah\",\"Elliot\"],e=[\"Sophia\",\"Emma\",\"Olivia\",\"Isabella\",\"Mia\",\"Ava\",\"Lily\",\"Zoe\",\"Emily\",\"Chloe\",\"Layla\",\"Madison\",\"Madelyn\",\"Abigail\",\"Aubrey\",\"Charlotte\",\"Amelia\",\"Ella\",\"Kaylee\",\"Avery\",\"Aaliyah\",\"Hailey\",\"Hannah\",\"Addison\",\"Riley\",\"Harper\",\"Aria\",\"Arianna\",\"Mackenzie\",\"Lila\",\"Evelyn\",\"Adalyn\",\"Grace\",\"Brooklyn\",\"Ellie\",\"Anna\",\"Kaitlyn\",\"Isabelle\",\"Sophie\",\"Scarlett\",\"Natalie\",\"Leah\",\"Sarah\",\"Nora\",\"Mila\",\"Elizabeth\",\"Lillian\",\"Kylie\",\"Audrey\",\"Lucy\",\"Maya\",\"Annabelle\",\"Makayla\",\"Gabriella\",\"Elena\",\"Victoria\",\"Claire\",\"Savannah\",\"Peyton\",\"Maria\",\"Alaina\",\"Kennedy\",\"Stella\",\"Liliana\",\"Allison\",\"Samantha\",\"Keira\",\"Alyssa\",\"Reagan\",\"Molly\",\"Alexandra\",\"Violet\",\"Charlie\",\"Julia\",\"Sadie\",\"Ruby\",\"Eva\",\"Alice\",\"Eliana\",\"Taylor\",\"Callie\",\"Penelope\",\"Camilla\",\"Bailey\",\"Kaelyn\",\"Alexis\",\"Kayla\",\"Katherine\",\"Sydney\",\"Lauren\",\"Jasmine\",\"London\",\"Bella\",\"Adeline\",\"Caroline\",\"Vivian\",\"Juliana\",\"Gianna\",\"Skyler\",\"Jordyn\"];c.getUniqueName=function(a){var b,c,f=0;do{var g=Math.random()>.5?d:e;b=g[Math.floor(Math.random()*g.length)],f>3&&(b+=g[Math.floor(Math.random()*g.length)]),f++,c=a(b)}while(c);return b}},{}],27:[function(a,b,c){\"use strict\";var d,e,f,g,h=a(\"./../utils\"),i=(a(\"./rooms\"),h.getDriver());i.constants;c.make=function(a,b,c,i){if(d=a,e=b,f=c,g=i,!g.Nuke){var j=function(a){if(!d.roomObjects[a])throw new Error(\"Could not find an object with ID \"+a);return d.roomObjects[a]},k=f.wrapFn(function(a){var b=j(a);g.RoomObject.call(this,b.x,b.y,b.room),this.id=a});k.prototype=Object.create(g.RoomObject.prototype),k.prototype.constructor=k,h.defineGameObjectProperties(k.prototype,j,{timeToLand:function(a){return a.landTime-d.time},launchRoomName:function(a){return a.launchRoomName}}),k.prototype.toString=f.wrapFn(function(){return\"[nuke #\"+this.id+\"]\"}),g.Nuke=k}}},{\"./../utils\":148,\"./rooms\":31}],28:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../utils\")),e=d.getDriver();e.constants;c.make=function(a,b,c,d){e.pathFinder.make(a,b,c,d);var f=c.wrapFn(function(){this._bits=new Uint8Array(2500)});f.prototype.set=c.wrapFn(function(a,b,c){a=0|a,b=0|b,this._bits[50*a+b]=Math.min(Math.max(0,c),255)}),f.prototype.get=c.wrapFn(function(a,b){return a=0|a,b=0|b,this._bits[50*a+b]}),f.prototype.clone=c.wrapFn(function(){var a=new f;return a._bits=new Uint8Array(this._bits),a}),f.prototype.serialize=c.wrapFn(function(){return Array.prototype.slice.apply(new Uint32Array(this._bits.buffer))}),f.deserialize=c.wrapFn(function(a){var b=Object.create(f.prototype);return b._bits=new Uint8Array(new Uint32Array(a).buffer),b}),d.PathFinder={CostMatrix:f,search:c.wrapFn(function(a,b,c){return!b||Array.isArray(b)&&!b.length?{path:[],ops:0}:e.pathFinder.search(a,b,c)}),use:c.wrapFn(function(a){c._useNewPathFinder=!!a})}}},{\"../utils\":148,lodash:60}],29:[function(a,b,c){\"use strict\";function d(a,b){if(!(a instanceof b))throw new TypeError(\"Cannot call a class as a function\")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,\"value\"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();c.OpenClosed=function(){function a(b){d(this,a),this.list=new Uint8Array(b),this.marker=1}return e(a,[{key:\"clear\",value:function(){this.marker>=253?(this.list=new Uint8Array(this.list.length),this.marker=1):this.marker+=2}},{key:\"isOpen\",value:function(a){return this.list[a]===this.marker}},{key:\"isClosed\",value:function(a){return this.list[a]===this.marker+1}},{key:\"open\",value:function(a){this.list[a]=this.marker}},{key:\"close\",value:function(a){this.list[a]=this.marker+1}}]),a}(),c.Heap=function(){function a(b,c){d(this,a),this.priorities=new(c||Uint16Array)(b+1),this.heap=new Uint16Array(b+1),this.size_=0}return e(a,[{key:\"minPriority\",value:function(){return this.priorities[this.heap[1]]}},{key:\"min\",value:function(){return this.heap[1]}},{key:\"size\",value:function(){return this.size_}},{key:\"priority\",value:function(a){return this.priorities[a]}},{key:\"pop\",value:function(){this.heap[1]=this.heap[this.size_],--this.size_;for(var a=1;;){var b=a;if((b<<1)+1<=this.size_?(this.priorities[this.heap[b]]>=this.priorities[this.heap[b<<1]]&&(a=b<<1),this.priorities[this.heap[a]]>=this.priorities[this.heap[(b<<1)+1]]&&(a=(b<<1)+1)):b<<1<=this.size_&&this.priorities[this.heap[b]]>=this.priorities[this.heap[b<<1]]&&(a=b<<1),b===a)return;var c=this.heap[b];this.heap[b]=this.heap[a],this.heap[a]=c}}},{key:\"push\",value:function(a,b){this.priorities[a]=b;var c=++this.size_;this.heap[c]=a,this.bubbleUp(c)}},{key:\"update\",value:function(a,b){for(var c=this.size_;c>0;--c)if(this.heap[c]===a)return this.priorities[a]=b,void this.bubbleUp(c)}},{key:\"bubbleUp\",value:function(a){for(;1!==a;){if(!(this.priorities[this.heap[a]]<=this.priorities[this.heap[a>>>1]]))return;var b=this.heap[a];this.heap[a]=this.heap[a>>>1],this.heap[a>>>=1]=b}}},{key:\"clear\",value:function(){this.size_=0}}]),a}()},{}],30:[function(a,b,c){\"use strict\";var d,e,f,g,h=a(\"./../utils\"),i=(a(\"./rooms\"),h.getDriver()),j=i.constants;c.make=function(a,b,c,i){if(d=a,e=b,f=c,g=i,!g.Resource){var k=function(a){if(!d.roomObjects[a])throw new Error(\"Could not find an object with ID \"+a);return d.roomObjects[a]},l=f.wrapFn(function(a){var b=k(a);g.RoomObject.call(this,b.x,b.y,b.room),this.id=a});l.prototype=Object.create(g.RoomObject.prototype),l.prototype.constructor=l,h.defineGameObjectProperties(l.prototype,k,{energy:function(a){return a.energy},amount:function(a){return a[a.resourceType||j.RESOURCE_ENERGY]},resourceType:function(a){return a.resourceType||j.RESOURCE_ENERGY}}),l.prototype.toString=f.wrapFn(function(){return\"[resource (\"+this.resourceType+\") #\"+this.id+\"]\"}),g.Resource=l,g.Energy=l}}},{\"./../utils\":148,\"./rooms\":31}],31:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function e(a,b){b=b||{},v.defaults(b,{maxOps:2e3,heuristicWeight:1});var c=b.maxOps+\",\"+b.heuristicWeight;return s[a].pfFinders[c]||(s[a].pfFinders[c]=new z.AStarFinder({diagonalMovement:1,maxOpsLimit:b.maxOps,heuristic:z.Heuristic.chebyshev,weight:b.heuristicWeight})),s[a].pfFinders[c]}function f(a,b,c){b=b||{};var d=new Array(50),e=v.clone(y.OBSTACLE_OBJECT_TYPES);b.ignoreDestructibleStructures&&(e=v.without(e,\"constructedWall\",\"spawn\",\"extension\",\"link\",\"storage\",\"observer\",\"tower\",\"powerBank\",\"powerSpawn\",\"lab\",\"terminal\")),b.ignoreCreeps&&(e=v.without(e,\"creep\"));for(var f=0;50>f;f++){d[f]=new Array(50);for(var g=0;50>g;g++){d[f][g]=0==g||0==f||49==g||49==f?11:2;var h=l.staticTerrainData[a][50*f+g];h&y.TERRAIN_MASK_WALL&&(d[f][g]=0),h&y.TERRAIN_MASK_SWAMP&&2==d[f][g]&&(d[f][g]=10)}}if(n.objectsByRoomKeys[a].forEach(function(c){var f=n.objectsByRoom[a][c];(v.contains(e,f.type)||!b.ignoreDestructibleStructures&&\"rampart\"==f.type&&!f.isPublic&&f.user!=l.user._id||!b.ignoreDestructibleStructures&&\"constructionSite\"==f.type&&f.user==l.user._id&&v.contains(y.OBSTACLE_OBJECT_TYPES,f.structureType))&&(d[f.y][f.x]=0),\"road\"==f.type&&d[f.y][f.x]>0&&(d[f.y][f.x]=1)}),b.ignore){if(!v.isArray(b.ignore))throw new Error(\"option `ignore` is not an array\");v.forEach(b.ignore,function(c,e){c&&(c.pos&&(d[c.pos.y][c.pos.x]=d[c.pos.y][c.pos.x]>2?2:d[c.pos.y][c.pos.x]),!v.isObject(c)||v.isUndefined(c.x)||c instanceof o.RoomPosition||(b.ignore[e]=new o.RoomPosition(c.x,c.y,a)),v.isUndefined(c.x)||(d[c.y][c.x]=d[c.y][c.x]>2?2:d[c.y][c.x]))})}if(b.avoid){if(!v.isArray(b.avoid))throw new Error(\"option `avoid` is not an array\");v.forEach(b.avoid,function(c,e){c&&(c.pos&&(d[c.pos.y][c.pos.x]=0),!v.isObject(c)||v.isUndefined(c.x)||c instanceof o.RoomPosition||(b.avoid[e]=new o.RoomPosition(c.x,c.y,a)),v.isUndefined(c.x)||(d[c.y][c.x]=0))})}return c&&v.forEach(s[a].pfEndNodes[c],function(a){v.isUndefined(a.x)?v.isUndefined(a.pos)||(d[a.pos.y][a.pos.x]=999):d[a.y][a.x]=999}),new z.Grid(50,50,d)}function g(a,b,c){var d=\"grid\";return b=b||{},b.ignoreCreeps&&(d+=\"_ignoreCreeps\"),b.ignoreDestructibleStructures&&(d+=\"_ignoreDestructibleStructures\"),v.isNumber(c)&&(d+=\"_endNodes\"+c),b.avoid&&(d+=\"_avoid\"+s[a].positionsSetCache.key(b.avoid)),b.ignore&&(d+=\"_ignore\"+s[a].positionsSetCache.key(b.ignore)),s[a].pfGrid[d]||(s[a].pfGrid[d]=f(a,b,c)),s[a].pfGrid[d].clone()}function h(a,b){b=b||{};var c=new o.PathFinder.CostMatrix,d=v.clone(y.OBSTACLE_OBJECT_TYPES);return d.push(\"portal\"),b.ignoreDestructibleStructures&&(d=v.without(d,\"constructedWall\",\"spawn\",\"extension\",\"link\",\"storage\",\"observer\",\"tower\",\"powerBank\",\"powerSpawn\",\"lab\",\"terminal\")),(b.ignoreCreeps||n.rooms[a].controller&&n.rooms[a].controller.safeMode&&n.rooms[a].controller.my)&&(d=v.without(d,\"creep\")),n.objectsByRoomKeys[a]&&n.objectsByRoomKeys[a].forEach(function(e){var f=n.objectsByRoom[a][e];\n";
 d += "(v.contains(d,f.type)||!b.ignoreCreeps&&n.rooms[a].controller&&n.rooms[a].controller.safeMode&&n.rooms[a].controller.my&&\"creep\"==f.type&&f.user==l.user._id||!b.ignoreDestructibleStructures&&\"rampart\"==f.type&&!f.isPublic&&f.user!=l.user._id||!b.ignoreDestructibleStructures&&\"constructionSite\"==f.type&&f.user==l.user._id&&v.contains(y.OBSTACLE_OBJECT_TYPES,f.structureType))&&c.set(f.x,f.y,255),\"swamp\"==f.type&&0==c.get(f.x,f.y)&&c.set(f.x,f.y,b.ignoreRoads?5:10),!b.ignoreRoads&&\"road\"==f.type&&c.get(f.x,f.y)<255&&c.set(f.x,f.y,1)}),c}function i(a,b){if(!s[a])return new o.PathFinder.CostMatrix;var c=\"grid2\";return b=b||{},b.ignoreCreeps&&(c+=\"_ignoreCreeps\"),b.ignoreDestructibleStructures&&(c+=\"_ignoreDestructibleStructures\"),b.ignoreRoads&&(c+=\"_ignoreRoads\"),s[a].pfGrid[c]||(s[a].pfGrid[c]=h(a,b)),s[a].pfGrid[c]}function j(a,b,c,d){if(d=d||{},b.isEqualTo(c))return d.serialize?\"\":[];d.avoid&&(n.deprecated(\"`avoid` option cannot be used when `PathFinder.use()` is enabled. Use `costCallback` instead.\"),d.avoid=void 0),d.ignore&&(n.deprecated(\"`ignore` option cannot be used when `PathFinder.use()` is enabled. Use `costCallback` instead.\"),d.ignore=void 0),void 0===d.maxOps&&(void 0===d.maxRooms||d.maxRooms>1)&&b.roomName!=c.roomName&&(d.maxOps=2e4);var e={roomCallback:function(a){var b=i(a,d);if(\"function\"==typeof d.costCallback){b=b.clone();var c=d.costCallback(a,b);c instanceof o.PathFinder.CostMatrix&&(b=c)}return b},maxOps:d.maxOps,maxRooms:d.maxRooms};d.ignoreRoads||(e.plainCost=2,e.swampCost=10);var f=o.PathFinder.search(b,{range:Math.max(1,d.range||0),pos:c},e);!d.range&&(f.path.length&&f.path[f.path.length-1].isNearTo(c)&&!f.path[f.path.length-1].isEqualTo(c)||!f.path.length&&b.isNearTo(c))&&f.path.push(c);for(var g=b.x,h=b.y,j=[],k=0;k<f.path.length;k++){var l=f.path[k];if(l.roomName!=a)break;var m={x:l.x,y:l.y,dx:l.x-g,dy:l.y-h,direction:w.getDirection(l.x-g,l.y-h)};g=m.x,h=m.y,j.push(m)}return d.serialize?w.serializePath(j):j}function k(a,b,c){if(c=c||{},v.isNumber(b)?b=n.rooms[a.roomName].find(b,{filter:c.filter}):c.filter&&(b=v.filter(b,c.filter)),!b.length)return null;var d=v.find(b,function(b){return a.isEqualTo(b)});if(d)return d;var e=v.map(b,function(a){return a.pos&&(a=a.pos),{range:1,pos:a}});c.avoid&&n.deprecated(\"`avoid` option cannot be used when `PathFinder.use()` is enabled. Use `costCallback` instead.\"),c.ignore&&n.deprecated(\"`ignore` option cannot be used when `PathFinder.use()` is enabled. Use `costCallback` instead.\");var f={roomCallback:function(a){if(n.objectsByRoom[a]){var b=i(a,c);return\"function\"==typeof c.costCallback&&(b=b.clone(),c.costCallback(a,b)),b}},maxOps:c.maxOps,maxRooms:1};c.ignoreRoads||(f.plainCost=2,f.swampCost=10);var g=o.PathFinder.search(a,e,f),h=null,j=a;return g.path.length&&(j=g.path[g.path.length-1]),b.forEach(function(a){return j.isEqualTo(a)?a:void(j.isNearTo(a)&&(h=a))}),h}var l,m,n,o,p,q,r,s,t,u=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h[\"return\"]&&h[\"return\"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),v=a(\"lodash\"),w=a(\"./../utils\"),x=w.getDriver(),y=x.constants,z=a(\"@screeps/pathfinding\"),A=Math.abs,B=(Math.min,Math.max);c.make=function(a,b,c,f){function h(a,b,c,d,e,f){var g;if(\"terrain\"==b){var h=\"plain\",i=l.staticTerrainData[a][50*d+c];return i&y.TERRAIN_MASK_SWAMP&&(h=\"swamp\"),i&y.TERRAIN_MASK_WALL&&(h=\"wall\"),e?(g={type:\"terrain\",terrain:h},f&&(g.x=c,g.y=d),void e.push(g)):[h]}if(0>c||0>d||c>49||d>49)throw new Error(\"look coords are out of bounds\");var j=s[a].lookTypeSpatialRegisters[b][d][c];return j?e?void j.forEach(function(a){g={type:b},g[b]=a,f&&(g.x=c,g.y=d),e.push(g)}):v.clone(j):[]}function i(a,b,c,e,f,g,i,j,k){var l=s[a].lookTypeRegisters[b],m=l&&Object.keys(l);if(\"terrain\"!=b&&m.length<(f-c+1)*(g-e+1)){var n,o=function(b){return(!b.pos&&b.roomName==a||b.pos&&b.pos.roomName==a)&&b.pos&&b.pos.y>=c&&b.pos.y<=f&&b.pos.x>=e&&b.pos.x<=g||!b.pos&&b.y>=c&&b.y<=f&&b.x>=e&&b.x<=g};m.forEach(function(a){var c=l[a];o(c)&&(i?(n={type:b},n[b]=c,j?k.push(d({x:c.x||c.pos.x,y:c.y||c.pos.y,type:b},b,c)):k[c.y||c.pos.y][c.x||c.pos.x].push(n)):j?k.push(d({x:c.x||c.pos.x,y:c.y||c.pos.y},b,c)):(k[c.y||c.pos.y][c.x||c.pos.x]=k[c.y||c.pos.y][c.x||c.pos.x]||[],k[c.y||c.pos.y][c.x||c.pos.x].push(c)))})}else for(var p=c;f>=p;p++)for(var q=e;g>=q;q++)j?h(a,b,q,p,k,!0):k[p][q]?h(a,b,q,p,k[p][q]):k[p][q]=h(a,b,q,p,void 0)}if(l=a,m=b,n=c,o=f,p=1,q=[],r=[],s={},t=0,!o.Room){var k=function(a){if(!l.rooms[a])throw new Error(\"Could not find a room with name \"+a);return l.rooms[a]},x=n.wrapFn(function(a){var b,c=(k(a),a),d=a.match(/survival_(.*)$/);d&&(c=d[1]),l.games&&c in l.games&&(b=l.games[c]),this.name=a,this.mode=\"sim\"==a?y.MODE_SIMULATION:/^arena/.test(a)?y.MODE_ARENA:/^survival/.test(a)?y.MODE_SURVIVAL:y.MODE_WORLD,this.energyAvailable=0,this.energyCapacityAvailable=0,this.survivalInfo=b,s[a]={pfGrid:{},pfFinders:{},pfEndNodes:{},pfDijkstraFinder:new z.DijkstraFinder({diagonalMovement:1}),pathCache:{},positionsSetCache:{cache:{},key:function e(b){if(!v.isArray(b))return 0;var c=v.map(b,function(b){return b&&b.pos?b.pos:!v.isObject(b)||v.isUndefined(b.x)||b instanceof o.RoomPosition?b:new o.RoomPosition(b.x,b.y,a)}),e=v.findKey(this.cache,function(a){return c.length==a.length&&v.every(c,function(b){return v.any(a,function(a){if(!v.isObject(b)||!b.isEqualTo)throw new Error(\"Invalid position \"+b+\", check your `opts` property\");return b.isEqualTo(a)})})});return void 0===e?(e=p++,this.cache[e]=v.clone(b)):e=parseInt(e),e}},lookTypeRegisters:{creep:n.byRoom[a].creeps,energy:n.byRoom[a].energy,resource:n.byRoom[a].energy,source:n.byRoom[a].sources,mineral:n.byRoom[a].minerals,structure:n.byRoom[a].structures,flag:n.byRoom[a].flags,constructionSite:n.byRoom[a].constructionSites,nuke:n.byRoom[a].nukes},lookTypeSpatialRegisters:{creep:n.byRoom[a].spatial.creeps,energy:n.byRoom[a].spatial.energy,resource:n.byRoom[a].spatial.energy,source:n.byRoom[a].spatial.sources,mineral:n.byRoom[a].spatial.minerals,structure:n.byRoom[a].spatial.structures,flag:n.byRoom[a].spatial.flags,constructionSite:n.byRoom[a].spatial.constructionSites,nuke:n.byRoom[a].spatial.nukes}}});x.serializePath=n.wrapFn(function(a){return w.serializePath(a)}),x.deserializePath=n.wrapFn(function(a){return w.deserializePath(a)}),x.prototype.toString=n.wrapFn(function(){return\"[room \"+this.name+\"]\"}),x.prototype.toJSON=n.wrapFn(function(){var a={};for(var b in this)\"_\"==b[0]||v.contains([\"toJSON\",\"toString\",\"controller\",\"storage\",\"terminal\"],b)||(a[b]=this[b]);return a}),Object.defineProperty(x.prototype,\"memory\",{get:function(){return(v.isUndefined(o.Memory.rooms)||\"undefined\"===o.Memory.rooms)&&(o.Memory.rooms={}),v.isObject(o.Memory.rooms)?o.Memory.rooms[this.name]=o.Memory.rooms[this.name]||{}:void 0},set:function(a){if((v.isUndefined(o.Memory.rooms)||\"undefined\"===o.Memory.rooms)&&(o.Memory.rooms={}),!v.isObject(o.Memory.rooms))throw new Error(\"Could not set room memory\");o.Memory.rooms[this.name]=a}}),x.prototype.find=n.wrapFn(function(a,b){var c=this,d=[];if(b=b||{},n.findCache[a]&&n.findCache[a][this.name])d=n.findCache[a][this.name];else switch(a){case y.FIND_EXIT:return n.findCache[a]=n.findCache[a]||{},n.findCache[a][this.name]=this.find(y.FIND_EXIT_TOP,b).concat(this.find(y.FIND_EXIT_BOTTOM,b)).concat(this.find(y.FIND_EXIT_RIGHT,b)).concat(this.find(y.FIND_EXIT_LEFT,b)),v.clone(n.findCache[a][this.name]);case y.FIND_EXIT_TOP:case y.FIND_EXIT_RIGHT:case y.FIND_EXIT_BOTTOM:case y.FIND_EXIT_LEFT:n.findCache[a]=n.findCache[a]||{};for(var e=[],f=0;50>f;f++){var g=0,h=0;a==y.FIND_EXIT_LEFT||a==y.FIND_EXIT_RIGHT?h=f:g=f,a==y.FIND_EXIT_RIGHT&&(g=49),a==y.FIND_EXIT_BOTTOM&&(h=49),e.push(!(l.staticTerrainData[this.name][50*h+g]&y.TERRAIN_MASK_WALL))}d=v.reduce(e,function(b,d,e){return d&&(a==y.FIND_EXIT_TOP&&b.push(c.getPositionAt(e,0)),a==y.FIND_EXIT_BOTTOM&&b.push(c.getPositionAt(e,49)),a==y.FIND_EXIT_LEFT&&b.push(c.getPositionAt(0,e)),a==y.FIND_EXIT_RIGHT&&b.push(c.getPositionAt(49,e))),b},[]),n.findCache[a][this.name]=d}return d=b.filter?v.filter(d,b.filter):v.clone(d)}),x.prototype.lookAt=n.wrapFn(function(a,b){var c=w.fetchXYArguments(a,b,o),d=u(c,2),e=d[0],f=d[1],g=[];return h(this.name,y.LOOK_CREEPS,e,f,g),h(this.name,y.LOOK_ENERGY,e,f,g),h(this.name,y.LOOK_RESOURCES,e,f,g),h(this.name,y.LOOK_SOURCES,e,f,g),h(this.name,y.LOOK_MINERALS,e,f,g),h(this.name,y.LOOK_STRUCTURES,e,f,g),h(this.name,y.LOOK_FLAGS,e,f,g),h(this.name,y.LOOK_CONSTRUCTION_SITES,e,f,g),h(this.name,y.LOOK_TERRAIN,e,f,g),h(this.name,y.LOOK_NUKES,e,f,g),g}),x.prototype.lookForAt=n.wrapFn(function(a,b,c){var d=w.fetchXYArguments(b,c,o),e=u(d,2),f=e[0],g=e[1];return\"terrain\"==a||a in s[this.name].lookTypeSpatialRegisters?h(this.name,a,f,g):y.ERR_INVALID_ARGS}),x.prototype.lookAtArea=n.wrapFn(function(a,b,c,d,e){var f=e?[]:{};if(!e)for(var g=a;c>=g;g++){f[g]={};for(var h=b;d>=h;h++)f[g][h]=[]}return i(this.name,y.LOOK_CREEPS,a,b,c,d,!0,e,f),i(this.name,y.LOOK_ENERGY,a,b,c,d,!0,e,f),i(this.name,y.LOOK_RESOURCES,a,b,c,d,!0,e,f),i(this.name,y.LOOK_SOURCES,a,b,c,d,!0,e,f),i(this.name,y.LOOK_MINERALS,a,b,c,d,!0,e,f),i(this.name,y.LOOK_STRUCTURES,a,b,c,d,!0,e,f),i(this.name,y.LOOK_FLAGS,a,b,c,d,!0,e,f),i(this.name,y.LOOK_CONSTRUCTION_SITES,a,b,c,d,!0,e,f),i(this.name,y.LOOK_TERRAIN,a,b,c,d,!0,e,f),i(this.name,y.LOOK_NUKES,a,b,c,d,!0,e,f),f}),x.prototype.lookForAtArea=n.wrapFn(function(a,b,c,d,e,f){var g=f?[]:{};if(!f)for(var h=b;d>=h;h++)g[h]={};return i(this.name,a,b,c,d,e,!1,f,g),g}),x.prototype.findPath=n.wrapFn(function(a,b,c){if(a.roomName!=this.name)return c.serialize?\"\":[];if(n._useNewPathFinder)return j(this.name,a,b,c);var d,f=a.x,h=a.y,i=\"\";if(c=v.clone(c||{}),c.ignoreCreeps&&(i+=\"_ignoreCreeps\"),c.ignoreDestructibleStructures&&(i+=\"_ignoreDestructibleStructures\"),c.avoid&&(i+=\"_avoid\"+s[this.name].positionsSetCache.key(c.avoid)),c.ignore&&(i+=\"_ignore\"+s[this.name].positionsSetCache.key(c.ignore)),v.isNumber(b)){if(!s[this.name].pfEndNodes[b])return c.serialize?\"\":[];var k=g(this.name,c,b);d=s[this.name].pfDijkstraFinder.findPath(f,h,-999,-999,k)}else{if(b.roomName!=this.name)return c.serialize?\"\":[];var l=b.x,m=b.y,o=f+\",\"+h+\",\"+l+\",\"+m+i;if(s[this.name].pathCache[o])return c.serialize?w.serializePath(s[this.name].pathCache[o]):v.cloneDeep(s[this.name].pathCache[o]);if(f==l&&h==m)return c.serialize?\"\":[];if(0>f||0>h||0>l||0>m||f>=50||h>=50||l>=50||m>=50)return c.serialize?\"\":[];if(A(f-l)<2&&A(h-m)<2){var p=[{x:l,y:m,dx:l-f,dy:m-h,direction:w.getDirection(l-f,m-h)}];return c.serialize?w.serializePath(p):p}var k=g(this.name,c),q=e(this.name,c);k.setWalkableAt(l,m,!0),d=q.findPath(f,h,l,m,k)}d.splice(0,1);var r=f,t=h,u=v.map(d,function(a){var b={x:a[0],y:a[1],dx:a[0]-r,dy:a[1]-t,direction:w.getDirection(a[0]-r,a[1]-t)};return r=b.x,t=b.y,b});if(u.length>0){var x=u[u.length-1],o=f+\",\"+h+\",\"+x.x+\",\"+x.y+i;s[this.name].pathCache[o]=v.cloneDeep(u)}return c.serialize?w.serializePath(u):u}),x.prototype.getPositionAt=n.wrapFn(function(a,b){return 0>a||a>49||0>b||b>49?null:new o.RoomPosition(a,b,this.name)}),x.prototype.createFlag=n.wrapFn(function(a,b,c,d,e){var f=w.fetchXYArguments(a,b,o),g=u(f,2),h=g[0],i=g[1];if(v.isUndefined(h)||v.isUndefined(i)||0>h||h>49||0>i||i>49)return y.ERR_INVALID_ARGS;if(v.size(o.Game.flags)>=y.FLAGS_LIMIT)return y.ERR_FULL;if(v.isObject(a)&&(e=d,d=c,c=b),d||(d=y.COLOR_WHITE),e||(e=d),!v.contains(y.COLORS_ALL,d))return y.ERR_INVALID_ARGS;if(!v.contains(y.COLORS_ALL,e))return y.ERR_INVALID_ARGS;if(!c){var j=1;do c=\"Flag\"+j,j++;while(v.any(n.flags,{name:c})||-1!=q.indexOf(c))}return v.any(n.flags,{name:c})||-1!=q.indexOf(c)?y.ERR_NAME_EXISTS:c.length>60?y.ERR_INVALID_ARGS:(q.push(c),o.Game.flags[c]=new o.Flag(c,d,e,this.name,h,i),m.pushByName(\"room\",\"createFlag\",{roomName:this.name,x:h,y:i,name:c,color:d,secondaryColor:e}),c)}),x.prototype.createConstructionSite=n.wrapFn(function(a,b,c){var d=w.fetchXYArguments(a,b,o),e=u(d,2),f=e[0],g=e[1];if(v.isUndefined(f)||v.isUndefined(g)||0>f||f>49||0>g||g>49)return y.ERR_INVALID_ARGS;if(v.isString(b)&&v.isUndefined(c)&&(c=b),!y.CONSTRUCTION_COST[c])return y.ERR_INVALID_ARGS;if(this.controller&&this.controller.level>0&&!this.controller.my)return y.ERR_RCL_NOT_ENOUGH;if(!w.checkControllerAvailability(c,n.objectsByRoom[this.name],this.controller))return y.ERR_RCL_NOT_ENOUGH;if(!w.checkConstructionSite(n.objectsByRoom[this.name],c,f,g)||!w.checkConstructionSite(l.staticTerrainData[this.name],c,f,g))return y.ERR_INVALID_TARGET;if(this.mode==y.MODE_ARENA)return y.ERR_INVALID_TARGET;if(v(l.userObjects).filter({type:\"constructionSite\"}).size()+t>=y.MAX_CONSTRUCTION_SITES)return y.ERR_FULL;var h={roomName:this.name,x:f,y:g,structureType:c};if(\"spawn\"==c){var i,j=1;do i=\"Spawn\"+j,j++;while(v.any(n.spawns,{name:i})||v.any(n.constructionSites,{structureType:\"spawn\",name:i})||-1!=r.indexOf(i));r.push(i),h.name=i}return t++,m.pushByName(\"room\",\"createConstructionSite\",h),y.OK}),x.prototype.getEndNodes=n.wrapFn(function(a,b){var c;if(b=b||{},v.isUndefined(a))throw new Error(\"Find type cannot be undefined\");return!b.filter&&v.isNumber(a)?c=a:(v.isNumber(a)&&(a=this.find(a,b)),c=s[this.name].positionsSetCache.key(a),s[this.name].pfEndNodes[c]=s[this.name].positionsSetCache.cache[c]),s[this.name].pfEndNodes[c]||(s[this.name].pfEndNodes[c]=v.clone(a),v.isNumber(a)&&(s[this.name].pfEndNodes[c]=this.find(a,b))),{key:c,objects:s[this.name].pfEndNodes[c]}}),x.prototype.findExitTo=n.wrapFn(function(a){return n.map.findExit(this.name,a)}),o.Room=x}},c.makePos=function(a){if(n=a,!o.RoomPosition){var b=n.wrapFn(function(a,b,c){if(a=+a,b=+b,v.isNaN(a)||v.isNaN(b)||!v.isString(c))throw new Error(\"invalid arguments in RoomPosition constructor\");this.x=a,this.y=b,this.roomName=c});b.prototype.toString=n.wrapFn(function(){return\"[room \"+this.roomName+\" pos \"+this.x+\",\"+this.y+\"]\"}),b.prototype.inRangeTo=n.wrapFn(function(a,b,c){var d=a,e=b,f=c,g=this.roomName;if(v.isUndefined(c)){var h=a;h.pos&&(h=h.pos),d=h.x,e=h.y,g=h.roomName,f=b}return A(d-this.x)<=f&&A(e-this.y)<=f&&g==this.roomName}),b.prototype.isNearTo=n.wrapFn(function(a,b){var c=w.fetchXYArguments(a,b,o),d=u(c,3),e=d[0],f=d[1],g=d[2];return A(e-this.x)<=1&&A(f-this.y)<=1&&(!g||g==this.roomName)}),b.prototype.getDirectionTo=n.wrapFn(function(a,b){var c=w.fetchXYArguments(a,b,o),d=u(c,2),e=d[0],f=d[1];return w.getDirection(e-this.x,f-this.y)}),b.prototype.findPathTo=n.wrapFn(function(a,b,c){var d=w.fetchXYArguments(a,b,o),e=u(d,3),f=e[0],g=e[1],h=e[2],i=n.rooms[this.roomName];if(v.isObject(b)&&(c=v.clone(b)),c=c||{},h=h||this.roomName,!i)throw new Error(\"Could not access room \"+this.roomName);if(h==this.roomName||n._useNewPathFinder)return i.findPath(this,new o.RoomPosition(f,g,h),c);var j=i.findExitTo(h);if(0>j)return[];var k=this.findClosestByPath(j,c);return k?i.findPath(this,k,c):[]}),b.prototype.findClosestByPath=n.wrapFn(function(a,b){var c=this;b=v.clone(b||{});var d=n.rooms[this.roomName];if(!d)throw new Error(\"Could not access room \"+this.roomName);if(v.isUndefined(a))return null;if(n._useNewPathFinder)return k(this,a,b);b.serialize=!1;var e,f=null,g=d.getEndNodes(a,b);if(!b.algorithm){var h,i=0;g.objects.forEach(function(a){var b=a.x,d=a.y,e=a.roomName;a.pos&&(b=a.pos.x,d=a.pos.y,e=a.pos.roomName);var f=B(A(c.x-b),A(c.y-d));(v.isUndefined(h)||h>f)&&(h=f),i+=f}),b.algorithm=i>10*h?\"dijkstra\":\"astar\"}if(\"dijkstra\"==b.algorithm&&(e=1,g.objects.forEach(function(a){var b=c.isEqualTo(a)?-1:c.isNearTo(a)?0:1;e>b&&(f=a,e=b)}),1==e)){var j=d.findPath(this,g.key,b);if(j.length>0){var l=j[j.length-1],m=d.getPositionAt(l.x,l.y);f=v.find(g.objects,function(a){return m.isEqualTo(a)})}}return\"astar\"==b.algorithm&&g.objects.forEach(function(a){var g,h=c.isEqualTo(a)?-1:c.isNearTo(a)?0:(g=c.findPathTo(a,b))&&g.length>0&&d.getPositionAt(g[g.length-1].x,g[g.length-1].y).isNearTo(a)?g.length:void 0;(v.isUndefined(e)||e>=h)&&!v.isUndefined(h)&&(e=h,f=a)}),f}),b.prototype.findInRange=n.wrapFn(function(a,b,c){var d=this,e=n.rooms[this.roomName];if(!e)throw new Error(\"Could not access room \"+this.roomName);c=v.clone(c||{});var f=[],g=[];return v.isNumber(a)&&(f=e.find(a,c)),v.isArray(a)&&(f=c.filter?v.filter(a,c.filter):a),f.forEach(function(a){d.inRangeTo(a,b)&&g.push(a)}),g}),b.prototype.findClosestByRange=n.wrapFn(function(a,b){var c=this,d=n.rooms[this.roomName];if(!d)throw new Error(\"Could not access room \"+this.roomName);b=v.clone(b||{});var e=[];v.isNumber(a)&&(e=d.find(a,b)),v.isArray(a)&&(e=b.filter?v.filter(a,b.filter):a);var f=null,g=1/0;return e.forEach(function(a){var b=c.getRangeTo(a);g>b&&(g=b,f=a)}),f}),b.prototype.isEqualTo=n.wrapFn(function(a,b){var c=w.fetchXYArguments(a,b,o),d=u(c,3),e=d[0],f=d[1],g=d[2];return e==this.x&&f==this.y&&(!g||g==this.roomName)}),b.prototype.getRangeTo=n.wrapFn(function(a,b){var c=w.fetchXYArguments(a,b,o),d=u(c,3),e=d[0],f=d[1],g=d[2];return g&&g!=this.roomName?1/0:B(A(this.x-e),A(this.y-f))}),b.prototype.look=n.wrapFn(function(){var a=n.rooms[this.roomName];if(!a)throw new Error(\"Could not access room \"+this.roomName);return a.lookAt(this)}),b.prototype.lookFor=n.wrapFn(function(a){if(\"terrain\"==a)return[n.map.getTerrainAt(this)];var b=n.rooms[this.roomName];if(!b)throw new Error(\"Could not access room \"+this.roomName);return b.lookForAt(a,this)}),b.prototype.createFlag=n.wrapFn(function(a,b,c){var d=n.rooms[this.roomName];if(!d)throw new Error(\"Could not access room \"+this.roomName);return d.createFlag(this,a,b,c)}),b.prototype.createConstructionSite=n.wrapFn(function(a){var b=n.rooms[this.roomName];if(!b)throw new Error(\"Could not access room \"+this.roomName);return b.createConstructionSite(this,a)}),o.RoomPosition=b;var c=n.wrapFn(function(a,b,c){this.room=n.rooms[c],this.pos=new o.RoomPosition(a,b,c)});o.RoomObject=c}}},{\"./../utils\":148,\"@screeps/pathfinding\":36,lodash:60}],32:[function(a,b,c){\"use strict\";var d,e,f,g,h=a(\"./../utils\"),i=(a(\"./rooms\"),h.getDriver());i.constants;c.make=function(a,b,c,i){if(d=a,e=b,f=c,g=i,!g.Source){var j=function(a){if(!d.roomObjects[a])throw new Error(\"Could not find an object with ID \"+a);return d.roomObjects[a]},k=f.wrapFn(function(a){var b=j(a);g.RoomObject.call(this,b.x,b.y,b.room),this.id=a});k.prototype=Object.create(g.RoomObject.prototype),k.prototype.constructor=k,h.defineGameObjectProperties(k.prototype,j,{energy:function(a){return a.energy},energyCapacity:function(a){return a.energyCapacity},ticksToRegeneration:function(a){return a.nextRegenerationTime?a.nextRegenerationTime-d.time:void 0}}),k.prototype.toString=f.wrapFn(function(){return\"[source #\"+this.id+\"]\"}),g.Source=k}}},{\"./../utils\":148,\"./rooms\":31}],33:[function(a,b,c){\"use strict\";function d(a){if(!h.roomObjects[a])throw new Error(\"Could not find an object with ID \"+a);return h.roomObjects[a]}function e(a){var b={energy:a.energy};return p.RESOURCES_ALL.forEach(function(c){a[c]&&(b[c]=a[c])}),b}function f(a,b,c){return a&&a.id&&j.creeps[a.id]&&a instanceof k.Creep?a.my?this.my===!1&&q.any(this.pos.lookFor(\"structure\"),function(a){return a.structureType==p.STRUCTURE_RAMPART})?p.ERR_NOT_OWNER:this.room.controller&&!this.room.controller.my&&this.room.controller.safeMode?p.ERR_NOT_OWNER:d(this.id)[b]?(c||(c=Math.min(d(this.id)[b],d(a.id).energyCapacity-n.calcResources(d(a.id)))),d(this.id)[b]<c||0>c?p.ERR_NOT_ENOUGH_ENERGY:d(a.id).energyCapacity&&(!c||n.calcResources(d(a.id))+c>d(a.id).energyCapacity)?p.ERR_FULL:a.pos.isNearTo(this.pos)?(i.set(d(this.id)._id,\"transfer\",{id:a.id,amount:c,resourceType:b}),p.OK):p.ERR_NOT_IN_RANGE):p.ERR_NOT_ENOUGH_ENERGY:p.ERR_NOT_OWNER:(j.assertTargetObject(a),p.ERR_INVALID_TARGET)}function g(a,b){return a&&a.id&&j.creeps[a.id]&&a instanceof k.Creep?a.my?this.my===!1&&q.any(this.pos.lookFor(\"structure\"),function(a){return a.structureType==p.STRUCTURE_RAMPART})?p.ERR_NOT_OWNER:d(this.id).energy?(b||(b=d(a.id).energyCapacity?Math.min(d(this.id).energy,d(a.id).energyCapacity-n.calcResources(d(a.id))):d(this.id).energy),this.energy<b||0>b?p.ERR_NOT_ENOUGH_ENERGY:d(a.id).energyCapacity&&(!b||n.calcResources(d(a.id))+b>d(a.id).energyCapacity)?p.ERR_FULL:a.pos.isNearTo(this.pos)?(i.set(this.id,\"transfer\",{id:a.id,amount:b,resourceType:\"energy\"}),p.OK):p.ERR_NOT_IN_RANGE):p.ERR_NOT_ENOUGH_ENERGY:p.ERR_NOT_OWNER:(j.assertTargetObject(a),p.ERR_INVALID_TARGET)}var h,i,j,k,l,m=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h[\"return\"]&&h[\"return\"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),n=a(\"./../utils\"),o=(a(\"./rooms\"),n.getDriver()),p=o.constants,q=a(\"lodash\");c.make=function(b,c,o,r){if(h=b,i=c,j=o,k=r,l=[],!k.Structure){var s=j.wrapFn(function(a){var b=d(a);k.RoomObject.call(this,b.x,b.y,b.room),this.id=a;var c=d(a);c.type==p.STRUCTURE_CONTROLLER&&(j.rooms[c.room].controller=this),c.type==p.STRUCTURE_STORAGE&&(j.rooms[c.room].storage=this),c.type==p.STRUCTURE_TERMINAL&&(j.rooms[c.room].terminal=this)});s.prototype=Object.create(k.RoomObject.prototype),s.prototype.constructor=s,n.defineGameObjectProperties(s.prototype,d,{hits:function(a){return a.hits},hitsMax:function(a){return a.hitsMax},structureType:function(a){return a.type}}),s.prototype.toString=j.wrapFn(function(){return\"[structure (\"+d(this.id).type+\") #\"+this.id+\"]\"}),s.prototype.destroy=j.wrapFn(function(){return this.room.controller&&this.room.controller.my?this.room.find(p.FIND_HOSTILE_CREEPS).length>0?p.ERR_BUSY:(i.pushByName(\"room\",\"destroyStructure\",{roomName:this.room.name,id:this.id}),p.OK):p.ERR_NOT_OWNER}),s.prototype.notifyWhenAttacked=j.wrapFn(function(a){return this.my===!1||this.room.controller&&!this.room.controller.my?p.ERR_NOT_OWNER:q.isBoolean(a)?(a!=d(this.id).notifyWhenAttacked&&i.set(this.id,\"notifyWhenAttacked\",{enabled:a}),p.OK):p.ERR_INVALID_ARGS}),s.prototype.isActive=j.wrapFn(function(){return this.owner&&p.CONTROLLER_STRUCTURES[d(this.id).type]?this.room.controller?n.checkStructureAgainstController(d(this.id),j.objectsByRoom[d(this.id).room],d(this.room.controller.id)):!1:!0}),k.Structure=s;var t=j.wrapFn(function(a){s.call(this,a)});t.prototype=Object.create(s.prototype),t.prototype.constructor=t,n.defineGameObjectProperties(t.prototype,d,{owner:function(a){return q.isUndefined(a.user)||null===a.user?void 0:{username:h.users[a.user].username}},my:function(a){return q.isUndefined(a.user)?void 0:a.user==h.user._id}}),k.OwnedStructure=t;var u=j.wrapFn(function(a){s.call(this,a)});u.prototype=Object.create(s.prototype),u.prototype.constructor=u,n.defineGameObjectProperties(u.prototype,d,{store:e,storeCapacity:function(a){return a.energyCapacity},ticksToDecay:function(a){return a.nextDecayTime?a.nextDecayTime-h.time:a.decayTime?a.decayTime-h.time:void 0}}),u.prototype.transfer=j.wrapFn(f),k.StructureContainer=u;var v=j.wrapFn(function(a){t.call(this,a)});v.prototype=Object.create(t.prototype),v.prototype.constructor=v,n.defineGameObjectProperties(v.prototype,d,{ticksToDowngrade:function(a){return a.downgradeTime?a.downgradeTime-h.time:void 0},reservation:function(a){return a.reservation?{username:h.users[a.reservation.user].username,ticksToEnd:a.reservation.endTime-h.time}:void 0},level:function(a){return a.level},progress:function(a){return a.level>0?a.progress:void 0},progressTotal:function(a){return a.level>0&&a.level<8?p.CONTROLLER_LEVELS[a.level]:void 0},upgradeBlocked:function(a){return a.upgradeBlocked&&a.upgradeBlocked>h.time?a.upgradeBlocked-h.time:void 0},safeMode:function(a){return a.safeMode&&a.safeMode>h.time?a.safeMode-h.time:void 0},safeModeCooldown:function(a){return a.safeModeCooldown&&a.safeModeCooldown>h.time?a.safeModeCooldown-h.time:void 0},safeModeAvailable:function(a){return a.safeModeAvailable||0}}),v.prototype.unclaim=j.wrapFn(function(){return this.my?(i.set(this.id,\"unclaim\",{}),p.OK):p.ERR_NOT_OWNER}),v.prototype.activateSafeMode=j.wrapFn(function(){return this.my?this.safeModeAvailable<=0?p.ERR_NOT_ENOUGH_RESOURCES:this.safeModeCooldown||this.upgradeBlocked>0?p.ERR_TIRED:q.any(j.structures,function(a){return\"controller\"==a.structureType&&a.my&&a.safeMode})?p.ERR_BUSY:(i.set(this.id,\"activateSafeMode\",{}),p.OK):p.ERR_NOT_OWNER}),k.StructureController=v;var w=j.wrapFn(function(a){t.call(this,a)});w.prototype=Object.create(t.prototype),w.prototype.constructor=w,n.defineGameObjectProperties(w.prototype,d,{energy:function(a){return a.energy},energyCapacity:function(a){return a.energyCapacity}}),w.prototype.transferEnergy=j.wrapFn(g),k.StructureExtension=w;var x=j.wrapFn(function(a){t.call(this,a)});x.prototype=Object.create(t.prototype),x.prototype.constructor=x,n.defineGameObjectProperties(x.prototype,d,{cooldown:function(a){return a.cooldown||0}}),k.StructureExtractor=x;var y=j.wrapFn(function(a){t.call(this,a)});y.prototype=Object.create(t.prototype),y.prototype.constructor=y,n.defineGameObjectProperties(y.prototype,d,{my:function(){return!1},owner:function(){return{username:\"Source Keeper\"}},ticksToSpawn:function(a){return a.nextSpawnTime?a.nextSpawnTime-h.time:void 0}}),k.StructureKeeperLair=y;var z=j.wrapFn(function(a){t.call(this,a)});z.prototype=Object.create(t.prototype),z.prototype.constructor=z,n.defineGameObjectProperties(z.prototype,d,{energy:function(a){return a.energy},energyCapacity:function(a){return a.energyCapacity},cooldown:function(a){return a.cooldown||0},mineralAmount:function(a){return a.mineralAmount},mineralCapacity:function(a){return a.mineralCapacity},mineralType:function(a){return a.mineralType}}),z.prototype.transfer=j.wrapFn(function(a,b,c){if(!(a&&a.id&&j.creeps[a.id]&&a instanceof k.Creep))return j.assertTargetObject(a),p.ERR_INVALID_TARGET;if(!a.my)return p.ERR_NOT_OWNER;if(this.my===!1&&q.any(this.pos.lookFor(\"structure\"),function(a){return a.structureType==p.STRUCTURE_RAMPART}))return p.ERR_NOT_OWNER;if(b!=p.RESOURCE_ENERGY&&d(this.id).mineralType!=b)return p.ERR_INVALID_ARGS;var e=b==p.RESOURCE_ENERGY?d(this.id).energy:d(this.id).mineralAmount;return e?(c||(c=Math.min(e,d(a.id).energyCapacity-n.calcResources(d(a.id)))),c>e||0>c?p.ERR_NOT_ENOUGH_ENERGY:d(a.id).energyCapacity&&(!c||n.calcResources(d(a.id))+c>d(a.id).energyCapacity)?p.ERR_FULL:a.pos.isNearTo(this.pos)?(i.set(d(this.id)._id,\"transfer\",{id:a.id,amount:c,resourceType:b}),p.OK):p.ERR_NOT_IN_RANGE):p.ERR_NOT_ENOUGH_RESOURCES}),z.prototype.runReaction=j.wrapFn(function(a,b){return this.my?this.cooldown>0?p.ERR_TIRED:n.checkStructureAgainstController(d(this.id),j.objectsByRoom[d(this.id).room],d(this.room.controller.id))?a&&a.id&&j.structures[a.id]&&a instanceof k.Structure&&a.structureType==p.STRUCTURE_LAB&&a.id!=this.id?b&&a.id&&j.structures[b.id]&&b instanceof k.Structure&&b.structureType==p.STRUCTURE_LAB&&b.id!=this.id?this.pos.getRangeTo(a)>2||this.pos.getRangeTo(b)>2?p.ERR_NOT_IN_RANGE:this.mineralAmount>this.mineralCapacity-p.LAB_REACTION_AMOUNT?p.ERR_FULL:a.mineralAmount<p.LAB_REACTION_AMOUNT||b.mineralAmount<p.LAB_REACTION_AMOUNT?p.ERR_NOT_ENOUGH_RESOURCES:!p.REACTIONS[a.mineralType][b.mineralType]||this.mineralType&&this.mineralType!=p.REACTIONS[a.mineralType][b.mineralType]?p.ERR_INVALID_ARGS:(i.set(this.id,\"runReaction\",{lab1:a.id,lab2:b.id}),p.OK):(j.assertTargetObject(b),p.ERR_INVALID_TARGET):(j.assertTargetObject(a),p.ERR_INVALID_TARGET):p.ERR_RCL_NOT_ENOUGH:p.ERR_NOT_OWNER}),z.prototype.boostCreep=j.wrapFn(function(a,b){var c=this;if(!this.my)return p.ERR_NOT_OWNER;if(!n.checkStructureAgainstController(d(this.id),j.objectsByRoom[d(this.id).room],d(this.room.controller.id)))return p.ERR_RCL_NOT_ENOUGH;if(!(a&&a.id&&j.creeps[a.id]&&a instanceof k.Creep))return j.assertTargetObject(a),p.ERR_INVALID_TARGET;if(!this.pos.isNearTo(a))return p.ERR_NOT_IN_RANGE;if(d(this.id).energy<p.LAB_BOOST_ENERGY)return p.ERR_NOT_ENOUGH_RESOURCES;if(d(this.id).mineralAmount<p.LAB_BOOST_MINERAL)return p.ERR_NOT_ENOUGH_RESOURCES;b=b||0;var e=q(a.body).filter(function(a){return!a.boost&&p.BOOSTS[a.type][d(c.id).mineralType]}).size();return!e||b&&b>e?p.ERR_NOT_FOUND:(i.set(this.id,\"boostCreep\",{id:a.id,bodyPartsCount:b}),p.OK)}),k.StructureLab=z;var A=j.wrapFn(function(a){t.call(this,a)});A.prototype=Object.create(t.prototype),A.prototype.constructor=A,n.defineGameObjectProperties(A.prototype,d,{energy:function(a){return a.energy},energyCapacity:function(a){return a.energyCapacity},cooldown:function(a){return a.cooldown||0}}),A.prototype.transferEnergy=j.wrapFn(function(a,b){if(0>b)return p.ERR_INVALID_ARGS;if(!(a&&a.id&&(j.structures[a.id]||j.creeps[a.id])&&(a instanceof k.Structure||a instanceof k.Creep)&&a!==this))return j.assertTargetObject(a),p.ERR_INVALID_TARGET;if(!a.my)return p.ERR_NOT_OWNER;if(this.my===!1&&q.any(this.pos.lookFor(\"structure\"),function(a){return a.structureType==p.STRUCTURE_RAMPART}))return p.ERR_NOT_OWNER;if(a instanceof k.Structure){if(a.structureType!=p.STRUCTURE_LINK)return j.assertTargetObject(a),p.ERR_INVALID_TARGET;if(this.cooldown>0)return p.ERR_TIRED;if(!this.room.controller)return p.ERR_RCL_NOT_ENOUGH;if(!n.checkStructureAgainstController(d(this.id),j.objectsByRoom[d(this.id).room],d(this.room.controller.id)))return p.ERR_RCL_NOT_ENOUGH}return a instanceof k.Creep&&!this.pos.isNearTo(a)?p.ERR_NOT_IN_RANGE:d(this.id).energy?(b||(b=d(a.id).energyCapacity?Math.min(d(this.id).energy,d(a.id).energyCapacity-d(a.id).energy):d(this.id).energy),this.energy<b?p.ERR_NOT_ENOUGH_ENERGY:d(a.id).energyCapacity&&(!b||d(a.id).energy+b>d(a.id).energyCapacity)?p.ERR_FULL:a.pos.roomName!=this.pos.roomName?p.ERR_NOT_IN_RANGE:(i.set(this.id,\"transfer\",{id:a.id,amount:b,resourceType:\"energy\"}),p.OK)):p.ERR_NOT_ENOUGH_ENERGY}),k.StructureLink=A;var B=j.wrapFn(function(a){t.call(this,a)});B.prototype=Object.create(t.prototype),B.prototype.constructor=B,B.prototype.observeRoom=j.wrapFn(function(a){if(!this.my)return p.ERR_NOT_OWNER;if(!q.isString(a)||!/^(W|E)\\d+(S|N)\\d+$/.test(a))return p.ERR_INVALID_ARGS;if(!n.checkStructureAgainstController(d(this.id),j.objectsByRoom[d(this.id).room],d(this.room.controller.id)))return p.ERR_RCL_NOT_ENOUGH;var b=n.roomNameToXY(a),c=m(b,2),e=c[0],f=c[1],g=n.roomNameToXY(d(this.id).room),h=m(g,2),k=h[0],l=h[1];return Math.abs(e-k)>p.OBSERVER_RANGE||Math.abs(f-l)>p.OBSERVER_RANGE?p.ERR_NOT_IN_RANGE:(i.set(this.id,\"observeRoom\",{roomName:a}),p.OK)}),k.StructureObserver=B;var C=j.wrapFn(function(a){t.call(this,a)});C.prototype=Object.create(t.prototype),C.prototype.constructor=C,n.defineGameObjectProperties(C.prototype,d,{power:function(a){return a.power},ticksToDecay:function(a){return a.nextDecayTime?a.nextDecayTime-h.time:a.decayTime?a.decayTime-h.time:void 0},my:function(){return!1},owner:function(){return{username:\"Power Bank\"}}}),k.StructurePowerBank=C;var D=j.wrapFn(function(a){t.call(this,a)});D.prototype=Object.create(t.prototype),D.prototype.constructor=D,n.defineGameObjectProperties(D.prototype,d,{energy:function(a){return a.energy},energyCapacity:function(a){return a.energyCapacity},power:function(a){return a.power},powerCapacity:function(a){return a.powerCapacity}}),D.prototype.transferEnergy=j.wrapFn(g),D.prototype.processPower=j.wrapFn(function(){return this.my?n.checkStructureAgainstController(d(this.id),j.objectsByRoom[d(this.id).room],d(this.room.controller.id))?!this.power||this.energy<p.POWER_SPAWN_ENERGY_RATIO?p.ERR_NOT_ENOUGH_RESOURCES:(i.set(this.id,\"processPower\",{}),p.OK):p.ERR_RCL_NOT_ENOUGH:p.ERR_NOT_OWNER}),k.StructurePowerSpawn=D;var E=j.wrapFn(function(a){t.call(this,a)});E.prototype=Object.create(t.prototype),E.prototype.constructor=E,n.defineGameObjectProperties(E.prototype,d,{ticksToDecay:function(a){return a.nextDecayTime?a.nextDecayTime-h.time:a.decayTime?a.decayTime-h.time:void 0;\n";
 d += "},isPublic:function(a){return!!a.isPublic}}),E.prototype.setPublic=j.wrapFn(function(a){return this.my?(i.set(this.id,\"setPublic\",{isPublic:!!a}),p.OK):p.ERR_NOT_OWNER}),k.StructureRampart=E;var F=j.wrapFn(function(a){s.call(this,a)});F.prototype=Object.create(s.prototype),F.prototype.constructor=F,n.defineGameObjectProperties(F.prototype,d,{ticksToDecay:function(a){return a.nextDecayTime?a.nextDecayTime-h.time:a.decayTime?a.decayTime-h.time:void 0}}),k.StructureRoad=F;var G=j.wrapFn(function(a){t.call(this,a)});G.prototype=Object.create(t.prototype),G.prototype.constructor=G,n.defineGameObjectProperties(G.prototype,d,{store:e,storeCapacity:function(a){return a.energyCapacity}}),G.prototype.transfer=j.wrapFn(f),k.StructureStorage=G;var H=j.wrapFn(function(a){t.call(this,a)});H.prototype=Object.create(t.prototype),H.prototype.constructor=H,n.defineGameObjectProperties(H.prototype,d,{store:e,storeCapacity:function(a){return a.energyCapacity}}),H.prototype.transfer=j.wrapFn(f),H.prototype.send=j.wrapFn(function(a,b,c,e){if(!this.my)return p.ERR_NOT_OWNER;if(!n.checkStructureAgainstController(d(this.id),j.objectsByRoom[d(this.id).room],d(this.room.controller.id)))return p.ERR_RCL_NOT_ENOUGH;if(!/^(W|E)\\d+(N|S)\\d+$/.test(c))return p.ERR_INVALID_ARGS;if(!q.contains(p.RESOURCES_ALL,a))return p.ERR_INVALID_ARGS;if(b<p.TERMINAL_MIN_SEND)return p.ERR_INVALID_ARGS;if(!d(this.id)[a]||d(this.id)[a]<b)return p.ERR_NOT_ENOUGH_RESOURCES;var f=n.calcRoomsDistance(d(this.id).room,c,!0),g=Math.max(0,Math.ceil(b*(Math.log(.1*(f+9))+.1)));return a!=p.RESOURCE_ENERGY&&d(this.id).energy<g||a==p.RESOURCE_ENERGY&&d(this.id).energy<b+g?p.ERR_NOT_ENOUGH_RESOURCES:e&&(!q.isString(e)||e.length>100)?p.ERR_INVALID_ARGS:(i.set(this.id,\"send\",{resourceType:a,amount:b,targetRoomName:c,description:e}),p.OK)}),k.StructureTerminal=H;var I=j.wrapFn(function(a){t.call(this,a)});I.prototype=Object.create(t.prototype),I.prototype.constructor=I,n.defineGameObjectProperties(I.prototype,d,{energy:function(a){return a.energy},energyCapacity:function(a){return a.energyCapacity}}),I.prototype.transferEnergy=j.wrapFn(g),I.prototype.attack=j.wrapFn(function(a){return this.my?a&&a.id&&(j.creeps[a.id]||j.structures[a.id])&&(a instanceof k.Creep||a instanceof k.StructureSpawn||a instanceof k.Structure)?d(this.id).energy<p.TOWER_ENERGY_COST?p.ERR_NOT_ENOUGH_ENERGY:n.checkStructureAgainstController(d(this.id),j.objectsByRoom[d(this.id).room],d(this.room.controller.id))?(i.set(this.id,\"attack\",{id:a.id}),p.OK):p.ERR_RCL_NOT_ENOUGH:(j.assertTargetObject(a),p.ERR_INVALID_TARGET):p.ERR_NOT_OWNER}),I.prototype.heal=j.wrapFn(function(a){return this.my?a&&a.id&&j.creeps[a.id]&&a instanceof k.Creep?d(this.id).energy<p.TOWER_ENERGY_COST?p.ERR_NOT_ENOUGH_ENERGY:n.checkStructureAgainstController(d(this.id),j.objectsByRoom[d(this.id).room],d(this.room.controller.id))?(i.set(this.id,\"heal\",{id:a.id}),p.OK):p.ERR_RCL_NOT_ENOUGH:(j.assertTargetObject(a),p.ERR_INVALID_TARGET):p.ERR_NOT_OWNER}),I.prototype.repair=j.wrapFn(function(a){return this.my?a&&a.id&&j.structures[a.id]&&(a instanceof k.Structure||a instanceof k.StructureSpawn)?d(this.id).energy<p.TOWER_ENERGY_COST?p.ERR_NOT_ENOUGH_ENERGY:n.checkStructureAgainstController(d(this.id),j.objectsByRoom[d(this.id).room],d(this.room.controller.id))?(i.set(this.id,\"repair\",{id:a.id}),p.OK):p.ERR_RCL_NOT_ENOUGH:(j.assertTargetObject(a),p.ERR_INVALID_TARGET):p.ERR_NOT_OWNER}),k.StructureTower=I;var J=j.wrapFn(function(a){s.call(this,a)});J.prototype=Object.create(s.prototype),J.prototype.constructor=J,n.defineGameObjectProperties(J.prototype,d,{ticksToLive:function(a){return a.ticksToLive}}),k.StructureWall=J;var K=j.wrapFn(function(a){t.call(this,a)});K.prototype=Object.create(t.prototype),K.prototype.constructor=K,n.defineGameObjectProperties(K.prototype,d,{name:function(a){return a.user==h.user._id?a.name:void 0},energy:function(a){return a.energy},energyCapacity:function(a){return a.energyCapacity},spawning:function(a){return a.spawning||null}}),Object.defineProperty(K.prototype,\"memory\",{get:function(){return this.my&&((q.isUndefined(k.Memory.spawns)||\"undefined\"===k.Memory.spawns)&&(k.Memory.spawns={}),q.isObject(k.Memory.spawns))?k.Memory.spawns[d(this.id).name]=k.Memory.spawns[d(this.id).name]||{}:void 0},set:function(a){if(!this.my)throw new Error(\"Could not set other player's spawn memory\");if((q.isUndefined(k.Memory.spawns)||\"undefined\"===k.Memory.spawns)&&(k.Memory.spawns={}),!q.isObject(k.Memory.spawns))throw new Error(\"Could not set spawn memory\");k.Memory.spawns[d(this.id).name]=a}}),K.prototype.toString=j.wrapFn(function(){return\"[spawn \"+(d(this.id).user==h.user._id?d(this.id).name:\"#\"+this.id)+\"]\"}),K.prototype.canCreateCreep=j.wrapFn(function(a,b){if(!this.my)return p.ERR_NOT_OWNER;if(d(this.id).spawning)return p.ERR_BUSY;if(!a||!q.isArray(a)||0==a.length||a.length>p.MAX_CREEP_SIZE)return p.ERR_INVALID_ARGS;for(var c=0;c<a.length;c++)if(!q.contains(p.BODYPARTS_ALL,a[c]))return p.ERR_INVALID_ARGS;return this.room.energyAvailable<n.calcCreepCost(a)?p.ERR_NOT_ENOUGH_ENERGY:h.roomObjects[this.id].off?p.ERR_RCL_NOT_ENOUGH:b&&(k.Game.creeps[b]||-1!=l.indexOf(b))?p.ERR_NAME_EXISTS:p.OK}),K.prototype.createCreep=j.wrapFn(function(b,c,e){var f=this;q.isObject(c)&&q.isUndefined(e)&&(e=c,c=void 0);var g=this.canCreateCreep(b,c);return g!=p.OK?g:(c||(c=a(\"./names\").getUniqueName(function(a){return q.any(h.roomObjects,{type:\"creep\",user:d(f.id).user,name:a})||-1!=l.indexOf(a)})),l.push(c),q.isUndefined(k.Memory.creeps)&&(k.Memory.creeps={}),q.isObject(k.Memory.creeps)&&(q.isUndefined(e)?k.Memory.creeps[c]=k.Memory.creeps[c]||{}:k.Memory.creeps[c]=e),k.Game.creeps[c]=new k.Creep,k.RoomObject.call(k.Game.creeps[c],this.pos.x,this.pos.y,this.pos.roomName),Object.defineProperties(k.Game.creeps[c],{name:{enumerable:!0,get:function(){return c}},spawning:{enumerable:!0,get:function(){return!0}},my:{enumerable:!0,get:function(){return!0}},body:{enumerable:!0,get:function(){return q.map(b,function(a){return{type:a,hits:100}})}},owner:{enumerable:!0,get:function(){return new Object({username:h.user.username})}},ticksToLive:{enumerable:!0,get:function(){return p.CREEP_LIFE_TIME}},carryCapacity:{enumerable:!0,get:function(){return q.reduce(b,function(a,b){return a+=b==p.CARRY?p.CARRY_CAPACITY:0},0)}},carry:{enumerable:!0,get:function(){return{energy:0}}},fatigue:{enumerable:!0,get:function(){return 0}},hits:{enumerable:!0,get:function(){return 100*b.length}},hitsMax:{enumerable:!0,get:function(){return 100*b.length}},saying:{enumerable:!0,get:function(){}}}),i.set(this.id,\"createCreep\",{name:c,body:b}),c)}),K.prototype.transferEnergy=j.wrapFn(function(a,b){return this.my?a&&a.id&&j.creeps[a.id]&&a instanceof k.Creep?h.roomObjects[this.id].off?p.ERR_RCL_NOT_ENOUGH:d(this.id).energy?(b||(b=d(a.id).energyCapacity?Math.min(d(this.id).energy,d(a.id).energyCapacity-d(a.id).energy):d(this.id).energy),this.energy<b||0>b?p.ERR_NOT_ENOUGH_ENERGY:d(a.id).energy==d(a.id).energyCapacity?p.ERR_FULL:a.pos.isNearTo(this.pos)?(i.set(this.id,\"transferEnergy\",{id:a.id,amount:b}),p.OK):p.ERR_NOT_IN_RANGE):p.ERR_NOT_ENOUGH_ENERGY:(j.assertTargetObject(a),p.ERR_INVALID_TARGET):p.ERR_NOT_OWNER}),K.prototype.destroy=j.wrapFn(function(){return this.my?(i.pushByName(\"room\",\"destroyStructure\",{roomName:this.room.name,id:this.id}),p.OK):p.ERR_NOT_OWNER}),K.prototype.notifyWhenAttacked=j.wrapFn(function(a){return this.my?q.isBoolean(a)?(a!=d(this.id).notifyWhenAttacked&&i.set(this.id,\"notifyWhenAttacked\",{enabled:a}),p.OK):p.ERR_INVALID_ARGS:p.ERR_NOT_OWNER}),K.prototype.renewCreep=j.wrapFn(function(a){return this.my?a&&a.id&&j.creeps[a.id]&&a instanceof k.Creep?h.roomObjects[this.id].off?p.ERR_RCL_NOT_ENOUGH:a.my?a.pos.isNearTo(this.pos)?this.spawning?p.ERR_BUSY:this.room.energyAvailable<Math.ceil(p.SPAWN_RENEW_RATIO*n.calcCreepCost(a.body)/p.CREEP_SPAWN_TIME/a.body.length)?p.ERR_NOT_ENOUGH_ENERGY:a.ticksToLive+Math.floor(p.SPAWN_RENEW_RATIO*p.CREEP_LIFE_TIME/p.CREEP_SPAWN_TIME/a.body.length)>p.CREEP_LIFE_TIME?p.ERR_FULL:(i.set(this.id,\"renewCreep\",{id:a.id}),p.OK):p.ERR_NOT_IN_RANGE:p.ERR_NOT_OWNER:(j.assertTargetObject(a),p.ERR_INVALID_TARGET):p.ERR_NOT_OWNER}),K.prototype.recycleCreep=j.wrapFn(function(a){return this.my?a&&a.id&&j.creeps[a.id]&&a instanceof k.Creep?h.roomObjects[this.id].off?p.ERR_RCL_NOT_ENOUGH:a.my?a.pos.isNearTo(this.pos)?(i.set(this.id,\"recycleCreep\",{id:a.id}),p.OK):p.ERR_NOT_IN_RANGE:p.ERR_NOT_OWNER:(j.assertTargetObject(a),p.ERR_INVALID_TARGET):p.ERR_NOT_OWNER}),k.StructureSpawn=K,k.Spawn=K;var L=j.wrapFn(function(a){t.call(this,a)});L.prototype=Object.create(t.prototype),L.prototype.constructor=L,n.defineGameObjectProperties(L.prototype,d,{energy:function(a){return a.energy},energyCapacity:function(a){return a.energyCapacity},ghodium:function(a){return a.G},ghodiumCapacity:function(a){return a.GCapacity},cooldown:function(a){return a.cooldownTime&&a.cooldownTime>h.time?a.cooldownTime-h.time:0}}),L.prototype.launchNuke=j.wrapFn(function(a){if(!this.my)return p.ERR_NOT_OWNER;if(h.rooms[this.room.name].novice>Date.now())return p.ERR_INVALID_TARGET;if(!(a instanceof k.RoomPosition))return p.ERR_INVALID_TARGET;if(this.cooldown>0)return p.ERR_TIRED;if(!n.checkStructureAgainstController(d(this.id),j.objectsByRoom[d(this.id).room],d(this.room.controller.id)))return p.ERR_RCL_NOT_ENOUGH;var b=n.roomNameToXY(a.roomName),c=m(b,2),e=c[0],f=c[1],g=n.roomNameToXY(d(this.id).room),l=m(g,2),o=l[0],q=l[1];return Math.abs(e-o)>p.NUKE_RANGE||Math.abs(f-q)>p.NUKE_RANGE?p.ERR_NOT_IN_RANGE:this.energy<this.energyCapacity||this.ghodium<this.ghodiumCapacity?p.ERR_NOT_ENOUGH_RESOURCES:(i.set(this.id,\"launchNuke\",{roomName:a.roomName,x:a.x,y:a.y}),p.OK)}),k.StructureNuker=L;var M=j.wrapFn(function(a){s.call(this,a)});M.prototype=Object.create(s.prototype),M.prototype.constructor=M,n.defineGameObjectProperties(M.prototype,d,{destination:function(a){return new k.RoomPosition(a.destination.x,a.destination.y,a.destination.room)},ticksToDecay:function(a){return a.decayTime?a.decayTime-h.time:void 0}}),k.StructurePortal=M}}},{\"./../utils\":148,\"./names\":26,\"./rooms\":31,lodash:60}],34:[function(a,b,c){\"use strict\";b.exports={ptr:!1}},{}],35:[function(a,b,c){(function(b){\"use strict\";function c(){var f,h=b.hrtime?b.hrtime():Date.now(),k=\"start\";i.config.emit(\"mainLoopStage\",k),\"undefined\"==typeof self&&(f=setInterval(function(){i.queue.resetAll()},i.config.mainLoopResetInterval)),i.notifyTickStarted().then(function(){return k=\"getUsers\",i.config.emit(\"mainLoopStage\",k),i.getAllUsers()}).then(function(a){return k=\"addUsersToQueue\",i.config.emit(\"mainLoopStage\",k,a),d.addMulti(g.map(a,function(a){return a._id.toString()}))}).then(function(){return k=\"waitForUsers\",i.config.emit(\"mainLoopStage\",k),d.whenAllDone()}).then(function(){return k=\"getRooms\",i.config.emit(\"mainLoopStage\",k),i.getAllRooms()}).then(function(a){return k=\"addRoomsToQueue\",i.config.emit(\"mainLoopStage\",k,a),e.addMulti(g.map(a,function(a){return a._id.toString()}))}).then(function(){return k=\"waitForRooms\",i.config.emit(\"mainLoopStage\",k),e.whenAllDone()}).then(function(){return k=\"commit1\",i.config.emit(\"mainLoopStage\",k),i.commitDbBulk()}).then(function(){return k=\"global\",i.config.emit(\"mainLoopStage\",k),a(\"./processor/global\")()}).then(function(){return k=\"commit2\",i.config.emit(\"mainLoopStage\",k),i.commitDbBulk()}).then(function(){return k=\"incrementGameTime\",i.config.emit(\"mainLoopStage\",k),i.incrementGameTime()}).then(function(a){return+a>j+20&&(i.updateAccessibleRoomsList(),j=+a),k=\"notifyRoomsDone\",i.config.emit(\"mainLoopStage\",k),i.notifyRoomsDone(a)}).then(function(){return k=\"custom\",i.config.emit(\"mainLoopStage\",k),i.config.mainLoopCustomStage()})[\"catch\"](function(a){})[\"finally\"](function(){f&&clearInterval(f);var a;b.hrtime?(a=b.hrtime(h),a=1e3*a[0]+a[1]/1e6):a=Date.now()-h,i.config.emit(\"mainLoopStage\",\"finish\"),setTimeout(c,Math.max(i.config.mainLoopMinDuration-a,0))})[\"catch\"](function(a){})}var d,e,f=a(\"q\"),g=a(\"lodash\"),h=a(\"./utils\"),i=h.getDriver(),j=(a(\"./config\"),0);i.connect(\"main\").then(function(){return f.all([i.queue.create(\"users\",\"write\"),i.queue.create(\"rooms\",\"write\")])}).then(function(a){d=a[0],e=a[1],c()})[\"catch\"](function(a){}),\"undefined\"==typeof self&&setInterval(function(){var a=f.getUnhandledReasons();a.forEach(function(a){}),f.resetUnhandledRejections()},1e3)}).call(this,a(\"_process\"))},{\"./config\":1,\"./processor/global\":63,\"./utils\":148,_process:151,lodash:60,q:61}],36:[function(a,b,c){b.exports=a(\"./src/PathFinding\")},{\"./src/PathFinding\":37}],37:[function(a,b,c){b.exports={Heap:a(\"heap\"),Node:a(\"./core/Node\"),Grid:a(\"./core/Grid\"),Util:a(\"./core/Util\"),DiagonalMovement:a(\"./core/DiagonalMovement\"),Heuristic:a(\"./core/Heuristic\"),AStarFinder:a(\"./finders/AStarFinder\"),BestFirstFinder:a(\"./finders/BestFirstFinder\"),BreadthFirstFinder:a(\"./finders/BreadthFirstFinder\"),DijkstraFinder:a(\"./finders/DijkstraFinder\"),BiAStarFinder:a(\"./finders/BiAStarFinder\"),BiBestFirstFinder:a(\"./finders/BiBestFirstFinder\"),BiBreadthFirstFinder:a(\"./finders/BiBreadthFirstFinder\"),BiDijkstraFinder:a(\"./finders/BiDijkstraFinder\"),IDAStarFinder:a(\"./finders/IDAStarFinder\"),JumpPointFinder:a(\"./finders/JumpPointFinder\")}},{\"./core/DiagonalMovement\":38,\"./core/Grid\":39,\"./core/Heuristic\":40,\"./core/Node\":41,\"./core/Util\":42,\"./finders/AStarFinder\":43,\"./finders/BestFirstFinder\":44,\"./finders/BiAStarFinder\":45,\"./finders/BiBestFirstFinder\":46,\"./finders/BiBreadthFirstFinder\":47,\"./finders/BiDijkstraFinder\":48,\"./finders/BreadthFirstFinder\":49,\"./finders/DijkstraFinder\":50,\"./finders/IDAStarFinder\":51,\"./finders/JumpPointFinder\":56,heap:58}],38:[function(a,b,c){var d={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4};b.exports=d},{}],39:[function(a,b,c){function d(a,b,c){this.width=a,this.height=b,this.nodes=this._buildNodes(a,b,c)}var e=a(\"./Node\"),f=a(\"./DiagonalMovement\");d.prototype._buildNodes=function(a,b,c){var d,f,g=new Array(b);for(d=0;b>d;++d)for(g[d]=new Array(a),f=0;a>f;++f)g[d][f]=new e(f,d);if(void 0===c)return g;if(c.length!==b||c[0].length!==a)throw new Error(\"Matrix size does not fit\");for(d=0;b>d;++d)for(f=0;a>f;++f)c[d][f]&&(g[d][f].walkable=!1),g[d][f].weight=c[d][f];return g},d.prototype.getNodeAt=function(a,b){return this.nodes[b][a]},d.prototype.isWalkableAt=function(a,b){return this.isInside(a,b)&&this.nodes[b][a].weight>0},d.prototype.isInside=function(a,b){return a>=0&&a<this.width&&b>=0&&b<this.height},d.prototype.setWalkableAt=function(a,b,c){this.nodes[b][a].weight=1},d.prototype.getNeighbors=function(a,b){var c=a.x,d=a.y,e=[],g=!1,h=!1,i=!1,j=!1,k=!1,l=!1,m=!1,n=!1,o=this.nodes;if(this.isWalkableAt(c,d-1)&&(e.push(o[d-1][c]),g=!0),this.isWalkableAt(c+1,d)&&(e.push(o[d][c+1]),i=!0),this.isWalkableAt(c,d+1)&&(e.push(o[d+1][c]),k=!0),this.isWalkableAt(c-1,d)&&(e.push(o[d][c-1]),m=!0),b===f.Never)return e;if(b===f.OnlyWhenNoObstacles)h=m&&g,j=g&&i,l=i&&k,n=k&&m;else if(b===f.IfAtMostOneObstacle)h=m||g,j=g||i,l=i||k,n=k||m;else{if(b!==f.Always)throw new Error(\"Incorrect value of diagonalMovement\");h=!0,j=!0,l=!0,n=!0}return h&&this.isWalkableAt(c-1,d-1)&&e.push(o[d-1][c-1]),j&&this.isWalkableAt(c+1,d-1)&&e.push(o[d-1][c+1]),l&&this.isWalkableAt(c+1,d+1)&&e.push(o[d+1][c+1]),n&&this.isWalkableAt(c-1,d+1)&&e.push(o[d+1][c-1]),e},d.prototype.clone=function(){var a,b,c=this.width,f=this.height,g=this.nodes,h=new d(c,f),i=new Array(f);for(a=0;f>a;++a)for(i[a]=new Array(c),b=0;c>b;++b)i[a][b]=new e(b,a,g[a][b].walkable,g[a][b].weight);return h.nodes=i,h},b.exports=d},{\"./DiagonalMovement\":38,\"./Node\":41}],40:[function(a,b,c){b.exports={manhattan:function(a,b){return a+b},euclidean:function(a,b){return Math.sqrt(a*a+b*b)},octile:function(a,b){var c=Math.SQRT2-1;return b>a?c*a+b:c*b+a},chebyshev:function(a,b){return Math.max(a,b)}}},{}],41:[function(a,b,c){function d(a,b,c,d){this.x=a,this.y=b,this.walkable=void 0===c?!0:c,this.weight=d}b.exports=d},{}],42:[function(a,b,c){function d(a){for(var b=[[a.x,a.y]];a.parent;)a=a.parent,b.push([a.x,a.y]);return b.reverse()}function e(a,b){var c=d(a),e=d(b);return c.concat(e.reverse())}function f(a){var b,c,d,e,f,g=0;for(b=1;b<a.length;++b)c=a[b-1],d=a[b],e=c[0]-d[0],f=c[1]-d[1],g+=Math.sqrt(e*e+f*f);return g}function g(a,b,c,d){var e,f,g,h,i,j,k=Math.abs,l=[];for(g=k(c-a),h=k(d-b),e=c>a?1:-1,f=d>b?1:-1,i=g-h;;){if(l.push([a,b]),a===c&&b===d)break;j=2*i,j>-h&&(i-=h,a+=e),g>j&&(i+=g,b+=f)}return l}function h(a){var b,c,d,e,f,h,i=[],j=a.length;if(2>j)return i;for(f=0;j-1>f;++f)for(b=a[f],c=a[f+1],d=g(b[0],b[1],c[0],c[1]),e=d.length,h=0;e-1>h;++h)i.push(d[h]);return i.push(a[j-1]),i}function i(a,b){var c,d,e,f,h,i,j,k,l,m,n,o=b.length,p=b[0][0],q=b[0][1],r=b[o-1][0],s=b[o-1][1];for(c=p,d=q,h=[[c,d]],i=2;o>i;++i){for(k=b[i],e=k[0],f=k[1],l=g(c,d,e,f),n=!1,j=1;j<l.length;++j)if(m=l[j],!a.isWalkableAt(m[0],m[1])){n=!0;break}n&&(lastValidCoord=b[i-1],h.push(lastValidCoord),c=lastValidCoord[0],d=lastValidCoord[1])}return h.push([r,s]),h}function j(a){if(a.length<3)return a;var b,c,d,e,f,g,h=[],i=a[0][0],j=a[0][1],k=a[1][0],l=a[1][1],m=k-i,n=l-j;for(f=Math.sqrt(m*m+n*n),m/=f,n/=f,h.push([i,j]),g=2;g<a.length;g++)b=k,c=l,d=m,e=n,k=a[g][0],l=a[g][1],m=k-b,n=l-c,f=Math.sqrt(m*m+n*n),m/=f,n/=f,(m!==d||n!==e)&&h.push([b,c]);return h.push([k,l]),h}c.backtrace=d,c.biBacktrace=e,c.pathLength=f,c.interpolate=g,c.expandPath=h,c.smoothenPath=i,c.compressPath=j},{}],43:[function(a,b,c){function d(a){a=a||{},this.allowDiagonal=a.allowDiagonal,this.dontCrossCorners=a.dontCrossCorners,this.heuristic=a.heuristic||g.manhattan,this.weight=a.weight||1,this.maxOpsLimit=a.maxOpsLimit,this.diagonalMovement=a.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=h.OnlyWhenNoObstacles:this.diagonalMovement=h.IfAtMostOneObstacle:this.diagonalMovement=h.Never),this.diagonalMovement===h.Never?this.heuristic=a.heuristic||g.manhattan:this.heuristic=a.heuristic||g.octile}var e=a(\"heap\"),f=a(\"../core/Util\"),g=a(\"../core/Heuristic\"),h=a(\"../core/DiagonalMovement\");d.prototype.findPath=function(a,b,c,d,g){var h,i,j,k,l,m,n,o,p=new e(function(a,b){return a.f-b.f}),q=g.getNodeAt(a,b),r=-999!=c?g.getNodeAt(c,d):null,s=this.heuristic,t=this.diagonalMovement,u=this.weight,v=Math.abs,w=(Math.SQRT2,q),x=0;for(q.g=0,q.f=0,q.h=r?u*s(v(a-c),v(b-d)):0,p.push(q),q.opened=!0;!p.empty();){if(h=p.pop(),h.closed=!0,h===r||999==h.weight)return f.backtrace(h);if(x++,this.maxOpsLimit&&x>this.maxOpsLimit)break;for(i=g.getNeighbors(h,t),k=0,l=i.length;l>k;++k)j=i[k],j.closed||(m=j.x,n=j.y,o=h.g+j.weight*(m-h.x===0||n-h.y===0?1:1.00000001),(!j.opened||o<j.g)&&(j.g=o,j.h=j.h||u*s(v(m-c),v(n-d)),j.f=j.g+j.h,j.parent=h,(j.h<w.h||j.h===w.h&&j.g<w.g)&&(w=j),j.opened?p.updateItem(j):(p.push(j),j.opened=!0)))}return f.backtrace(w)},b.exports=d},{\"../core/DiagonalMovement\":38,\"../core/Heuristic\":40,\"../core/Util\":42,heap:58}],44:[function(a,b,c){function d(a){e.call(this,a);var b=this.heuristic;this.heuristic=function(a,c){return 1e6*b(a,c)}}var e=a(\"./AStarFinder\");d.prototype=new e,d.prototype.constructor=d,b.exports=d},{\"./AStarFinder\":43}],45:[function(a,b,c){function d(a){a=a||{},this.allowDiagonal=a.allowDiagonal,this.dontCrossCorners=a.dontCrossCorners,this.diagonalMovement=a.diagonalMovement,this.heuristic=a.heuristic||g.manhattan,this.weight=a.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=h.OnlyWhenNoObstacles:this.diagonalMovement=h.IfAtMostOneObstacle:this.diagonalMovement=h.Never),this.diagonalMovement===h.Never?this.heuristic=a.heuristic||g.manhattan:this.heuristic=a.heuristic||g.octile}var e=a(\"heap\"),f=a(\"../core/Util\"),g=a(\"../core/Heuristic\"),h=a(\"../core/DiagonalMovement\");d.prototype.findPath=function(a,b,c,d,g){var h,i,j,k,l,m,n,o,p=function(a,b){return a.f-b.f},q=new e(p),r=new e(p),s=g.getNodeAt(a,b),t=g.getNodeAt(c,d),u=this.heuristic,v=this.diagonalMovement,w=this.weight,x=Math.abs,y=Math.SQRT2,z=1,A=2;for(s.g=0,s.f=0,q.push(s),s.opened=z,t.g=0,t.f=0,r.push(t),t.opened=A;!q.empty()&&!r.empty();){for(h=q.pop(),h.closed=!0,i=g.getNeighbors(h,v),k=0,l=i.length;l>k;++k)if(j=i[k],!j.closed){if(j.opened===A)return f.biBacktrace(h,j);m=j.x,n=j.y,o=h.g+(m-h.x===0||n-h.y===0?1:y),(!j.opened||o<j.g)&&(j.g=o,j.h=j.h||w*u(x(m-c),x(n-d)),j.f=j.g+j.h,j.parent=h,j.opened?q.updateItem(j):(q.push(j),j.opened=z))}for(h=r.pop(),h.closed=!0,i=g.getNeighbors(h,v),k=0,l=i.length;l>k;++k)if(j=i[k],!j.closed){if(j.opened===z)return f.biBacktrace(j,h);m=j.x,n=j.y,o=h.g+(m-h.x===0||n-h.y===0?1:y),(!j.opened||o<j.g)&&(j.g=o,j.h=j.h||w*u(x(m-a),x(n-b)),j.f=j.g+j.h,j.parent=h,j.opened?r.updateItem(j):(r.push(j),j.opened=A))}}return[]},b.exports=d},{\"../core/DiagonalMovement\":38,\"../core/Heuristic\":40,\"../core/Util\":42,heap:58}],46:[function(a,b,c){function d(a){e.call(this,a);var b=this.heuristic;this.heuristic=function(a,c){return 1e6*b(a,c)}}var e=a(\"./BiAStarFinder\");d.prototype=new e,d.prototype.constructor=d,b.exports=d},{\"./BiAStarFinder\":45}],47:[function(a,b,c){function d(a){a=a||{},this.allowDiagonal=a.allowDiagonal,this.dontCrossCorners=a.dontCrossCorners,this.diagonalMovement=a.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=f.OnlyWhenNoObstacles:this.diagonalMovement=f.IfAtMostOneObstacle:this.diagonalMovement=f.Never)}var e=a(\"../core/Util\"),f=a(\"../core/DiagonalMovement\");d.prototype.findPath=function(a,b,c,d,f){var g,h,i,j,k,l=f.getNodeAt(a,b),m=f.getNodeAt(c,d),n=[],o=[],p=this.diagonalMovement,q=0,r=1;for(n.push(l),l.opened=!0,l.by=q,o.push(m),m.opened=!0,m.by=r;n.length&&o.length;){for(i=n.shift(),i.closed=!0,g=f.getNeighbors(i,p),j=0,k=g.length;k>j;++j)if(h=g[j],!h.closed)if(h.opened){if(h.by===r)return e.biBacktrace(i,h)}else n.push(h),h.parent=i,h.opened=!0,h.by=q;for(i=o.shift(),i.closed=!0,g=f.getNeighbors(i,p),j=0,k=g.length;k>j;++j)if(h=g[j],!h.closed)if(h.opened){if(h.by===q)return e.biBacktrace(h,i)}else o.push(h),h.parent=i,h.opened=!0,h.by=r}return[]},b.exports=d},{\"../core/DiagonalMovement\":38,\"../core/Util\":42}],48:[function(a,b,c){function d(a){e.call(this,a),this.heuristic=function(a,b){return 0}}var e=a(\"./BiAStarFinder\");d.prototype=new e,d.prototype.constructor=d,b.exports=d},{\"./BiAStarFinder\":45}],49:[function(a,b,c){function d(a){a=a||{},this.allowDiagonal=a.allowDiagonal,this.dontCrossCorners=a.dontCrossCorners,this.diagonalMovement=a.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=f.OnlyWhenNoObstacles:this.diagonalMovement=f.IfAtMostOneObstacle:this.diagonalMovement=f.Never)}var e=a(\"../core/Util\"),f=a(\"../core/DiagonalMovement\");d.prototype.findPath=function(a,b,c,d,f){var g,h,i,j,k,l=[],m=this.diagonalMovement,n=f.getNodeAt(a,b),o=f.getNodeAt(c,d);for(l.push(n),n.opened=!0;l.length;){if(i=l.shift(),i.closed=!0,i===o)return e.backtrace(o);for(g=f.getNeighbors(i,m),j=0,k=g.length;k>j;++j)h=g[j],h.closed||h.opened||(l.push(h),h.opened=!0,h.parent=i)}return[]},b.exports=d},{\"../core/DiagonalMovement\":38,\"../core/Util\":42}],50:[function(a,b,c){function d(a){e.call(this,a),this.heuristic=function(a,b){return 0}}var e=a(\"./AStarFinder\");d.prototype=new e,d.prototype.constructor=d,b.exports=d},{\"./AStarFinder\":43}],51:[function(a,b,c){function d(a){a=a||{},this.allowDiagonal=a.allowDiagonal,this.dontCrossCorners=a.dontCrossCorners,this.diagonalMovement=a.diagonalMovement,this.heuristic=a.heuristic||e.manhattan,this.weight=a.weight||1,this.trackRecursion=a.trackRecursion||!1,this.timeLimit=a.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=g.OnlyWhenNoObstacles:this.diagonalMovement=g.IfAtMostOneObstacle:this.diagonalMovement=g.Never),this.diagonalMovement===g.Never?this.heuristic=a.heuristic||e.manhattan:this.heuristic=a.heuristic||e.octile}var e=(a(\"../core/Util\"),a(\"../core/Heuristic\")),f=a(\"../core/Node\"),g=a(\"../core/DiagonalMovement\");d.prototype.findPath=function(a,b,c,d,e){var g,h,i,j=0,k=(new Date).getTime(),l=function(a,b){return this.heuristic(Math.abs(b.x-a.x),Math.abs(b.y-a.y))}.bind(this),m=function(a,b){return a.x===b.x||a.y===b.y?1:Math.SQRT2},n=function(a,b,c,d,g){if(j++,this.timeLimit>0&&(new Date).getTime()-k>1e3*this.timeLimit)return 1/0;var h=b+l(a,p)*this.weight;if(h>c)return h;if(a==p)return d[g]=[a.x,a.y],a;var i,o,q,r,s=e.getNeighbors(a,this.diagonalMovement);for(q=0,i=1/0;r=s[q];++q){if(this.trackRecursion&&(r.retainCount=r.retainCount+1||1,r.tested!==!0&&(r.tested=!0)),o=n(r,b+m(a,r),c,d,g+1),o instanceof f)return d[g]=[a.x,a.y],o;this.trackRecursion&&0===--r.retainCount&&(r.tested=!1),i>o&&(i=o)}return i}.bind(this),o=e.getNodeAt(a,b),p=e.getNodeAt(c,d),q=l(o,p);for(g=0;!0;++g){if(h=[],i=n(o,0,q,h,0),i===1/0)return[];if(i instanceof f)return h;q=i}return[]},b.exports=d},{\"../core/DiagonalMovement\":38,\"../core/Heuristic\":40,\"../core/Node\":41,\"../core/Util\":42}],52:[function(a,b,c){function d(a){e.call(this,a)}var e=a(\"./JumpPointFinderBase\"),f=a(\"../core/DiagonalMovement\");d.prototype=new e,d.prototype.constructor=d,d.prototype._jump=function(a,b,c,d){var e=this.grid,f=a-c,g=b-d;if(!e.isWalkableAt(a,b))return null;if(this.trackJumpRecursion===!0&&(e.getNodeAt(a,b).tested=!0),e.getNodeAt(a,b)===this.endNode)return[a,b];if(0!==f&&0!==g){if(e.isWalkableAt(a-f,b+g)&&!e.isWalkableAt(a-f,b)||e.isWalkableAt(a+f,b-g)&&!e.isWalkableAt(a,b-g))return[a,b];if(this._jump(a+f,b,a,b)||this._jump(a,b+g,a,b))return[a,b]}else if(0!==f){if(e.isWalkableAt(a+f,b+1)&&!e.isWalkableAt(a,b+1)||e.isWalkableAt(a+f,b-1)&&!e.isWalkableAt(a,b-1))return[a,b]}else if(e.isWalkableAt(a+1,b+g)&&!e.isWalkableAt(a+1,b)||e.isWalkableAt(a-1,b+g)&&!e.isWalkableAt(a-1,b))return[a,b];return this._jump(a+f,b+g,a,b)},d.prototype._findNeighbors=function(a){var b,c,d,e,g,h,i,j,k=a.parent,l=a.x,m=a.y,n=this.grid,o=[];if(k)b=k.x,c=k.y,d=(l-b)/Math.max(Math.abs(l-b),1),e=(m-c)/Math.max(Math.abs(m-c),1),0!==d&&0!==e?(n.isWalkableAt(l,m+e)&&o.push([l,m+e]),n.isWalkableAt(l+d,m)&&o.push([l+d,m]),n.isWalkableAt(l+d,m+e)&&o.push([l+d,m+e]),n.isWalkableAt(l-d,m)||o.push([l-d,m+e]),n.isWalkableAt(l,m-e)||o.push([l+d,m-e])):0===d?(n.isWalkableAt(l,m+e)&&o.push([l,m+e]),n.isWalkableAt(l+1,m)||o.push([l+1,m+e]),n.isWalkableAt(l-1,m)||o.push([l-1,m+e])):(n.isWalkableAt(l+d,m)&&o.push([l+d,m]),n.isWalkableAt(l,m+1)||o.push([l+d,m+1]),n.isWalkableAt(l,m-1)||o.push([l+d,m-1]));else for(g=n.getNeighbors(a,f.Always),i=0,j=g.length;j>i;++i)h=g[i],o.push([h.x,h.y]);return o},b.exports=d},{\"../core/DiagonalMovement\":38,\"./JumpPointFinderBase\":57}],53:[function(a,b,c){function d(a){e.call(this,a)}var e=a(\"./JumpPointFinderBase\"),f=a(\"../core/DiagonalMovement\");d.prototype=new e,d.prototype.constructor=d,d.prototype._jump=function(a,b,c,d){var e=this.grid,f=a-c,g=b-d;if(!e.isWalkableAt(a,b))return null;if(this.trackJumpRecursion===!0&&(e.getNodeAt(a,b).tested=!0),e.getNodeAt(a,b)===this.endNode)return[a,b];if(0!==f&&0!==g){if(e.isWalkableAt(a-f,b+g)&&!e.isWalkableAt(a-f,b)||e.isWalkableAt(a+f,b-g)&&!e.isWalkableAt(a,b-g))return[a,b];if(this._jump(a+f,b,a,b)||this._jump(a,b+g,a,b))return[a,b]}else if(0!==f){if(e.isWalkableAt(a+f,b+1)&&!e.isWalkableAt(a,b+1)||e.isWalkableAt(a+f,b-1)&&!e.isWalkableAt(a,b-1))return[a,b]}else if(e.isWalkableAt(a+1,b+g)&&!e.isWalkableAt(a+1,b)||e.isWalkableAt(a-1,b+g)&&!e.isWalkableAt(a-1,b))return[a,b];return e.isWalkableAt(a+f,b)||e.isWalkableAt(a,b+g)?this._jump(a+f,b+g,a,b):null},d.prototype._findNeighbors=function(a){var b,c,d,e,g,h,i,j,k=a.parent,l=a.x,m=a.y,n=this.grid,o=[];if(k)b=k.x,c=k.y,d=(l-b)/Math.max(Math.abs(l-b),1),e=(m-c)/Math.max(Math.abs(m-c),1),0!==d&&0!==e?(n.isWalkableAt(l,m+e)&&o.push([l,m+e]),n.isWalkableAt(l+d,m)&&o.push([l+d,m]),(n.isWalkableAt(l,m+e)||n.isWalkableAt(l+d,m))&&o.push([l+d,m+e]),!n.isWalkableAt(l-d,m)&&n.isWalkableAt(l,m+e)&&o.push([l-d,m+e]),!n.isWalkableAt(l,m-e)&&n.isWalkableAt(l+d,m)&&o.push([l+d,m-e])):0===d?n.isWalkableAt(l,m+e)&&(o.push([l,m+e]),n.isWalkableAt(l+1,m)||o.push([l+1,m+e]),n.isWalkableAt(l-1,m)||o.push([l-1,m+e])):n.isWalkableAt(l+d,m)&&(o.push([l+d,m]),n.isWalkableAt(l,m+1)||o.push([l+d,m+1]),n.isWalkableAt(l,m-1)||o.push([l+d,m-1]));else for(g=n.getNeighbors(a,f.IfAtMostOneObstacle),i=0,j=g.length;j>i;++i)h=g[i],o.push([h.x,h.y]);return o},b.exports=d},{\"../core/DiagonalMovement\":38,\"./JumpPointFinderBase\":57}],54:[function(a,b,c){function d(a){e.call(this,a)}var e=a(\"./JumpPointFinderBase\"),f=a(\"../core/DiagonalMovement\");d.prototype=new e,d.prototype.constructor=d,d.prototype._jump=function(a,b,c,d){var e=this.grid,f=a-c,g=b-d;if(!e.isWalkableAt(a,b))return null;if(this.trackJumpRecursion===!0&&(e.getNodeAt(a,b).tested=!0),e.getNodeAt(a,b)===this.endNode)return[a,b];if(0!==f&&0!==g){if(this._jump(a+f,b,a,b)||this._jump(a,b+g,a,b))return[a,b]}else if(0!==f){if(e.isWalkableAt(a,b-1)&&!e.isWalkableAt(a-f,b-1)||e.isWalkableAt(a,b+1)&&!e.isWalkableAt(a-f,b+1))return[a,b]}else if(0!==g&&(e.isWalkableAt(a-1,b)&&!e.isWalkableAt(a-1,b-g)||e.isWalkableAt(a+1,b)&&!e.isWalkableAt(a+1,b-g)))return[a,b];return e.isWalkableAt(a+f,b)&&e.isWalkableAt(a,b+g)?this._jump(a+f,b+g,a,b):null},d.prototype._findNeighbors=function(a){var b,c,d,e,g,h,i,j,k=a.parent,l=a.x,m=a.y,n=this.grid,o=[];if(k)if(b=k.x,c=k.y,d=(l-b)/Math.max(Math.abs(l-b),1),e=(m-c)/Math.max(Math.abs(m-c),1),0!==d&&0!==e)n.isWalkableAt(l,m+e)&&o.push([l,m+e]),n.isWalkableAt(l+d,m)&&o.push([l+d,m]),n.isWalkableAt(l,m+e)&&n.isWalkableAt(l+d,m)&&o.push([l+d,m+e]);else{var p;if(0!==d){p=n.isWalkableAt(l+d,m);var q=n.isWalkableAt(l,m+1),r=n.isWalkableAt(l,m-1);p&&(o.push([l+d,m]),q&&o.push([l+d,m+1]),r&&o.push([l+d,m-1])),q&&o.push([l,m+1]),r&&o.push([l,m-1])}else if(0!==e){p=n.isWalkableAt(l,m+e);var s=n.isWalkableAt(l+1,m),t=n.isWalkableAt(l-1,m);p&&(o.push([l,m+e]),s&&o.push([l+1,m+e]),t&&o.push([l-1,m+e])),s&&o.push([l+1,m]),t&&o.push([l-1,m])}}else for(g=n.getNeighbors(a,f.OnlyWhenNoObstacles),i=0,j=g.length;j>i;++i)h=g[i],o.push([h.x,h.y]);return o},b.exports=d},{\"../core/DiagonalMovement\":38,\"./JumpPointFinderBase\":57}],55:[function(a,b,c){function d(a){e.call(this,a)}var e=a(\"./JumpPointFinderBase\"),f=a(\"../core/DiagonalMovement\");d.prototype=new e,d.prototype.constructor=d,d.prototype._jump=function(a,b,c,d){var e=this.grid,f=a-c,g=b-d;if(!e.isWalkableAt(a,b))return null;if(this.trackJumpRecursion===!0&&(e.getNodeAt(a,b).tested=!0),e.getNodeAt(a,b)===this.endNode)return[a,b];if(0!==f){if(e.isWalkableAt(a,b-1)&&!e.isWalkableAt(a-f,b-1)||e.isWalkableAt(a,b+1)&&!e.isWalkableAt(a-f,b+1))return[a,b]}else{if(0===g)throw new Error(\"Only horizontal and vertical movements are allowed\");if(e.isWalkableAt(a-1,b)&&!e.isWalkableAt(a-1,b-g)||e.isWalkableAt(a+1,b)&&!e.isWalkableAt(a+1,b-g))return[a,b];if(this._jump(a+1,b,a,b)||this._jump(a-1,b,a,b))return[a,b]}return this._jump(a+f,b+g,a,b)},d.prototype._findNeighbors=function(a){var b,c,d,e,g,h,i,j,k=a.parent,l=a.x,m=a.y,n=this.grid,o=[];if(k)b=k.x,c=k.y,d=(l-b)/Math.max(Math.abs(l-b),1),e=(m-c)/Math.max(Math.abs(m-c),1),0!==d?(n.isWalkableAt(l,m-1)&&o.push([l,m-1]),n.isWalkableAt(l,m+1)&&o.push([l,m+1]),n.isWalkableAt(l+d,m)&&o.push([l+d,m])):0!==e&&(n.isWalkableAt(l-1,m)&&o.push([l-1,m]),n.isWalkableAt(l+1,m)&&o.push([l+1,m]),n.isWalkableAt(l,m+e)&&o.push([l,m+e]));else for(g=n.getNeighbors(a,f.Never),i=0,j=g.length;j>i;++i)h=g[i],o.push([h.x,h.y]);return o},b.exports=d},{\"../core/DiagonalMovement\":38,\"./JumpPointFinderBase\":57}],56:[function(a,b,c){function d(a){return a=a||{},a.diagonalMovement===e.Never?new f(a):a.diagonalMovement===e.Always?new g(a):a.diagonalMovement===e.OnlyWhenNoObstacles?new h(a):new i(a)}var e=a(\"../core/DiagonalMovement\"),f=a(\"./JPFNeverMoveDiagonally\"),g=a(\"./JPFAlwaysMoveDiagonally\"),h=a(\"./JPFMoveDiagonallyIfNoObstacles\"),i=a(\"./JPFMoveDiagonallyIfAtMostOneObstacle\");b.exports=d},{\"../core/DiagonalMovement\":38,\"./JPFAlwaysMoveDiagonally\":52,\"./JPFMoveDiagonallyIfAtMostOneObstacle\":53,\"./JPFMoveDiagonallyIfNoObstacles\":54,\"./JPFNeverMoveDiagonally\":55}],57:[function(a,b,c){function d(a){a=a||{},this.heuristic=a.heuristic||g.manhattan,\n";
 d += "this.trackJumpRecursion=a.trackJumpRecursion||!1}var e=a(\"heap\"),f=a(\"../core/Util\"),g=a(\"../core/Heuristic\");a(\"../core/DiagonalMovement\");d.prototype.findPath=function(a,b,c,d,g){var h,i=this.openList=new e(function(a,b){return a.f-b.f}),j=this.startNode=g.getNodeAt(a,b),k=this.endNode=g.getNodeAt(c,d);for(this.grid=g,j.g=0,j.f=0,i.push(j),j.opened=!0;!i.empty();){if(h=i.pop(),h.closed=!0,h===k)return f.expandPath(f.backtrace(k));this._identifySuccessors(h)}return[]},d.prototype._identifySuccessors=function(a){var b,c,d,e,f,h,i,j,k,l,m=this.grid,n=this.heuristic,o=this.openList,p=this.endNode.x,q=this.endNode.y,r=a.x,s=a.y,t=Math.abs;Math.max;for(b=this._findNeighbors(a),e=0,f=b.length;f>e;++e)if(c=b[e],d=this._jump(c[0],c[1],r,s)){if(h=d[0],i=d[1],l=m.getNodeAt(h,i),l.closed)continue;j=g.octile(t(h-r),t(i-s)),k=a.g+j,(!l.opened||k<l.g)&&(l.g=k,l.h=l.h||n(t(h-p),t(i-q)),l.f=l.g+l.h,l.parent=a,l.opened?o.updateItem(l):(o.push(l),l.opened=!0))}},b.exports=d},{\"../core/DiagonalMovement\":38,\"../core/Heuristic\":40,\"../core/Util\":42,heap:58}],58:[function(a,b,c){b.exports=a(\"./lib/heap\")},{\"./lib/heap\":59}],59:[function(a,b,c){(function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p;d=Math.floor,k=Math.min,c=function(a,b){return b>a?-1:a>b?1:0},j=function(a,b,e,f,g){var h;if(null==e&&(e=0),null==g&&(g=c),0>e)throw new Error(\"lo must be non-negative\");for(null==f&&(f=a.length);f>e;)h=d((e+f)/2),g(b,a[h])<0?f=h:e=h+1;return[].splice.apply(a,[e,e-e].concat(b)),b},g=function(a,b,d){return null==d&&(d=c),a.push(b),o(a,0,a.length-1,d)},f=function(a,b){var d,e;return null==b&&(b=c),d=a.pop(),a.length?(e=a[0],a[0]=d,p(a,0,b)):e=d,e},i=function(a,b,d){var e;return null==d&&(d=c),e=a[0],a[0]=b,p(a,0,d),e},h=function(a,b,d){var e;return null==d&&(d=c),a.length&&d(a[0],b)<0&&(e=[a[0],b],b=e[0],a[0]=e[1],p(a,0,d)),b},e=function(a,b){var e,f,g,h,i,j;for(null==b&&(b=c),h=function(){j=[];for(var b=0,c=d(a.length/2);c>=0?c>b:b>c;c>=0?b++:b--)j.push(b);return j}.apply(this).reverse(),i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(p(a,e,b));return i},n=function(a,b,d){var e;return null==d&&(d=c),e=a.indexOf(b),-1!==e?(o(a,0,e,d),p(a,e,d)):void 0},l=function(a,b,d){var f,g,i,j,k;if(null==d&&(d=c),g=a.slice(0,b),!g.length)return g;for(e(g,d),k=a.slice(b),i=0,j=k.length;j>i;i++)f=k[i],h(g,f,d);return g.sort(d).reverse()},m=function(a,b,d){var g,h,i,l,m,n,o,p,q,r;if(null==d&&(d=c),10*b<=a.length){if(l=a.slice(0,b).sort(d),!l.length)return l;for(i=l[l.length-1],p=a.slice(b),m=0,o=p.length;o>m;m++)g=p[m],d(g,i)<0&&(j(l,g,0,null,d),l.pop(),i=l[l.length-1]);return l}for(e(a,d),r=[],h=n=0,q=k(b,a.length);q>=0?q>n:n>q;h=q>=0?++n:--n)r.push(f(a,d));return r},o=function(a,b,d,e){var f,g,h;for(null==e&&(e=c),f=a[d];d>b&&(h=d-1>>1,g=a[h],e(f,g)<0);)a[d]=g,d=h;return a[d]=f},p=function(a,b,d){var e,f,g,h,i;for(null==d&&(d=c),f=a.length,i=b,g=a[b],e=2*b+1;f>e;)h=e+1,f>h&&!(d(a[e],a[h])<0)&&(e=h),a[b]=a[e],b=e,e=2*b+1;return a[b]=g,o(a,i,b,d)},a=function(){function a(a){this.cmp=null!=a?a:c,this.nodes=[]}return a.push=g,a.pop=f,a.replace=i,a.pushpop=h,a.heapify=e,a.updateItem=n,a.nlargest=l,a.nsmallest=m,a.prototype.push=function(a){return g(this.nodes,a,this.cmp)},a.prototype.pop=function(){return f(this.nodes,this.cmp)},a.prototype.peek=function(){return this.nodes[0]},a.prototype.contains=function(a){return-1!==this.nodes.indexOf(a)},a.prototype.replace=function(a){return i(this.nodes,a,this.cmp)},a.prototype.pushpop=function(a){return h(this.nodes,a,this.cmp)},a.prototype.heapify=function(){return e(this.nodes,this.cmp)},a.prototype.updateItem=function(a){return n(this.nodes,a,this.cmp)},a.prototype.clear=function(){return this.nodes=[]},a.prototype.empty=function(){return 0===this.nodes.length},a.prototype.size=function(){return this.nodes.length},a.prototype.clone=function(){var b;return b=new a,b.nodes=this.nodes.slice(0),b},a.prototype.toArray=function(){return this.nodes.slice(0)},a.prototype.insert=a.prototype.push,a.prototype.top=a.prototype.peek,a.prototype.front=a.prototype.peek,a.prototype.has=a.prototype.contains,a.prototype.copy=a.prototype.clone,a}(),(\"undefined\"!=typeof b&&null!==b?b.exports:void 0)?b.exports=a:window.Heap=a}).call(this)},{}],60:[function(a,b,c){arguments[4][9][0].apply(c,arguments)},{dup:9}],61:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{_process:151,dup:10}],62:[function(a,b,c){\"use strict\";function d(b,c,d,f,j,n,o){return g.when().then(function(){var p,q=k.bulkObjectsWrite(),r=k.bulkUsersWrite(),s=k.bulkFlagsWrite(),t=!1,u=k.getRoomStatsUpdater(b),v={},w=[],x=[],y=h.clone(n);n.active=!1;var z=f[h.findKey(f)];z.terrain&&(f=z.terrain),h.forEach(d,function(a){a&&(\"creep\"==a.type&&(a._actionLog=a.actionLog,a._ticksToLive=a.ageTime-j,a.actionLog={attacked:null,healed:null,attack:null,rangedAttack:null,rangedMassAttack:null,rangedHeal:null,harvest:null,heal:null,repair:null,build:null,say:null,upgradeController:null,reserveController:null}),\"link\"==a.type&&(a._actionLog=a.actionLog,a.actionLog={transferEnergy:null}),\"lab\"==a.type&&(a._actionLog=a.actionLog,a.actionLog={runReaction:null}),\"tower\"==a.type&&(a._actionLog=a.actionLog,a.actionLog={attack:null,heal:null,repair:null}),\"controller\"==a.type&&(p=a),\"observer\"==a.type&&(a.observeRoom=null),a.user&&\"3\"!=a.user&&!a.userNotActive&&\"flag\"!=a.type&&(n.active=!0),\"powerBank\"==a.type&&j>a.decayTime-500&&(n.active=!0),\"energy\"==a.type&&(n.active=!0),\"nuke\"==a.type&&(n.active=!0),\"portal\"==a.type&&(n.active=!0),\"constructedWall\"==a.type&&a.decayTime&&a.user&&(t=!0),\"extension\"==a.type&&x.push(a),\"spawn\"==a.type&&w.push(a),k.config.emit(\"processObject\",a,d,f,j,n,q,r))}),(w.length||x.length)&&a(\"./processor/intents/_calc_spawns\")(w,x,p,q),i.init(d,f),c&&h.forEach(c.users,function(b,c){b.objectsManual&&(b.objects=b.objects||{},h.extend(b.objects,b.objectsManual));for(var e in b.objects){var g=b.objects[e],i=d[e];\"room\"!=e?i&&!i._skip&&(\"creep\"==i.type&&a(\"./processor/intents/creeps/intents\")(i,g,d,f,q,r,p,u,j,n),\"link\"==i.type&&a(\"./processor/intents/links/intents\")(i,g,d,f,q,r,p,u),\"tower\"==i.type&&a(\"./processor/intents/towers/intents\")(i,g,d,f,q,r,p,u,j,n),\"lab\"==i.type&&a(\"./processor/intents/labs/intents\")(i,g,d,f,q,r,p,u),\"spawn\"==i.type&&a(\"./processor/intents/spawns/intents\")(i,g,d,f,q,r,p,u,j),\"constructionSite\"==i.type&&g.remove&&a(\"./processor/intents/construction-sites/remove\")(i,d,q),\"rampart\"==i.type&&g.setPublic&&a(\"./processor/intents/ramparts/set-public\")(i,g.setPublic,d,f,q,r,p),\"terminal\"==i.type&&g.send&&a(\"./processor/intents/terminal/send\")(i,g.send,d,f,q,r,p),\"nuker\"==i.type&&g.launchNuke&&a(\"./processor/intents/nukers/launch-nuke\")(i,g.launchNuke,d,f,q,r,p,u,j,n),\"observer\"==i.type&&g.observeRoom&&(i.observeRoom=g.observeRoom.roomName),\"powerSpawn\"==i.type&&a(\"./processor/intents/power-spawns/intents\")(i,g,d,f,q,r,p,u),(\"extension\"==i.type||\"storage\"==i.type||\"powerSpawn\"==i.type||\"terminal\"==i.type||\"container\"==i.type)&&g.transfer&&a(\"./processor/intents/extensions/transfer\")(i,g.transfer,d,f,q,r,p),\"controller\"==i.type&&(g.unclaim&&a(\"./processor/intents/controllers/unclaim\")(i,g.unclaim,d,f,q,r,j,n),g.activateSafeMode&&a(\"./processor/intents/controllers/activateSafeMode\")(i,g.activateSafeMode,d,f,q,r,j,n)),g.notifyWhenAttacked&&(l.CONSTRUCTION_COST[i.type]||\"creep\"==i.type)&&q.update(i,{notifyWhenAttacked:!!g.notifyWhenAttacked.enabled}),k.config.emit(\"processObjectIntents\",i,c,g,d,f,j,n,q,r)):a(\"./processor/intents/room/intents\")(g,d,f,q,r,p,o,s)}}),i.check(p&&p.safeMode>j?p.user:!1);var A=h(d).filter(function(a){return!a.off&&(\"spawn\"==a.type||\"extension\"==a.type)}).sum(\"energy\"),B={w:[],r:[],pb:[],p:[],s:[],c:[],m:[],k:[]},C=[];return h.forEach(d,function(b){if(b&&!b._skip){if(\"energy\"==b.type&&a(\"./processor/intents/energy/tick\")(b,d,f,q,r,p),\"source\"==b.type&&a(\"./processor/intents/sources/tick\")(b,d,f,q,r,p,j),\"mineral\"==b.type&&a(\"./processor/intents/minerals/tick\")(b,d,f,q,r,p,j),\"creep\"==b.type&&a(\"./processor/intents/creeps/tick\")(b,d,f,q,r,p,u,j),\"spawn\"==b.type&&a(\"./processor/intents/spawns/tick\")(b,d,f,q,r,p,u,A),\"rampart\"==b.type&&a(\"./processor/intents/ramparts/tick\")(b,d,f,q,r,p,j),\"extension\"==b.type&&a(\"./processor/intents/extensions/tick\")(b,d,f,q,r,p,j),\"road\"==b.type&&a(\"./processor/intents/roads/tick\")(b,d,f,q,r,p,j),\"constructionSite\"==b.type&&a(\"./processor/intents/construction-sites/tick\")(b,d,f,q,r,p),\"keeperLair\"==b.type&&a(\"./processor/intents/keeper-lairs/tick\")(b,d,f,q,r,p,j),\"portal\"==b.type&&a(\"./processor/intents/portals/tick\")(b,d,f,q,r,p,j),\"constructedWall\"==b.type&&a(\"./processor/intents/constructedWalls/tick\")(b,d,f,q,r,p,j),\"link\"==b.type&&a(\"./processor/intents/links/tick\")(b,d,f,q,r,p),\"extractor\"==b.type&&a(\"./processor/intents/extractors/tick\")(b,d,f,q,r,p),\"tower\"==b.type&&a(\"./processor/intents/towers/tick\")(b,d,f,q,r,p),\"controller\"==b.type&&a(\"./processor/intents/controllers/tick\")(b,d,f,q,r,p,j,n),\"lab\"==b.type&&a(\"./processor/intents/labs/tick\")(b,d,f,q,r,p,j),\"container\"==b.type&&a(\"./processor/intents/containers/tick\")(b,d,f,q,r,p,j),\"terminal\"==b.type&&a(\"./processor/intents/terminal/tick\")(b,d,f,q,r,p,j),\"nuke\"==b.type&&a(\"./processor/intents/nukes/tick\")(b,d,f,q,r,p,u,j,n),\"observer\"==b.type&&q.update(b,{observeRoom:b.observeRoom}),\"storage\"==b.type&&p){var c=p.level>0&&p.user==b.user&&l.CONTROLLER_STRUCTURES.storage[p.level]>0?l.STORAGE_CAPACITY:0;c!=b.energyCapacity&&q.update(b,{energyCapacity:c})}\"powerBank\"==b.type&&j>=b.decayTime-1&&(q.remove(b._id),delete d[b._id]),\"flag\"!=b.type&&(v[b._id]=b,\"creep\"==b.type&&(v[b._id]=JSON.parse(JSON.stringify(b)),v[b._id]._id=\"\"+b._id,delete v[b._id]._actionLog,delete v[b._id]._ticksToLive,b.actionLog.say&&!b.actionLog.say.isPublic&&delete v[b._id].actionLog.say)),b.user?\"constructionSite\"==b.type||b.newbieWall||\"rampart\"==b.type&&b.isPublic||(B[b.user]=B[b.user]||[],B[b.user].push([b.x,b.y])):\"constructedWall\"==b.type?B.w.push([b.x,b.y]):\"road\"==b.type?B.r.push([b.x,b.y]):\"powerBank\"==b.type?B.pb.push([b.x,b.y]):\"portal\"==b.type?B.p.push([b.x,b.y]):\"source\"==b.type?B.s.push([b.x,b.y]):\"mineral\"==b.type?B.m.push([b.x,b.y]):\"controller\"==b.type?B.c.push([b.x,b.y]):\"keeperLair\"==b.type?B.k.push([b.x,b.y]):\"energy\"==b.type&&\"power\"==b.resourceType&&B.pb.push([b.x,b.y])}}),k.config.emit(\"processRoom\",b,n),k.config.emit(\"processorLoopStage\",\"saveRoom\",b),C.push(k.mapViewSave(b,B)),C.push(q.execute()),C.push(r.execute()),C.push(s.execute()),h.isEqual(n,y)||C.push(k.saveRoomInfo(b,n)),n.active&&e(b,v,j),Date.now()>m+3e4&&(k.roomsStatsSave(),m=Date.now()),g.all(C)})}function e(a,b,c){return n.then(function(){var d=g.when();if(!(c%20)){var e=20*Math.floor((c-1)/20);d=k.history.upload(a,e)}var f=JSON.stringify(b);return n=d.then(function(){return k.history.saveTick(a,c,f)})})}var f,g=a(\"q\"),h=a(\"lodash\"),i=a(\"./processor/intents/movement\"),j=a(\"./utils\"),k=j.getDriver(),l=k.constants,m=(a(\"./config\"),0),n=g.when();k.connect(\"processor\").then(function(){return k.queue.create(\"rooms\",\"read\")}).then(function(a){function b(){var a;k.config.emit(\"processorLoopStage\",\"start\"),f.fetch().then(function(b){return k.config.emit(\"processorLoopStage\",\"getRoomData\",b),a=b,g.all([k.getRoomIntents(b),k.getRoomObjects(b),k.getRoomTerrain(b),k.getGameTime(),k.getRoomInfo(b),k.getRoomFlags(b)])}).then(function(b){k.config.emit(\"processorLoopStage\",\"processRoom\",a),d(a,b[0],b[1],b[2],b[3],b[4],b[5])[\"catch\"](function(a){}).then(function(){return k.clearRoomIntents(a)}).then(function(){return f.markDone(a)})})[\"catch\"](function(a){}).then(function(){k.config.emit(\"processorLoopStage\",\"finish\",a),setTimeout(b,0)})}f=a,b()})[\"catch\"](function(a){}),\"undefined\"==typeof self&&setInterval(function(){var a=g.getUnhandledReasons();a.forEach(function(a){}),g.resetUnhandledRejections()},1e3)},{\"./config\":1,\"./processor/intents/_calc_spawns\":64,\"./processor/intents/constructedWalls/tick\":66,\"./processor/intents/construction-sites/remove\":67,\"./processor/intents/construction-sites/tick\":68,\"./processor/intents/containers/tick\":69,\"./processor/intents/controllers/activateSafeMode\":70,\"./processor/intents/controllers/tick\":71,\"./processor/intents/controllers/unclaim\":72,\"./processor/intents/creeps/intents\":86,\"./processor/intents/creeps/tick\":96,\"./processor/intents/energy/tick\":100,\"./processor/intents/extensions/tick\":101,\"./processor/intents/extensions/transfer\":102,\"./processor/intents/extractors/tick\":103,\"./processor/intents/keeper-lairs/tick\":104,\"./processor/intents/labs/intents\":106,\"./processor/intents/labs/tick\":108,\"./processor/intents/links/intents\":110,\"./processor/intents/links/tick\":111,\"./processor/intents/minerals/tick\":113,\"./processor/intents/movement\":114,\"./processor/intents/nukers/launch-nuke\":115,\"./processor/intents/nukes/tick\":116,\"./processor/intents/portals/tick\":117,\"./processor/intents/power-spawns/intents\":118,\"./processor/intents/ramparts/set-public\":120,\"./processor/intents/ramparts/tick\":121,\"./processor/intents/roads/tick\":122,\"./processor/intents/room/intents\":127,\"./processor/intents/sources/tick\":129,\"./processor/intents/spawns/intents\":133,\"./processor/intents/spawns/tick\":136,\"./processor/intents/terminal/send\":138,\"./processor/intents/terminal/tick\":139,\"./processor/intents/towers/intents\":142,\"./processor/intents/towers/tick\":144,\"./utils\":148,lodash:60,q:61}],63:[function(a,b,c){\"use strict\";var d=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h[\"return\"]&&h[\"return\"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),e=a(\"q\"),f=(a(\"lodash\"),a(\"../utils\")),g=f.getDriver(),h=(g.constants,a(\"./market\"));b.exports=function(){return g.getInterRoom().then(function(a){if(a){var b=d(a,5),c=b[0],f=b[1],i=b[2],j=b[3],k=b[4],l=g.bulkObjectsWrite(),m=g.bulkRoomsWrite(),n={};return f.forEach(function(a){i[a.interRoom.room]&&(n[a.interRoom.room]||m.update(a.interRoom.room,{active:!0}),n[a.interRoom.room]=!0,l.update(a,{room:a.interRoom.room,x:a.interRoom.x,y:a.interRoom.y,interRoom:null}))}),h.execute(k,c,j,l).then(function(){return e.all([l.execute(),m.execute()])})}})}},{\"../utils\":148,\"./market\":146,lodash:60,q:61}],64:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,f){var h=a;h.length>g.CONTROLLER_STRUCTURES.spawn[0|c.level]?(h.sort(e.comparatorDistance(c)),h=d.take(h,g.CONTROLLER_STRUCTURES.spawn[0|c.level]),a.forEach(function(a){return a._off=!d.contains(h,a)})):a.forEach(function(a){return a._off=!1}),a.forEach(function(a){a._off!==a.off&&f.update(a._id,{off:a._off})});var i=b;i.length>g.CONTROLLER_STRUCTURES.extension[0|c.level]?(i.sort(e.comparatorDistance(c)),i=d.take(i,g.CONTROLLER_STRUCTURES.extension[0|c.level]),b.forEach(function(a){return a._off=!d.contains(i,a)})):b.forEach(function(a){return a._off=!1}),b.forEach(function(a){a._off!==a.off&&f.update(a._id,{off:a._off})})}},{\"../../utils\":148,lodash:60}],65:[function(a,b,c){\"use strict\";function d(b,c,d,g,i){var j=0,k=c;if(e.any(b.body,function(a){return!!a.boost}))for(var l=0;l<b.body.length&&!(0>=k);l++){var m=b.body[l],n=1;m.boost&&h.BOOSTS[m.type][m.boost]&&h.BOOSTS[m.type][m.boost].damage&&(n=h.BOOSTS[m.type][m.boost].damage);var o=m.hits/n;j+=Math.min(o,k)*(1-n),k-=Math.min(o,k)}c-=Math.round(j),b.hits-=c,a(\"./creeps/_recalc-body\")(b);for(var p=0;p<h.RESOURCES_ALL.length;p++){var q=h.RESOURCES_ALL[p],r=f.calcResources(b);if(r<=b.energyCapacity)break;b[q]&&a(\"./creeps/drop\")(b,{amount:Math.min(b[q],r-b.energyCapacity),resourceType:q},d,g,i)}}var e=a(\"lodash\"),f=a(\"../../utils\"),g=f.getDriver(),h=g.constants;b.exports=function(b,c,g,i,j,k,l,m,n,o,p){if(c.hits){var q=0;if(\"creep\"==c.type?(\"melee\"!=i||e.any(j,{type:\"rampart\",x:b.x,y:b.y})||(q=f.calcBodyEffectiveness(c.body,h.ATTACK,\"attack\",h.ATTACK_POWER)),d(c,g,j,k,l)):c.hits-=g,\"powerBank\"==c.type&&(q=g*h.POWER_BANK_HIT_BACK),m&&m.user==b.user&&m.safeMode>o&&(q=0),\"constructedWall\"==c.type&&c.decayTime)a(\"./creeps/_clear-newbie-walls\")(j,l);else if(c.hits<=0){if(\"creep\"==c.type?a(\"./creeps/_die\")(c,j,l,n):(h.RESOURCES_ALL.forEach(function(b){c[b]>0&&a(\"./creeps/_create-energy\")(c.x,c.y,c.room,c[b],j,l,b)}),l.remove(c._id),delete j[c._id]),\"spawn\"==c.type&&c.spawning){var r=e.find(j,{user:c.user,name:c.spawning.name});r&&l.remove(r._id)}}else\"creep\"==c.type?l.update(c,{hits:c.hits,body:c.body,energy:c.energy,energyCapacity:c.energyCapacity}):l.update(c,{hits:c.hits});b.actionLog&&(b.actionLog[\"creep\"==b.type&&\"ranged\"==i?\"rangedAttack\":\"attack\"]={x:c.x,y:c.y}),c.actionLog&&(c.actionLog.attacked={x:b.x,y:b.y}),\"2\"!=b.user&&\"3\"!=b.user&&(c.notifyWhenAttacked&&f.sendAttackingNotification(c,m),p&&b.user&&c.user&&b.user!=c.user&&\"2\"!=c.user&&\"3\"!=c.user&&(p.lastPvpTime=o)),q&&(d(b,q,j,k,l),b.actionLog.attacked={x:c.x,y:c.y},b.hits<=0?a(\"./creeps/_die\")(b,j,l,n):l.update(b,{hits:b.hits,body:b.body,energy:b.energy,energyCapacity:b.energyCapacity}))}}},{\"../../utils\":148,\"./creeps/_clear-newbie-walls\":73,\"./creeps/_create-energy\":74,\"./creeps/_die\":75,\"./creeps/_recalc-body\":76,\"./creeps/drop\":82,lodash:60}],66:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,e,h,i,j){if(a&&\"constructedWall\"==a.type){if(i&&!a.newbieWall){var k=g.CONTROLLER_STRUCTURES.constructedWall[i.level]?g.WALL_HITS_MAX:0;k!=a.hitsMax&&e.update(a,{hitsMax:k})}a.ticksToLive>0&&e.update(a,{decayTime:j+a.ticksToLive,ticksToLive:null}),a.decayTime&&(d.isObject(a.decayTime)||((j>=a.decayTime-1||i&&!i.user)&&(e.remove(a._id),delete b[a._id]),a.user&&j==a.decayTime-5e3&&f.sendNotification(a.user,\"Attention! Your room protection will be removed soon.\\nLearn how to defend your room against intruders from <a href='http://support.screeps.com/hc/en-us/articles/203339002-Defending-your-room'>this article</a>.\")),d.isObject(a.decayTime)&&Date.now()>a.decayTime.timestamp&&(e.remove(a._id),delete b[a._id]))}}},{\"../../../utils\":148,lodash:60}],67:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver();e.constants;b.exports=function(b,c,d){b&&\"constructionSite\"==b.type&&(d.remove(b._id),b.progress>1&&a(\"../creeps/_create-energy\")(b.x,b.y,b.room,Math.floor(b.progress/2),c,d))}},{\"../../../utils\":148,\"../creeps/_create-energy\":74,lodash:60}],68:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver();e.constants;b.exports=function(a,b,c,d){!a||\"constructionSite\"!=a.type}},{\"../../../utils\":148,lodash:60}],69:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(b,c,d,e,g,h,i){(!b.nextDecayTime||i>=b.nextDecayTime-1)&&(b.hits=b.hits||0,b.hits-=f.CONTAINER_DECAY,b.hits<=0?(f.RESOURCES_ALL.forEach(function(d){b[d]>0&&a(\"../creeps/_create-energy\")(b.x,b.y,b.room,b[d],c,e,d)}),e.remove(b._id),delete c[b._id]):(b.nextDecayTime=i+(h&&h.level>0?f.CONTAINER_DECAY_TIME_OWNED:f.CONTAINER_DECAY_TIME),e.update(b,{hits:b.hits,nextDecayTime:b.nextDecayTime})))}},{\"../../../utils\":148,\"../creeps/_create-energy\":74,lodash:60}],70:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a,b,c,d,e,g,h,i){a.user&&a.level&&a.safeModeAvailable>=0&&(a.safeModeCooldown>=h||a.upgradeBlocked>h||e.update(a,{safeModeAvailable:a.safeModeAvailable-1,safeMode:h+f.SAFE_MODE_DURATION,safeModeCooldown:i.novice>Date.now()?null:h+f.SAFE_MODE_COOLDOWN}))}},{\"../../../utils\":148,lodash:60}],71:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a,b,c,d,g,h,i,j){if(a&&\"controller\"==a.type&&(a.reservation&&(i>=a.reservation.endTime-1||a.user)&&d.update(a,{reservation:null}),a.user)){if(a._upgraded||!a.downgradeTime||a.tutorial)return void d.update(a,{downgradeTime:i+f.CONTROLLER_DOWNGRADE[a.level]+1});i==a.downgradeTime-3e3&&e.sendNotification(a.user,\"Attention! Your Controller in room \"+a.room+\" will be downgraded to level \"+(a.level-1)+\" in 3000 ticks (~2 hours)! Upgrade it to prevent losing of this room. <a href='http://support.screeps.com/hc/en-us/articles/203086021-Territory-control'>Learn more</a>\"),i>=a.downgradeTime-1&&(a.level--,e.sendNotification(a.user,\"Your Controller in room \"+a.room+\" has been downgraded to level \"+a.level+\" due to absence of upgrading activity!\"),0==a.level?(a.progress=0,a.user=null,a.downgradeTime=null,a.upgradeBlocked=null,a.safeMode=null,a.safeModeAvailable=0,a.safeModeCooldown=j.novice>Date.now()?null:i+f.SAFE_MODE_COOLDOWN):(a.downgradeTime=i+f.CONTROLLER_DOWNGRADE[a.level]+1,a.progress+=Math.round(.9*f.CONTROLLER_LEVELS[a.level]),a.safeModeAvailable=0,a.safeModeCooldown=j.novice>Date.now()?null:i+f.SAFE_MODE_COOLDOWN),d.update(a,{downgradeTime:a.downgradeTime,level:a.level,progress:a.progress,user:a.user,upgradeBlocked:a.upgradeBlocked,safeMode:a.safeMode,safeModeCooldown:a.safeModeCooldown,safeModeAvailable:a.safeModeAvailable}))}}},{\"../../../utils\":148,lodash:60}],72:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a,b,c,d,e,g,h,i){\"controller\"==a.type&&a.user&&a.level&&e.update(a,{user:null,level:0,progress:0,downgradeTime:null,safeMode:null,safeModeAvailable:0,safeModeCooldown:i.novice>Date.now()?null:h+f.SAFE_MODE_COOLDOWN})}},{\"../../../utils\":148,lodash:60}],73:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver();f.constants;b.exports=function(a,b){d.forEach(a,function(c){\"constructedWall\"==c.type&&c.decayTime&&c.user&&(b.remove(c._id),delete a[c._id])})}},{\"../../../utils\":148,lodash:60}],74:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var e=a(\"lodash\"),f=a(\"../../../utils\"),g=f.getDriver();g.constants;b.exports=function(a,b,c,g,h,i,j){if(j=j||\"energy\",g=Math.round(g),!(0>=g)){var k=e.find(h,{type:\"container\",x:a,y:b});if(k&&k.hits>0){var l=f.calcResources(k),m=Math.min(g,k.energyCapacity-l);m>0&&(k[j]=k[j]||0,k[j]+=m,i.update(k,d({},j,k[j])),g-=m)}if(g>0){var n=e.find(h,{type:\"energy\",x:a,y:b,resourceType:j});if(n)i.update(n,d({},j,n[j]+g));else{var o;i.insert((o={type:\"energy\",x:a,y:b,room:c},d(o,j,g),d(o,\"resourceType\",j),o))}}}}},{\"../../../utils\":148,lodash:60}],75:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,f,h,i){if(void 0===i&&(i=g.CREEP_CORPSE_RATE),f.remove(b._id),delete c[b._id],i>0&&!b.userSummoned){var j=d.any(b.body,{type:g.CLAIM})?g.CREEP_CLAIM_LIFE_TIME:g.CREEP_LIFE_TIME,k={energy:e.calcCreepCost(b.body)*i*b._ticksToLive/j};b.body.forEach(function(a){a.boost&&(k[a.boost]=k[a.boost]||0,k[a.boost]+=g.LAB_BOOST_MINERAL*i*b._ticksToLive/j,k.energy+=g.LAB_BOOST_ENERGY*i*b._ticksToLive/j)}),d.forEach(k,function(d,e){d>0&&a(\"./_create-energy\")(b.x,b.y,b.room,Math.floor(d),c,f,e)}),g.RESOURCES_ALL.forEach(function(d){b[d]>0&&a(\"./_create-energy\")(b.x,b.y,b.room,b[d],c,f,d)})}h&&\"3\"!=b.user&&\"2\"!=b.user&&h.inc(\"creepsLost\",b.user,b.body.length)}},{\"../../../utils\":148,\"./_create-energy\":74,lodash:60}],76:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a){for(var b=a.hits,c=a.body.length-1;c>=0;c--)a.body[c]._oldHits=a.body[c]._oldHits||a.body[c].hits,b>100?a.body[c].hits=100:a.body[c].hits=b,b-=100,0>b&&(b=0);a.energyCapacity=d.calcBodyEffectiveness(a.body,f.CARRY,\"capacity\",f.CARRY_CAPACITY,!0)}},{\"../../../utils\":148,lodash:60}],77:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,f,h,i,j,k,l,m,n){if(\"creep\"==b.type&&!b.spawning){var o=f[c.id];if(o&&o!=b&&!(Math.abs(o.x-b.x)>1||Math.abs(o.y-b.y)>1)&&(\"creep\"!=o.type||!o.spawning)&&o.hits&&!(k&&k.user!=b.user&&k.safeMode>m)){var p=d.find(f,{type:\"rampart\",x:o.x,y:o.y});p&&(o=p);var q=e.calcBodyEffectiveness(b.body,g.ATTACK,\"attack\",g.ATTACK_POWER);a(\"../_damage\")(b,o,q,\"melee\",f,h,i,k,l,m,n),b._attack=!0}}}},{\"../../../utils\":148,\"../_damage\":65,lodash:60}],78:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,e,f,h,i,j,k){if(\"creep\"==a.type&&!a.spawning){var l=c[b.id];if(l&&\"controller\"==l.type&&!(Math.abs(l.x-a.x)>1||Math.abs(l.y-a.y)>1)&&(l.user||l.reservation)&&!(i&&i.user!=a.user&&i.safeMode>k)){var m=Math.floor(d.filter(a.body,function(a){return a.hits>0&&a.type==g.CLAIM}).length*g.CONTROLLER_CLAIM_DOWNGRADE);if(m){if(l.reservation){var n=l.reservation.endTime-m;f.update(l,{reservation:{endTime:n}})}if(l.user){var o=l.downgradeTime-m;f.update(l,{downgradeTime:o,upgradeBlocked:k+g.CONTROLLER_ATTACK_BLOCKED_UPGRADE})}a.actionLog.attack={x:l.x,y:l.y}}}}}},{\"../../../utils\":148,lodash:60}],79:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../config\"),f=a(\"../../../utils\"),g=f.getDriver(),h=g.constants,i=0;b.exports=function(a,b,c,g,j,k,l,m,n){if(\"creep\"==a.type&&!(a.spawning||a.energy<=0)){var o=c[b.id];if(o&&\"constructionSite\"==o.type&&h.CONSTRUCTION_COST[o.structureType]&&!(Math.abs(o.x-a.x)>3||Math.abs(o.y-a.y)>3||d.any(c,{x:o.x,y:o.y,type:o.structureType})||d.contains(h.OBSTACLE_OBJECT_TYPES,o.structureType)&&d.any(c,function(a){return a.x==o.x&&a.y==o.y&&d.contains(h.OBSTACLE_OBJECT_TYPES,a.type)})||\"extractor\"!=o.structureType&&f.checkTerrain(g,o.x,o.y,h.TERRAIN_MASK_WALL))){var p=d.filter(a.body,function(a){return(a.hits>0||a._oldHits>0)&&a.type==h.WORK}).length*h.BUILD_POWER||0,q=o.progressTotal-o.progress,r=Math.min(p,q,a.energy),s=d.map(a.body,function(a){return a.type==h.WORK&&a.boost&&h.BOOSTS[h.WORK][a.boost].build>0?(h.BOOSTS[h.WORK][a.boost].build-1)*h.BUILD_POWER:0});s.sort(function(a,b){return b-a}),s=s.slice(0,r);var t=Math.min(Math.floor(r+d.sum(s)),q);if(!(o.progress+t>=o.progressTotal)||o.tutorial||f.checkControllerAvailability(o.structureType,c,l,1))if(o.progress+=t,a.energy-=r,m.inc(\"energyConstruction\",a.user,r),a.actionLog.build={x:o.x,y:o.y},j.update(a,{energy:a.energy}),o.progress<o.progressTotal)j.update(o,{progress:o.progress});else{j.remove(o._id);var u={type:o.structureType,x:o.x,y:o.y,room:o.room,notifyWhenAttacked:!0};if(\"spawn\"==o.structureType&&d.extend(u,{name:o.name,user:o.user,energy:0,energyCapacity:h.SPAWN_ENERGY_CAPACITY,hits:h.SPAWN_HITS,hitsMax:h.SPAWN_HITS}),\"extension\"==o.structureType&&d.extend(u,{user:o.user,energy:0,energyCapacity:0,hits:h.EXTENSION_HITS,hitsMax:h.EXTENSION_HITS}),\"link\"==o.structureType&&d.extend(u,{user:o.user,energy:0,energyCapacity:h.LINK_CAPACITY,cooldown:0,hits:h.LINK_HITS,hitsMax:h.LINK_HITS_MAX}),\"storage\"==o.structureType&&d.extend(u,{user:o.user,energy:0,energyCapacity:h.STORAGE_CAPACITY,hits:h.STORAGE_HITS,hitsMax:h.STORAGE_HITS}),\"rampart\"==o.structureType&&d.extend(u,{user:o.user,hits:h.RAMPART_HITS,hitsMax:h.RAMPART_HITS,nextDecayTime:n+h.RAMPART_DECAY_TIME}),\"road\"==o.structureType){var v=h.ROAD_HITS;(d.any(c,{x:o.x,y:o.y,type:\"swamp\"})||f.checkTerrain(g,o.x,o.y,h.TERRAIN_MASK_SWAMP))&&(v*=h.CONSTRUCTION_COST_ROAD_SWAMP_RATIO),d.extend(u,{hits:v,hitsMax:v})}\"constructedWall\"==o.structureType&&d.extend(u,{hits:h.WALL_HITS,hitsMax:h.WALL_HITS_MAX}),\"tower\"==o.structureType&&d.extend(u,{user:o.user,energy:0,energyCapacity:h.TOWER_CAPACITY,hits:h.TOWER_HITS,hitsMax:h.TOWER_HITS}),\"observer\"==o.structureType&&d.extend(u,{user:o.user,hits:h.OBSERVER_HITS,hitsMax:h.OBSERVER_HITS}),\"extractor\"==o.structureType&&d.extend(u,{user:o.user,hits:h.EXTRACTOR_HITS,hitsMax:h.EXTRACTOR_HITS}),\"lab\"==o.structureType&&d.extend(u,{user:o.user,hits:h.LAB_HITS,hitsMax:h.LAB_HITS,mineralAmount:0,cooldown:0,mineralType:null,mineralCapacity:h.LAB_MINERAL_CAPACITY,energy:0,energyCapacity:h.LAB_ENERGY_CAPACITY}),\"powerSpawn\"==o.structureType&&d.extend(u,{user:o.user,power:0,powerCapacity:h.POWER_SPAWN_POWER_CAPACITY,energy:0,energyCapacity:h.POWER_SPAWN_ENERGY_CAPACITY,hits:h.POWER_SPAWN_HITS,hitsMax:h.POWER_SPAWN_HITS}),\"terminal\"==o.structureType&&d.extend(u,{user:o.user,energy:0,energyCapacity:h.TERMINAL_CAPACITY,hits:h.TERMINAL_HITS,hitsMax:h.TERMINAL_HITS}),\"container\"==o.structureType&&d.extend(u,{energy:0,energyCapacity:h.CONTAINER_CAPACITY,hits:h.CONTAINER_HITS,hitsMax:h.CONTAINER_HITS,nextDecayTime:n+h.CONTAINER_DECAY_TIME}),\"nuker\"==o.structureType&&d.extend(u,{user:o.user,energy:0,energyCapacity:e.ptr?1:h.NUKER_ENERGY_CAPACITY,G:0,GCapacity:e.ptr?1:h.NUKER_GHODIUM_CAPACITY,hits:h.NUKER_HITS,hitsMax:h.NUKER_HITS,cooldownTime:n+(e.ptr?100:h.NUKER_COOLDOWN)}),j.insert(u),c[\"createdStructure\"+i]=u,i++,delete c[b.id]}}}}},{\"../../../config\":1,\"../../../utils\":148,lodash:60}],80:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver();e.constants;b.exports=function(a,b,c,d,e,f,g,h,i){if(\"creep\"==a.type&&!a.spawning){var j=c[b.id];if(j&&\"controller\"==j.type&&!(Math.abs(j.x-a.x)>1||Math.abs(j.y-a.y)>1||j.bindUser&&a.user!=j.bindUser||j.level>0||j.reservation&&j.reservation.user!=a.user)){var k=1;e.update(j,{user:a.user,level:k,progress:0,downgradeTime:null,reservation:null})}}}},{\"../../../utils\":148,lodash:60}],81:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,f,h,i,j,k,l,m,n){if(\"creep\"==b.type&&!b.spawning){var o=f[c.id];if(o&&g.CONSTRUCTION_COST[o.type]&&!(Math.abs(o.x-b.x)>1||Math.abs(o.y-b.y)>1||k&&k.user!=b.user&&k.safeMode>m)){var p=d.find(f,{type:\"rampart\",x:o.x,y:o.y});p&&(o=p);var q=e.calcBodyEffectiveness(b.body,g.WORK,\"dismantle\",g.DISMANTLE_POWER),r=Math.min(q,o.hits),s=Math.floor(r*g.DISMANTLE_COST);r&&(b.energy+=s,i.update(b,{energy:b.energy}),b.energy>b.energyCapacity&&a(\"./drop\")(b,{amount:b.energy-b.energyCapacity,resourceType:\"energy\"},f,h,i),a(\"../_damage\")(b,o,r,\"melee\",f,h,i,k,l,m,n))}}}},{\"../../../utils\":148,\"../_damage\":65,\"./drop\":82,lodash:60}],82:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var e=a(\"lodash\"),f=a(\"../../../utils\"),g=f.getDriver(),h=g.constants;b.exports=function(b,c,f,g,i){\"creep\"==b.type&&e.contains(h.RESOURCES_ALL,c.resourceType)&&!b.spawning&&b[c.resourceType]>=c.amount&&(c.amount>0&&(b[c.resourceType]-=c.amount,a(\"./_create-energy\")(b.x,b.y,b.room,c.amount,f,i,c.resourceType)),i.update(b,d({},c.resourceType,b[c.resourceType])))}},{\"../../../utils\":148,\"./_create-energy\":74,lodash:60}],83:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var e=(a(\"lodash\"),a(\"../../../utils\")),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,e,f,h,i,j,k){if(!a.spawning){var l=c[b.id];l&&\"controller\"==l.type&&(Math.abs(l.x-a.x)>1||Math.abs(l.y-a.y)>1||a[g.RESOURCE_GHODIUM]>=g.SAFE_MODE_COST&&(f.update(l,{safeModeAvailable:(l.safeModeAvailable||0)+1}),f.update(a,d({},g.RESOURCE_GHODIUM,a[g.RESOURCE_GHODIUM]-g.SAFE_MODE_COST))))}}},{\"../../../utils\":148,lodash:60}],84:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var e=a(\"lodash\"),f=a(\"../../../utils\"),g=f.getDriver(),h=g.constants;b.exports=function(b,c,g,i,j,k,l,m){if(\"creep\"==b.type&&!b.spawning){var n=g[c.id];if(n&&!(Math.abs(n.x-b.x)>1||Math.abs(n.y-b.y)>1)){if(\"source\"==n.type){if(!n.energy)return;if(l&&(l.user&&l.user!=b.user||l.reservation&&l.reservation.user!=b.user))return;var o=f.calcBodyEffectiveness(b.body,h.WORK,\"harvest\",h.HARVEST_POWER);if(o){var p=Math.min(n.energy,o);n.energy-=p,b.energy+=p;var q=(n.invaderHarvested||0)+p;j.update(b,{energy:b.energy}),j.update(n,{energy:n.energy,invaderHarvested:q});var r=f.calcResources(b);r>b.energyCapacity&&a(\"./drop\")(b,{\n";
 d += "amount:Math.min(b.energy,r-b.energyCapacity),resourceType:\"energy\"},g,i,j),b.actionLog.harvest={x:n.x,y:n.y},m.inc(\"energyHarvested\",b.user,p)}}if(\"mineral\"==n.type){if(!n.mineralAmount)return;var s=e.find(g,function(a){return a.type==h.STRUCTURE_EXTRACTOR&&a.x==n.x&&a.y==n.y});if(!s)return;if(s.user&&s.user!=b.user)return;if(!f.checkStructureAgainstController(s,g,l))return;if(s.cooldown)return;var t=f.calcBodyEffectiveness(b.body,h.WORK,\"harvest\",h.HARVEST_MINERAL_POWER);if(t){var u=Math.min(n.mineralAmount,t);j.update(n,{mineralAmount:n.mineralAmount-u}),j.update(b,d({},n.mineralType,(b[n.mineralType]||0)+u));var v=f.calcResources(b);v>b.energyCapacity&&a(\"./drop\")(b,{amount:Math.min(b[n.mineralType],v-b.energyCapacity),resourceType:n.mineralType},g,i,j),b.actionLog.harvest={x:n.x,y:n.y},s._cooldown=h.EXTRACTOR_COOLDOWN}}}}}},{\"../../../utils\":148,\"./drop\":82,lodash:60}],85:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(b,c,e,g,h,i,j,k,l){function m(b){a(\"./_recalc-body\")(b)}if(\"creep\"==b.type&&!b.spawning){var n=e[c.id];if(!(!n||\"creep\"!=n.type||n.spawning||n.hits>=n.hitsMax||Math.abs(n.x-b.x)>1||Math.abs(n.y-b.y)>1||j&&j.user!=b.user&&j.safeMode>l)){var o=d.calcBodyEffectiveness(b.body,f.HEAL,\"heal\",f.HEAL_POWER);n.hits+=o,n.hits>n.hitsMax&&(n.hits=n.hitsMax),m(n),b.actionLog.heal={x:n.x,y:n.y},n.actionLog.healed={x:b.x,y:b.y},h.update(n,{hits:n.hits,body:n.body,energyCapacity:n.energyCapacity})}}}},{\"../../../utils\":148,\"./_recalc-body\":76,lodash:60}],86:[function(a,b,c){\"use strict\";function d(a,b){return a[b]&&(!f[b]||!e.any(f[b],function(b){return!!a[b]}))}var e=a(\"lodash\"),f={rangedHeal:[\"heal\"],dismantle:[\"attackController\",\"rangedHeal\",\"heal\"],repair:[\"dismantle\",\"attackController\",\"rangedHeal\",\"heal\"],build:[\"repair\",\"dismantle\",\"attackController\",\"rangedHeal\",\"heal\"],attack:[\"build\",\"repair\",\"dismantle\",\"attackController\",\"rangedHeal\",\"heal\"],harvest:[\"attack\",\"build\",\"repair\",\"dismantle\",\"attackController\",\"rangedHeal\",\"heal\"],rangedMassAttack:[\"build\",\"repair\",\"rangedHeal\"],rangedAttack:[\"rangedMassAttack\",\"build\",\"repair\",\"rangedHeal\"]},g=[\"drop\",\"transfer\",\"withdraw\",\"pickup\",\"heal\",\"rangedHeal\",\"dismantle\",\"attack\",\"harvest\",\"move\",\"repair\",\"build\",\"rangedMassAttack\",\"rangedAttack\",\"suicide\",\"say\",\"claimController\",\"upgradeController\",\"reserveController\",\"attackController\",\"generateSafeMode\"],h={\"_clear-newbie-walls\":a(\"./_clear-newbie-walls.js\"),\"_create-energy\":a(\"./_create-energy.js\"),_die:a(\"./_die.js\"),\"_recalc-body\":a(\"./_recalc-body.js\"),attack:a(\"./attack.js\"),attackController:a(\"./attackController.js\"),build:a(\"./build.js\"),claimController:a(\"./claimController.js\"),dismantle:a(\"./dismantle.js\"),drop:a(\"./drop.js\"),generateSafeMode:a(\"./generateSafeMode.js\"),harvest:a(\"./harvest.js\"),heal:a(\"./heal.js\"),intents:a(\"./intents.js\"),move:a(\"./move.js\"),pickup:a(\"./pickup.js\"),rangedAttack:a(\"./rangedAttack.js\"),rangedHeal:a(\"./rangedHeal.js\"),rangedMassAttack:a(\"./rangedMassAttack.js\"),repair:a(\"./repair.js\"),reserveController:a(\"./reserveController.js\"),say:a(\"./say.js\"),suicide:a(\"./suicide.js\"),tick:a(\"./tick.js\"),transfer:a(\"./transfer.js\"),upgradeController:a(\"./upgradeController.js\"),withdraw:a(\"./withdraw.js\")};b.exports=function(a,b,c,e,f,i,j,k,l,m){g.forEach(function(g){d(b,g)&&h[g](a,b[g],c,e,f,i,j,k,l,m)})}},{\"./_clear-newbie-walls.js\":73,\"./_create-energy.js\":74,\"./_die.js\":75,\"./_recalc-body.js\":76,\"./attack.js\":77,\"./attackController.js\":78,\"./build.js\":79,\"./claimController.js\":80,\"./dismantle.js\":81,\"./drop.js\":82,\"./generateSafeMode.js\":83,\"./harvest.js\":84,\"./heal.js\":85,\"./intents.js\":86,\"./move.js\":87,\"./pickup.js\":88,\"./rangedAttack.js\":89,\"./rangedHeal.js\":90,\"./rangedMassAttack.js\":91,\"./repair.js\":92,\"./reserveController.js\":93,\"./say.js\":94,\"./suicide.js\":95,\"./tick.js\":96,\"./transfer.js\":97,\"./upgradeController.js\":98,\"./withdraw.js\":99,lodash:60}],87:[function(a,b,c){\"use strict\";var d=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h[\"return\"]&&h[\"return\"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),e=a(\"lodash\"),f=a(\"../../../utils\"),g=f.getDriver(),h=g.constants,i=a(\"../movement\");b.exports=function(b,c,g,j,k,l,m,n,o){if(\"creep\"==b.type&&!(b.spawning||b.fatigue>0)&&0!=e.filter(b.body,function(a){return a.hits>0&&a.type==h.MOVE}).length&&c.direction){var p=f.getOffsetsByDirection(c.direction),q=null,r=!1;if(p){var s=d(p,2),t=s[0],u=s[1];if(!(b.x+t<0||b.x+t>49||b.y+u<0||b.y+u>49)){var v=e.filter(g,{x:b.x+t,y:b.y+u});v.forEach(function(a){!(m&&m.user!=b.user&&m.safeMode>o)&&!b._attack&&e.filter(b.body,function(a){return a.hits>0&&a.type==h.ATTACK}).length>0&&(e.contains(h.OBSTACLE_OBJECT_TYPES,a.type)||\"rampart\"==a.type&&!a.isPublic)&&b.user!=a.user&&a.hits?q=a:(e.contains(h.OBSTACLE_OBJECT_TYPES,a.type)&&\"creep\"!=a.type||\"rampart\"==a.type&&!a.isPublic&&b.user!=a.user)&&(r=!0)}),q?a(\"./attack\")(b,{id:q._id,x:q.x,y:q.y},g,j,k):r||i.add(b,t,u)}}}}},{\"../../../utils\":148,\"../movement\":114,\"./attack\":77,lodash:60}],88:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var e=(a(\"lodash\"),a(\"../../../utils\")),f=e.getDriver();f.constants;b.exports=function(a,b,c,f,g){if(\"creep\"==a.type){var h=e.calcResources(a);if(!(a.spawning||h>=a.energyCapacity)){var i=c[b.id];if(i&&\"energy\"==i.type&&!(Math.abs(i.x-a.x)>1||Math.abs(i.y-a.y)>1)){var j=i.resourceType||\"energy\",k=Math.min(a.energyCapacity-h,i[j]);i[j]-=k,a[j]=a[j]||0,a[j]+=k,i[j]?g.update(i,d({},j,i[j])):(g.remove(i._id),delete c[i._id]),g.update(a,d({},j,a[j]))}}}}},{\"../../../utils\":148,lodash:60}],89:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,f,h,i,j,k,l,m,n){if(\"creep\"==b.type&&!b.spawning){var o=f[c.id];if(o&&o!=b&&!(Math.abs(o.x-b.x)>3||Math.abs(o.y-b.y)>3)&&(\"creep\"!=o.type||!o.spawning)&&o.hits&&!(k&&k.user!=b.user&&k.safeMode>m)){var p=d.find(f,{type:\"rampart\",x:o.x,y:o.y});p&&(o=p);var q=e.calcBodyEffectiveness(b.body,g.RANGED_ATTACK,\"rangedAttack\",g.RANGED_ATTACK_POWER);a(\"../_damage\")(b,o,q,\"ranged\",f,h,i,k,l,m,n)}}}},{\"../../../utils\":148,\"../_damage\":65,lodash:60}],90:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,f,h,i,j,k,l){function m(a){for(var b=a.hits,c=a.body.length-1;c>=0;c--)b>100?a.body[c].hits=100:a.body[c].hits=b,b-=100,0>b&&(b=0);a.energyCapacity=d.filter(a.body,function(a){return a.hits>0&&a.type==g.CARRY}).length*g.CARRY_CAPACITY}if(\"creep\"==a.type&&!a.spawning){var n=c[b.id];if(!(!n||\"creep\"!=n.type||n.spawning||n.hits>=n.hitsMax||Math.abs(n.x-a.x)>3||Math.abs(n.y-a.y)>3||j&&j.user!=a.user&&j.safeMode>l)){var o=e.calcBodyEffectiveness(a.body,g.HEAL,\"rangedHeal\",g.RANGED_HEAL_POWER);n.hits+=o,n.hits>n.hitsMax&&(n.hits=n.hitsMax),m(n),a.actionLog.rangedHeal={x:n.x,y:n.y},n.actionLog.healed={x:a.x,y:a.y},h.update(n,{hits:n.hits,body:n.body,energyCapacity:n.energyCapacity})}}}},{\"../../../utils\":148,lodash:60}],91:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,f,h,i,j,k,l,m,n){if(\"creep\"==b.type&&!b.spawning){var o=e.calcBodyEffectiveness(b.body,g.RANGED_ATTACK,\"rangedMassAttack\",g.RANGED_ATTACK_POWER);if(0!=o&&!(k&&k.user!=b.user&&k.safeMode>m)){var p=d.filter(f,function(a){return(!d.isUndefined(a.user)||\"powerBank\"==a.type)&&a.user!=b.user&&a.x>=b.x-3&&a.x<=b.x+3&&a.y>=b.y-3&&a.y<=b.y+3}),q={1:1,2:.4,3:.1};for(var r in p){var s=p[r];if((\"rampart\"==s.type||!d.find(f,{type:\"rampart\",x:s.x,y:s.y}))&&s.hits){var t=Math.max(Math.abs(b.x-s.x),Math.abs(b.y-s.y)),u=Math.round(o*q[t]);a(\"../_damage\")(b,s,u,\"ranged\",f,h,i,k,l,m,n)}}b.actionLog.rangedMassAttack={}}}}},{\"../../../utils\":148,\"../_damage\":65,lodash:60}],92:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,e,f,h,i,j){if(\"creep\"==a.type&&!(a.spawning||a.energy<=0)){var k=c[b.id];if(k&&g.CONSTRUCTION_COST[k.type]&&!(k.hits>=k.hitsMax)&&!(Math.abs(k.x-a.x)>3||Math.abs(k.y-a.y)>3)&&k.hitsMax){var l=d.filter(a.body,function(a){return(a.hits>0||a._oldHits>0)&&a.type==g.WORK}).length*g.REPAIR_POWER||0,m=a.energy/g.REPAIR_COST,n=k.hitsMax-k.hits,o=Math.min(l,m,n),p=Math.min(a.energy,Math.ceil(o*g.REPAIR_COST)),q=d.map(a.body,function(a){return a.type==g.WORK&&a.boost&&g.BOOSTS[g.WORK][a.boost].repair>0?(g.BOOSTS[g.WORK][a.boost].repair-1)*g.REPAIR_POWER:0});q.sort(function(a,b){return b-a}),q=q.slice(0,o);var r=Math.min(Math.floor(o+d.sum(q)),n);r&&(k.hits+=r,a.energy-=p,j.inc(\"energyConstruction\",a.user,p),k.hits>k.hitsMax&&(k.hits=k.hitsMax),a.actionLog.repair={x:k.x,y:k.y},f.update(k,{hits:k.hits}),f.update(a,{energy:a.energy}))}}}},{\"../../../utils\":148,lodash:60}],93:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,e,f,h,i,j,k){if(\"creep\"==a.type&&!a.spawning){var l=c[b.id];if(l&&\"controller\"==l.type&&!(Math.abs(l.x-a.x)>1||Math.abs(l.y-a.y)>1||l.user||l.reservation&&l.reservation.user!=a.user)){var m=d.filter(a.body,function(a){return a.hits>0&&a.type==g.CLAIM}).length*g.CONTROLLER_RESERVE;m&&(l.reservation||(l.reservation={user:a.user,endTime:k+1}),l.reservation.endTime+=m,l.reservation.endTime>k+g.CONTROLLER_RESERVE_MAX||(a.actionLog.reserveController={x:l.x,y:l.y},f.update(l,{reservation:l.reservation})))}}}},{\"../../../utils\":148,lodash:60}],94:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver();f.constants;b.exports=function(a,b,c,e,f){\"creep\"==a.type&&(a.spawning||d.isString(b.message)&&(a.actionLog.say={message:b.message.substring(0,10),isPublic:b.isPublic}))}},{\"../../../utils\":148,lodash:60}],95:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver();e.constants;b.exports=function(b,c,d,e,f,g,h,i){\"creep\"==b.type&&(b.spawning||a(\"./_die\")(b,d,f,void 0,\"2\"==b.user?0:void 0))}},{\"../../../utils\":148,\"./_die\":75,lodash:60}],96:[function(a,b,c){\"use strict\";var d=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h[\"return\"]&&h[\"return\"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),e=a(\"lodash\"),f=a(\"../../../utils\"),g=f.getDriver(),h=g.constants,i=a(\"../movement\");b.exports=function(b,c,g,j,k,l,m,n){if(b&&\"creep\"==b.type){if(b.spawning){var o=e.find(c,{type:\"spawn\",x:b.x,y:b.y});o?o.spawning&&o.spawning.name==b.name||a(\"../spawns/_born-creep\")(o,b,c,g,j,m):j.remove(b._id)}else{if(i.execute(b,j,l,n),(0==b.x||0==b.y||49==b.x||49==b.y)&&\"2\"!=b.user&&\"3\"!=b.user){var p=f.roomNameToXY(b.room),q=d(p,2),r=q[0],s=q[1],t=b.x,u=b.y,v=b.room;0==b.x?(t=49,v=f.getRoomNameFromXY(r-1,s)):0==b.y?(u=49,v=f.getRoomNameFromXY(r,s-1)):49==b.x?(t=0,v=f.getRoomNameFromXY(r+1,s)):49==b.y&&(u=0,v=f.getRoomNameFromXY(r,s+1)),j.update(b,{interRoom:{room:v,x:t,y:u}})}var w=e.find(c,function(a){return\"portal\"==a.type&&a.x==b.x&&a.y==b.y});w&&j.update(b,{interRoom:w.destination}),b.tutorial||(b.ageTime||(b.ageTime=n+(e.any(b.body,{type:h.CLAIM})?h.CREEP_CLAIM_LIFE_TIME:h.CREEP_LIFE_TIME),j.update(b,{ageTime:b.ageTime})),n>=b.ageTime-1&&(h.RESOURCES_ALL.forEach(function(d){var e=b[d];e&&a(\"./_create-energy\")(b.x,b.y,b.room,e,c,j,d)}),j.remove(b._id),delete c[b._id])),e.isEqual(b.actionLog,b._actionLog)||j.update(b,{actionLog:b.actionLog})}if(b.fatigue>0){var x=f.calcBodyEffectiveness(b.body,h.MOVE,\"fatigue\",1);b.fatigue-=2*x,b.fatigue<0&&(b.fatigue=0),j.update(b._id,{fatigue:b.fatigue})}e.isNaN(b.hits)&&a(\"./_die\")(b,c,j,m),b.userSummoned&&e.any(c,function(a){return\"creep\"==a.type&&\"2\"!=a.user&&a.user!=l.user})&&a(\"./_die\")(b,c,j,m)}}},{\"../../../utils\":148,\"../movement\":114,\"../spawns/_born-creep\":130,\"./_create-energy\":74,\"./_die\":75,lodash:60}],97:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var e=a(\"lodash\"),f=a(\"../../../utils\"),g=f.getDriver(),h=g.constants;b.exports=function(a,b,c,g,i,j){if(\"creep\"==a.type&&e.contains(h.RESOURCES_ALL,b.resourceType)&&!a.spawning&&a[b.resourceType]>=b.amount&&!(b.amount<0)){var k=c[b.id];if(k&&!(Math.abs(k.x-a.x)>1||Math.abs(k.y-a.y)>1)){if(\"energy\"==b.resourceType){if(!e.contains([\"spawn\",\"creep\",\"extension\",\"link\",\"storage\",\"tower\",\"powerSpawn\",\"lab\",\"terminal\",\"container\",\"nuker\"],k.type))return}else if(\"power\"==b.resourceType){if(!e.contains([\"creep\",\"storage\",\"powerSpawn\",\"terminal\",\"container\"],k.type))return}else if(!e.contains([\"creep\",\"storage\",\"lab\",\"terminal\",\"container\",\"nuker\"],k.type))return;var l=b.amount;if(\"lab\"==k.type){if(b.resourceType!=h.RESOURCE_ENERGY&&k.mineralType&&k.mineralType!=b.resourceType)return;var m=b.resourceType==h.RESOURCE_ENERGY?\"energyCapacity\":\"mineralCapacity\",n=b.resourceType==h.RESOURCE_ENERGY?\"energy\":\"mineralAmount\";if(k[n]>=k[m])return;k[n]+l>k[m]&&(l=k[m]-k[n]),k[n]+=l,i.update(k,d({},n,k[n])),k.mineralAmount&&!k.mineralType&&i.update(k,{mineralType:b.resourceType})}else{if(\"powerSpawn\"==k.type){if(k[b.resourceType]>=k[b.resourceType+\"Capacity\"])return;k[b.resourceType]+l>k[b.resourceType+\"Capacity\"]&&(l=k[b.resourceType+\"Capacity\"]-k[b.resourceType])}else if(\"nuker\"==k.type){if(b.resourceType!=h.RESOURCE_ENERGY&&b.resourceType!=h.RESOURCE_GHODIUM)return;if(k[b.resourceType]>=k[b.resourceType+\"Capacity\"])return;k[b.resourceType]+l>k[b.resourceType+\"Capacity\"]&&(l=k[b.resourceType+\"Capacity\"]-k[b.resourceType])}else{var o=f.calcResources(k);if(o>=k.energyCapacity)return;o+l>k.energyCapacity&&(l=k.energyCapacity-o)}k[b.resourceType]=k[b.resourceType]||0,k[b.resourceType]+=l,i.update(k,d({},b.resourceType,k[b.resourceType]))}a[b.resourceType]-=l,i.update(a,d({},b.resourceType,a[b.resourceType]))}}}},{\"../../../utils\":148,lodash:60}],98:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants,h=a(\"../../../config\");b.exports=function(a,b,c,e,i,j,k,l,m){if(\"creep\"==a.type&&!(a.spawning||a.energy<=0)){var n=c[b.id];if(n&&\"controller\"==n.type&&!(Math.abs(n.x-a.x)>3||Math.abs(n.y-a.y)>3||0==n.level||n.user!=a.user||n.upgradeBlocked&&n.upgradeBlocked>m)){n._upgraded=n._upgraded||0;var o=d.filter(a.body,function(a){return(a.hits>0||a._oldHits>0)&&a.type==g.WORK}).length*g.UPGRADE_CONTROLLER_POWER||0,p=Math.min(o,a.energy),q=d.map(a.body,function(a){return a.type==g.WORK&&a.boost&&g.BOOSTS[g.WORK][a.boost].upgradeController>0?g.BOOSTS[g.WORK][a.boost].upgradeController-1:0});if(8==n.level){if(n._upgraded>=g.CONTROLLER_MAX_UPGRADE_PER_TICK)return;p=Math.min(p,g.CONTROLLER_MAX_UPGRADE_PER_TICK-n._upgraded)}q.sort(function(a,b){return b-a}),q=q.slice(0,p);var r=Math.floor(p+d.sum(q));if(n.level<8){var s=g.CONTROLLER_LEVELS[n.level];h.ptr&&(s=1e3),n.tutorial&&1==n.level&&(s=4),n.progress+r>=s?(n.progress=n.progress+r-s,n.level++,f.sendNotification(n.user,\"Your Controller in room \"+n.room+\" has been upgraded to level \"+n.level+\".\"),8==n.level&&(n.progress=0),n.safeModeAvailable=(n.safeModeAvailable||0)+1):n.progress+=r}j.inc&&j.inc(n.user,\"gcl\",r),n._upgraded+=p,l.inc(\"energyControl\",a.user,r),a.energy-=p,a.actionLog.upgradeController={x:n.x,y:n.y},i.update(a,{energy:a.energy}),i.update(n,{level:n.level,progress:n.progress,safeModeAvailable:n.safeModeAvailable})}}}},{\"../../../config\":1,\"../../../utils\":148,lodash:60}],99:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var e=a(\"lodash\"),f=a(\"../../../utils\"),g=f.getDriver(),h=g.constants;b.exports=function(a,b,c,g,i,j,k,l,m){if(e.contains(h.RESOURCES_ALL,b.resourceType)){var n=f.calcResources(a),o=a.energyCapacity-n,p=Math.min(b.amount,o);if(!(a.spawning||0>p||k&&k.user!=a.user&&k.safeMode>m)){var q=c[b.id];if(q&&!(Math.abs(q.x-a.x)>1||Math.abs(q.y-a.y)>1)){if(\"energy\"==b.resourceType){if(!e.contains([\"spawn\",\"creep\",\"extension\",\"link\",\"storage\",\"tower\",\"powerSpawn\",\"lab\",\"terminal\",\"container\"],q.type))return}else if(\"power\"==b.resourceType){if(!e.contains([\"creep\",\"storage\",\"powerSpawn\",\"terminal\",\"container\"],q.type))return}else if(!e.contains([\"creep\",\"storage\",\"lab\",\"terminal\",\"container\"],q.type))return;if(\"lab\"==q.type){if(b.resourceType!=h.RESOURCE_ENERGY&&b.resourceType!=q.mineralType)return;var r=(b.resourceType==h.RESOURCE_ENERGY?\"energyCapacity\":\"mineralCapacity\",b.resourceType==h.RESOURCE_ENERGY?\"energy\":\"mineralAmount\");p>q[r]&&(p=q[r]),q[r]-=p,i.update(q,d({},r,q[r])),!q.mineralAmount&&q.mineralType&&i.update(q,{mineralType:null})}else p>q[b.resourceType]&&(p=q[b.resourceType]),q[b.resourceType]-=p,i.update(q,d({},b.resourceType,q[b.resourceType]));a[b.resourceType]=a[b.resourceType]||0,a[b.resourceType]+=p,i.update(a,d({},b.resourceType,a[b.resourceType]))}}}}},{\"../../../utils\":148,lodash:60}],100:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var e=a(\"lodash\"),f=a(\"../../../utils\"),g=f.getDriver(),h=g.constants;b.exports=function(a,b,c,f){if(a&&\"energy\"==a.type){var g=a.resourceType||\"energy\";a[g]-=Math.ceil(a[g]/h.ENERGY_DECAY),a[g]<=0||!a[g]?(e.isNaN(a[g]),f.remove(a._id),delete b[a._id]):f.update(a,d({},g,a[g]))}}},{\"../../../utils\":148,lodash:60}],101:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a,b,c,d,e,g,h){if(a&&\"extension\"==a.type&&g){var i=f.EXTENSION_ENERGY_CAPACITY[g.level]||0;i!=a.energyCapacity&&d.update(a,{energyCapacity:i})}}},{\"../../../utils\":148,lodash:60}],102:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var e=a(\"lodash\"),f=a(\"../../../utils\"),g=f.getDriver(),h=g.constants;b.exports=function(a,b,c,g,i){if(e.contains(h.RESOURCES_ALL,b.resourceType)){var j=c[b.id];if(!(!j||\"creep\"!=j.type||f.calcResources(j)>=j.energyCapacity||b.amount<0||Math.abs(j.x-a.x)>1||Math.abs(j.y-a.y)>1)){var k=b.amount;f.calcResources(j)+k>j.energyCapacity&&(k=j.energyCapacity-f.calcResources(j)),a[b.resourceType]>=k&&(j[b.resourceType]=j[b.resourceType]||0,j[b.resourceType]+=k,a[b.resourceType]-=k,i.update(a,d({},b.resourceType,a[b.resourceType])),i.update(j,d({},b.resourceType,j[b.resourceType])))}}}},{\"../../../utils\":148,lodash:60}],103:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver();e.constants,a(\"../movement\");b.exports=function(a,b,c,d,e,f,g){a.cooldown>0&&(a.cooldown--,a.cooldown<0&&(a.cooldown=0),d.update(a,{cooldown:a.cooldown})),a._cooldown&&d.update(a,{cooldown:a._cooldown})}},{\"../../../utils\":148,\"../movement\":114,lodash:60}],104:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,e,f,h,i){if(a&&\"keeperLair\"==a.type){if(!a.nextSpawnTime){var j=d.find(b,function(b){return\"creep\"==b.type&&\"3\"==b.user&&b.name==\"Keeper\"+a._id});(!j||j.hits<5e3)&&e.update(a,{nextSpawnTime:i+g.ENERGY_REGEN_TIME})}if(a.nextSpawnTime&&i>=a.nextSpawnTime-1){var j=d.find(b,function(b){return\"creep\"==b.type&&\"3\"==b.user&&b.name==\"Keeper\"+a._id});j&&e.remove(j._id);for(var k=[],l=0;17>l;l++)k.push({type:g.TOUGH,hits:100});for(var l=0;13>l;l++)k.push({type:g.MOVE,hits:100});for(var l=0;10>l;l++)k.push({type:g.ATTACK,hits:100}),k.push({type:g.RANGED_ATTACK,hits:100});e.insert({name:\"Keeper\"+a._id,x:a.x,y:a.y,body:k,energy:0,energyCapacity:0,type:\"creep\",room:a.room,user:\"3\",hits:5e3,hitsMax:5e3,spawning:!1,fatigue:0}),e.update(a,{nextSpawnTime:null})}}}},{\"../../../utils\":148,lodash:60}],105:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,e,f,h){if(!(b.mineralAmount<g.LAB_BOOST_MINERAL||b.energy<g.LAB_BOOST_ENERGY)){var i=e[c.id];if(i&&\"creep\"==i.type&&!(Math.abs(i.x-b.x)>1||Math.abs(i.y-b.y)>1)){var j=d.filter(i.body,function(a){return!a.boost&&g.BOOSTS[a.type][b.mineralType]});if(j.length){for(j[0].type!=g.TOUGH&&j.reverse(),c.bodyPartsCount&&j.slice(0,c.bodyPartsCount);b.mineralAmount>=g.LAB_BOOST_MINERAL&&b.energy>=g.LAB_BOOST_ENERGY&&j.length;)j[0].boost=b.mineralType,b.mineralAmount-=g.LAB_BOOST_MINERAL,b.energy-=g.LAB_BOOST_ENERGY,j.splice(0,1);h.update(b,{mineralAmount:b.mineralAmount,energy:b.energy}),b.mineralAmount||h.update(b,{mineralType:null}),a(\"../creeps/_recalc-body\")(i),h.update(i,{body:i.body,energyCapacity:i.energyCapacity}),i.actionLog.healed={x:b.x,y:b.y}}}}}},{\"../../../utils\":148,\"../creeps/_recalc-body\":76,lodash:60}],106:[function(a,b,c){\"use strict\";b.exports=function(b,c,d,e,f,g,h,i){c.transfer&&a(\"./transfer\")(b,c.transfer,d,e,f,g,h,i),c.runReaction&&a(\"./run-reaction\")(b,c.runReaction,d,e,f,g,h,i),c.boostCreep&&a(\"./boost-creep\")(b,c.boostCreep,d,e,f,g,h,i)}},{\"./boost-creep\":105,\"./run-reaction\":107,\"./transfer\":109}],107:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a,b,c,d,e){if(!(a.cooldown>0)){var g=c[b.lab1];if(g&&\"lab\"==g.type&&!(g.mineralAmount<f.LAB_REACTION_AMOUNT)&&!(Math.abs(g.x-a.x)>2||Math.abs(g.y-a.y)>2)){var h=c[b.lab2];!h||\"lab\"!=h.type||h.mineralAmount<f.LAB_REACTION_AMOUNT||Math.abs(h.x-a.x)>2||Math.abs(h.y-a.y)>2||a.mineralAmount>a.mineralCapacity-f.LAB_REACTION_AMOUNT||!f.REACTIONS[g.mineralType][h.mineralType]||a.mineralType&&a.mineralType!=f.REACTIONS[g.mineralType][h.mineralType]||(e.update(a,{mineralAmount:a.mineralAmount+f.LAB_REACTION_AMOUNT,cooldown:f.LAB_COOLDOWN}),a.mineralType||e.update(a,{mineralType:f.REACTIONS[g.mineralType][h.mineralType]}),e.update(g,{mineralAmount:g.mineralAmount-f.LAB_REACTION_AMOUNT}),g.mineralAmount||e.update(g,{mineralType:null}),e.update(h,{mineralAmount:h.mineralAmount-f.LAB_REACTION_AMOUNT}),h.mineralAmount||e.update(h,{mineralType:null}),a.actionLog.runReaction={x1:g.x,y1:g.y,x2:h.x,y2:h.y})}}}},{\"../../../utils\":148,lodash:60}],108:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver();f.constants,a(\"../movement\");b.exports=function(a,b,c,e,f,g,h){a.cooldown>0?(a.cooldown--,a.cooldown<0&&(a.cooldown=0),e.update(a,{cooldown:a.cooldown,actionLog:a.actionLog})):d.isEqual(a._actionLog,a.actionLog)||e.update(a,{actionLog:a.actionLog})}},{\"../../../utils\":148,\"../movement\":114,lodash:60}],109:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var e=a(\"lodash\"),f=a(\"../../../utils\"),g=f.getDriver(),h=g.constants;b.exports=function(a,b,c,g,i){if(e.contains(h.RESOURCES_ALL,b.resourceType)){var j=c[b.id];if(!(!j||\"creep\"!=j.type||f.calcResources(j)>=j.energyCapacity||b.amount<0||Math.abs(j.x-a.x)>1||Math.abs(j.y-a.y)>1)){var k=b.amount,l=b.resourceType==h.RESOURCE_ENERGY?\"energy\":\"mineralAmount\";f.calcResources(j)+k>j.energyCapacity&&(k=j.energyCapacity-f.calcResources(j)),a[l]<k||(j[b.resourceType]=j[b.resourceType]||0,j[b.resourceType]+=k,a[l]-=k,!a.mineralAmount&&a.mineralType&&i.update(a,{mineralType:null}),i.update(a,d({},l,a[l])),i.update(j,d({},b.resourceType,j[b.resourceType])))}}}},{\"../../../utils\":148,lodash:60}],110:[function(a,b,c){\"use strict\";b.exports=function(b,c,d,e,f,g,h,i){c.transfer&&a(\"./transfer\")(b,c.transfer,d,e,f,g,h,i)}},{\"./transfer\":112}],111:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver();f.constants,a(\"../movement\");b.exports=function(a,b,c,e,f,g,h){a&&\"link\"==a.type&&(a.cooldown>0?(a.cooldown--,a.cooldown<0&&(a.cooldown=0),e.update(a,{cooldown:a.cooldown,actionLog:a.actionLog})):d.isEqual(a._actionLog,a.actionLog)||e.update(a,{actionLog:a.actionLog}))}},{\"../../../utils\":148,\"../movement\":114,lodash:60}],112:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,f,h,i,j){if(\"link\"==a.type&&!(a.energy<b.amount||b.amount<0)){var k=c[b.id];if(k&&d.contains([\"link\",\"creep\"],k.type)){var l;if(\"creep\"==k.type){if(Math.abs(k.x-a.x)>1||Math.abs(k.y-a.y)>1)return;l=e.calcResources(k)}if(\"link\"==k.type){if(a.cooldown>0)return;if(!e.checkStructureAgainstController(a,c,j))return;l=k.energy}if(l!=k.energyCapacity){var m=b.amount;l+m>k.energyCapacity&&(m=k.energyCapacity-l),k.energy+=m,a.energy-=m,\"link\"==k.type&&(k.energy-=Math.ceil(m*g.LINK_LOSS_RATIO),a.cooldown+=g.LINK_COOLDOWN*Math.max(Math.abs(k.x-a.x),Math.abs(k.y-a.y)),a.actionLog.transferEnergy={x:k.x,y:k.y}),h.update(a,{energy:a.energy,cooldown:a.cooldown,actionLog:a.actionLog}),h.update(k,{energy:k.energy})}}}}},{\"../../../utils\":148,lodash:60}],113:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a,b,c,d,e,g,h){if(!a.mineralAmount&&(a.nextRegenerationTime||(a.nextRegenerationTime=h+f.MINERAL_REGEN_TIME,d.update(a,{nextRegenerationTime:a.nextRegenerationTime})),h>=a.nextRegenerationTime-1)){var i={nextRegenerationTime:null,mineralAmount:f.MINERAL_DENSITY[a.density]};if(a.density==f.DENSITY_LOW||a.density==f.DENSITY_ULTRA||Math.random()<f.MINERAL_DENSITY_CHANGE){var j,k=a.density;do{var l=Math.random();for(var m in f.MINERAL_DENSITY_PROBABILITY)if(l<=f.MINERAL_DENSITY_PROBABILITY[m]){j=+m;break}}while(j==k);i.density=a.density=j}d.update(a,i)}}},{\"../../../utils\":148,lodash:60}],114:[function(a,b,c){\"use strict\";function d(a,b,c,d){return l.any(i,function(e){return e.x==a&&e.y==b&&(\"creep\"==e.type&&!g[e._id]&&(!d||d!=c.user||d==c.user&&c.user==e.user)||\"creep\"!=e.type&&l.contains(o.OBSTACLE_OBJECT_TYPES,e.type)||\"rampart\"==e.type&&!e.isPublic&&e.user!=c.user||\"constructionSite\"==e.type&&e.user==c.user&&l.contains(o.OBSTACLE_OBJECT_TYPES,e.structureType))})||m.checkTerrain(j,a,b,o.TERRAIN_MASK_WALL)}function e(a){var b=0,c=0;o.RESOURCES_ALL.forEach(function(c){b+=a[c]||0});for(var d=a.body.length-1;d>=0&&b;d--){var e=a.body[d];if(e.type==o.CARRY&&e.hits){var f=1;e.boost&&(f=o.BOOSTS[o.CARRY][e.boost].capacity||1),b-=Math.min(b,o.CARRY_CAPACITY*f),c++}}return c}var f,g,h,i,j,k=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h[\"return\"]&&h[\"return\"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),l=a(\"lodash\"),m=a(\"../../utils\"),n=m.getDriver(),o=n.constants;c.init=function(a,b){f={},g={},h={},i=a,j=b},c.add=function(a,b,c){var d=a.x+b,e=a.y+c;d>=50&&(d=49),e>=50&&(e=49),0>d&&(d=0),0>e&&(e=0);var g=d+\",\"+e;f[g]=f[g]||[],f[g].push(a),h[g]=h[g]+1||1},c.isTileBusy=function(a,b){return!!f[a+\",\"+b]},c.check=function(a){function b(a){var c=f[a];if(g[f[a]._id]=null,delete f[a],c){var d=c.x+\",\"+c.y;f[d]&&b(d)}}var c={};for(var i in f){var j,m=i.split(/,/),n=k(m,2),p=n[0],q=n[1];if(p=parseInt(p),q=parseInt(q),f[i].length>1){var r=l.map(f[i],function(a){var b=l.filter(a.body,function(a){return a.hits>0&&a.type==o.MOVE}).length,c=l.filter(a.body,function(a){return a.type!=o.MOVE&&a.type!=o.CARRY}).length;c+=e(a),c=c||1;var d=a.x+\",\"+a.y,g=h[d]||0;return f[d]&&l.any(f[d],{x:p,y:q})&&(g=100),{object:a,rate1:g,rate2:b/c}});r.sort(function(a,b){return b.rate1-a.rate1!=0?b.rate1-a.rate1:b.rate2-a.rate2}),j=r[0].object}else j=f[i][0];g[j._id]={x:p,y:q},c[i]=j}f=c;for(var i in f){var s=i.split(/,/),t=k(s,2),p=t[0],q=t[1];p=parseInt(p),q=parseInt(q);var u=f[i],v=(p-u.x,q-u.y,d(p,q,u,a));v&&b(i)}},c.execute=function(b,c,d,f){var h=g[b._id];if(h){var k=l.filter(i,function(a){return a.x==h.x&&a.y==h.y}),n=2;(l.any(k,{type:\"swamp\"})||m.checkTerrain(j,h.x,h.y,o.TERRAIN_MASK_SWAMP))&&(n=10);var p=l.find(k,{type:\"road\"});if(p&&(n=1,p.nextDecayTime-=o.ROAD_WEAROUT*b.body.length,c.update(p,{nextDecayTime:p.nextDecayTime})),!(d&&d.safeMode>f)){var q=l.find(k,function(a){return\"constructionSite\"==a.type&&a.user!=b.user});q&&a(\"./construction-sites/remove\")(q,i,c)}var r=l(b.body).filter(function(a){return a.type!=o.MOVE&&a.type!=o.CARRY}).size();r+=e(b),r*=n,0!=h.x&&49!=h.x&&0!=h.y&&49!=h.y||0==b.x||49==b.x||0==b.y||49==b.y||(r=0),c.update(b,{x:h.x,y:h.y,fatigue:r})}}},{\"../../utils\":148,\"./construction-sites/remove\":67,lodash:60}],115:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../config\")),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,f,h,i,j,k,l,m){e.checkStructureAgainstController(a,c,j)&&(a.G<a.GCapacity||a.energy<a.energyCapacity||a.cooldownTime>l||b.x<0||b.y<0||b.x>49||b.y>49||m.novice&&m.novice>Date.now()||(h.update(a,{energy:0,G:0,cooldownTime:l+(d.ptr?100:g.NUKER_COOLDOWN)}),h.insert({type:\"nuke\",room:b.roomName,x:b.x,y:b.y,landTime:l+(d.ptr?100:g.NUKE_LAND_TIME),launchRoomName:a.room})))}},{\"../../../config\":1,\"../../../utils\":148,lodash:60}],116:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,e,f,h,i,j,k,l){if(l.novice&&l.novice>Date.now())return f.remove(b._id),void delete c[b._id];if(k==b.landTime-1){d.forEach(c,function(b){b&&(\"creep\"==b.type&&a(\"../creeps/_die\")(b,c,f,j,0),(\"constructionSite\"==b.type||\"energy\"==b.type)&&(f.remove(b._id),delete c[b._id]))});for(var m=-2;2>=m;m++)for(var n=function(h){var n=b.x+m,o=b.y+h,p=Math.max(Math.abs(m),Math.abs(h)),q=0==p?g.NUKE_DAMAGE[0]:g.NUKE_DAMAGE[2],r=d.filter(c,{x:n,y:o}),s=d.find(r,{type:\"rampart\"});if(s){var t=s.hits;d.pull(r,s),a(\"../_damage\")(b,s,q,\"ranged\",c,e,f,i,j,k,l),q-=t}q>0&&r.forEach(function(d){a(\"../_damage\")(b,d,q,\"ranged\",c,e,f,i,j,k,l)})},o=-2;2>=o;o++)n(o);i&&(i.safeMode>k&&f.update(i,{safeMode:k}),i.user&&f.update(i,{upgradeBlocked:k+g.CONTROLLER_NUKE_BLOCKED_UPGRADE}))}k>=b.landTime&&(f.remove(b._id),delete c[b._id])}},{\"../../../utils\":148,\"../_damage\":65,\"../creeps/_die\":75,lodash:60}],117:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,e,f,h,i){if(a.unstableDate&&Date.now()>a.unstableDate&&e.update(a,{decayTime:i+g.PORTAL_DECAY,unstableDate:null}),a.decayTime&&i>a.decayTime){e.remove(a._id),delete b[a._id];var j=d.find(b,function(b){return\"constructedWall\"==b.type&&b.x==a.x+1&&b.y==a.y+1});j&&(e.remove(j._id),delete b[j._id])}}},{\"../../../utils\":148,lodash:60}],118:[function(a,b,c){\"use strict\";b.exports=function(b,c,d,e,f,g,h,i,j){c.processPower&&a(\"./process-power\")(b,c.createCreep,d,e,f,g,h,i)}},{\"./process-power\":119}],119:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a,b,c,e,g,h,i,j){\"powerSpawn\"==a.type&&d.checkStructureAgainstController(a,c,i)&&(!a.power||a.energy<f.POWER_SPAWN_ENERGY_RATIO||(a.power--,a.energy-=f.POWER_SPAWN_ENERGY_RATIO,j.inc(\"powerProcessed\",a.user,1),g.update(a,{energy:a.energy,power:a.power}),h.inc&&h.inc(a.user,\"power\",1)))}},{\"../../../utils\":148,lodash:60}],120:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver();e.constants;b.exports=function(a,b,c,d,e){e.update(a,{isPublic:!!b.isPublic})}},{\"../../../utils\":148,lodash:60}],121:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a,b,c,d,e,g,h){if(a&&\"rampart\"==a.type){if(g){var i=f.RAMPART_HITS_MAX[g.level]||0;\n";
 d += "i!=a.hitsMax&&d.update(a,{hitsMax:i})}(!a.nextDecayTime||h>=a.nextDecayTime-1)&&(a.hits=a.hits||0,a.hits-=f.RAMPART_DECAY_AMOUNT,a.hits<=0?(d.remove(a._id),delete b[a._id]):(a.nextDecayTime=h+f.RAMPART_DECAY_TIME,d.update(a,{hits:a.hits,nextDecayTime:a.nextDecayTime})))}}},{\"../../../utils\":148,lodash:60}],122:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,f,h,i,j){if(a&&\"road\"==a.type&&(!a.nextDecayTime||j>=a.nextDecayTime-1)){var k=g.ROAD_DECAY_AMOUNT;(d.any(b,function(b){return b.x==a.x&&b.y==a.y&&\"swamp\"==b.type})||e.checkTerrain(c,a.x,a.y,g.TERRAIN_MASK_SWAMP))&&(k*=g.CONSTRUCTION_COST_ROAD_SWAMP_RATIO),a.hits-=k,a.hits<=0?(f.remove(a._id),delete b[a._id]):(a.nextDecayTime=j+g.ROAD_DECAY_TIME,f.update(a,{hits:a.hits,nextDecayTime:a.nextDecayTime}))}}},{\"../../../utils\":148,lodash:60}],123:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants,h=a(\"../../../config\"),i=0;b.exports=function(a,b,c,f,j,k){if(!(a.x<=0||a.x>=49||a.y<=0||a.y>=49)&&g.CONSTRUCTION_COST[a.structureType]){if(/^(W|E)/.test(a.roomName)){if(k&&(k.user&&k.user!=a.user||k.reservation&&k.reservation.user!=a.user))return;if(!e.checkControllerAvailability(a.structureType,b,k))return}if(e.checkConstructionSite(b,a.structureType,a.x,a.y)&&e.checkConstructionSite(c,a.structureType,a.x,a.y)){var l=g.CONSTRUCTION_COST[a.structureType];\"road\"==a.structureType&&(d.any(b,{x:a.x,y:a.y,type:\"swamp\"})||e.checkTerrain(c,a.x,a.y,g.TERRAIN_MASK_SWAMP))&&(l*=g.CONSTRUCTION_COST_ROAD_SWAMP_RATIO),h.ptr&&(l=1),\"sim\"==a.roomName&&\"tower\"==a.structureType&&(l=100);var m={structureType:a.structureType,x:a.x,y:a.y,type:\"constructionSite\",room:a.roomName,user:a.user,progress:0,progressTotal:l};\"spawn\"==a.structureType&&(m.name=a.name),f.insert(m),b[\"_createdConstructionSite\"+i]=m,i++}}}},{\"../../../config\":1,\"../../../utils\":148,lodash:60}],124:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b){var c=a.name.replace(/\\|/g,\"$VLINE$\").replace(/~/g,\"$TILDE$\");if(!d.any(b,function(b){return b.user==a.user&&d.any(b._parsed,function(a){return a[0]==c})})&&a.color&&d.contains(g.COLORS_ALL,a.color)&&a.secondaryColor&&d.contains(g.COLORS_ALL,a.secondaryColor)&&!(a.x<0||a.x>49||a.y<0||a.y>49)){var e=d.find(b,{user:a.user});e||(e={user:a.user,room:a.roomName,_parsed:[]},b.push(e)),e._modified=!0,e._parsed.push([c,a.color,a.secondaryColor,a.x,a.y])}}},{\"../../../utils\":148,lodash:60}],125:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,e,f,h,i){var j=c[b.id];if(j&&g.CONSTRUCTION_COST[j.type]&&i&&i.user==b.user&&(j.type!=g.STRUCTURE_WALL||!j.decayTime||j.user)&&!d.any(c,function(a){return\"creep\"==a.type&&a.user!=b.user})){if(f.remove(j._id),\"spawn\"==j.type&&j.spawning){var k=d.find(c,{user:j.user,name:j.spawning.name});k&&f.remove(k._id)}g.RESOURCES_ALL.forEach(function(b){j[b]>0&&a(\"../creeps/_create-energy\")(j.x,j.y,j.room,j[b],c,f,b)}),\"constructedWall\"==j.type&&j.decayTime&&j.user&&a(\"../creeps/_clear-newbie-walls\")(c,f)}}},{\"../../../utils\":148,\"../creeps/_clear-newbie-walls\":73,\"../creeps/_create-energy\":74,lodash:60}],126:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,f){if(\"3\"==a.user){var h,i;do h=Math.floor(48*Math.random())+1,i=Math.floor(48*Math.random())+1;while(d.any(b,function(a){return d.contains(g.OBSTACLE_OBJECT_TYPES,a.type)&&a.x==h&&a.y==i})||e.checkTerrain(c,h,i,g.TERRAIN_MASK_WALL));f.insert({x:h,y:i,type:\"energy\",energy:300,room:a.roomName})}}},{\"../../../utils\":148,lodash:60}],127:[function(a,b,c){\"use strict\";var d=a(\"lodash\");b.exports=function(b,c,e,f,g,h,i,j){i.forEach(function(a){a._parsed=a.data.split(\"|\"),a._parsed=d.map(a._parsed,function(a){return a.split(\"~\")})}),b.removeFlag&&d.forEach(b.removeFlag,function(b){a(\"./remove-flag\")(b,i)}),b.createFlag&&d.forEach(b.createFlag,function(b){a(\"./create-flag\")(b,i)}),b.createConstructionSite&&d.forEach(b.createConstructionSite,function(b){a(\"./create-construction-site\")(b,c,e,f,g,h)}),b.destroyStructure&&d.forEach(b.destroyStructure,function(b){a(\"./destroy-structure\")(b,c,e,f,g,h)}),b.genEnergy&&a(\"./gen-energy\")(b.genEnergy,c,e,f,g,h),i.forEach(function(a){if(a._modified){var b=d.map(a._parsed,function(a){return a.join(\"~\")}).join(\"|\");a._id?j.update(a._id,{data:b}):j.insert({data:b,user:a.user,room:a.room})}})}},{\"./create-construction-site\":123,\"./create-flag\":124,\"./destroy-structure\":125,\"./gen-energy\":126,\"./remove-flag\":128,lodash:60}],128:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver();f.constants;b.exports=function(a,b){var c=d.find(b,{user:a.user});if(c){var e=a.name.replace(/\\|/g,\"$VLINE$\").replace(/~/g,\"$TILDE$\");d.any(c._parsed,function(a){return a[0]==e})&&(c._modified=!0,d.remove(c._parsed,function(a){return a[0]==e}))}}},{\"../../../utils\":148,lodash:60}],129:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a,b,c,d,e,g,h){a&&\"source\"==a.type&&(a.energy<a.energyCapacity&&(a.nextRegenerationTime||(a.nextRegenerationTime=h+f.ENERGY_REGEN_TIME,d.update(a,{nextRegenerationTime:a.nextRegenerationTime})),h>=a.nextRegenerationTime-1&&d.update(a,{nextRegenerationTime:null,energy:a.energyCapacity})),g?(g.user||g.reservation||a.energyCapacity==f.SOURCE_ENERGY_NEUTRAL_CAPACITY||d.update(a,{energyCapacity:f.SOURCE_ENERGY_NEUTRAL_CAPACITY,energy:Math.min(a.energy,f.SOURCE_ENERGY_NEUTRAL_CAPACITY)}),(g.user||g.reservation)&&a.energyCapacity!=f.SOURCE_ENERGY_CAPACITY&&d.update(a,{energyCapacity:f.SOURCE_ENERGY_CAPACITY})):a.energyCapacity!=f.SOURCE_ENERGY_KEEPER_CAPACITY&&d.update(a,{energyCapacity:f.SOURCE_ENERGY_KEEPER_CAPACITY}))}},{\"../../../utils\":148,lodash:60}],130:[function(a,b,c){\"use strict\";var d=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h[\"return\"]&&h[\"return\"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),e=a(\"lodash\"),f=a(\"../../../utils\"),g=f.getDriver(),h=g.constants,i=a(\"../movement\");b.exports=function(b,c,g,j,k,l){for(var m,n,o,p,q=function(a){return e.contains(h.OBSTACLE_OBJECT_TYPES,a.type)&&a.x==m&&a.y==n},r=1;8>=r;r++){var s=f.getOffsetsByDirection(r),t=d(s,2),u=t[0],v=t[1];if(m=b.x+u,n=b.y+v,o=e.any(g,q)||f.checkTerrain(j,m,n,h.TERRAIN_MASK_WALL)||i.isTileBusy(m,n),!o)break;p||(p=e.find(g,function(a){return a.x==m&&a.y==n&&\"creep\"==a.type&&a.user!=b.user}))}return o?p?(a(\"../creeps/_die\")(p,g,k,l),k.update(c,{x:p.x,y:p.y,spawning:!1}),!0):!1:(k.update(c,{x:m,y:n,spawning:!1}),!0)}},{\"../../../utils\":148,\"../creeps/_die\":75,\"../movement\":114,lodash:60}],131:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver();f.constants;b.exports=function(a,b,c,f,g){var h=d.filter(b,function(b){return\"spawn\"==b.type&&b.user==a.user&&!b.off}),i=d.filter(b,function(b){return\"extension\"==b.type&&b.user==a.user&&!b.off}),j=d.sum(i,\"energy\")+d.sum(h,\"energy\");return c>j?!1:(i.sort(e.comparatorDistance(a)),h.forEach(function(a){var b=Math.min(c,a.energy);a.energy-=b,c-=b,f.update(a,{energy:a.energy})}),i.forEach(function(a){if(!(0>=c)){var b=Math.min(c,a.energy);a.energy-=b,c-=b,f.update(a,{energy:a.energy})}}),!0)}},{\"../../../utils\":148,lodash:60}],132:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,f,h,i,j,k,l){if(!b.spawning&&\"spawn\"==b.type&&e.checkStructureAgainstController(b,f,k)){c.body=c.body.slice(0,g.MAX_CREEP_SIZE);var m=e.calcCreepCost(c.body),n=a(\"./_charge-energy\")(b,f,m,i,k);if(n){l.inc(\"energyCreeps\",b.user,m),l.inc(\"creepsProduced\",b.user,c.body.length),i.update(b,{spawning:{name:c.name,needTime:g.CREEP_SPAWN_TIME*c.body.length,remainingTime:g.CREEP_SPAWN_TIME*c.body.length}});var o=[],p=0;c.body.forEach(function(a){d.contains(g.BODYPARTS_ALL,a)&&o.push({type:a,hits:100}),a==g.CARRY&&(p+=g.CARRY_CAPACITY)});var q={name:c.name,x:b.x,y:b.y,body:o,energy:0,energyCapacity:p,type:\"creep\",room:b.room,user:b.user,hits:100*o.length,hitsMax:100*o.length,spawning:!0,fatigue:0,notifyWhenAttacked:!0};b.tutorial&&(q.tutorial=!0),i.insert(q)}}}},{\"../../../utils\":148,\"./_charge-energy\":131,lodash:60}],133:[function(a,b,c){\"use strict\";b.exports=function(b,c,d,e,f,g,h,i,j){c.createCreep&&a(\"./create-creep\")(b,c.createCreep,d,e,f,g,h,i),c.transferEnergy&&a(\"./transfer-energy\")(b,c.transferEnergy,d,e,f,g,h),c.renewCreep&&a(\"./renew-creep\")(b,c.renewCreep,d,e,f,g,h,i,j),c.recycleCreep&&a(\"./recycle-creep\")(b,c.recycleCreep,d,e,f,g,h,i,j)}},{\"./create-creep\":132,\"./recycle-creep\":134,\"./renew-creep\":135,\"./transfer-energy\":137}],134:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver();e.constants;b.exports=function(b,c,d,e,f,g,h,i,j){if(\"spawn\"==b.type){var k=d[c.id];k&&\"creep\"==k.type&&k.user==b.user&&(Math.abs(k.x-b.x)>1||Math.abs(k.y-b.y)>1||a(\"../creeps/_die\")(k,d,f,void 0,1))}}},{\"../../../utils\":148,\"../creeps/_die\":75,lodash:60}],135:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,f,h,i,j,k,l,m){if(\"spawn\"==b.type&&!b.spawning){var n=f[c.id];if(n&&\"creep\"==n.type&&n.user==b.user&&!(Math.abs(n.x-b.x)>1||Math.abs(n.y-b.y)>1||d.filter(n.body,function(a){return a.type==g.CLAIM}).length>0)){var o=Math.floor(g.SPAWN_RENEW_RATIO*g.CREEP_LIFE_TIME/g.CREEP_SPAWN_TIME/n.body.length);if(!(n.ageTime+o>m+g.CREEP_LIFE_TIME)){var p=Math.ceil(g.SPAWN_RENEW_RATIO*e.calcCreepCost(n.body)/g.CREEP_SPAWN_TIME/n.body.length),q=a(\"./_charge-energy\")(b,f,p,i,k);q&&(l.inc(\"energyCreeps\",b.user,p),n.ageTime+=o,n.actionLog.healed={x:b.x,y:b.y},i.update(n,{ageTime:n.ageTime}),d.any(n.body,function(a){return!!a.boost})&&(n.body.forEach(function(a){a.boost=null}),a(\"../creeps/_recalc-body\")(n),i.update(n,{body:n.body,energyCapacity:n.energyCapacity})))}}}}},{\"../../../utils\":148,\"../creeps/_recalc-body\":76,\"./_charge-energy\":131,lodash:60}],136:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,f,h,i,j,k,l){if(b&&\"spawn\"==b.type){if(b.spawning)if(b.spawning.remainingTime--,b.spawning.remainingTime<=0){var m=d.find(c,{type:\"creep\",name:b.spawning.name,x:b.x,y:b.y}),n=a(\"./_born-creep\")(b,m,c,f,h,k);n?h.update(b,{spawning:null}):h.update(b,{spawning:{remainingTime:0}})}else h.update(b,{spawning:{remainingTime:b.spawning.remainingTime}});if(j&&!(j.level<1)&&j.user==b.user){var o=d.filter(c,{type:\"spawn\"});o.length>g.CONTROLLER_STRUCTURES.spawn[j.level]&&(o.sort(e.comparatorDistance(j)),o=d.take(o,g.CONTROLLER_STRUCTURES.spawn[j.level]),!d.contains(o,b))||!b.tutorial&&l<g.SPAWN_ENERGY_CAPACITY&&b.energy<g.SPAWN_ENERGY_CAPACITY&&(b.energy++,h.update(b,{energy:b.energy}))}}}},{\"../../../utils\":148,\"./_born-creep\":130,lodash:60}],137:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver();e.constants;b.exports=function(a,b,c,d,e){if(\"spawn\"==a.type){var f=c[b.id];if(!(!f||\"creep\"!=f.type||f.energy>=f.energyCapacity||b.amount<0||Math.abs(f.x-a.x)>1||Math.abs(f.y-a.y)>1)){var g=b.amount;f.energy+g>f.energyCapacity&&(g=f.energyCapacity-f.energy),a.energy<g||(f.energy+=g,a.energy-=g,e.update(a,{energy:a.energy}),e.update(f,{energy:f.energy}))}}}},{\"../../../utils\":148,lodash:60}],138:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(a,b,c,f,h){if(/^(W|E)\\d+(N|S)\\d+$/.test(b.targetRoomName)&&d.contains(g.RESOURCES_ALL,b.resourceType)&&b.amount&&a[b.resourceType]>=b.amount){var i=e.calcRoomsDistance(a.room,b.targetRoomName,!0),j=Math.ceil(b.amount*(Math.log(.1*(i+9))+.1));b.resourceType!=g.RESOURCE_ENERGY&&a.energy<j||b.resourceType==g.RESOURCE_ENERGY&&a.energy<b.amount+j||h.update(a,{send:b})}}},{\"../../../utils\":148,lodash:60}],139:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a,b,c,d,e,g,h){if(g){var i=f.CONTROLLER_STRUCTURES.terminal[g.level]?f.TERMINAL_CAPACITY:0;i!=a.energyCapacity&&d.update(a,{energyCapacity:i})}}},{\"../../../utils\":148,lodash:60}],140:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver(),g=f.constants;b.exports=function(b,c,f,h,i,j,k,l,m,n){if(\"tower\"==b.type&&!b.spawning){var o=f[c.id];if(o&&o!=b&&(\"creep\"!=o.type||!o.spawning)&&o.hits&&!(b.energy<g.TOWER_ENERGY_COST)){var p=d.find(f,{type:\"rampart\",x:o.x,y:o.y});p&&(o=p);var q=Math.max(Math.abs(o.x-b.x),Math.abs(o.y-b.y)),r=g.TOWER_POWER_ATTACK;q>g.TOWER_OPTIMAL_RANGE&&(q>g.TOWER_FALLOFF_RANGE&&(q=g.TOWER_FALLOFF_RANGE),r-=r*g.TOWER_FALLOFF*(q-g.TOWER_OPTIMAL_RANGE)/(g.TOWER_FALLOFF_RANGE-g.TOWER_OPTIMAL_RANGE)),r=Math.floor(r),r&&(a(\"../_damage\")(b,o,r,\"ranged\",f,h,i,k,l,m,n),b.energy-=g.TOWER_ENERGY_COST,i.update(b,{energy:b.energy}),b.actionLog.attack={x:o.x,y:o.y},o.actionLog&&(o.actionLog.attacked={x:b.x,y:b.y}),o.notifyWhenAttacked&&e.sendAttackingNotification(o,k))}}}},{\"../../../utils\":148,\"../_damage\":65,lodash:60}],141:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(b,c,d,e,g,h,i,j){if(\"tower\"==b.type&&!b.spawning){var k=d[c.id];if(k&&\"creep\"==k.type&&!k.spawning&&!(k.hits>=k.hitsMax||b.energy<f.TOWER_ENERGY_COST)){var l=Math.max(Math.abs(k.x-b.x),Math.abs(k.y-b.y)),m=f.TOWER_POWER_HEAL;l>f.TOWER_OPTIMAL_RANGE&&(l>f.TOWER_FALLOFF_RANGE&&(l=f.TOWER_FALLOFF_RANGE),m-=m*f.TOWER_FALLOFF*(l-f.TOWER_OPTIMAL_RANGE)/(f.TOWER_FALLOFF_RANGE-f.TOWER_OPTIMAL_RANGE)),m=Math.floor(m),m&&(k.hits+=m,k.hits>k.hitsMax&&(k.hits=k.hitsMax),a(\"../creeps/_recalc-body\")(k),g.update(k,{hits:k.hits,body:k.body,energyCapacity:k.energyCapacity}),b.energy-=f.TOWER_ENERGY_COST,g.update(b,{energy:b.energy}),b.actionLog.heal={x:k.x,y:k.y},k.actionLog.healed={x:b.x,y:b.y})}}}},{\"../../../utils\":148,\"../creeps/_recalc-body\":76,lodash:60}],142:[function(a,b,c){\"use strict\";b.exports=function(b,c,d,e,f,g,h,i,j,k){c.transfer&&a(\"./transfer\")(b,c.transfer,d,e,f,g,h,i),c.heal?a(\"./heal\")(b,c.heal,d,e,f,g,h,i):c.repair?a(\"./repair\")(b,c.repair,d,e,f,g,h,i):c.attack&&a(\"./attack\")(b,c.attack,d,e,f,g,h,i,j,k)}},{\"./attack\":140,\"./heal\":141,\"./repair\":143,\"./transfer\":145}],143:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver(),f=e.constants;b.exports=function(a,b,c,d,e,g,h,i){if(\"tower\"==a.type&&!a.spawning){var j=c[b.id];if(j&&f.CONSTRUCTION_COST[j.type]&&!(j.hits>=j.hitsMax)&&!(a.energy<f.TOWER_ENERGY_COST)){var k=Math.max(Math.abs(j.x-a.x),Math.abs(j.y-a.y)),l=f.TOWER_POWER_REPAIR;k>f.TOWER_OPTIMAL_RANGE&&(k>f.TOWER_FALLOFF_RANGE&&(k=f.TOWER_FALLOFF_RANGE),l-=l*f.TOWER_FALLOFF*(k-f.TOWER_OPTIMAL_RANGE)/(f.TOWER_FALLOFF_RANGE-f.TOWER_OPTIMAL_RANGE)),l=Math.floor(l),l&&(j.hits+=l,j.hits>j.hitsMax&&(j.hits=j.hitsMax),e.update(j,{hits:j.hits}),a.energy-=f.TOWER_ENERGY_COST,a.actionLog.repair={x:j.x,y:j.y},e.update(a,{energy:a.energy}),i.inc(\"energyConstruction\",a.user,f.TOWER_ENERGY_COST))}}}},{\"../../../utils\":148,lodash:60}],144:[function(a,b,c){\"use strict\";var d=a(\"lodash\"),e=a(\"../../../utils\"),f=e.getDriver();f.constants,a(\"../movement\");b.exports=function(a,b,c,e,f,g,h){a&&\"tower\"==a.type&&(d.isEqual(a._actionLog,a.actionLog)||e.update(a,{actionLog:a.actionLog}))}},{\"../../../utils\":148,\"../movement\":114,lodash:60}],145:[function(a,b,c){\"use strict\";var d=(a(\"lodash\"),a(\"../../../utils\")),e=d.getDriver();e.constants;b.exports=function(a,b,c,d,e,f,g){if(\"tower\"==a.type&&!(a.energy<b.amount||b.amount<0)){var h=c[b.id];if(h&&\"creep\"==h.type&&!(Math.abs(h.x-a.x)>1||Math.abs(h.y-a.y)>1)&&h.energy!=h.energyCapacity){var i=b.amount;h.energy+i>h.energyCapacity&&(i=h.energyCapacity-h.energy),h.energy+=i,a.energy-=i,e.update(a,{energy:a.energy}),e.update(h,{energy:h.energy})}}}},{\"../../../utils\":148,lodash:60}],146:[function(a,b,c){\"use strict\";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var e=a(\"q\"),f=a(\"lodash\"),g=a(\"../utils\"),h=g.getDriver(),i=h.constants;b.exports.execute=function(a,b,c,j){function k(a,c,e,h,k,l){if(l=l||{},!a||!c||!k)return!1;if(a.user&&(!a[e]||a[e]<h))return!1;if(c.user){var n=g.calcResources(c),o=Math.max(0,c.energyCapacity-n);h=Math.min(h,o)}if(h>0){var p=g.calcRoomsDistance(a.room,c.room,!0),q=Math.max(0,Math.ceil(h*(Math.log(.1*(p+9))+.1)));return k===a&&(e!=i.RESOURCE_ENERGY&&a.energy<q||e==i.RESOURCE_ENERGY&&a.energy<h+q)||k===c&&c.energy<q?!1:(c.user&&(c[e]=c[e]||0,c[e]+=h,j.update(c,d({},e,c[e]))),j.update(a,d({},e,a[e]-h)),j.update(k,{energy:k.energy-q}),m.insert(f.extend({time:+b,sender:a.user?\"\"+a.user:void 0,recipient:c.user?\"\"+c.user:void 0,resourceType:e,amount:h,from:a.room,to:c.room},l)),!0)}}var l=h.bulkUsersWrite(),m=h.bulkTransactionsWrite(),n=h.bulkUsersMoney(),o=h.bulkUsersResources(),p=h.bulkMarketOrders(),q=f.indexBy(c,\"room\");if(f.filter(c,function(a){return!!a.send}).forEach(function(a){var b=a.send;j.update(a,{send:null}),q[b.targetRoomName]&&q[b.targetRoomName].user&&k(a,q[b.targetRoomName],b.resourceType,b.amount,a,{description:b.description?b.description.replace(/</g,\"&lt;\"):void 0})}),a){var r=f.indexBy(a.users,\"_id\"),s=f.indexBy(a.orders,\"_id\"),t=[],u=[];a.intents.forEach(function(a){var c=r[a.user];a.intents.createOrder&&a.intents.createOrder.forEach(function(d){if(d.price&&d.totalAmount&&(f.contains(i.RESOURCES_ALL,d.resourceType)||d.resourceType==i.SUBSCRIPTION_TOKEN)&&(d.resourceType==i.SUBSCRIPTION_TOKEN||q[d.roomName]&&q[d.roomName].user==a.user)&&!(d.price<=0||d.totalAmount<=0)){var e=g.roundCredits(d.price*d.totalAmount*i.MARKET_FEE);c.money<e||(l.update(c,{money:c.money-e}),p.insert(f.extend({created:b,user:a.user,active:!1,type:d.type==i.ORDER_SELL?i.ORDER_SELL:i.ORDER_BUY,amount:0,remainingAmount:d.totalAmount},d)),n.insert({date:new Date,tick:b,user:a.user,type:\"market.fee\",balance:c.money,change:-e,market:{order:d}}))}}),a.intents.changeOrderPrice&&a.intents.changeOrderPrice.forEach(function(d){var e=s[d.orderId];if(e&&e.user==a.user&&d.newPrice&&!(d.newPrice<=0)){if(d.newPrice>e.price){var f=g.roundCredits((d.newPrice-e.price)*e.remainingAmount*i.MARKET_FEE);if(c.money<f)return;l.update(c,{money:c.money-f}),n.insert({date:new Date,tick:b,user:a.user,type:\"market.fee\",balance:c.money,change:-f,market:{changeOrderPrice:{orderId:d.orderId,oldPrice:e.price,newPrice:d.newPrice}}})}p.update(e,{price:d.newPrice})}}),a.intents.extendOrder&&a.intents.extendOrder.forEach(function(d){var e=s[d.orderId];if(e&&e.user==a.user&&d.addAmount&&!(d.addAmount<=0)){var f=g.roundCredits(e.price*d.addAmount*i.MARKET_FEE);c.money<f||(l.update(c,{money:c.money-f}),n.insert({date:new Date,tick:b,user:a.user,type:\"market.fee\",balance:c.money,change:-f,market:{extendOrder:{orderId:d.orderId,addAmount:d.addAmount}}}),p.update(e,{remainingAmount:e.remainingAmount+d.addAmount,totalAmount:e.totalAmount+d.addAmount}))}}),a.intents.cancelOrder&&a.intents.cancelOrder.forEach(function(b){s[b.orderId]&&s[b.orderId].user==a.user&&(s[b.orderId].remainingAmount=0,s[b.orderId]._cancelled=!0)}),a.intents.deal&&a.intents.deal.forEach(function(b){return b.user=a.user,!s[b.orderId]||b.amount<=0?void 0:s[b.orderId].resourceType==i.SUBSCRIPTION_TOKEN?void u.push(b):void(q[b.targetRoomName]&&q[b.targetRoomName].user==a.user&&t.push(b))})}),t.sort(function(a,b){return g.calcRoomsDistance(a.targetRoomName,s[a.orderId].roomName,!0)-g.calcRoomsDistance(b.targetRoomName,s[b.orderId].roomName,!0)}),t.forEach(function(a){var c,d,e=s[a.orderId],f=q[e.roomName],h=q[a.targetRoomName];e.type==i.ORDER_SELL?(c=h,d=f):(d=h,c=f);var j=Math.min(a.amount,e.remainingAmount);if(d.user&&(j=Math.min(j,d[e.resourceType]||0)),c.user){var m=g.calcResources(c),o=Math.max(0,c.energyCapacity-m);j=Math.min(j,o)}if(j>0){var t=g.roundCredits(j*e.price);(!c.user||(t=Math.min(t,r[c.user].money||0),j=Math.floor(t/e.price),t=g.roundCredits(j*e.price),j))&&k(d,c,e.resourceType,j,h,{order:{id:\"\"+e._id,type:e.type,price:e.price}})&&(d.user&&(l.update(r[d.user],{money:(r[d.user].money||0)+t}),n.insert({date:new Date,tick:b,user:d.user,type:\"market.sell\",balance:r[d.user].money,change:t,market:{resourceType:e.resourceType,roomName:e.roomName,targetRoomName:a.targetRoomName,price:e.price,npc:!c.user,amount:j}})),c.user&&(l.update(r[c.user],{money:(r[c.user].money||0)-t}),n.insert({date:new Date,tick:b,user:c.user,type:\"market.buy\",balance:r[c.user].money,change:-t,market:{resourceType:e.resourceType,roomName:e.roomName,targetRoomName:a.targetRoomName,price:e.price,npc:!d.user,amount:j}})),p.update(e,{amount:e.amount-j,remainingAmount:e.remainingAmount-j}))}}),u=f.shuffle(u),u.forEach(function(a){var c,e,f=s[a.orderId],h=\"subscriptionTokens\";if(f.type==i.ORDER_SELL?(c=r[a.user],e=r[f.user]):(e=r[a.user],c=r[f.user]),e&&c){var j=Math.min(a.amount,f.remainingAmount);if(e.user&&(j=Math.min(j,e[h]||0)),j){var k=g.roundCredits(j*f.price);c.user&&(!c.money||c.money<k)||(l.update(e,d({money:(e.money||0)+k},h,(e[h]||0)-j)),n.insert({date:new Date,tick:b,user:\"\"+e._id,type:\"market.sell\",balance:e.money,change:k,market:{resourceType:f.resourceType,price:f.price,amount:j}}),o.insert({date:new Date,resourceType:f.resourceType,user:\"\"+e._id,change:-j,balance:e[h],marketOrderId:\"\"+f._id,market:{orderId:\"\"+f._id,anotherUser:\"\"+c._id}}),l.update(c,d({money:(c.money||0)-k},h,(c[h]||0)+j)),n.insert({date:new Date,tick:b,user:\"\"+c._id,type:\"market.buy\",balance:c.money,change:-k,market:{resourceType:f.resourceType,price:f.price,amount:j}}),p.update(f,{amount:f.amount-j,remainingAmount:f.remainingAmount-j}),o.insert({date:new Date,resourceType:f.resourceType,user:\"\"+c._id,change:j,balance:c[h],market:{orderId:\"\"+f._id,anotherUser:\"\"+e._id}}))}}}),a.orders.forEach(function(a){if(a._cancelled)return void p.remove(a._id);if(a.user){var b=q[a.roomName];if(a.type==i.ORDER_SELL){var c=a.resourceType==i.SUBSCRIPTION_TOKEN?r[a.user].subscriptionTokens||0:b&&b.user==a.user?b[a.resourceType]||0:0;if(c=Math.min(c,a.remainingAmount),a.active){if(!c)return void p.update(a,{active:!1,amount:0});a.amount!=c&&p.update(a,{amount:c})}else c>0&&p.update(a,{active:!0,amount:c})}if(a.type==i.ORDER_BUY){var d=r[a.user],e=d.money||0,f=a.resourceType==i.SUBSCRIPTION_TOKEN||!!b&&b.user==a.user,h=Math.min(Math.floor(e/a.price),a.remainingAmount);if(b&&b.user){var j=g.calcResources(b),k=Math.max(0,b.energyCapacity-j);h=Math.min(h,k)}var l=f&&h>0;(a.amount!=h||a.active!=l)&&p.update(a,{amount:h,active:l})}}})}return e.all([l.execute(),p.execute(),n.execute(),m.execute(),o.execute(),h.clearMarketIntents()])}},{\"../utils\":148,lodash:60,q:61}],147:[function(a,b,c){\"use strict\";function d(a,b){function c(c){g.config.emit(\"runnerLoopStage\",\"saveResultStart\",c),c.console&&g.sendConsoleMessages(a,c.console);var d=[];return c.memory&&d.push(g.saveUserMemory(a,c.memory,b)),c.intents&&d.push(g.saveUserIntents(a,c.intents)),e.all(d).then(function(){return g.config.emit(\"runnerLoopStage\",\"saveResultFinish\",c),c.error?e.reject(c.error):void 0})}return g.config.emit(\"runnerLoopStage\",\"runUser\",a,b),g.makeRuntime(a,b).then(c,c)}var e=a(\"q\"),f=(a(\"lodash\"),a(\"util\"),a(\"./utils\")),g=f.getDriver();g.constants;g.connect(\"runner\").then(function(){return g.queue.create(\"users\",\"read\")}).then(function(a){function b(){var a,e;g.config.emit(\"runnerLoopStage\",\"start\"),c.fetch().then(function(b){a=e=b;var c,f=a.match(/^SourceKeeper:(.*)$/);return f&&(a=\"3\",c=f[1]),f=a.match(/^Invader:(.*)$/),f&&(a=\"2\",c=f[1]),d(a,c)})[\"catch\"](function(b){return g.sendConsoleError(a,b)}).then(function(){return c.markDone(e)})[\"catch\"](function(a){})[\"finally\"](function(){g.config.emit(\"runnerLoopStage\",\"finish\",a),setTimeout(b,0)})}var c=a;b()})[\"catch\"](function(a){}),\"undefined\"==typeof self&&setInterval(function(){var a=e.getUnhandledReasons();a.forEach(function(a){}),e.resetUnhandledRejections()},1e3)},{\"./utils\":148,lodash:60,q:61,util:153}],148:[function(require,module,exports){(function(process){\"use strict\";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var _slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h[\"return\"]&&h[\"return\"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),_typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&\"function\"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?\"symbol\":typeof a},_=require(\"lodash\"),driver,C,offsetsByDirection;exports.getDriver=function(){var a;return driver=require(\"undefined\"!=typeof process&&process.env.DRIVER_MODULE?process.env.DRIVER_MODULE:\"./core/index\"),C=driver.constants,a={},_defineProperty(a,C.TOP,[0,-1]),_defineProperty(a,C.TOP_RIGHT,[1,-1]),_defineProperty(a,C.RIGHT,[1,0]),_defineProperty(a,C.BOTTOM_RIGHT,[1,1]),_defineProperty(a,C.BOTTOM,[0,1]),_defineProperty(a,C.BOTTOM_LEFT,[-1,1]),_defineProperty(a,C.LEFT,[-1,0]),_defineProperty(a,C.TOP_LEFT,[-1,-1]),offsetsByDirection=a,driver},exports.fetchXYArguments=function(a,b,c){var d,e,f;if(_.isUndefined(b)||!_.isNumber(b)){if(!_.isObject(a))return[void 0,void 0,void 0];a instanceof c.RoomPosition&&(d=a.x,e=a.y,f=a.roomName),a.pos&&a.pos instanceof c.RoomPosition&&(d=a.pos.x,e=a.pos.y,f=a.pos.roomName)}else d=a,e=b;return _.isNaN(d)&&(d=void 0),_.isNaN(e)&&(e=void 0),[d,e,f]},exports.getDirection=function(a,b){var c=Math.abs(a),d=Math.abs(b);return c>2*d?a>0?C.RIGHT:C.LEFT:d>2*c?b>0?C.BOTTOM:C.TOP:a>0&&b>0?C.BOTTOM_RIGHT:a>0&&0>b?C.TOP_RIGHT:0>a&&b>0?C.BOTTOM_LEFT:0>a&&0>b?C.TOP_LEFT:void 0},exports.getOffsetsByDirection=function(a){if(!offsetsByDirection[a])try{throw new Error}catch(b){}return offsetsByDirection[a]},exports.calcCreepCost=function(a){var b=0;return a.forEach(function(a){b+=_.isObject(a)?C.BODYPART_COST[a.type]:C.BODYPART_COST[a]}),b},exports.checkConstructionSite=function(a,b,c,d){var e;if(\"road\"==b||1!=c&&48!=c&&1!=d&&48!=d||(1==c&&(e=[[0,d-1],[0,d],[0,d+1]]),48==c&&(e=[[49,d-1],[49,d],[49,d+1]]),1==d&&(e=[[c-1,0],[c,0],[c+1,0]]),48==d&&(e=[[c-1,49],[c,49],[c+1,49]])),_.isString(a)||a instanceof Uint8Array){if(e)for(var f in e)if(!exports.checkTerrain(a,e[f][0],e[f][1],C.TERRAIN_MASK_WALL))return!1;return\"extractor\"==b?!0:exports.checkTerrain(a,c,d,C.TERRAIN_MASK_WALL)?!1:!0}if(a&&_.isArray(a[0])&&_.isString(a[0][0])){if(e)for(var f in e)if(!(a[e[f][1]][e[f][0]]&C.TERRAIN_MASK_WALL))return!1;return\"extractor\"==b?!0:a[d][c]&C.TERRAIN_MASK_WALL?!1:!0}return _.any(a,{x:c,y:d,type:b})?!1:_.any(a,{x:c,y:d,type:\"constructionSite\"})?!1:\"extractor\"==b?_.any(a,{x:c,y:d,type:\"mineral\"})&&!_.any(a,{x:c,y:d,type:\"extractor\"}):\"rampart\"!=b&&\"road\"!=b&&_.any(a,function(a){return a.x==c&&a.y==d&&\"rampart\"!=a.type&&\"road\"!=a.type&&C.CONSTRUCTION_COST[a.type]})?!1:0>=c||0>=d||c>=49||d>=49?!1:!0},exports.getDiff=function(a,b){function c(a){var b={};return _.forEach(a,function(a){return b[a._id]=a}),b}var d={},e=c(a),f=c(b);return _.forEach(a,function(a){if(f[a._id]){var b=f[a._id],c=d[a._id]={};for(var e in a)if(\"_id\"!=e)if(_.isUndefined(b[e]))c[e]=null;else if(_typeof(a[e])!=_typeof(b[e])||a[e]&&!b[e])c[e]=b[e];else if(_.isObject(a[e])){c[e]={};for(var g in a[e])_.isEqual(a[e][g],b[e][g])||(c[e][g]=b[e][g]);for(var g in b[e])_.isUndefined(a[e][g])&&(c[e][g]=b[e][g]);_.size(c[e])||delete d[a._id][e]}else _.isEqual(a[e],b[e])||(c[e]=b[e]);for(var e in b)_.isUndefined(a[e])&&(c[e]=b[e]);_.size(c)||delete d[a._id]}else d[a._id]=null}),_.forEach(b,function(a){e[a._id]||(d[a._id]=a)}),d},exports.encodeTerrain=function(a){for(var b=\"\",c=0;50>c;c++)for(var d=0;50>d;d++){var e=_.filter(a,{x:d,y:c}),f=0;_.any(e,{type:\"wall\"})&&(f|=C.TERRAIN_MASK_WALL),_.any(e,{type:\"swamp\"})&&(f|=C.TERRAIN_MASK_SWAMP),b+=f}return b},exports.decodeTerrain=function(a){var b=[];for(var c in a)if(\"terrain\"==a[c].type)for(var d=0;50>d;d++)for(var e=0;50>e;e++){var f=a[c].terrain.charAt(50*d+e);f&C.TERRAIN_MASK_WALL&&b.push({room:a[c].room,x:e,y:d,type:\"wall\"}),f&C.TERRAIN_MASK_SWAMP&&b.push({room:a[c].room,x:e,y:d,type:\"swamp\"})}return b},exports.decodeTerrainByRoom=function(a){var b={spatial:{}};for(var c in a)if(\"terrain\"==a[c].type){b[a[c].room]=b[a[c].room]||[],b.spatial[a[c].room]=new Array(50);for(var d=0;50>d;d++){b.spatial[a[c].room][d]=new Array(50);for(var e=0;50>e;e++){var f=a[c].terrain.charAt(50*d+e);b.spatial[a[c].room][d][e]=f}}}return b},exports.checkTerrain=function(a,b,c,d){var e=a instanceof Uint8Array?a[50*c+b]:Number(a.charAt(50*c+b));return(e&d)>0},exports.checkControllerAvailability=function(a,b,c,d){var e=0;_.isObject(c)&&c.level&&(c.user||c.owner)&&(e=c.level),_.isNumber(c)&&(e=c),d=d||0;var f=_(b).filter(function(b){return b.type==a||\"constructionSite\"==b.type&&b.structureType==a}).size(),g=C.CONTROLLER_STRUCTURES[a][e]+d;return g>f},exports.getRoomNameFromXY=function(a,b){return a=0>a?\"W\"+(-a-1):\"E\"+a,b=0>b?\"N\"+(-b-1):\"S\"+b,\"\"+a+b},exports.roomNameToXY=function(a){a=a.toUpperCase();var b=a.match(/^(\\w)(\\d+)(\\w)(\\d+)$/);if(!b)return[void 0,void 0];var c=_slicedToArray(b,5),d=c[1],e=c[2],f=c[3],g=c[4];return e=\"W\"==d?-e-1:+e,g=\"N\"==f?-g-1:+g,[e,g]},exports.comparatorDistance=function(a){return a.pos&&(a=a.pos),function(b,c){b.pos&&(b=b.pos),c.pos&&(c=c.pos);var d=Math.max(Math.abs(b.x-a.x),Math.abs(b.y-a.y)),e=Math.max(Math.abs(c.x-a.x),Math.abs(c.y-a.y));return d-e}},exports.storeIntents=function(a,b,c){var d={},e=exports.getDriver();for(var f in b)if(\"notify\"!=f)if(\"room\"!=f)if(\"market\"!=f){var g=c.userObjects[f]||c.roomObjects[f];if(g){var h=b[f];d[g.room]=d[g.room]||{};var i=d[g.room][f]={};if(h.transfer&&(i.transfer={id:\"\"+h.transfer.id,amount:parseInt(h.transfer.amount),resourceType:\"\"+h.transfer.resourceType}),f in c.userObjects){h.move&&(i.move={direction:parseInt(h.move.direction)}),h.harvest&&(i.harvest={id:\"\"+h.harvest.id}),h.attack&&(i.attack={id:\"\"+h.attack.id,x:parseInt(h.attack.x),y:parseInt(h.attack.y)}),h.rangedAttack&&(i.rangedAttack={id:\"\"+h.rangedAttack.id}),h.rangedMassAttack&&(i.rangedMassAttack={}),h.heal&&(i.heal={id:\"\"+h.heal.id,x:parseInt(h.heal.x),y:parseInt(h.heal.y)}),h.rangedHeal&&(i.rangedHeal={id:\"\"+h.rangedHeal.id}),h.repair&&(i.repair={id:\"\"+h.repair.id,x:parseInt(h.repair.x),y:parseInt(h.repair.y)}),h.build&&(i.build={id:\"\"+h.build.id,x:parseInt(h.build.x),y:parseInt(h.build.y)}),h.transferEnergy&&(i.transferEnergy={id:\"\"+h.transferEnergy.id,amount:parseInt(h.transferEnergy.amount)}),h.drop&&(i.drop={amount:parseInt(h.drop.amount),resourceType:\"\"+h.drop.resourceType}),h.pickup&&(i.pickup={id:\"\"+h.pickup.id}),h.createCreep&&(i.createCreep={name:\"\"+h.createCreep.name,body:_.filter(h.createCreep.body,function(a){return _.contains(C.BODYPARTS_ALL,a)})}),h.renewCreep&&(i.renewCreep={id:\"\"+h.renewCreep.id}),h.recycleCreep&&(i.recycleCreep={id:\"\"+h.recycleCreep.id}),h.suicide&&(i.suicide={}),h.remove&&(i.remove={}),h.unclaim&&(i.unclaim={}),h.say&&(i.say={message:h.say.message.substring(0,10),isPublic:!!h.say.isPublic}),h.claimController&&(i.claimController={id:\"\"+h.claimController.id}),h.attackController&&(i.attackController={id:\"\"+h.attackController.id}),h.unclaimController&&(i.unclaimController={id:\"\"+h.unclaimController.id}),h.upgradeController&&(i.upgradeController={id:\"\"+h.upgradeController.id}),h.reserveController&&(i.reserveController={id:\"\"+h.reserveController.id\n";
 d += "}),h.notifyWhenAttacked&&(i.notifyWhenAttacked={enabled:!!h.notifyWhenAttacked.enabled}),h.setPosition&&(i.setPosition={x:parseInt(h.setPosition.x),y:parseInt(h.setPosition.y),roomName:\"\"+h.setPosition.roomName}),h.setColor&&(i.setColor={color:\"\"+h.setColor.color,secondaryColor:\"\"+h.setColor.secondaryColor}),h.destroy&&(i.destroy={}),h.observeRoom&&(i.observeRoom={roomName:\"\"+h.observeRoom.roomName}),h.processPower&&(i.processPower={}),h.dismantle&&(i.dismantle={id:\"\"+h.dismantle.id}),h.runReaction&&(i.runReaction={lab1:\"\"+h.runReaction.lab1,lab2:\"\"+h.runReaction.lab2}),h.boostCreep&&(i.boostCreep={id:\"\"+h.boostCreep.id,bodyPartsCount:parseInt(h.boostCreep.bodyPartsCount)}),h.send&&(i.send={targetRoomName:\"\"+h.send.targetRoomName,resourceType:\"\"+h.send.resourceType,amount:parseInt(h.send.amount),description:(\"\"+(h.send.description||\"\")).substring(0,100)}),h.launchNuke&&(i.launchNuke={roomName:\"\"+h.launchNuke.roomName,x:parseInt(h.launchNuke.x),y:parseInt(h.launchNuke.y)}),h.setPublic&&(i.setPublic={isPublic:!!h.setPublic.isPublic}),h.withdraw&&(i.withdraw={id:\"\"+h.withdraw.id,amount:parseInt(h.withdraw.amount),resourceType:\"\"+h.withdraw.resourceType}),h.activateSafeMode&&(i.activateSafeMode={}),h.generateSafeMode&&(i.generateSafeMode={id:\"\"+h.generateSafeMode.id});for(var j in e.config.customIntentTypes)if(h[j]){i[j]={};for(var k in e.config.customIntentTypes[j])switch(e.config.customIntentTypes[j][k]){case\"string\":i[j][k]=\"\"+h[j][k];break;case\"number\":i[j][k]=+h[j][k];break;case\"boolean\":i[j][k]=!!h[j][k]}}}}}else{var l=b.market;l.createOrder&&_.forEach(l.createOrder,function(a){d.market=d.market||{},d.market.createOrder=d.market.createOrder||[],d.market.createOrder.push({type:\"\"+a.type,resourceType:\"\"+a.resourceType,price:exports.roundCredits(a.price),totalAmount:parseInt(a.totalAmount),roomName:a.roomName?\"\"+a.roomName:void 0})}),l.cancelOrder&&_.forEach(l.cancelOrder,function(a){d.market=d.market||{},d.market.cancelOrder=d.market.cancelOrder||[],d.market.cancelOrder.push({orderId:\"\"+a.orderId})}),l.changeOrderPrice&&_.forEach(l.changeOrderPrice,function(a){d.market=d.market||{},d.market.changeOrderPrice=d.market.changeOrderPrice||[],d.market.changeOrderPrice.push({orderId:\"\"+a.orderId,newPrice:exports.roundCredits(a.newPrice)})}),l.extendOrder&&_.forEach(l.extendOrder,function(a){d.market=d.market||{},d.market.extendOrder=d.market.extendOrder||[],d.market.extendOrder.push({orderId:\"\"+a.orderId,addAmount:parseInt(a.addAmount)})}),l.deal&&_.forEach(l.deal,function(a){d.market=d.market||{},d.market.deal=d.market.deal||[],d.market.deal.push({orderId:\"\"+a.orderId,amount:parseInt(a.amount),targetRoomName:\"\"+a.targetRoomName})})}else{var m=b.room;m.createFlag&&_.forEach(m.createFlag,function(b){d[b.roomName]=d[b.roomName]||{};var c=d[b.roomName].room=d[b.roomName].room||{};c.createFlag=c.createFlag||[],c.createFlag.push({x:parseInt(b.x),y:parseInt(b.y),name:\"\"+b.name,color:+b.color,secondaryColor:+b.secondaryColor,roomName:b.roomName,user:a})}),m.createConstructionSite&&_.forEach(m.createConstructionSite,function(b){d[b.roomName]=d[b.roomName]||{};var c=d[b.roomName].room=d[b.roomName].room||{};c.createConstructionSite=c.createConstructionSite||[],c.createConstructionSite.push({x:parseInt(b.x),y:parseInt(b.y),structureType:\"\"+b.structureType,name:\"\"+b.name,roomName:\"\"+b.roomName,user:a})}),m.destroyStructure&&_.forEach(m.destroyStructure,function(b){d[b.roomName]=d[b.roomName]||{};var c=d[b.roomName].room=d[b.roomName].room||{};c.destroyStructure=c.destroyStructure||[],c.destroyStructure.push({roomName:\"\"+b.roomName,id:\"\"+b.id,user:a})}),m.removeFlag&&_.forEach(m.removeFlag,function(b){d[b.roomName]=d[b.roomName]||{};var c=d[b.roomName].room=d[b.roomName].room||{};c.removeFlag=c.removeFlag||[],c.removeFlag.push({roomName:\"\"+b.roomName,name:\"\"+b.name,user:a})})}else d.notify=[],_.isArray(b.notify)&&b.notify.forEach(function(a){d.notify.push({message:(\"\"+a.message).substring(0,1e3),groupInterval:+a.groupInterval})});return d},exports.sendAttackingNotification=function(a,b){var c,d=exports.getDriver();c=\"creep\"==a.type?\"creep \"+a.name:\"spawn\"==a.type?\"spawn \"+a.name:a.type+\" #\"+a._id;var e=a.user?a.user:b?b.user:null;e&&d.sendNotification(e,\"Your \"+c+\" in room \"+a.room+\" is under attack!\")},exports.checkStructureAgainstController=function(a,b,c){if(!a.user)return!0;if(!c||c.level<1||a.user&&c.user!=a.user)return!1;if(1==C.CONTROLLER_STRUCTURES[a.type][8])return 0!=C.CONTROLLER_STRUCTURES[a.type][c.level];var d=_.filter(b,{type:a.type,user:a.user});return d.length>C.CONTROLLER_STRUCTURES[a.type][c.level]&&(d.sort(exports.comparatorDistance(c)),d=_.take(d,C.CONTROLLER_STRUCTURES[a.type][c.level]),!_.contains(d,a))?!1:!0},exports.defineGameObjectProperties=function(obj,dataFn,properties){var propertiesInfo={};for(var name in properties)eval(\"\\n            propertiesInfo['\"+name+\"'] = {\\n                enumerable: true,\\n                get() {\\n                    if(!this['_\"+name+\"']) {\\n                        this['_\"+name+\"'] = properties['\"+name+\"'](dataFn(this.id));\\n                    }\\n                    return this['_\"+name+\"'];\\n                }\\n            }\");Object.defineProperties(obj,propertiesInfo),obj.toJSON=function(){var a={};for(var b in this)\"_\"==b[0]||_.contains([\"toJSON\",\"toString\"],b)||(a[b]=this[b]);return a}},exports.serializePath=function(a){if(!_.isArray(a))throw new Error(\"path is not an array\");var b=\"\";if(!a.length)return b;if(a[0].x<0||a[0].y<0)throw new Error(\"path coordinates cannot be negative\");b+=a[0].x>9?a[0].x:\"0\"+a[0].x,b+=a[0].y>9?a[0].y:\"0\"+a[0].y;for(var c=0;c<a.length;c++)b+=a[c].direction;return b},exports.deserializePath=function(a){if(!_.isString(a))throw new Error(\"`path` is not a string\");var b=[];if(!a.length)return b;var c,d,e,f,g;if(c=parseInt(a.substring(0,2)),d=parseInt(a.substring(2,4)),_.isNaN(c)||_.isNaN(d))throw new Error(\"`path` is not a valid serialized path string\");for(var h=4;h<a.length;h++){if(e=parseInt(a.charAt(h)),!offsetsByDirection[e])throw new Error(\"`path` is not a valid serialized path string\");f=offsetsByDirection[e][0],g=offsetsByDirection[e][1],h>4&&(c+=f,d+=g),b.push({x:c,y:d,dx:f,dy:g,direction:e})}return b},exports.calcResources=function(a){return _.sum(C.RESOURCES_ALL,function(b){return\"object\"==_typeof(a[b])?a[b].amount:a[b]||0})},exports.calcBodyEffectiveness=function(a,b,c,d,e){var f=0;return a.forEach(function(a){if((a.hits||!e&&a._oldHits)&&a.type==b){var g=d;a.boost&&C.BOOSTS[b][a.boost]&&C.BOOSTS[b][a.boost][c]&&(g*=C.BOOSTS[b][a.boost][c]),f+=g}}),f},exports.roundCredits=function(a){return Math.ceil((100*+a).toFixed(0))/100},exports.calcRoomsDistance=function(a,b,c){var d=exports.roomNameToXY(a),e=_slicedToArray(d,2),f=e[0],g=e[1],h=exports.roomNameToXY(b),i=_slicedToArray(h,2),j=i[0],k=i[1],l=Math.abs(j-f),m=Math.abs(k-g);return c&&(l=Math.min(C.WORLD_WIDTH-l,l),m=Math.min(C.WORLD_HEIGHT-m,m)),Math.max(l,m)}}).call(this,require(\"_process\"))},{\"./core/index\":6,_process:151,lodash:60}],149:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return\"function\"==typeof a}function f(a){return\"number\"==typeof a}function g(a){return\"object\"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError(\"n must be a positive number\");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),\"error\"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified \"error\" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError(\"listener must be a function\");if(this._events||(this._events={}),this._events.newListener&&this.emit(\"newListener\",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,\"function\"==typeof console.trace)}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError(\"listener must be a function\");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError(\"listener must be a function\");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit(\"removeListener\",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit(\"removeListener\",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)\"removeListener\"!==b&&this.removeAllListeners(b);return this.removeAllListeners(\"removeListener\"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],150:[function(a,b,c){\"function\"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],151:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h&&h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title=\"browser\",i.browser=!0,i.env={},i.argv=[],i.version=\"\",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error(\"process.binding is not supported\")},i.cwd=function(){return\"/\"},i.chdir=function(a){throw new Error(\"process.chdir is not supported\")},i.umask=function(){return 0}},{}],152:[function(a,b,c){b.exports=function(a){return a&&\"object\"==typeof a&&\"function\"==typeof a.copy&&\"function\"==typeof a.fill&&\"function\"==typeof a.readUInt8}},{}],153:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?\"[\"+e.colors[c][0]+\"m\"+a+\"[\"+e.colors[c][1]+\"m\":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf(\"message\")>=0||g.indexOf(\"description\")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?\": \"+b.name:\"\";return a.stylize(\"[Function\"+q+\"]\",\"special\")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),\"regexp\");if(y(b))return a.stylize(Date.prototype.toString.call(b),\"date\");if(z(b))return k(b)}var r=\"\",s=!1,u=[\"{\",\"}\"];if(o(b)&&(s=!0,u=[\"[\",\"]\"]),A(b)){var v=b.name?\": \"+b.name:\"\";r=\" [Function\"+v+\"]\"}if(w(b)&&(r=\" \"+RegExp.prototype.toString.call(b)),y(b)&&(r=\" \"+Date.prototype.toUTCString.call(b)),z(b)&&(r=\" \"+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),\"regexp\"):a.stylize(\"[Object]\",\"special\");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize(\"undefined\",\"undefined\");if(t(b)){var c=\"'\"+JSON.stringify(b).replace(/^\"|\"$/g,\"\").replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"')+\"'\";return a.stylize(c,\"string\")}return s(b)?a.stylize(\"\"+b,\"number\"):p(b)?a.stylize(\"\"+b,\"boolean\"):q(b)?a.stylize(\"null\",\"null\"):void 0}function k(a){return\"[\"+Error.prototype.toString.call(a)+\"]\"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)D(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push(\"\");return e.forEach(function(e){e.match(/^\\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize(\"[Getter/Setter]\",\"special\"):a.stylize(\"[Getter]\",\"special\"):j.set&&(h=a.stylize(\"[Setter]\",\"special\")),D(d,e)||(g=\"[\"+e+\"]\"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf(\"\\n\")>-1&&(h=f?h.split(\"\\n\").map(function(a){return\"  \"+a}).join(\"\\n\").substr(2):\"\\n\"+h.split(\"\\n\").map(function(a){return\"   \"+a}).join(\"\\n\"))):h=a.stylize(\"[Circular]\",\"special\")),v(g)){if(f&&e.match(/^\\d+$/))return h;g=JSON.stringify(\"\"+e),g.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,\"name\")):(g=g.replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"').replace(/(^\"|\"$)/g,\"'\"),g=a.stylize(g,\"string\"))}return g+\": \"+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf(\"\\n\")>=0&&d++,a+b.replace(/\\u001b\\[\\d\\d?m/g,\"\").length+1},0);return e>60?c[0]+(\"\"===b?\"\":b+\"\\n \")+\" \"+a.join(\",\\n  \")+\" \"+c[1]:c[0]+b+\" \"+a.join(\", \")+\" \"+c[1]}function o(a){return Array.isArray(a)}function p(a){return\"boolean\"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return\"number\"==typeof a}function t(a){return\"string\"==typeof a}function u(a){return\"symbol\"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&\"[object RegExp]\"===C(a)}function x(a){return\"object\"==typeof a&&null!==a}function y(a){return x(a)&&\"[object Date]\"===C(a)}function z(a){return x(a)&&(\"[object Error]\"===C(a)||a instanceof Error)}function A(a){return\"function\"==typeof a}function B(a){return null===a||\"boolean\"==typeof a||\"number\"==typeof a||\"string\"==typeof a||\"symbol\"==typeof a||\"undefined\"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var E=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(\" \")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(E,function(a){if(\"%%\"===a)return\"%\";if(c>=f)return a;switch(a){case\"%s\":return String(d[c++]);case\"%d\":return Number(d[c++]);case\"%j\":try{return JSON.stringify(d[c++])}catch(b){return\"[Circular]\"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?\" \"+h:\" \"+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation,g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var F,G={};c.debuglog=function(a){if(v(F)&&(F=b.env.NODE_DEBUG||\"\"),a=a.toUpperCase(),!G[a])if(new RegExp(\"\\\\b\"+a+\"\\\\b\",\"i\").test(F)){b.pid;G[a]=function(){c.format.apply(c,arguments)}}else G[a]=function(){};return G[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:\"cyan\",number:\"yellow\",\"boolean\":\"yellow\",undefined:\"grey\",\"null\":\"bold\",string:\"green\",date:\"magenta\",regexp:\"red\"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a(\"./support/isBuffer\");c.log=function(){},c.inherits=a(\"inherits\"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"./support/isBuffer\":152,_process:151,inherits:150}],154:[function(a,b,c){var d=[];self.onmessage=function(b){if(\"launch\"==b.data.type){switch(b.data.name){case\"main\":a(\"../.engine/main.js\");break;case\"runner\":a(\"../.engine/runner.js\");break;case\"processor\":a(\"../.engine/processor.js\");break;case\"runtime\":a(\"../.engine/core/runtime.js\")}d.forEach(function(a){self.onmessage(a)})}else d.push(b)}},{\"../.engine/core/runtime.js\":14,\"../.engine/main.js\":35,\"../.engine/processor.js\":62,\"../.engine/runner.js\":147}]},{},[154]);"; return (window.URL || window.webkitURL || window).createObjectURL(new Blob([d], {type: 'text/javascript'})); })()